import{f as h,a,c as M,s as A,d as Q,i as D,t as et}from"../chunks/rzUyzf2y.js";import{e as g,r as f,d as j,t as I,f as p,p as T,u as Z,s as O,b as X,g as r,a as C,c as F,y as K,aK as ot,br as bt}from"../chunks/AsQG98fS.js";import{i as E}from"../chunks/DZKExFZC.js";import{e as nt,i as vt}from"../chunks/Cztbr3Ea.js";import{c as ht,a as ct}from"../chunks/CS0aOiUg.js";import{n as V}from"../chunks/tv6-RHC_.js";import{c as xt}from"../chunks/BtQ8qZNz.js";import{c as q}from"../chunks/Dt3q2Svx.js";import{U as L}from"../chunks/C-S0GgRw.js";import{E as at}from"../chunks/cqXEgdME.js";import{n as Y}from"../chunks/HXYFdwja.js";import{s as J}from"../chunks/DNVUPZsi.js";import{T as yt}from"../chunks/2VdFane9.js";import{p as kt}from"../chunks/w-gpJwMz.js";import{U as wt}from"../chunks/DdUskozk.js";import{F as pt}from"../chunks/Cp2_visM.js";function W(y,t=100){return y?y.length>t?y.slice(0,t)+"...":y:""}var Nt=h("<div> </div>"),Pt=h('<div class="flex gap-3 p-4 hover:bg-muted/50 transition-colors border-b border-border"><div class="flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1 flex-wrap"><!> <span class="text-sm text-muted-foreground"><!></span> <!></div> <!> <!></div></div>');function U(y,t){var i=Pt(),k=g(i),_=g(k);J(_,()=>t.avatar),f(k);var w=j(k,2),u=g(w),v=g(u);{var b=o=>{var d=M(),N=p(d);J(N,()=>t.icon),a(o,d)};E(v,o=>{t.icon&&o(b)})}var c=j(v,2),n=g(c);J(n,()=>t.message),f(c);var e=j(c,2);{var s=o=>{yt(o,{get timestamp(){return t.timestamp},class:"text-sm text-muted-foreground ml-auto"})};E(e,o=>{t.timestamp&&o(s)})}f(u);var l=j(u,2);{var x=o=>{var d=M(),N=p(d);J(N,()=>t.content),a(o,d)};E(l,o=>{t.content&&o(x)})}var P=j(l,2);{var m=o=>{var d=Nt(),N=g(d,!0);f(d),I(()=>{ct(d,1,`text-sm text-muted-foreground bg-muted/30 rounded p-2 border-l-2 border-${t.previewColor??""}/50 break-words`),A(N,t.preview)}),a(o,d)};E(P,o=>{t.preview&&o(m)})}f(w),f(i),I(()=>ht(i,"data-testid",t.testId)),a(y,i)}var Ct=h('<button type="button" class="flex-shrink-0"><!></button>'),Et=D('<svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>'),jt=h('<button type="button" class="font-semibold hover:underline text-foreground"> </button> replied to your note',1),Mt=h('<div class="text-foreground leading-relaxed mb-2 break-words"><!></div>');function zt(y,t){T(t,!0);let i=X(null);Z(()=>{t.event.author.fetchProfile().then(u=>{O(i,u,!0)})});const k=C(()=>r(i)?.name||r(i)?.displayName||"Anonymous");function _(){Y(t.event.pubkey)}const w=C(()=>W(t.targetEvent?.content??""));U(y,{get timestamp(){return t.event.created_at},get preview(){return r(w)},previewColor:"primary",avatar:n=>{var e=Ct();e.__click=_;var s=g(e);q(s,()=>L.Root,(l,x)=>{x(l,{get ndk(){return V},get pubkey(){return t.event.pubkey},children:(P,m)=>{var o=M(),d=p(o);q(d,()=>L.Avatar,(N,z)=>{z(N,{class:"w-10 h-10 cursor-pointer hover:opacity-80 transition-opacity"})}),a(P,o)},$$slots:{default:!0}})}),f(e),a(n,e)},icon:n=>{var e=Et();a(n,e)},message:n=>{var e=jt(),s=p(e);s.__click=_;var l=g(s,!0);f(s),K(),I(()=>A(l,r(k))),a(n,e)},content:n=>{var e=Mt(),s=g(e);at(s,{get ndk(){return V},get content(){return t.event.content},get emojiTags(){return t.event.tags}}),f(e),a(n,e)}}),F()}Q(["click"]);var It=h('<button type="button" class="flex-shrink-0"><!></button>'),Rt=D('<svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path></svg>'),At=h('<button type="button" class="font-semibold hover:underline text-foreground"> </button> mentioned you',1),Vt=h('<div class="text-foreground leading-relaxed break-words"><!></div>');function Bt(y,t){T(t,!0);let i=X(null);Z(()=>{t.event.author.fetchProfile().then(w=>{O(i,w,!0)})});const k=C(()=>r(i)?.name||r(i)?.displayName||"Anonymous");function _(){Y(t.event.pubkey)}U(y,{get timestamp(){return t.event.created_at},avatar:c=>{var n=It();n.__click=_;var e=g(n);q(e,()=>L.Root,(s,l)=>{l(s,{get ndk(){return V},get pubkey(){return t.event.pubkey},children:(x,P)=>{var m=M(),o=p(m);q(o,()=>L.Avatar,(d,N)=>{N(d,{class:"w-10 h-10 cursor-pointer hover:opacity-80 transition-opacity"})}),a(x,m)},$$slots:{default:!0}})}),f(n),a(c,n)},icon:c=>{var n=Rt();a(c,n)},message:c=>{var n=At(),e=p(n);e.__click=_;var s=g(e,!0);f(e),K(),I(()=>A(s,r(k))),a(c,n)},content:c=>{var n=Vt(),e=g(n);at(e,{get ndk(){return V},get content(){return t.event.content},get emojiTags(){return t.event.tags}}),f(n),a(c,n)}}),F()}Q(["click"]);var Tt=h('<button type="button" class="flex-shrink-0"><!></button>'),Ft=D('<svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>'),qt=h('<button type="button" class="font-semibold hover:underline text-foreground"> </button> quoted your note',1),Lt=h('<div class="text-foreground leading-relaxed mb-2 break-words"><!></div>');function Ut(y,t){T(t,!0);let i=X(null);Z(()=>{t.event.author.fetchProfile().then(u=>{O(i,u,!0)})});const k=C(()=>r(i)?.name||r(i)?.displayName||"Anonymous");function _(){Y(t.event.pubkey)}const w=C(()=>W(t.targetEvent?.content??""));U(y,{get timestamp(){return t.event.created_at},get preview(){return r(w)},previewColor:"purple-500",avatar:n=>{var e=Tt();e.__click=_;var s=g(e);q(s,()=>L.Root,(l,x)=>{x(l,{get ndk(){return V},get pubkey(){return t.event.pubkey},children:(P,m)=>{var o=M(),d=p(o);q(d,()=>L.Avatar,(N,z)=>{z(N,{class:"w-10 h-10 cursor-pointer hover:opacity-80 transition-opacity"})}),a(P,o)},$$slots:{default:!0}})}),f(e),a(n,e)},icon:n=>{var e=Ft();a(n,e)},message:n=>{var e=qt(),s=p(e);s.__click=_;var l=g(s,!0);f(s),K(),I(()=>A(l,r(k))),a(n,e)},content:n=>{var e=Lt(),s=g(e);at(s,{get ndk(){return V},get content(){return t.event.content},get emojiTags(){return t.event.tags}}),f(e),a(n,e)}}),F()}Q(["click"]);var Ht=h('<button type="button" class="font-semibold hover:underline text-foreground"><!><!></button>'),St=h('<span class="text-muted-foreground"> </span>'),Qt=h('<span class="inline-flex items-center gap-1 flex-wrap"><!> <!></span>');function rt(y,t){T(t,!0);const i=kt(t,"maxVisible",3,2),k=C(()=>t.pubkeys.slice(0,i())),_=C(()=>Math.max(0,t.pubkeys.length-i()));function w(n,e){e.stopPropagation(),Y(n)}var u=Qt(),v=g(u);nt(v,17,()=>r(k),vt,(n,e,s)=>{var l=Ht();l.__click=o=>w(r(e),o);var x=g(l);q(x,()=>L.Root,(o,d)=>{d(o,{get ndk(){return V},get pubkey(){return r(e)},children:(N,z)=>{var B=M(),R=p(B);q(R,()=>L.Name,(G,$)=>{$(G,{})}),a(N,B)},$$slots:{default:!0}})});var P=j(x);{var m=o=>{var d=et(",");a(o,d)};E(P,o=>{(s<r(k).length-1||r(_)>0)&&o(m)})}f(l),a(n,l)});var b=j(v,2);{var c=n=>{var e=St(),s=g(e);f(e),I(()=>A(s,`and ${r(_)??""} ${r(_)===1?"other":"others"}`)),a(n,e)};E(b,n=>{r(_)>0&&n(c)})}f(u),a(y,u),F()}Q(["click"]);var Dt=h('<div class="flex-shrink-0 w-10 h-10 flex items-center justify-center text-2xl"> </div>'),Zt=D('<svg class="w-4 h-4 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>'),Kt=h('<!> <span class="text-lg mx-1"> </span> to your note',1);function Wt(y,t){T(t,!0),console.log("[ReactionNotification] Rendering:",t.emoji,"reactors:",t.reactors.length,"targetEvent:",!!t.targetEvent),ot(()=>{console.log("[ReactionNotification] Mounted:",t.emoji)});const i=C(()=>t.reactors.map(_=>_.pubkey)),k=C(()=>W(t.targetEvent?.content??""));U(y,{get timestamp(){return t.timestamp},get preview(){return r(k)},previewColor:"red-500",avatar:v=>{var b=Dt(),c=g(b,!0);f(b),I(()=>A(c,t.emoji)),a(v,b)},icon:v=>{var b=Zt();a(v,b)},message:v=>{var b=Kt(),c=p(b);rt(c,{get pubkeys(){return r(i)},maxVisible:2});var n=j(c);n.nodeValue=" reacted ";var e=j(n),s=g(e,!0);f(e),K(),I(()=>A(s,t.emoji)),a(v,b)}}),F()}var Gt=h('<div class="flex-shrink-0 w-10 h-10 flex items-center justify-center"><svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></div>'),Jt=h("<!> ",1);function Ot(y,t){T(t,!0);const i=C(()=>t.reposts.map(_=>_.pubkey)),k=C(()=>W(t.targetEvent?.content??""));U(y,{get timestamp(){return t.timestamp},get preview(){return r(k)},previewColor:"green-500",avatar:u=>{var v=Gt();a(u,v)},message:u=>{var v=Jt(),b=p(v);rt(b,{get pubkeys(){return r(i)},maxVisible:2});var c=j(b);c.nodeValue=` reposted
		your note`,a(u,v)}}),F()}var Xt=h('<div class="flex-shrink-0 w-10 h-10 flex items-center justify-center"><svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div>'),Yt=h('<!> <span class="font-semibold text-yellow-600 dark:text-yellow-400 mx-1"> </span> <!>',1);function $t(y,t){T(t,!0);const i=C(()=>t.zaps.map(u=>u.sender)),k=C(()=>t.zaps.reduce((u,v)=>u+v.amount,0)),_=C(()=>r(k).toLocaleString()),w=C(()=>W(t.targetEvent?.content??""));U(y,{get timestamp(){return t.timestamp},get preview(){return r(w)},previewColor:"yellow-500",avatar:b=>{var c=Xt();a(b,c)},message:b=>{var c=Yt(),n=p(c);rt(n,{get pubkeys(){return r(i)},maxVisible:2});var e=j(n);e.nodeValue=" zapped ";var s=j(e),l=g(s);f(s);var x=j(s,2);{var P=o=>{var d=et("to your note");a(o,d)},m=o=>{var d=et("to you");a(o,d)};E(x,o=>{t.targetEvent?o(P):o(m,!1)})}I(()=>A(l,`${r(_)??""} sats`)),a(b,c)}}),F()}var te=h('<p class="text-sm text-muted-foreground">accepted your invite ðŸŽ‰</p>'),ee=h('<div class="flex-1 min-w-0"><!></div>'),ne=D('<svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),oe=h('<p class="text-sm text-muted-foreground mt-1 line-clamp-2 break-words ml-[54px]"> </p>'),ae=h('<!> <div class="flex items-center gap-2 mt-2 ml-[54px]"><!></div>',1);function re(y,t){T(t,!0);let i=X(null);Z(()=>{V.fetchUser(t.notification.inviteePubkey).then(w=>{w?.fetchProfile().then(u=>{O(i,u,!0)})})});const k=C(()=>V.$sessions?.follows??new Set),_=C(()=>r(k).has(t.notification.inviteePubkey));U(y,{testId:"invite-acceptance-notification",get timestamp(){return t.notification.timestamp},avatar:c=>{var n=ee(),e=g(n);wt(e,{get pubkey(){return t.notification.inviteePubkey},variant:"avatar-name-meta",avatarSize:"w-10 h-10",nameSize:"text-base font-semibold",meta:l=>{var x=te();a(l,x)},$$slots:{meta:!0}}),f(n),a(c,n)},icon:c=>{var n=ne();a(c,n)},message:c=>{},content:c=>{var n=ae(),e=p(n);{var s=m=>{var o=oe(),d=g(o,!0);f(o),I(()=>A(d,r(i).about)),a(m,o)};E(e,m=>{r(i)?.about&&m(s)})}var l=j(e,2),x=g(l);{var P=m=>{pt(m,{get ndk(){return V},get target(){return t.notification.inviteePubkey}})};E(x,m=>{r(_)||m(P)})}f(l),a(c,n)}}),F()}function ie(y,t){T(t,!0),console.log("[NotificationItem] Rendering notification:",t.notification.type,t.notification.id),ot(()=>{console.log("[NotificationItem] Mounted:",t.notification.type,t.notification.id)}),bt(()=>{console.log("[NotificationItem] Destroyed:",t.notification.type,t.notification.id)});const i=C(()=>{if(console.log("[NotificationItem] Computing targetEvent for:",t.notification.type,t.notification.id),t.notification.type==="reply"){const v=t.targetEventsCache.get(t.notification.replyToEventId);return console.log("[NotificationItem] Reply target event:",v?"found":"not found"),v}else if(t.notification.type==="quote"){const v=t.targetEventsCache.get(t.notification.quotedEventId);return console.log("[NotificationItem] Quote target event:",v?"found":"not found"),v}else if(t.notification.type==="reaction"||t.notification.type==="repost"||t.notification.type==="zap"){const v=t.targetEventsCache.get(t.notification.targetEventId);return console.log("[NotificationItem]",t.notification.type,"target event:",v?"found":"not found"),v}});var k=M(),_=p(k);{var w=v=>{zt(v,{get event(){return t.notification.event},get targetEvent(){return r(i)}})},u=v=>{var b=M(),c=p(b);{var n=s=>{Bt(s,{get event(){return t.notification.event}})},e=s=>{var l=M(),x=p(l);{var P=o=>{Ut(o,{get event(){return t.notification.event},get targetEvent(){return r(i)}})},m=o=>{var d=M(),N=p(d);{var z=R=>{Wt(R,{get emoji(){return t.notification.emoji},get reactors(){return t.notification.reactors},get targetEvent(){return r(i)},get timestamp(){return t.notification.timestamp}})},B=R=>{var G=M(),$=p(G);{var lt=H=>{Ot(H,{get reposts(){return t.notification.reposts},get targetEvent(){return r(i)},get timestamp(){return t.notification.timestamp}})},ut=H=>{var it=M(),dt=p(it);{var ft=S=>{$t(S,{get zaps(){return t.notification.zaps},get targetEvent(){return r(i)},get timestamp(){return t.notification.timestamp}})},mt=S=>{var st=M(),gt=p(st);{var _t=tt=>{re(tt,{get notification(){return t.notification}})};E(gt,tt=>{t.notification.type==="invite_acceptance"&&tt(_t)},!0)}a(S,st)};E(dt,S=>{t.notification.type==="zap"?S(ft):S(mt,!1)},!0)}a(H,it)};E($,H=>{t.notification.type==="repost"?H(lt):H(ut,!1)},!0)}a(R,G)};E(N,R=>{t.notification.type==="reaction"?R(z):R(B,!1)},!0)}a(o,d)};E(x,o=>{t.notification.type==="quote"?o(P):o(m,!1)},!0)}a(s,l)};E(c,s=>{t.notification.type==="mention"?s(n):s(e,!1)},!0)}a(v,b)};E(_,v=>{t.notification.type==="reply"?v(w):v(u,!1)})}a(y,k),F()}var se=h('<span class="ml-1 opacity-70"> </span>'),ve=h('<button type="button"> <!></button>'),ce=h(`<div class="p-8 text-center text-muted-foreground"><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg> <p class="text-lg font-medium mb-1">No notifications yet</p> <p class="text-sm">When people interact with your posts, you'll see it here</p></div>`),le=h(" <!>",1),ue=h('<div class="w-full"><div class="sticky top-0 z-10 bg-background/90 backdrop-blur-xl border-b border-border"><div class="px-4 py-4"><h1 class="text-xl font-bold text-foreground mb-3">Notifications</h1> <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide svelte-xbnxce"></div></div></div> <div class="min-h-screen"><!></div></div>');function je(y,t){T(t,!0),console.log("[NotificationsPage] Initializing notifications page");const i=xt(V);ot(()=>{console.log("[NotificationsPage] Mounted")});const k=[{value:"all",label:"All"},{value:"reply",label:"Replies"},{value:"mention",label:"Mentions"},{value:"quote",label:"Quotes"},{value:"reaction",label:"Reactions"},{value:"repost",label:"Reposts"},{value:"zap",label:"Zaps"},{value:"invite",label:"Invites"}];function _(l){console.log("[NotificationsPage] Filter changed to:",l),i.setFilter(l)}Z(()=>{console.log("[NotificationsPage] Notifications count:",i.notifications.length),console.log("[NotificationsPage] Current filter:",i.filter),console.log("[NotificationsPage] Counts:",i.counts)});var w=ue(),u=g(w),v=g(u),b=j(g(v),2);nt(b,21,()=>k,vt,(l,x)=>{const P=C(()=>i.counts[r(x).value]);var m=ve();m.__click=()=>_(r(x).value);var o=g(m),d=j(o);{var N=z=>{var B=se(),R=g(B);f(B),I(()=>A(R,`(${r(P)??""})`)),a(z,B)};E(d,z=>{r(P)>0&&z(N)})}f(m),I(()=>{ct(m,1,`px-3 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors ${i.filter===r(x).value?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"}`),A(o,`${r(x).label??""} `)}),a(l,m)}),f(b),f(v),f(u);var c=j(u,2),n=g(c);{var e=l=>{var x=ce();a(l,x)},s=l=>{var x=M(),P=p(x);nt(P,19,()=>i.notifications,m=>m.id,(m,o,d)=>{K();var N=le(),z=p(N),B=j(z);ie(B,{get notification(){return r(o)},get targetEventsCache(){return i.targetEventsCache}}),I(R=>A(z,`${R??""} `),[()=>console.log("[NotificationsPage] Rendering notification",r(d),":",r(o).type,r(o).id)]),a(m,N)}),a(l,x)};E(n,l=>{i.notifications.length===0?l(e):l(s,!1)})}f(c),f(w),a(y,w),F()}Q(["click"]);export{je as component};
