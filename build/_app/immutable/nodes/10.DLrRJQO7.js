import{d as Ir,c as vr,j as We,a as l,f as n,t as K,s as D,i as jr}from"../chunks/rzUyzf2y.js";import{b as X,x as Sr,g as e,s as d,p as Br,f as he,c as Er,aJ as Vr,d as o,e as a,y,r as t,t as h,a as De,u as Ur}from"../chunks/AsQG98fS.js";import{i as U}from"../chunks/DZKExFZC.js";import{e as le,i as be}from"../chunks/Cztbr3Ea.js";import{a as Pr,f as Ge,c as xe,r as Fr}from"../chunks/CS0aOiUg.js";import{b as zr}from"../chunks/DF8Bk5Sh.js";import{n as ur,l as Or}from"../chunks/tv6-RHC_.js";import{g as cr}from"../chunks/s53o-P2j.js";import{h as Lr}from"../chunks/BVrYKRgp.js";import{c as Cr}from"../chunks/B_mUG5t6.js";import{c as fe}from"../chunks/Dt3q2Svx.js";import{b as Dr}from"../chunks/CkKAtl6l.js";import{p as Ar}from"../chunks/w-gpJwMz.js";import{t as Ke}from"../chunks/D7cSTCXZ.js";import{M as Rr,D as Tr,a as Hr,R as qr,b as Nr,d as Wr,e as Gr}from"../chunks/CVV5LOp_.js";import{D as Kr}from"../chunks/D1QSAoU9.js";import{D as Jr,a as Qr}from"../chunks/CKdpi0zW.js";import{I as _e,B as Qe}from"../chunks/DMKx7da8.js";import{L as ee}from"../chunks/Cqd1tifG.js";import{T as Mr}from"../chunks/DHCUFZXp.js";import{N as Xr,c as Yr}from"../chunks/BpHW1rOk.js";import{D as Zr}from"../chunks/Dw5jWGaA.js";function et(Xe,Pe={}){const Ye=new Xr(Xe),H=Yr(Ye);let g=X(Sr([])),M=X(0),J=X(!1);async function F(v){if(!v.type.startsWith("image/")){Ke.error("Please select an image file");return}try{if(await H.upload(v,{fallbackServer:Pe.fallbackServer||"https://blossom.primal.net"}),H.result?.url){const S=new Image,re=await new Promise(Le=>{S.onload=()=>Le({width:S.width,height:S.height}),S.src=URL.createObjectURL(v)});d(g,[...e(g),{url:H.result.url,mimeType:v.type,hash:H.result.sha256||"",blurhash:H.result.blurhash,dimensions:re}],!0),d(M,e(g).length-1)}}catch(S){console.error("Upload failed:",S),Ke.error("Failed to upload image")}}function ie(v){const re=v.target.files;re&&Array.from(re).forEach(Le=>F(Le))}function pe(v){v.preventDefault(),d(J,!0)}function me(){d(J,!1)}async function N(v){v.preventDefault(),d(J,!1);const S=v.dataTransfer?.files;S&&Array.from(S).forEach(re=>F(re))}function W(v){d(g,e(g).filter((S,re)=>re!==v),!0),e(M)>=e(g).length&&d(M,Math.max(0,e(g).length-1),!0)}function z(){d(g,[],!0),d(M,0),d(J,!1)}return{get uploadedImages(){return e(g)},set uploadedImages(v){d(g,v,!0)},get currentImageIndex(){return e(M)},set currentImageIndex(v){d(M,v,!0)},get isDragging(){return e(J)},get uploadStatus(){return H.status},get uploadProgress(){return H.progress},uploadFile:F,handleFileInputChange:ie,handleDragOver:pe,handleDragLeave:me,handleDrop:N,removeImage:W,reset:z}}var rt=n('<div class="flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <!></div>'),tt=n('Title <span class="text-red-500">*</span>',1),ot=n('Description <span class="text-red-500">*</span>',1),at=n("<option> </option>"),st=n("<option> </option>"),lt=jr('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>'),it=n('<div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm"><span> </span> <button type="button" class="hover:text-primary"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),nt=n('<div class="flex flex-wrap gap-2"></div>'),dt=n('<div class="flex flex-col items-center gap-2"><div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span class="text-sm text-muted-foreground"> </span></div>'),vt=n('<svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-muted-foreground">Click to upload or drag and drop</span> <span class="text-xs text-muted-foreground">Multiple images supported</span>',1),ut=n('<div class="relative group"><img class="w-full h-32 object-cover rounded-lg border border-border"/> <button type="button" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),ct=n('<div class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>'),pt=n("<!> <!>",1),gt=n('<!> <div class="space-y-6"><div class="space-y-5"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Pricing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <select id="currency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"></select></div> <div><!> <select id="frequency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>One time</option><option>Per hour</option><option>Per day</option><option>Per week</option><option>Per month</option><option>Per year</option></select></div></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Categories</h3> <div class="space-y-4"><div class="flex gap-2"><select class="flex-1 px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>Select a category</option><!></select> <!> <!></div> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Images</h3> <div class="space-y-4"><input type="file" accept="image/*" multiple class="hidden"/> <button type="button"><!></button> <!></div></div></div> <!>',1),mt=n('<div class="flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <!></div>'),ft=n('Title <span class="text-red-500">*</span>',1),_t=n('Description <span class="text-red-500">*</span>',1),ht=n("<option> </option>"),bt=n("<option> </option>"),xt=jr('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>'),yt=n('<div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm"><span> </span> <button type="button" class="hover:text-primary"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),$t=n('<div class="flex flex-wrap gap-2"></div>'),kt=n('<div class="flex flex-col items-center gap-2"><div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span class="text-sm text-muted-foreground"> </span></div>'),wt=n('<svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-muted-foreground">Click to upload or drag and drop</span> <span class="text-xs text-muted-foreground">Multiple images supported</span>',1),Ct=n('<div class="relative group"><img class="w-full h-32 object-cover rounded-lg border border-border"/> <button type="button" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Pt=n('<div class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>'),Lt=n("<!> <!>",1),Dt=n('<!> <div class="px-4 space-y-6 overflow-auto flex-1"><div class="space-y-5"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Pricing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <select id="currency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"></select></div> <div><!> <select id="frequency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>One time</option><option>Per hour</option><option>Per day</option><option>Per week</option><option>Per month</option><option>Per year</option></select></div></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Categories</h3> <div class="space-y-4"><div class="flex gap-2"><select class="flex-1 px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>Select a category</option><!></select> <!> <!></div> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Images</h3> <div class="space-y-4"><input type="file" accept="image/*" multiple class="hidden"/> <button type="button"><!></button> <!></div></div></div> <!>',1);function Mt(Xe,Pe){Br(Pe,!0);const Ye=new Rr("(min-width: 768px)");let H=Ar(Pe,"open",15,!1),g=X(!1),M=X(""),J=X(""),F=X(""),ie=X(""),pe=X(""),me=X("USD"),N=X(void 0),W=X(Sr([])),z=X("");const v=et(ur,{fallbackServer:"https://blossom.primal.net"});let S;const re=["electronics","furniture","clothing","books","services","vehicles","real-estate","jobs","free","wanted"],Le=["USD","EUR","GBP","BTC","SATS"];function Je(){e(z)&&!e(W).includes(e(z).toLowerCase())&&(d(W,[...e(W),e(z).toLowerCase()],!0),d(z,""))}function p(u){d(W,e(W).filter(m=>m!==u),!0)}async function k(){if(!e(M).trim()||!e(F).trim()||e(g)){Ke.error("Please provide a title and description");return}if(!ur.$currentUser){Ke.error("Please log in to create a listing");return}try{d(g,!0);const u=new Or(ur);if(u.title=e(M).trim(),u.summary=e(J).trim()||void 0,u.content=e(F).trim(),u.location=e(ie).trim()||void 0,u.published_at=Math.floor(Date.now()/1e3),u.tags.push(["status","active"]),e(pe).trim()&&(u.price={amount:parseFloat(e(pe)),currency:e(me),frequency:e(N)&&e(N)!=="once"?e(N):void 0}),e(W).forEach(m=>{u.tags.push(["t",m])}),v.uploadedImages.forEach(m=>{u.tags.push(["image",m.url])}),await u.sign(),await u.publish(),u.publishStatus==="error"){const $=u.publishError?.relayErrors||{},E=Object.entries($).map(([j,f])=>`${j}: ${f}`).join(`
`);Ke.error(`Failed to publish:
${E||"Unknown error"}`);return}Ke.success("Listing created successfully"),B(),H(!1),Pe.onClose?.(),cr("/marketplace")}catch(u){console.error("Failed to publish listing:",u),Ke.error(`Failed to create listing: ${u instanceof Error?u.message:"Unknown error"}`)}finally{d(g,!1)}}function B(){d(M,""),d(J,""),d(F,""),d(ie,""),d(pe,""),d(me,"USD"),d(N,void 0),d(W,[],!0),d(z,""),v.reset()}function I(){e(g)||(B(),H(!1),Pe.onClose?.())}function Y(u){u.key==="Escape"&&!e(g)&&I()}var C=vr();We("keydown",Vr,Y);var b=he(C);{var Q=u=>{var m=vr(),$=he(m);fe($,()=>qr,(E,j)=>{j(E,{get open(){return H()},onOpenChange:f=>{H(f),f||I()},children:(f,ne)=>{var Z=vr(),ge=he(Z);fe(ge,()=>Tr,(P,x)=>{x(P,{class:"max-w-4xl max-h-[90vh] overflow-y-auto",children:(q,de)=>{var oe=gt(),ye=he(oe);fe(ye,()=>Jr,(r,i)=>{i(r,{children:(s,w)=>{var c=rt(),_=o(a(c),2);fe(_,()=>Hr,(R,T)=>{T(R,{children:(we,Ne)=>{y();var Ce=K("Create Listing");l(we,Ce)},$$slots:{default:!0}})}),t(c),l(s,c)},$$slots:{default:!0}})});var ve=o(ye,2),ae=a(ve),L=a(ae),V=a(L);ee(V,{for:"title",children:(r,i)=>{y();var s=tt();y(),l(r,s)},$$slots:{default:!0}});var ue=o(V,2);_e(ue,{id:"title",type:"text",placeholder:"What are you listing?",maxlength:200,class:"mt-2",get value(){return e(M)},set value(r){d(M,r,!0)}}),t(L);var se=o(L,2),$e=a(se);ee($e,{for:"summary",children:(r,i)=>{y();var s=K("Summary");l(r,s)},$$slots:{default:!0}});var G=o($e,2);_e(G,{id:"summary",type:"text",placeholder:"Brief description",maxlength:200,class:"mt-2",get value(){return e(J)},set value(r){d(J,r,!0)}}),t(se);var O=o(se,2),ce=a(O);ee(ce,{for:"content",children:(r,i)=>{y();var s=ot();y(),l(r,s)},$$slots:{default:!0}});var Me=o(ce,2);Mr(Me,{id:"content",placeholder:"Detailed description (Markdown supported)",rows:6,class:"mt-2 resize-none",get value(){return e(F)},set value(r){d(F,r,!0)}}),t(O);var Ie=o(O,2),Ze=a(Ie);ee(Ze,{for:"location",children:(r,i)=>{y();var s=K("Location");l(r,s)},$$slots:{default:!0}});var pr=o(Ze,2);_e(pr,{id:"location",type:"text",placeholder:"City, State or Country",class:"mt-2",get value(){return e(ie)},set value(r){d(ie,r,!0)}}),t(Ie),t(ae);var je=o(ae,2),er=o(a(je),2),Se=a(er),rr=a(Se);ee(rr,{for:"price-amount",children:(r,i)=>{y();var s=K("Amount");l(r,s)},$$slots:{default:!0}});var gr=o(rr,2);_e(gr,{id:"price-amount",type:"text",placeholder:"0.00",class:"mt-2",get value(){return e(pe)},set value(r){d(pe,r,!0)}}),t(Se);var Be=o(Se,2),tr=a(Be);ee(tr,{for:"currency",children:(r,i)=>{y();var s=K("Currency");l(r,s)},$$slots:{default:!0}});var Ee=o(tr,2);le(Ee,21,()=>Le,be,(r,i)=>{var s=at(),w=a(s,!0);t(s);var c={};h(()=>{D(w,e(i)),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")}),l(r,s)}),t(Ee),t(Be);var or=o(Be,2),ar=a(or);ee(ar,{for:"frequency",children:(r,i)=>{y();var s=K("Frequency");l(r,s)},$$slots:{default:!0}});var Ve=o(ar,2),Ue=a(Ve);Ue.value=(Ue.__value=void 0)??"";var Fe=o(Ue);Fe.value=Fe.__value="hour";var ze=o(Fe);ze.value=ze.__value="day";var Oe=o(ze);Oe.value=Oe.__value="week";var Ae=o(Oe);Ae.value=Ae.__value="month";var sr=o(Ae);sr.value=sr.__value="year",t(Ve),t(or),t(er),t(je);var Re=o(je,2),lr=o(a(Re),2),Te=a(lr),ke=a(Te),He=a(ke);He.value=He.__value="";var mr=o(He);le(mr,17,()=>re,be,(r,i)=>{var s=st(),w=a(s,!0);t(s);var c={};h(_=>{D(w,_),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")},[()=>e(i).charAt(0).toUpperCase()+e(i).slice(1)]),l(r,s)}),t(ke);var ir=o(ke,2);_e(ir,{type:"text",placeholder:"Or type custom",class:"flex-1",onkeydown:r=>{r.key==="Enter"&&(r.preventDefault(),Je())},get value(){return e(z)},set value(r){d(z,r,!0)}});var fr=o(ir,2);Qe(fr,{type:"button",onclick:Je,size:"icon",children:(r,i)=>{var s=lt();l(r,s)},$$slots:{default:!0}}),t(Te);var _r=o(Te,2);{var hr=r=>{var i=nt();le(i,21,()=>e(W),be,(s,w)=>{var c=it(),_=a(c),R=a(_,!0);t(_);var T=o(_,2);T.__click=()=>p(e(w)),t(c),h(()=>D(R,e(w))),l(s,c)}),t(i),l(r,i)};U(_r,r=>{e(W).length>0&&r(hr)})}t(lr),t(Re);var nr=o(Re,2),dr=o(a(nr),2),qe=a(dr);qe.__change=function(...r){v.handleFileInputChange?.apply(this,r)},Dr(qe,r=>S=r,()=>S);var A=o(qe,2);A.__click=()=>S?.click();var br=a(A);{var xr=r=>{var i=dt(),s=o(a(i),2),w=a(s);t(s),t(i),h(()=>D(w,`${(v.uploadProgress?.percentage||0)??""}%`)),l(r,i)},yr=r=>{var i=vt();y(4),l(r,i)};U(br,r=>{v.uploadStatus==="uploading"?r(xr):r(yr,!1)})}t(A);var $r=o(A,2);{var kr=r=>{var i=ct();le(i,21,()=>v.uploadedImages,be,(s,w,c)=>{var _=ut(),R=a(_);xe(R,"alt",`Listing image ${c+1}`);var T=o(R,2);T.__click=()=>v.removeImage(c),t(_),h(()=>xe(R,"src",e(w).url)),l(s,_)}),t(i),l(r,i)};U($r,r=>{v.uploadedImages.length>0&&r(kr)})}t(dr),t(nr),t(ve);var wr=o(ve,2);fe(wr,()=>Zr,(r,i)=>{i(r,{class:"flex gap-3 sm:space-x-0",children:(s,w)=>{var c=pt(),_=he(c);Qe(_,{variant:"outline",onclick:I,get disabled(){return e(g)},children:(T,we)=>{y();var Ne=K("Cancel");l(T,Ne)},$$slots:{default:!0}});var R=o(_,2);{let T=De(()=>!e(M).trim()||!e(F).trim()||e(g));Qe(R,{onclick:k,get disabled(){return e(T)},children:(we,Ne)=>{y();var Ce=K();h(()=>D(Ce,e(g)?"Publishing...":"Publish Listing")),l(we,Ce)},$$slots:{default:!0}})}l(s,c)},$$slots:{default:!0}})}),h(()=>{A.disabled=v.uploadStatus==="uploading",Pr(A,1,`w-full h-32 rounded-lg border-2 border-dashed transition-colors flex flex-col items-center justify-center gap-2 ${v.isDragging?"border-primary bg-muted/40":"border-border hover:border-primary bg-muted/20 hover:bg-muted/40"}`)}),Ge(Ee,()=>e(me),r=>d(me,r)),Ge(Ve,()=>e(N),r=>d(N,r)),Ge(ke,()=>e(z),r=>d(z,r)),We("dragover",A,function(...r){v.handleDragOver?.apply(this,r)}),We("dragleave",A,function(...r){v.handleDragLeave?.apply(this,r)}),We("drop",A,function(...r){v.handleDrop?.apply(this,r)}),l(q,oe)},$$slots:{default:!0}})}),l(f,Z)},$$slots:{default:!0}})}),l(u,m)},te=u=>{var m=vr(),$=he(m);fe($,()=>Gr,(E,j)=>{j(E,{get open(){return H()},onOpenChange:f=>{H(f),f||I()},children:(f,ne)=>{var Z=vr(),ge=he(Z);fe(ge,()=>Nr,(P,x)=>{x(P,{children:(q,de)=>{var oe=Dt(),ye=he(oe);fe(ye,()=>Qr,(r,i)=>{i(r,{class:"text-left",children:(s,w)=>{var c=mt(),_=o(a(c),2);fe(_,()=>Wr,(R,T)=>{T(R,{children:(we,Ne)=>{y();var Ce=K("Create Listing");l(we,Ce)},$$slots:{default:!0}})}),t(c),l(s,c)},$$slots:{default:!0}})});var ve=o(ye,2),ae=a(ve),L=a(ae),V=a(L);ee(V,{for:"title",children:(r,i)=>{y();var s=ft();y(),l(r,s)},$$slots:{default:!0}});var ue=o(V,2);_e(ue,{id:"title",type:"text",placeholder:"What are you listing?",maxlength:200,class:"mt-2",get value(){return e(M)},set value(r){d(M,r,!0)}}),t(L);var se=o(L,2),$e=a(se);ee($e,{for:"summary",children:(r,i)=>{y();var s=K("Summary");l(r,s)},$$slots:{default:!0}});var G=o($e,2);_e(G,{id:"summary",type:"text",placeholder:"Brief description",maxlength:200,class:"mt-2",get value(){return e(J)},set value(r){d(J,r,!0)}}),t(se);var O=o(se,2),ce=a(O);ee(ce,{for:"content",children:(r,i)=>{y();var s=_t();y(),l(r,s)},$$slots:{default:!0}});var Me=o(ce,2);Mr(Me,{id:"content",placeholder:"Detailed description (Markdown supported)",rows:6,class:"mt-2 resize-none",get value(){return e(F)},set value(r){d(F,r,!0)}}),t(O);var Ie=o(O,2),Ze=a(Ie);ee(Ze,{for:"location",children:(r,i)=>{y();var s=K("Location");l(r,s)},$$slots:{default:!0}});var pr=o(Ze,2);_e(pr,{id:"location",type:"text",placeholder:"City, State or Country",class:"mt-2",get value(){return e(ie)},set value(r){d(ie,r,!0)}}),t(Ie),t(ae);var je=o(ae,2),er=o(a(je),2),Se=a(er),rr=a(Se);ee(rr,{for:"price-amount",children:(r,i)=>{y();var s=K("Amount");l(r,s)},$$slots:{default:!0}});var gr=o(rr,2);_e(gr,{id:"price-amount",type:"text",placeholder:"0.00",class:"mt-2",get value(){return e(pe)},set value(r){d(pe,r,!0)}}),t(Se);var Be=o(Se,2),tr=a(Be);ee(tr,{for:"currency",children:(r,i)=>{y();var s=K("Currency");l(r,s)},$$slots:{default:!0}});var Ee=o(tr,2);le(Ee,21,()=>Le,be,(r,i)=>{var s=ht(),w=a(s,!0);t(s);var c={};h(()=>{D(w,e(i)),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")}),l(r,s)}),t(Ee),t(Be);var or=o(Be,2),ar=a(or);ee(ar,{for:"frequency",children:(r,i)=>{y();var s=K("Frequency");l(r,s)},$$slots:{default:!0}});var Ve=o(ar,2),Ue=a(Ve);Ue.value=(Ue.__value=void 0)??"";var Fe=o(Ue);Fe.value=Fe.__value="hour";var ze=o(Fe);ze.value=ze.__value="day";var Oe=o(ze);Oe.value=Oe.__value="week";var Ae=o(Oe);Ae.value=Ae.__value="month";var sr=o(Ae);sr.value=sr.__value="year",t(Ve),t(or),t(er),t(je);var Re=o(je,2),lr=o(a(Re),2),Te=a(lr),ke=a(Te),He=a(ke);He.value=He.__value="";var mr=o(He);le(mr,17,()=>re,be,(r,i)=>{var s=bt(),w=a(s,!0);t(s);var c={};h(_=>{D(w,_),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")},[()=>e(i).charAt(0).toUpperCase()+e(i).slice(1)]),l(r,s)}),t(ke);var ir=o(ke,2);_e(ir,{type:"text",placeholder:"Or type custom",class:"flex-1",onkeydown:r=>{r.key==="Enter"&&(r.preventDefault(),Je())},get value(){return e(z)},set value(r){d(z,r,!0)}});var fr=o(ir,2);Qe(fr,{type:"button",onclick:Je,size:"icon",children:(r,i)=>{var s=xt();l(r,s)},$$slots:{default:!0}}),t(Te);var _r=o(Te,2);{var hr=r=>{var i=$t();le(i,21,()=>e(W),be,(s,w)=>{var c=yt(),_=a(c),R=a(_,!0);t(_);var T=o(_,2);T.__click=()=>p(e(w)),t(c),h(()=>D(R,e(w))),l(s,c)}),t(i),l(r,i)};U(_r,r=>{e(W).length>0&&r(hr)})}t(lr),t(Re);var nr=o(Re,2),dr=o(a(nr),2),qe=a(dr);qe.__change=function(...r){v.handleFileInputChange?.apply(this,r)},Dr(qe,r=>S=r,()=>S);var A=o(qe,2);A.__click=()=>S?.click();var br=a(A);{var xr=r=>{var i=kt(),s=o(a(i),2),w=a(s);t(s),t(i),h(()=>D(w,`${(v.uploadProgress?.percentage||0)??""}%`)),l(r,i)},yr=r=>{var i=wt();y(4),l(r,i)};U(br,r=>{v.uploadStatus==="uploading"?r(xr):r(yr,!1)})}t(A);var $r=o(A,2);{var kr=r=>{var i=Pt();le(i,21,()=>v.uploadedImages,be,(s,w,c)=>{var _=Ct(),R=a(_);xe(R,"alt",`Listing image ${c+1}`);var T=o(R,2);T.__click=()=>v.removeImage(c),t(_),h(()=>xe(R,"src",e(w).url)),l(s,_)}),t(i),l(r,i)};U($r,r=>{v.uploadedImages.length>0&&r(kr)})}t(dr),t(nr),t(ve);var wr=o(ve,2);fe(wr,()=>Kr,(r,i)=>{i(r,{class:"pt-2",children:(s,w)=>{var c=Lt(),_=he(c);{let T=De(()=>!e(M).trim()||!e(F).trim()||e(g));Qe(_,{onclick:k,get disabled(){return e(T)},class:"w-full",children:(we,Ne)=>{y();var Ce=K();h(()=>D(Ce,e(g)?"Publishing...":"Publish Listing")),l(we,Ce)},$$slots:{default:!0}})}var R=o(_,2);Qe(R,{variant:"outline",onclick:I,get disabled(){return e(g)},class:"w-full",children:(T,we)=>{y();var Ne=K("Cancel");l(T,Ne)},$$slots:{default:!0}}),l(s,c)},$$slots:{default:!0}})}),h(()=>{A.disabled=v.uploadStatus==="uploading",Pr(A,1,`w-full h-32 rounded-lg border-2 border-dashed transition-colors flex flex-col items-center justify-center gap-2 ${v.isDragging?"border-primary bg-muted/40":"border-border hover:border-primary bg-muted/20 hover:bg-muted/40"}`)}),Ge(Ee,()=>e(me),r=>d(me,r)),Ge(Ve,()=>e(N),r=>d(N,r)),Ge(ke,()=>e(z),r=>d(z,r)),We("dragover",A,function(...r){v.handleDragOver?.apply(this,r)}),We("dragleave",A,function(...r){v.handleDragLeave?.apply(this,r)}),We("drop",A,function(...r){v.handleDrop?.apply(this,r)}),l(q,oe)},$$slots:{default:!0}})}),l(f,Z)},$$slots:{default:!0}})}),l(u,m)};U(b,u=>{Ye.current?u(Q):u(te,!1)})}l(Xe,C),Er()}Ir(["click","change"]);var It=n("<option> </option>"),jt=n('<div class="container mx-auto px-4 py-3 max-w-7xl"><div class="mb-6"><div class="flex items-center justify-between mb-4"><h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent">Marketplace</h1> <button class="hidden sm:flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-foreground font-medium rounded-lg transition-colors"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span>Create Listing</span></button></div> <div class="flex gap-2 sm:gap-3"><div class="flex-1"><div class="relative"><svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search listings..." class="w-full pl-10 h-12 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all"/></div></div> <div class="relative"><select class="h-12 px-4 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all appearance-none pr-10"></select> <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div></div></div>'),St=n('<div class="mb-6"><h2 class="text-xl font-semibold text-foreground"> </h2> <p class="text-sm text-muted-foreground mt-1"> </p></div>'),Bt=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Et=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Vt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Ut=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),Ft=n('<div class="col-span-full text-center py-12 text-muted-foreground">No listings found</div>'),zt=n('<div><!> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Ot=n('<div class="text-center py-12 text-muted-foreground">No marketplace items yet</div>'),At=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Rt=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Tt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Ht=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),qt=n('<div class="mb-8"><h2 class="text-xl font-semibold text-foreground mb-4">Recent Listings</h2> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Nt=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Wt=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Gt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Kt=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),Jt=n('<div class="mb-8"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-foreground"> </h2> <button class="text-sm text-primary-600 dark:text-primary-400 hover:underline">View All</button></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Qt=n("<!> <!>",1),Xt=n("<div><!></div>"),Yt=n('<div class="min-h-screen bg-neutral-50 dark:bg-background"><div class="container mx-auto px-4 py-4 max-w-7xl"><!></div> <!></div>');function $o(Xe,Pe){Br(Pe,!0);const Ye=p=>{var k=jt(),B=a(k),I=a(B),Y=o(a(I),2);Y.__click=()=>Cr.open(),t(I);var C=o(I,2),b=a(C),Q=a(b),te=o(a(Q),2);Fr(te),t(Q),t(b);var u=o(b,2),m=a(u);le(m,21,()=>H,be,($,E)=>{var j=It(),f=a(j,!0);t(j);var ne={};h(()=>{D(f,e(E).label),ne!==(ne=e(E).value)&&(j.value=(j.__value=e(E).value)??"")}),l($,j)}),t(m),y(2),t(u),t(C),t(B),t(k),zr(te,()=>e(M),$=>d(M,$)),Ge(m,()=>e(g),$=>d(g,$)),l(p,k)},H=[{value:"",label:"All Categories"},{value:"electronics",label:"Electronics"},{value:"furniture",label:"Furniture"},{value:"clothing",label:"Clothing"},{value:"books",label:"Books"},{value:"services",label:"Services"},{value:"vehicles",label:"Vehicles"},{value:"real-estate",label:"Real Estate"},{value:"jobs",label:"Jobs"},{value:"free",label:"Free"},{value:"wanted",label:"Wanted"}];let g=X(""),M=X("");const J=ur.$subscribe(()=>{const p={kinds:[30402],limit:50};return e(g)&&(p["#t"]=[e(g).toLowerCase()]),{filters:[p],bufferMs:100}}),F=De(()=>J.events.filter(p=>{if((p.tagValue("status")||"active")!=="active")return!1;if(!e(M))return!0;const B=e(M).toLowerCase(),I=p.tagValue("title")?.toLowerCase()||"",Y=p.tagValue("summary")?.toLowerCase()||"",C=p.content?.toLowerCase()||"",b=p.tagValue("location")?.toLowerCase()||"";return I.includes(B)||Y.includes(B)||C.includes(B)||b.includes(B)})),ie=De(()=>{const p={};return e(F).forEach(k=>{const B=k.tags.filter(I=>I[0]==="t").map(I=>I[1]);B.length>0?B.forEach(I=>{const Y=I.toLowerCase();p[Y]||(p[Y]=[]),p[Y].push(k)}):(p.uncategorized||(p.uncategorized=[]),p.uncategorized.push(k))}),p}),pe=De(()=>e(g)||e(M));function me(p){d(g,p,!0)}function N(p){return p.tagValue("image")}function W(p){const k=p.tags.find(B=>B[0]==="price");return!k||!k[1]||!k[2]?null:{amount:k[1],currency:k[2]}}Ur(()=>(Lr.header=Ye,()=>{Lr.clear()}));var z=Yt(),v=a(z),S=a(v);{var re=p=>{var k=zt(),B=a(k);{var I=C=>{var b=St(),Q=a(b),te=a(Q,!0);t(Q);var u=o(Q,2),m=a(u);t(u),t(b),h($=>{D(te,$),D(m,`${e(F).length??""} listings found`)},[()=>H.find($=>$.value===e(g))?.label||e(g)]),l(C,b)};U(B,C=>{e(g)&&C(I)})}var Y=o(B,2);le(Y,21,()=>e(F),C=>C.id,(C,b)=>{const Q=De(()=>W(e(b)));var te=Ut();te.__click=()=>cr(`/marketplace/${e(b).encode()}`);var u=a(te);{var m=P=>{var x=Bt(),q=a(x);t(x),h((de,oe)=>{xe(q,"src",de),xe(q,"alt",oe)},[()=>N(e(b)),()=>e(b).tagValue("title")||"Listing"]),l(P,x)};U(u,P=>{N(e(b))&&P(m)})}var $=o(u,2),E=a($),j=a(E,!0);t(E);var f=o(E,2);{var ne=P=>{var x=Et(),q=a(x,!0);t(x),h(de=>D(q,de),[()=>e(b).tagValue("summary")]),l(P,x)};U(f,P=>{e(b).tagValue("summary")&&P(ne)})}var Z=o(f,2);{var ge=P=>{var x=Vt(),q=a(x);t(x),h(()=>D(q,`${e(Q).amount??""} ${e(Q).currency??""}`)),l(P,x)};U(Z,P=>{e(Q)&&P(ge)})}t($),t(te),h(P=>D(j,P),[()=>e(b).tagValue("title")||"Untitled"]),l(C,te)},C=>{var b=Ft();l(C,b)}),t(Y),t(k),l(p,k)},Le=p=>{var k=Xt(),B=a(k);{var I=C=>{var b=Ot();l(C,b)},Y=C=>{var b=Qt(),Q=he(b);{var te=m=>{var $=qt(),E=o(a($),2);le(E,21,()=>e(F).slice(0,8),j=>j.id,(j,f)=>{const ne=De(()=>W(e(f)));var Z=Ht();Z.__click=()=>cr(`/marketplace/${e(f).encode()}`);var ge=a(Z);{var P=L=>{var V=At(),ue=a(V);t(V),h((se,$e)=>{xe(ue,"src",se),xe(ue,"alt",$e)},[()=>N(e(f)),()=>e(f).tagValue("title")||"Listing"]),l(L,V)};U(ge,L=>{N(e(f))&&L(P)})}var x=o(ge,2),q=a(x),de=a(q,!0);t(q);var oe=o(q,2);{var ye=L=>{var V=Rt(),ue=a(V,!0);t(V),h(se=>D(ue,se),[()=>e(f).tagValue("summary")]),l(L,V)};U(oe,L=>{e(f).tagValue("summary")&&L(ye)})}var ve=o(oe,2);{var ae=L=>{var V=Tt(),ue=a(V);t(V),h(()=>D(ue,`${e(ne).amount??""} ${e(ne).currency??""}`)),l(L,V)};U(ve,L=>{e(ne)&&L(ae)})}t(x),t(Z),h(L=>D(de,L),[()=>e(f).tagValue("title")||"Untitled"]),l(j,Z)}),t(E),t($),l(m,$)};U(Q,m=>{e(F).length>0&&m(te)})}var u=o(Q,2);le(u,17,()=>H.filter(m=>m.value&&e(ie)[m.value]?.length>0),be,(m,$)=>{var E=Jt(),j=a(E),f=a(j),ne=a(f,!0);t(f);var Z=o(f,2);Z.__click=()=>me(e($).value),t(j);var ge=o(j,2);le(ge,21,()=>e(ie)[e($).value].slice(0,4),P=>P.id,(P,x)=>{const q=De(()=>W(e(x)));var de=Kt();de.__click=()=>cr(`/marketplace/${e(x).encode()}`);var oe=a(de);{var ye=G=>{var O=Nt(),ce=a(O);t(O),h((Me,Ie)=>{xe(ce,"src",Me),xe(ce,"alt",Ie)},[()=>N(e(x)),()=>e(x).tagValue("title")||"Listing"]),l(G,O)};U(oe,G=>{N(e(x))&&G(ye)})}var ve=o(oe,2),ae=a(ve),L=a(ae,!0);t(ae);var V=o(ae,2);{var ue=G=>{var O=Wt(),ce=a(O,!0);t(O),h(Me=>D(ce,Me),[()=>e(x).tagValue("summary")]),l(G,O)};U(V,G=>{e(x).tagValue("summary")&&G(ue)})}var se=o(V,2);{var $e=G=>{var O=Gt(),ce=a(O);t(O),h(()=>D(ce,`${e(q).amount??""} ${e(q).currency??""}`)),l(G,O)};U(se,G=>{e(q)&&G($e)})}t(ve),t(de),h(G=>D(L,G),[()=>e(x).tagValue("title")||"Untitled"]),l(P,de)}),t(ge),t(E),h(()=>D(ne,e($).label)),l(m,E)}),l(C,b)};U(B,C=>{Object.keys(e(ie)).length===0?C(I):C(Y,!1)})}t(k),l(p,k)};U(S,p=>{e(pe)?p(re):p(Le,!1)})}t(v);var Je=o(v,2);Mt(Je,{onClose:()=>{J.restart?.()},get open(){return Cr.show},set open(p){Cr.show=p}}),t(z),l(Xe,z),Er()}Ir(["click"]);export{$o as component};
