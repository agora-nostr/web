import"../chunks/DsnmJJEf.js";import{d as Pe,p as De,g as e,a as M,u as Y,s as C,b as I,K as Ge,i as j,e as _,h as qe,k as t,r,j as a,t as R,l as s,c as Qe,f as We,L as Xe}from"../chunks/Bq750rDx.js";import{i as H}from"../chunks/BcjopvHb.js";import{s as Ze,a as ke}from"../chunks/wxUnewq1.js";import{p as et}from"../chunks/CFwZN-iQ.js";import{g as ae}from"../chunks/C88829DE.js";import{n as O,e as ye,A as tt}from"../chunks/CdRP5_sk.js";import{d as rt}from"../chunks/BSM2-0iS.js";import{A as it}from"../chunks/Bt6DpIqu.js";import{o as at}from"../chunks/CXnZGrn4.js";import{$ as nt}from"../chunks/L2joq6-K.js";var ot=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-orange-600 mx-auto mb-4"></div> <p class="text-muted-foreground"> </p></div></div>'),st=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div> <h2 class="text-xl font-bold text-foreground mb-2"> </h2> <p class="text-muted-foreground mb-6"> </p> <button class="px-6 py-2 bg-primary hover:bg-primary-700 text-white font-semibold rounded-xl transition-colors"> </button></div></div>'),dt=j('<div class="flex flex-col items-center mb-8 -mt-20"><div class="relative mb-4"><div class="w-24 h-24 rounded-full ring-4 ring-white dark:ring-neutral-900 overflow-hidden bg-neutral-200 dark:bg-neutral-800 flex items-center justify-center"><!></div></div> <div class="text-center"><h2 class="text-xl font-bold text-foreground"> </h2> <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"> </p></div></div>'),lt=j('<div class="mb-8 p-6 bg-neutral-50 dark:bg-neutral-800/50 rounded-xl border border-border"><p class="text-foreground whitespace-pre-wrap leading-relaxed"> </p></div>'),vt=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden"><div class="h-32 bg-primary opacity-90"></div> <div class="px-8 pb-8 pt-12"><!> <!> <div class="text-center mb-8"><h1 class="text-3xl font-bold mb-3 text-foreground"> </h1> <p class="text-muted-foreground"> </p></div> <div class="space-y-5 mb-10"><div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-primary dark:text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div></div> <div class="space-y-4"><button class="w-full py-6 text-lg font-semibold bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white shadow-lg transition-all duration-200 hover:shadow-xl rounded-xl flex items-center justify-center gap-2"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg></button> <button class="w-full text-center text-muted-foreground hover:text-neutral-900 dark:hover:text-neutral-200 transition-colors py-2"> <span class="font-semibold underline"> </span></button></div> <div class="mt-8 pt-6 border-t border-neutral-200 dark:border-neutral-800"><p class="text-xs text-center text-neutral-500"> </p></div></div></div>'),ct=j('<div class="min-h-screen bg-gradient-to-b from-neutral-50 to-neutral-100 dark:from-neutral-950 dark:to-neutral-900 flex items-center justify-center p-4"><div class="w-full max-w-xl"><!></div></div>');function wt(we,Me){De(Me,!0);const Ce=()=>ke(et,"$page",ne),n=()=>ke(nt,"$t",ne),[ne,je]=Ze(),x=M(()=>Ce().params.code),Se=M(()=>e(x)?e(x).slice(0,12):null),oe=M(()=>e(x)&&e(x).length>12?e(x).slice(12):null),T=O.$subscribe(()=>({filters:{kinds:[513],"#d":[e(Se)],limit:1},relayUrls:[...tt],subId:"invite",cacheUsage:ye.ONLY_RELAY,closeOnEose:!0}));let c=I(null);Y(()=>{C(c,e(c)??T.events[0],!0)});let i=I(null);Y(()=>{!e(c)||!e(x)||e(i)||(async()=>{try{const d=e(c).tags.filter(l=>l[0]==="code").map(l=>l[1]);if(d.length===0)return;const v=e(c).relay?.url||Array.from(e(c).onRelays)[0]?.url;let u;if(e(oe)){const l=await rt(e(c).content,e(oe));u=JSON.parse(l)}else u=JSON.parse(e(c).content);C(i,{...u,inviteEventId:e(c).id,inviteRelay:v,inviteCode:d[0],validCodes:d},!0)}catch(o){console.error("Failed to parse invite:",o)}})()});let se=I(Ge(new Set)),V=I(!1);Y(()=>{!e(c)||!e(i)||e(V)||(async()=>{C(V,!0);const o=e(i).inviteRelay;if(o)try{const d=await O.guardrailOff().fetchEvents({kinds:[514],"#e":[e(c).id]},{relayUrls:[o],subId:"invite-redemptions",cacheUsage:ye.ONLY_RELAY}),v=new Set;for(const l of d){const f=l.tags.find(p=>p[0]==="code");f?.[1]&&v.add(f[1])}C(se,v,!0);const u=e(i).validCodes?.filter(l=>!v.has(l))||[];u.length>0&&(e(i).inviteCode=u[0])}catch(d){console.error("Failed to fetch redemptions:",d)}})()});const Ae=M(()=>e(i)?.validCodes?e(i).validCodes.some(o=>!e(se).has(o)):!1);let E=I(null);Y(()=>{const o=e(i)?.inviter;if(!o){C(E,null);return}O.fetchUser(o).then(d=>{d?.fetchProfile().then(v=>{C(E,v,!0)})})});const Ne=M(()=>!e(x)||!e(i)),de=M(()=>{if(!e(x)||T.events.length===0&&T.eosed)return n()("onboarding.invite.inviteNotFound");if(e(i)&&!e(Ae)&&e(V)){const o=e(i).inviter?"them":"the inviter";return n()("onboarding.invite.inviteReachedMax",{values:{inviter:o}})}return null});function Ie(){e(i)&&(at.setInvite({welcomeMessage:e(i).welcomeMessage,recipientName:e(i).recipientName,cashuToken:e(i).cashuToken,inviter:e(i).inviter,inviteEventId:e(i).inviteEventId,inviteRelay:e(i).inviteRelay,inviteCode:e(i).inviteCode}),ae("/onboarding"))}function Re(){ae("/")}var z=ct(),le=t(z),Ee=t(le);{var Le=o=>{var d=ot(),v=t(d),u=a(t(v),2),l=t(u,!0);r(u),r(v),r(d),R(f=>s(l,f),[()=>n()("onboarding.invite.loadingInvite")]),_(o,d)},$e=o=>{var d=Qe(),v=We(d);{var u=f=>{var p=st(),S=t(p),k=a(t(S),2),B=t(k,!0);r(k);var y=a(k,2),J=t(y,!0);r(y);var b=a(y,2);b.__click=()=>ae("/");var A=t(b,!0);r(b),r(S),r(p),R((K,L)=>{s(B,K),s(J,e(de)),s(A,L)},[()=>n()("onboarding.invite.inviteNotFound"),()=>n()("onboarding.invite.goHome")]),_(f,p)},l=f=>{var p=vt(),S=a(t(p),2),k=t(S);{var B=g=>{var m=dt(),h=t(m),w=t(h),ee=t(w);it(ee,{get ndk(){return O},get pubkey(){return e(i).inviter},class:"w-full h-full object-cover [&>*]:w-full [&>*]:h-full [&>*]:object-cover"}),r(w),r(h);var F=a(h,2),N=t(F),te=t(N,!0);r(N);var U=a(N,2),re=t(U,!0);r(U),r(F),r(m),R(ie=>{s(te,e(E)?.displayName||e(E)?.name||"Someone"),s(re,ie)},[()=>n()("onboarding.invite.invitedYou")]),_(g,m)};H(k,g=>{e(i)?.inviter&&g(B)})}var y=a(k,2);{var J=g=>{var m=lt(),h=t(m),w=t(h,!0);r(h),r(m),R(()=>s(w,e(i).welcomeMessage)),_(g,m)};H(y,g=>{e(i)?.welcomeMessage&&g(J)})}var b=a(y,2),A=t(b),K=t(A,!0);r(A);var L=a(A,2),Fe=t(L,!0);r(L),r(b);var P=a(b,2),D=t(P),ve=a(t(D),2),G=t(ve),Ue=t(G,!0);r(G);var ce=a(G,2),Ye=t(ce,!0);r(ce),r(ve),r(D);var q=a(D,2),ue=a(t(q),2),Q=t(ue),He=t(Q,!0);r(Q);var fe=a(Q,2),Oe=t(fe,!0);r(fe),r(ue),r(q);var pe=a(q,2),ge=a(t(pe),2),W=t(ge),Te=t(W,!0);r(W);var me=a(W,2),Ve=t(me,!0);r(me),r(ge),r(pe),r(P);var X=a(P,2),$=t(X);$.__click=Ie;var ze=t($);Xe(),r($);var Z=a($,2);Z.__click=Re;var xe=t(Z),he=a(xe),Be=t(he,!0);r(he),r(Z),r(X);var be=a(X,2),_e=t(be),Je=t(_e,!0);r(_e),r(be),r(S),r(p),R((g,m,h,w,ee,F,N,te,U,re,ie,Ke)=>{s(K,g),s(Fe,m),s(Ue,h),s(Ye,w),s(He,ee),s(Oe,F),s(Te,N),s(Ve,te),s(ze,`${U??""} `),s(xe,`${re??""}  `),s(Be,ie),s(Je,Ke)},[()=>n()("onboarding.invite.yourVoiceMatters"),()=>n()("onboarding.invite.joinGlobal"),()=>n()("onboarding.invite.ownYourVoice.title"),()=>n()("onboarding.invite.ownYourVoice.description"),()=>n()("onboarding.invite.earnFromStories.title"),()=>n()("onboarding.invite.earnFromStories.description"),()=>n()("onboarding.invite.connectCommunity.title"),()=>n()("onboarding.invite.connectCommunity.description"),()=>n()("onboarding.invite.startJourney"),()=>n()("onboarding.invite.alreadyHaveAccount"),()=>n()("onboarding.invite.signInHere"),()=>n()("onboarding.invite.trustSignals")]),_(f,p)};H(v,f=>{e(de)?f(u):f(l,!1)},!0)}_(o,d)};H(Ee,o=>{e(Ne)?o(Le):o($e,!1)})}r(le),r(z),_(we,z),qe(),je()}Pe(["click"]);export{wt as component};
