import"../chunks/DsnmJJEf.js";import{d as Me,p as ne,u as xe,s as c,b as F,i as u,k as d,j as z,r as i,t as de,l as pe,g as t,e,h as ie,f as b,aP as _e,c as S,a as he,M as je,K as Se,L as le}from"../chunks/Bq750rDx.js";import{i as y}from"../chunks/BcjopvHb.js";import{n as J}from"../chunks/CdRP5_sk.js";import{e as be}from"../chunks/Cjcfrngr.js";import{g as ze}from"../chunks/C88829DE.js";import{A as Ue}from"../chunks/Bt6DpIqu.js";import{T as Be}from"../chunks/3NtbZaKM.js";import{c as H}from"../chunks/BRAzWB6r.js";import{a as Ne,r as we}from"../chunks/uSFILAY7.js";import{b as ye}from"../chunks/BTSVJW8r.js";import{p as ge,b as ke}from"../chunks/BL6J_geM.js";import{M as Pe,b as Ae,c as De,d as Te,R as Oe,e as He,f as Le,g as Ie,h as Ee}from"../chunks/Dw4s2o4Z.js";import{U as Re}from"../chunks/DOhHcjXC.js";import{m as Ve}from"../chunks/BkQIuFjj.js";var Ke=u('<div class="text-xs text-neutral-500 flex-shrink-0 ml-2"><!></div>'),Qe=u('<span class="text-neutral-500">You:</span>'),We=u("<!> ",1),qe=u('<div class="ml-2 flex-shrink-0 min-w-[20px] h-5 px-1.5 rounded-full bg-primary flex items-center justify-center"><span class="text-xs font-bold text-primary-foreground"> </span></div>'),Ye=u('<button class="w-full flex items-center gap-3 px-4 py-4 hover:bg-neutral-900/50 transition-colors text-left"><!> <div class="flex-1 min-w-0"><div class="flex items-center justify-between mb-1"><div class="font-semibold text-white truncate"> </div> <!></div> <div class="flex items-center justify-between"><p class="text-sm text-neutral-400 truncate flex-1"><!></p> <!></div></div></button>');function Fe(A,r){ne(r,!0);const m=r.conversation.getOtherParticipant(),s=r.conversation.getLastMessage();let p=F(null);xe(()=>{if(!m?.pubkey){c(p,null);return}J.fetchUser(m.pubkey).then(l=>{l?.fetchProfile().then(v=>{c(p,v,!0)})})});function o(){m&&ze(`/messages/${m.npub}`)}var f=Ye();f.__click=o;var w=d(f);{var P=l=>{Ue(l,{get ndk(){return J},get pubkey(){return m.pubkey},class:"w-12 h-12 flex-shrink-0"})};y(w,l=>{m&&l(P)})}var h=z(w,2),_=d(h),k=d(_),O=d(k,!0);i(k);var U=z(k,2);{var j=l=>{var v=Ke(),B=d(v);Be(B,{get timestamp(){return s.timestamp}}),i(v),e(l,v)};y(U,l=>{s&&l(j)})}i(_);var G=z(_,2),a=d(G),L=d(a);{var X=l=>{var v=We(),B=b(v);{var I=R=>{var ve=Qe();e(R,ve)};y(B,R=>{s.sender.pubkey===J.activeUser?.pubkey&&R(I)})}var E=z(B);de(()=>pe(E,` ${s.content??""}`)),e(l,v)},Z=l=>{var v=_e("No messages yet");e(l,v)};y(L,l=>{s?l(X):l(Z,!1)})}i(a);var $=z(a,2);{var D=l=>{var v=qe(),B=d(v),I=d(B,!0);i(B),i(v),de(E=>pe(I,E),[()=>r.conversation.getUnreadCount()>99?"99+":r.conversation.getUnreadCount()]),e(l,v)};y($,l=>{r.conversation.getUnreadCount()>0&&l(D)})}i(G),i(h),i(f),de(()=>pe(O,t(p)?.name||t(p)?.displayName||"Anonymous")),e(A,f),ie()}Me(["click"]);var Ge=u(`<div class="flex flex-col items-center justify-center py-16 px-6 text-center"><svg class="w-20 h-20 text-neutral-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <h3 class="text-xl font-semibold text-white mb-2">No messages yet</h3> <p class="text-neutral-400 max-w-sm">Start a conversation by visiting someone's profile and clicking the message button</p></div>`),Je=u('<div class="divide-y divide-neutral-800/50"><!></div>');function Xe(A,r){ne(r,!0);var m=Je(),s=d(m);{var p=f=>{var w=Ge();e(f,w)},o=f=>{var w=S(),P=b(w);be(P,17,()=>r.conversations,h=>h.id,(h,_)=>{Fe(h,{get conversation(){return t(_)}})}),e(f,w)};y(s,f=>{r.conversations.length===0?f(p):f(o,!1)})}i(m),e(A,m),ie()}var Ze=je('<svg class="w-5 h-5 text-muted-foreground flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>'),$e=u("<div><!> <!></div>");function Ce(A,r){ne(r,!0);let m=ge(r,"showArrow",3,!1),s=ge(r,"size",3,"md"),p=ge(r,"class",3,"");const o=he(()=>s()==="sm"?"w-8 h-8":s()==="md"?"w-10 h-10":"w-12 h-12"),f=he(()=>s()==="sm"?"text-sm font-semibold":(s()==="md","text-base font-semibold")),w=he(()=>s()==="sm"?"text-xs text-muted-foreground":"text-sm text-muted-foreground");function P(U){U.preventDefault(),r.onClick(r.user)}var h=$e(),_=d(h);Re(_,{get pubkey(){return r.user.pubkey},variant:"avatar-name-handle",get avatarSize(){return t(o)},get nameSize(){return t(f)},get handleSize(){return t(w)},showHoverCard:!1,onclick:P,class:"flex-1"});var k=z(_,2);{var O=U=>{var j=Ze();e(U,j)};y(k,U=>{m()&&U(O)})}i(h),de(()=>Ne(h,1,`w-full flex items-center gap-3 px-4 py-4 hover:bg-muted transition-colors ${p()}`)),e(A,h),ie()}var et=u('<div class="flex items-center justify-center py-12"><svg class="w-8 h-8 text-primary animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div>'),tt=u('<div class="flex flex-col items-center justify-center py-12 px-6 text-center"><svg class="w-16 h-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <p class="text-muted-foreground">No users found</p> <p class="text-sm text-muted-foreground/60 mt-1">Try a different search term</p></div>'),rt=u('<div class="divide-y divide-border"></div>'),st=u('<div class="flex flex-col items-center justify-center py-12 px-6 text-center"><svg class="w-16 h-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <p class="text-muted-foreground">Search for someone to message</p> <p class="text-sm text-muted-foreground/60 mt-1">Enter a name or paste an npub</p></div>'),at=u('<!> <div class="mb-4"><div class="relative"><input type="text" placeholder="Search by name or paste npub..." class="w-full px-4 py-3 pl-12 bg-card border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></div> <div class="max-h-96 overflow-y-auto"><!></div>',1),ot=u('<div class="flex items-center justify-center py-12"><svg class="w-8 h-8 text-primary animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div>'),nt=u('<div class="flex flex-col items-center justify-center py-12 px-6 text-center"><svg class="w-16 h-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <p class="text-muted-foreground">No users found</p> <p class="text-sm text-muted-foreground/60 mt-1">Try a different search term</p></div>'),it=u('<div class="divide-y divide-border"></div>'),lt=u('<div class="flex flex-col items-center justify-center py-12 px-6 text-center"><svg class="w-16 h-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <p class="text-muted-foreground">Search for someone to message</p> <p class="text-sm text-muted-foreground/60 mt-1">Enter a name or paste an npub</p></div>'),dt=u('<!> <div class="px-4 mb-4"><div class="relative"><input type="text" placeholder="Search by name or paste npub..." class="w-full px-4 py-3 pl-12 bg-card border border-border rounded-lg text-foreground placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></div> <div class="overflow-y-auto pb-4"><!></div>',1);function vt(A,r){ne(r,!0);const m=new Pe("(min-width: 768px)");let s=F(""),p=F(!1),o=F(Se([])),f=F(null);async function w(){if(!t(s).trim()){c(o,[],!0);return}c(p,!0);try{if(t(s).startsWith("npub")||t(s).startsWith("nprofile"))try{const a=await J.fetchUser(t(s).trim());a?c(o,[a],!0):c(o,[],!0)}catch(a){console.error("Invalid npub:",a),c(o,[],!0)}else try{const a=await J.fetchUser(t(s).trim());a?c(o,[a],!0):c(o,[],!0)}catch(a){console.error("Search error:",a),c(o,[],!0)}}catch(a){console.error("Search error:",a),c(o,[],!0)}finally{c(p,!1)}}function P(a){c(f,a,!0),ze(`/messages/${a.npub}`),r.onClose()}function h(a){a.key==="Enter"&&!t(p)&&w()}let _=null;xe(()=>(t(s).trim()?(_&&clearTimeout(_),_=setTimeout(()=>{w()},500)):c(o,[],!0),()=>{_&&clearTimeout(_)}));let k=F(null);xe(()=>{r.isOpen&&t(k)&&setTimeout(()=>t(k)?.focus(),100)});var O=S(),U=b(O);{var j=a=>{var L=S(),X=b(L);H(X,()=>Oe,(Z,$)=>{$(Z,{get open(){return r.isOpen},onOpenChange:D=>{D||r.onClose()},children:(D,l)=>{var v=S(),B=b(v);H(B,()=>Ae,(I,E)=>{E(I,{class:"max-w-md",onkeydown:h,children:(R,ve)=>{var ee=at(),te=b(ee);H(te,()=>De,(n,C)=>{C(n,{children:(Q,ae)=>{var T=S(),g=b(T);H(g,()=>Te,(M,W)=>{W(M,{children:(q,oe)=>{le();var x=_e("New Message");e(q,x)},$$slots:{default:!0}})}),e(Q,T)},$$slots:{default:!0}})});var V=z(te,2),re=d(V),K=d(re);we(K),ke(K,n=>c(k,n),()=>t(k)),le(2),i(re),i(V);var se=z(V,2),ce=d(se);{var ue=n=>{var C=et();e(n,C)},fe=n=>{var C=S(),Q=b(C);{var ae=g=>{var M=tt();e(g,M)},T=g=>{var M=S(),W=b(M);{var q=x=>{var N=rt();be(N,21,()=>t(o),Y=>Y.pubkey,(Y,me)=>{Ce(Y,{get user(){return t(me)},onClick:P,showArrow:!0,size:"lg"})}),i(N),e(x,N)},oe=x=>{var N=st();e(x,N)};y(W,x=>{t(o).length>0?x(q):x(oe,!1)},!0)}e(g,M)};y(Q,g=>{t(s).trim()&&t(o).length===0?g(ae):g(T,!1)},!0)}e(n,C)};y(ce,n=>{t(p)?n(ue):n(fe,!1)})}i(se),ye(K,()=>t(s),n=>c(s,n)),e(R,ee)},$$slots:{default:!0}})}),e(D,v)},$$slots:{default:!0}})}),e(a,L)},G=a=>{var L=S(),X=b(L);H(X,()=>Ee,(Z,$)=>{$(Z,{get open(){return r.isOpen},onOpenChange:D=>{D||r.onClose()},children:(D,l)=>{var v=S(),B=b(v);H(B,()=>He,(I,E)=>{E(I,{onkeydown:h,children:(R,ve)=>{var ee=dt(),te=b(ee);H(te,()=>Le,(n,C)=>{C(n,{class:"text-left",children:(Q,ae)=>{var T=S(),g=b(T);H(g,()=>Ie,(M,W)=>{W(M,{children:(q,oe)=>{le();var x=_e("New Message");e(q,x)},$$slots:{default:!0}})}),e(Q,T)},$$slots:{default:!0}})});var V=z(te,2),re=d(V),K=d(re);we(K),ke(K,n=>c(k,n),()=>t(k)),le(2),i(re),i(V);var se=z(V,2),ce=d(se);{var ue=n=>{var C=ot();e(n,C)},fe=n=>{var C=S(),Q=b(C);{var ae=g=>{var M=nt();e(g,M)},T=g=>{var M=S(),W=b(M);{var q=x=>{var N=it();be(N,21,()=>t(o),Y=>Y.pubkey,(Y,me)=>{Ce(Y,{get user(){return t(me)},onClick:P,showArrow:!0,size:"lg"})}),i(N),e(x,N)},oe=x=>{var N=lt();e(x,N)};y(W,x=>{t(o).length>0?x(q):x(oe,!1)},!0)}e(g,M)};y(Q,g=>{t(s).trim()&&t(o).length===0?g(ae):g(T,!1)},!0)}e(n,C)};y(ce,n=>{t(p)?n(ue):n(fe,!1)})}i(se),ye(K,()=>t(s),n=>c(s,n)),e(R,ee)},$$slots:{default:!0}})}),e(D,v)},$$slots:{default:!0}})}),e(a,L)};y(U,a=>{m.current?a(j):a(G,!1)})}e(A,O),ie()}var ct=u('<div class="flex flex-col items-center justify-center h-full px-6 text-center"><svg class="w-20 h-20 text-muted mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> <h3 class="text-xl font-semibold text-foreground mb-2">Sign in required</h3> <p class="text-muted-foreground max-w-sm">Please sign in to view and send direct messages</p></div>'),ut=u('<div class="h-full flex flex-col"><div class="sticky top-0 z-10 bg-background border-b border-border/50 px-4 py-3"><div class="flex items-center justify-between"><h1 class="text-xl font-bold text-foreground">Messages</h1> <button class="p-2 rounded-lg hover:bg-muted transition-colors text-muted-foreground hover:text-primary" title="New message"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div class="flex-1 overflow-y-auto"><!></div></div> <!>',1);function St(A,r){ne(r,!0);let m=F(!1);function s(){c(m,!0)}var p=ut(),o=b(p),f=d(o),w=d(f),P=z(d(w),2);P.__click=s,i(w),i(f);var h=z(f,2),_=d(h);{var k=j=>{var G=ct();e(j,G)},O=j=>{Xe(j,{get conversations(){return Ve.conversations}})};y(_,j=>{J.$currentUser?j(O,!1):j(k)})}i(h),i(o);var U=z(o,2);vt(U,{get isOpen(){return t(m)},onClose:()=>c(m,!1)}),e(A,p),ie()}Me(["click"]);export{St as component};
