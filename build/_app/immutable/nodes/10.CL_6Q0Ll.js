import"../chunks/DsnmJJEf.js";import{b as X,K as Ir,g as e,s as d,d as jr,p as Sr,c as vr,P as Ke,f as he,e as l,h as Br,aO as Vr,i as n,j as a,k as o,L as y,aP as G,r as t,t as h,l as M,M as Er,a as Me,u as Ur}from"../chunks/Bq750rDx.js";import{i as U}from"../chunks/BcjopvHb.js";import{e as le,i as be}from"../chunks/Cjcfrngr.js";import{a as Pr,g as We,c as xe,r as Fr}from"../chunks/uSFILAY7.js";import{b as Or}from"../chunks/BTSVJW8r.js";import{n as ur,l as zr}from"../chunks/CdRP5_sk.js";import{g as cr}from"../chunks/C88829DE.js";import{h as Lr}from"../chunks/jsJqZDHS.js";import{c as Cr}from"../chunks/BTtwMI9n.js";import{c as fe}from"../chunks/BRAzWB6r.js";import{p as Ar,b as Mr}from"../chunks/BL6J_geM.js";import{t as Ge}from"../chunks/8lBcLtWK.js";import{M as Rr,b as Tr,c as Hr,d as qr,R as Nr,e as Kr,f as Wr,g as Gr,h as Qr}from"../chunks/Dw4s2o4Z.js";import{D as Jr}from"../chunks/DtjL0N-6.js";import{I as _e,B as Je}from"../chunks/DMhdcQZj.js";import{L as ee,T as Dr}from"../chunks/BoTf7nuy.js";import{N as Xr,c as Yr}from"../chunks/wiMjQwcH.js";import{D as Zr}from"../chunks/CHVQ8-IN.js";function et(Xe,Pe={}){const Ye=new Xr(Xe),H=Yr(Ye);let g=X(Ir([])),D=X(0),Q=X(!1);async function F(v){if(!v.type.startsWith("image/")){Ge.error("Please select an image file");return}try{if(await H.upload(v,{fallbackServer:Pe.fallbackServer||"https://blossom.primal.net"}),H.result?.url){const S=new Image,re=await new Promise(Le=>{S.onload=()=>Le({width:S.width,height:S.height}),S.src=URL.createObjectURL(v)});d(g,[...e(g),{url:H.result.url,mimeType:v.type,hash:H.result.sha256||"",blurhash:H.result.blurhash,dimensions:re}],!0),d(D,e(g).length-1)}}catch(S){console.error("Upload failed:",S),Ge.error("Failed to upload image")}}function ie(v){const re=v.target.files;re&&Array.from(re).forEach(Le=>F(Le))}function pe(v){v.preventDefault(),d(Q,!0)}function me(){d(Q,!1)}async function N(v){v.preventDefault(),d(Q,!1);const S=v.dataTransfer?.files;S&&Array.from(S).forEach(re=>F(re))}function K(v){d(g,e(g).filter((S,re)=>re!==v),!0),e(D)>=e(g).length&&d(D,Math.max(0,e(g).length-1),!0)}function O(){d(g,[],!0),d(D,0),d(Q,!1)}return{get uploadedImages(){return e(g)},set uploadedImages(v){d(g,v,!0)},get currentImageIndex(){return e(D)},set currentImageIndex(v){d(D,v,!0)},get isDragging(){return e(Q)},get uploadStatus(){return H.status},get uploadProgress(){return H.progress},uploadFile:F,handleFileInputChange:ie,handleDragOver:pe,handleDragLeave:me,handleDrop:N,removeImage:K,reset:O}}var rt=n('<div class="flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <!></div>'),tt=n('Title <span class="text-red-500">*</span>',1),at=n('Description <span class="text-red-500">*</span>',1),ot=n("<option> </option>"),st=n("<option> </option>"),lt=Er('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>'),it=n('<div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm"><span> </span> <button type="button" class="hover:text-primary"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),nt=n('<div class="flex flex-wrap gap-2"></div>'),dt=n('<div class="flex flex-col items-center gap-2"><div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span class="text-sm text-muted-foreground"> </span></div>'),vt=n('<svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-muted-foreground">Click to upload or drag and drop</span> <span class="text-xs text-muted-foreground">Multiple images supported</span>',1),ut=n('<div class="relative group"><img class="w-full h-32 object-cover rounded-lg border border-border"/> <button type="button" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),ct=n('<div class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>'),pt=n("<!> <!>",1),gt=n('<!> <div class="space-y-6"><div class="space-y-5"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Pricing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <select id="currency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"></select></div> <div><!> <select id="frequency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>One time</option><option>Per hour</option><option>Per day</option><option>Per week</option><option>Per month</option><option>Per year</option></select></div></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Categories</h3> <div class="space-y-4"><div class="flex gap-2"><select class="flex-1 px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>Select a category</option><!></select> <!> <!></div> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Images</h3> <div class="space-y-4"><input type="file" accept="image/*" multiple class="hidden"/> <button type="button"><!></button> <!></div></div></div> <!>',1),mt=n('<div class="flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> <!></div>'),ft=n('Title <span class="text-red-500">*</span>',1),_t=n('Description <span class="text-red-500">*</span>',1),ht=n("<option> </option>"),bt=n("<option> </option>"),xt=Er('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>'),yt=n('<div class="inline-flex items-center gap-1 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm"><span> </span> <button type="button" class="hover:text-primary"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),$t=n('<div class="flex flex-wrap gap-2"></div>'),kt=n('<div class="flex flex-col items-center gap-2"><div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span class="text-sm text-muted-foreground"> </span></div>'),wt=n('<svg class="w-10 h-10 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <span class="text-sm text-muted-foreground">Click to upload or drag and drop</span> <span class="text-xs text-muted-foreground">Multiple images supported</span>',1),Ct=n('<div class="relative group"><img class="w-full h-32 object-cover rounded-lg border border-border"/> <button type="button" class="absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Pt=n('<div class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>'),Lt=n("<!> <!>",1),Mt=n('<!> <div class="px-4 space-y-6 overflow-auto flex-1"><div class="space-y-5"><div><!> <!></div> <div><!> <!></div> <div><!> <!></div> <div><!> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Pricing</h3> <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><!> <!></div> <div><!> <select id="currency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"></select></div> <div><!> <select id="frequency" class="mt-2 w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>One time</option><option>Per hour</option><option>Per day</option><option>Per week</option><option>Per month</option><option>Per year</option></select></div></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Categories</h3> <div class="space-y-4"><div class="flex gap-2"><select class="flex-1 px-4 py-3 bg-muted border border-border rounded-lg text-foreground focus:outline-none focus:border-primary transition-colors"><option>Select a category</option><!></select> <!> <!></div> <!></div></div> <div class="bg-muted/30 rounded-lg p-5 border border-border"><h3 class="text-lg font-semibold text-foreground mb-4">Images</h3> <div class="space-y-4"><input type="file" accept="image/*" multiple class="hidden"/> <button type="button"><!></button> <!></div></div></div> <!>',1);function Dt(Xe,Pe){Sr(Pe,!0);const Ye=new Rr("(min-width: 768px)");let H=Ar(Pe,"open",15,!1),g=X(!1),D=X(""),Q=X(""),F=X(""),ie=X(""),pe=X(""),me=X("USD"),N=X(void 0),K=X(Ir([])),O=X("");const v=et(ur,{fallbackServer:"https://blossom.primal.net"});let S;const re=["electronics","furniture","clothing","books","services","vehicles","real-estate","jobs","free","wanted"],Le=["USD","EUR","GBP","BTC","SATS"];function Qe(){e(O)&&!e(K).includes(e(O).toLowerCase())&&(d(K,[...e(K),e(O).toLowerCase()],!0),d(O,""))}function p(u){d(K,e(K).filter(m=>m!==u),!0)}async function k(){if(!e(D).trim()||!e(F).trim()||e(g)){Ge.error("Please provide a title and description");return}if(!ur.$currentUser){Ge.error("Please log in to create a listing");return}try{d(g,!0);const u=new zr(ur);if(u.title=e(D).trim(),u.summary=e(Q).trim()||void 0,u.content=e(F).trim(),u.location=e(ie).trim()||void 0,u.published_at=Math.floor(Date.now()/1e3),u.tags.push(["status","active"]),e(pe).trim()&&(u.price={amount:parseFloat(e(pe)),currency:e(me),frequency:e(N)&&e(N)!=="once"?e(N):void 0}),e(K).forEach(m=>{u.tags.push(["t",m])}),v.uploadedImages.forEach(m=>{u.tags.push(["image",m.url])}),await u.sign(),await u.publish(),u.publishStatus==="error"){const $=u.publishError?.relayErrors||{},E=Object.entries($).map(([j,f])=>`${j}: ${f}`).join(`
`);Ge.error(`Failed to publish:
${E||"Unknown error"}`);return}Ge.success("Listing created successfully"),B(),H(!1),Pe.onClose?.(),cr("/marketplace")}catch(u){console.error("Failed to publish listing:",u),Ge.error(`Failed to create listing: ${u instanceof Error?u.message:"Unknown error"}`)}finally{d(g,!1)}}function B(){d(D,""),d(Q,""),d(F,""),d(ie,""),d(pe,""),d(me,"USD"),d(N,void 0),d(K,[],!0),d(O,""),v.reset()}function I(){e(g)||(B(),H(!1),Pe.onClose?.())}function Y(u){u.key==="Escape"&&!e(g)&&I()}var C=vr();Ke("keydown",Vr,Y);var b=he(C);{var J=u=>{var m=vr(),$=he(m);fe($,()=>Nr,(E,j)=>{j(E,{get open(){return H()},onOpenChange:f=>{H(f),f||I()},children:(f,ne)=>{var Z=vr(),ge=he(Z);fe(ge,()=>Tr,(P,x)=>{x(P,{class:"max-w-4xl max-h-[90vh] overflow-y-auto",children:(q,de)=>{var ae=gt(),ye=he(ae);fe(ye,()=>Hr,(r,i)=>{i(r,{children:(s,w)=>{var c=rt(),_=a(o(c),2);fe(_,()=>qr,(R,T)=>{T(R,{children:(we,Ne)=>{y();var Ce=G("Create Listing");l(we,Ce)},$$slots:{default:!0}})}),t(c),l(s,c)},$$slots:{default:!0}})});var ve=a(ye,2),oe=o(ve),L=o(oe),V=o(L);ee(V,{for:"title",children:(r,i)=>{y();var s=tt();y(),l(r,s)},$$slots:{default:!0}});var ue=a(V,2);_e(ue,{id:"title",type:"text",placeholder:"What are you listing?",maxlength:200,class:"mt-2",get value(){return e(D)},set value(r){d(D,r,!0)}}),t(L);var se=a(L,2),$e=o(se);ee($e,{for:"summary",children:(r,i)=>{y();var s=G("Summary");l(r,s)},$$slots:{default:!0}});var W=a($e,2);_e(W,{id:"summary",type:"text",placeholder:"Brief description",maxlength:200,class:"mt-2",get value(){return e(Q)},set value(r){d(Q,r,!0)}}),t(se);var z=a(se,2),ce=o(z);ee(ce,{for:"content",children:(r,i)=>{y();var s=at();y(),l(r,s)},$$slots:{default:!0}});var De=a(ce,2);Dr(De,{id:"content",placeholder:"Detailed description (Markdown supported)",rows:6,class:"mt-2 resize-none",get value(){return e(F)},set value(r){d(F,r,!0)}}),t(z);var Ie=a(z,2),Ze=o(Ie);ee(Ze,{for:"location",children:(r,i)=>{y();var s=G("Location");l(r,s)},$$slots:{default:!0}});var pr=a(Ze,2);_e(pr,{id:"location",type:"text",placeholder:"City, State or Country",class:"mt-2",get value(){return e(ie)},set value(r){d(ie,r,!0)}}),t(Ie),t(oe);var je=a(oe,2),er=a(o(je),2),Se=o(er),rr=o(Se);ee(rr,{for:"price-amount",children:(r,i)=>{y();var s=G("Amount");l(r,s)},$$slots:{default:!0}});var gr=a(rr,2);_e(gr,{id:"price-amount",type:"text",placeholder:"0.00",class:"mt-2",get value(){return e(pe)},set value(r){d(pe,r,!0)}}),t(Se);var Be=a(Se,2),tr=o(Be);ee(tr,{for:"currency",children:(r,i)=>{y();var s=G("Currency");l(r,s)},$$slots:{default:!0}});var Ee=a(tr,2);le(Ee,21,()=>Le,be,(r,i)=>{var s=ot(),w=o(s,!0);t(s);var c={};h(()=>{M(w,e(i)),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")}),l(r,s)}),t(Ee),t(Be);var ar=a(Be,2),or=o(ar);ee(or,{for:"frequency",children:(r,i)=>{y();var s=G("Frequency");l(r,s)},$$slots:{default:!0}});var Ve=a(or,2),Ue=o(Ve);Ue.value=(Ue.__value=void 0)??"";var Fe=a(Ue);Fe.value=Fe.__value="hour";var Oe=a(Fe);Oe.value=Oe.__value="day";var ze=a(Oe);ze.value=ze.__value="week";var Ae=a(ze);Ae.value=Ae.__value="month";var sr=a(Ae);sr.value=sr.__value="year",t(Ve),t(ar),t(er),t(je);var Re=a(je,2),lr=a(o(Re),2),Te=o(lr),ke=o(Te),He=o(ke);He.value=He.__value="";var mr=a(He);le(mr,17,()=>re,be,(r,i)=>{var s=st(),w=o(s,!0);t(s);var c={};h(_=>{M(w,_),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")},[()=>e(i).charAt(0).toUpperCase()+e(i).slice(1)]),l(r,s)}),t(ke);var ir=a(ke,2);_e(ir,{type:"text",placeholder:"Or type custom",class:"flex-1",onkeydown:r=>{r.key==="Enter"&&(r.preventDefault(),Qe())},get value(){return e(O)},set value(r){d(O,r,!0)}});var fr=a(ir,2);Je(fr,{type:"button",onclick:Qe,size:"icon",children:(r,i)=>{var s=lt();l(r,s)},$$slots:{default:!0}}),t(Te);var _r=a(Te,2);{var hr=r=>{var i=nt();le(i,21,()=>e(K),be,(s,w)=>{var c=it(),_=o(c),R=o(_,!0);t(_);var T=a(_,2);T.__click=()=>p(e(w)),t(c),h(()=>M(R,e(w))),l(s,c)}),t(i),l(r,i)};U(_r,r=>{e(K).length>0&&r(hr)})}t(lr),t(Re);var nr=a(Re,2),dr=a(o(nr),2),qe=o(dr);qe.__change=function(...r){v.handleFileInputChange?.apply(this,r)},Mr(qe,r=>S=r,()=>S);var A=a(qe,2);A.__click=()=>S?.click();var br=o(A);{var xr=r=>{var i=dt(),s=a(o(i),2),w=o(s);t(s),t(i),h(()=>M(w,`${(v.uploadProgress?.percentage||0)??""}%`)),l(r,i)},yr=r=>{var i=vt();y(4),l(r,i)};U(br,r=>{v.uploadStatus==="uploading"?r(xr):r(yr,!1)})}t(A);var $r=a(A,2);{var kr=r=>{var i=ct();le(i,21,()=>v.uploadedImages,be,(s,w,c)=>{var _=ut(),R=o(_);xe(R,"alt",`Listing image ${c+1}`);var T=a(R,2);T.__click=()=>v.removeImage(c),t(_),h(()=>xe(R,"src",e(w).url)),l(s,_)}),t(i),l(r,i)};U($r,r=>{v.uploadedImages.length>0&&r(kr)})}t(dr),t(nr),t(ve);var wr=a(ve,2);fe(wr,()=>Zr,(r,i)=>{i(r,{class:"flex gap-3 sm:space-x-0",children:(s,w)=>{var c=pt(),_=he(c);Je(_,{variant:"outline",onclick:I,get disabled(){return e(g)},children:(T,we)=>{y();var Ne=G("Cancel");l(T,Ne)},$$slots:{default:!0}});var R=a(_,2);{let T=Me(()=>!e(D).trim()||!e(F).trim()||e(g));Je(R,{onclick:k,get disabled(){return e(T)},children:(we,Ne)=>{y();var Ce=G();h(()=>M(Ce,e(g)?"Publishing...":"Publish Listing")),l(we,Ce)},$$slots:{default:!0}})}l(s,c)},$$slots:{default:!0}})}),h(()=>{A.disabled=v.uploadStatus==="uploading",Pr(A,1,`w-full h-32 rounded-lg border-2 border-dashed transition-colors flex flex-col items-center justify-center gap-2 ${v.isDragging?"border-primary bg-muted/40":"border-border hover:border-primary bg-muted/20 hover:bg-muted/40"}`)}),We(Ee,()=>e(me),r=>d(me,r)),We(Ve,()=>e(N),r=>d(N,r)),We(ke,()=>e(O),r=>d(O,r)),Ke("dragover",A,function(...r){v.handleDragOver?.apply(this,r)}),Ke("dragleave",A,function(...r){v.handleDragLeave?.apply(this,r)}),Ke("drop",A,function(...r){v.handleDrop?.apply(this,r)}),l(q,ae)},$$slots:{default:!0}})}),l(f,Z)},$$slots:{default:!0}})}),l(u,m)},te=u=>{var m=vr(),$=he(m);fe($,()=>Qr,(E,j)=>{j(E,{get open(){return H()},onOpenChange:f=>{H(f),f||I()},children:(f,ne)=>{var Z=vr(),ge=he(Z);fe(ge,()=>Kr,(P,x)=>{x(P,{children:(q,de)=>{var ae=Mt(),ye=he(ae);fe(ye,()=>Wr,(r,i)=>{i(r,{class:"text-left",children:(s,w)=>{var c=mt(),_=a(o(c),2);fe(_,()=>Gr,(R,T)=>{T(R,{children:(we,Ne)=>{y();var Ce=G("Create Listing");l(we,Ce)},$$slots:{default:!0}})}),t(c),l(s,c)},$$slots:{default:!0}})});var ve=a(ye,2),oe=o(ve),L=o(oe),V=o(L);ee(V,{for:"title",children:(r,i)=>{y();var s=ft();y(),l(r,s)},$$slots:{default:!0}});var ue=a(V,2);_e(ue,{id:"title",type:"text",placeholder:"What are you listing?",maxlength:200,class:"mt-2",get value(){return e(D)},set value(r){d(D,r,!0)}}),t(L);var se=a(L,2),$e=o(se);ee($e,{for:"summary",children:(r,i)=>{y();var s=G("Summary");l(r,s)},$$slots:{default:!0}});var W=a($e,2);_e(W,{id:"summary",type:"text",placeholder:"Brief description",maxlength:200,class:"mt-2",get value(){return e(Q)},set value(r){d(Q,r,!0)}}),t(se);var z=a(se,2),ce=o(z);ee(ce,{for:"content",children:(r,i)=>{y();var s=_t();y(),l(r,s)},$$slots:{default:!0}});var De=a(ce,2);Dr(De,{id:"content",placeholder:"Detailed description (Markdown supported)",rows:6,class:"mt-2 resize-none",get value(){return e(F)},set value(r){d(F,r,!0)}}),t(z);var Ie=a(z,2),Ze=o(Ie);ee(Ze,{for:"location",children:(r,i)=>{y();var s=G("Location");l(r,s)},$$slots:{default:!0}});var pr=a(Ze,2);_e(pr,{id:"location",type:"text",placeholder:"City, State or Country",class:"mt-2",get value(){return e(ie)},set value(r){d(ie,r,!0)}}),t(Ie),t(oe);var je=a(oe,2),er=a(o(je),2),Se=o(er),rr=o(Se);ee(rr,{for:"price-amount",children:(r,i)=>{y();var s=G("Amount");l(r,s)},$$slots:{default:!0}});var gr=a(rr,2);_e(gr,{id:"price-amount",type:"text",placeholder:"0.00",class:"mt-2",get value(){return e(pe)},set value(r){d(pe,r,!0)}}),t(Se);var Be=a(Se,2),tr=o(Be);ee(tr,{for:"currency",children:(r,i)=>{y();var s=G("Currency");l(r,s)},$$slots:{default:!0}});var Ee=a(tr,2);le(Ee,21,()=>Le,be,(r,i)=>{var s=ht(),w=o(s,!0);t(s);var c={};h(()=>{M(w,e(i)),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")}),l(r,s)}),t(Ee),t(Be);var ar=a(Be,2),or=o(ar);ee(or,{for:"frequency",children:(r,i)=>{y();var s=G("Frequency");l(r,s)},$$slots:{default:!0}});var Ve=a(or,2),Ue=o(Ve);Ue.value=(Ue.__value=void 0)??"";var Fe=a(Ue);Fe.value=Fe.__value="hour";var Oe=a(Fe);Oe.value=Oe.__value="day";var ze=a(Oe);ze.value=ze.__value="week";var Ae=a(ze);Ae.value=Ae.__value="month";var sr=a(Ae);sr.value=sr.__value="year",t(Ve),t(ar),t(er),t(je);var Re=a(je,2),lr=a(o(Re),2),Te=o(lr),ke=o(Te),He=o(ke);He.value=He.__value="";var mr=a(He);le(mr,17,()=>re,be,(r,i)=>{var s=bt(),w=o(s,!0);t(s);var c={};h(_=>{M(w,_),c!==(c=e(i))&&(s.value=(s.__value=e(i))??"")},[()=>e(i).charAt(0).toUpperCase()+e(i).slice(1)]),l(r,s)}),t(ke);var ir=a(ke,2);_e(ir,{type:"text",placeholder:"Or type custom",class:"flex-1",onkeydown:r=>{r.key==="Enter"&&(r.preventDefault(),Qe())},get value(){return e(O)},set value(r){d(O,r,!0)}});var fr=a(ir,2);Je(fr,{type:"button",onclick:Qe,size:"icon",children:(r,i)=>{var s=xt();l(r,s)},$$slots:{default:!0}}),t(Te);var _r=a(Te,2);{var hr=r=>{var i=$t();le(i,21,()=>e(K),be,(s,w)=>{var c=yt(),_=o(c),R=o(_,!0);t(_);var T=a(_,2);T.__click=()=>p(e(w)),t(c),h(()=>M(R,e(w))),l(s,c)}),t(i),l(r,i)};U(_r,r=>{e(K).length>0&&r(hr)})}t(lr),t(Re);var nr=a(Re,2),dr=a(o(nr),2),qe=o(dr);qe.__change=function(...r){v.handleFileInputChange?.apply(this,r)},Mr(qe,r=>S=r,()=>S);var A=a(qe,2);A.__click=()=>S?.click();var br=o(A);{var xr=r=>{var i=kt(),s=a(o(i),2),w=o(s);t(s),t(i),h(()=>M(w,`${(v.uploadProgress?.percentage||0)??""}%`)),l(r,i)},yr=r=>{var i=wt();y(4),l(r,i)};U(br,r=>{v.uploadStatus==="uploading"?r(xr):r(yr,!1)})}t(A);var $r=a(A,2);{var kr=r=>{var i=Pt();le(i,21,()=>v.uploadedImages,be,(s,w,c)=>{var _=Ct(),R=o(_);xe(R,"alt",`Listing image ${c+1}`);var T=a(R,2);T.__click=()=>v.removeImage(c),t(_),h(()=>xe(R,"src",e(w).url)),l(s,_)}),t(i),l(r,i)};U($r,r=>{v.uploadedImages.length>0&&r(kr)})}t(dr),t(nr),t(ve);var wr=a(ve,2);fe(wr,()=>Jr,(r,i)=>{i(r,{class:"pt-2",children:(s,w)=>{var c=Lt(),_=he(c);{let T=Me(()=>!e(D).trim()||!e(F).trim()||e(g));Je(_,{onclick:k,get disabled(){return e(T)},class:"w-full",children:(we,Ne)=>{y();var Ce=G();h(()=>M(Ce,e(g)?"Publishing...":"Publish Listing")),l(we,Ce)},$$slots:{default:!0}})}var R=a(_,2);Je(R,{variant:"outline",onclick:I,get disabled(){return e(g)},class:"w-full",children:(T,we)=>{y();var Ne=G("Cancel");l(T,Ne)},$$slots:{default:!0}}),l(s,c)},$$slots:{default:!0}})}),h(()=>{A.disabled=v.uploadStatus==="uploading",Pr(A,1,`w-full h-32 rounded-lg border-2 border-dashed transition-colors flex flex-col items-center justify-center gap-2 ${v.isDragging?"border-primary bg-muted/40":"border-border hover:border-primary bg-muted/20 hover:bg-muted/40"}`)}),We(Ee,()=>e(me),r=>d(me,r)),We(Ve,()=>e(N),r=>d(N,r)),We(ke,()=>e(O),r=>d(O,r)),Ke("dragover",A,function(...r){v.handleDragOver?.apply(this,r)}),Ke("dragleave",A,function(...r){v.handleDragLeave?.apply(this,r)}),Ke("drop",A,function(...r){v.handleDrop?.apply(this,r)}),l(q,ae)},$$slots:{default:!0}})}),l(f,Z)},$$slots:{default:!0}})}),l(u,m)};U(b,u=>{Ye.current?u(J):u(te,!1)})}l(Xe,C),Br()}jr(["click","change"]);var It=n("<option> </option>"),jt=n('<div class="container mx-auto px-4 py-3 max-w-7xl"><div class="mb-6"><div class="flex items-center justify-between mb-4"><h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary-600 to-primary-400 bg-clip-text text-transparent">Marketplace</h1> <button class="hidden sm:flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary/90 text-foreground font-medium rounded-lg transition-colors"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span>Create Listing</span></button></div> <div class="flex gap-2 sm:gap-3"><div class="flex-1"><div class="relative"><svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search listings..." class="w-full pl-10 h-12 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all"/></div></div> <div class="relative"><select class="h-12 px-4 bg-white/80 dark:bg-background/80 backdrop-blur border border rounded-xl text-base focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all appearance-none pr-10"></select> <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-5 h-5 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></div></div></div>'),St=n('<div class="mb-6"><h2 class="text-xl font-semibold text-foreground"> </h2> <p class="text-sm text-muted-foreground mt-1"> </p></div>'),Bt=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Et=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Vt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Ut=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),Ft=n('<div class="col-span-full text-center py-12 text-muted-foreground">No listings found</div>'),Ot=n('<div><!> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),zt=n('<div class="text-center py-12 text-muted-foreground">No marketplace items yet</div>'),At=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Rt=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Tt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Ht=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),qt=n('<div class="mb-8"><h2 class="text-xl font-semibold text-foreground mb-4">Recent Listings</h2> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Nt=n('<div class="aspect-video bg-neutral-100 dark:bg-muted overflow-hidden"><img class="w-full h-full object-cover"/></div>'),Kt=n('<p class="text-sm text-muted-foreground mt-1 line-clamp-2"> </p>'),Wt=n('<p class="text-sm font-medium text-primary-600 dark:text-primary-400 mt-2"> </p>'),Gt=n('<button class="bg-white dark:bg-card/50 rounded-xl border border overflow-hidden transition-all hover:border-primary-500 dark:hover:border-primary-500 hover:shadow-lg text-left"><!> <div class="p-4"><h3 class="font-semibold text-foreground truncate"> </h3> <!> <!></div></button>'),Qt=n('<div class="mb-8"><div class="flex items-center justify-between mb-4"><h2 class="text-xl font-semibold text-foreground"> </h2> <button class="text-sm text-primary-600 dark:text-primary-400 hover:underline">View All</button></div> <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div>'),Jt=n("<!> <!>",1),Xt=n("<div><!></div>"),Yt=n('<div class="min-h-screen bg-neutral-50 dark:bg-background"><div class="container mx-auto px-4 py-4 max-w-7xl"><!></div> <!></div>');function ha(Xe,Pe){Sr(Pe,!0);const Ye=p=>{var k=jt(),B=o(k),I=o(B),Y=a(o(I),2);Y.__click=()=>Cr.open(),t(I);var C=a(I,2),b=o(C),J=o(b),te=a(o(J),2);Fr(te),t(J),t(b);var u=a(b,2),m=o(u);le(m,21,()=>H,be,($,E)=>{var j=It(),f=o(j,!0);t(j);var ne={};h(()=>{M(f,e(E).label),ne!==(ne=e(E).value)&&(j.value=(j.__value=e(E).value)??"")}),l($,j)}),t(m),y(2),t(u),t(C),t(B),t(k),Or(te,()=>e(D),$=>d(D,$)),We(m,()=>e(g),$=>d(g,$)),l(p,k)},H=[{value:"",label:"All Categories"},{value:"electronics",label:"Electronics"},{value:"furniture",label:"Furniture"},{value:"clothing",label:"Clothing"},{value:"books",label:"Books"},{value:"services",label:"Services"},{value:"vehicles",label:"Vehicles"},{value:"real-estate",label:"Real Estate"},{value:"jobs",label:"Jobs"},{value:"free",label:"Free"},{value:"wanted",label:"Wanted"}];let g=X(""),D=X("");const Q=ur.$subscribe(()=>{const p={kinds:[30402],limit:50};return e(g)&&(p["#t"]=[e(g).toLowerCase()]),{filters:[p],bufferMs:100}}),F=Me(()=>Q.events.filter(p=>{if((p.tagValue("status")||"active")!=="active")return!1;if(!e(D))return!0;const B=e(D).toLowerCase(),I=p.tagValue("title")?.toLowerCase()||"",Y=p.tagValue("summary")?.toLowerCase()||"",C=p.content?.toLowerCase()||"",b=p.tagValue("location")?.toLowerCase()||"";return I.includes(B)||Y.includes(B)||C.includes(B)||b.includes(B)})),ie=Me(()=>{const p={};return e(F).forEach(k=>{const B=k.tags.filter(I=>I[0]==="t").map(I=>I[1]);B.length>0?B.forEach(I=>{const Y=I.toLowerCase();p[Y]||(p[Y]=[]),p[Y].push(k)}):(p.uncategorized||(p.uncategorized=[]),p.uncategorized.push(k))}),p}),pe=Me(()=>e(g)||e(D));function me(p){d(g,p,!0)}function N(p){return p.tagValue("image")}function K(p){const k=p.tags.find(B=>B[0]==="price");return!k||!k[1]||!k[2]?null:{amount:k[1],currency:k[2]}}Ur(()=>(Lr.header=Ye,()=>{Lr.clear()}));var O=Yt(),v=o(O),S=o(v);{var re=p=>{var k=Ot(),B=o(k);{var I=C=>{var b=St(),J=o(b),te=o(J,!0);t(J);var u=a(J,2),m=o(u);t(u),t(b),h($=>{M(te,$),M(m,`${e(F).length??""} listings found`)},[()=>H.find($=>$.value===e(g))?.label||e(g)]),l(C,b)};U(B,C=>{e(g)&&C(I)})}var Y=a(B,2);le(Y,21,()=>e(F),C=>C.id,(C,b)=>{const J=Me(()=>K(e(b)));var te=Ut();te.__click=()=>cr(`/marketplace/${e(b).encode()}`);var u=o(te);{var m=P=>{var x=Bt(),q=o(x);t(x),h((de,ae)=>{xe(q,"src",de),xe(q,"alt",ae)},[()=>N(e(b)),()=>e(b).tagValue("title")||"Listing"]),l(P,x)};U(u,P=>{N(e(b))&&P(m)})}var $=a(u,2),E=o($),j=o(E,!0);t(E);var f=a(E,2);{var ne=P=>{var x=Et(),q=o(x,!0);t(x),h(de=>M(q,de),[()=>e(b).tagValue("summary")]),l(P,x)};U(f,P=>{e(b).tagValue("summary")&&P(ne)})}var Z=a(f,2);{var ge=P=>{var x=Vt(),q=o(x);t(x),h(()=>M(q,`${e(J).amount??""} ${e(J).currency??""}`)),l(P,x)};U(Z,P=>{e(J)&&P(ge)})}t($),t(te),h(P=>M(j,P),[()=>e(b).tagValue("title")||"Untitled"]),l(C,te)},C=>{var b=Ft();l(C,b)}),t(Y),t(k),l(p,k)},Le=p=>{var k=Xt(),B=o(k);{var I=C=>{var b=zt();l(C,b)},Y=C=>{var b=Jt(),J=he(b);{var te=m=>{var $=qt(),E=a(o($),2);le(E,21,()=>e(F).slice(0,8),j=>j.id,(j,f)=>{const ne=Me(()=>K(e(f)));var Z=Ht();Z.__click=()=>cr(`/marketplace/${e(f).encode()}`);var ge=o(Z);{var P=L=>{var V=At(),ue=o(V);t(V),h((se,$e)=>{xe(ue,"src",se),xe(ue,"alt",$e)},[()=>N(e(f)),()=>e(f).tagValue("title")||"Listing"]),l(L,V)};U(ge,L=>{N(e(f))&&L(P)})}var x=a(ge,2),q=o(x),de=o(q,!0);t(q);var ae=a(q,2);{var ye=L=>{var V=Rt(),ue=o(V,!0);t(V),h(se=>M(ue,se),[()=>e(f).tagValue("summary")]),l(L,V)};U(ae,L=>{e(f).tagValue("summary")&&L(ye)})}var ve=a(ae,2);{var oe=L=>{var V=Tt(),ue=o(V);t(V),h(()=>M(ue,`${e(ne).amount??""} ${e(ne).currency??""}`)),l(L,V)};U(ve,L=>{e(ne)&&L(oe)})}t(x),t(Z),h(L=>M(de,L),[()=>e(f).tagValue("title")||"Untitled"]),l(j,Z)}),t(E),t($),l(m,$)};U(J,m=>{e(F).length>0&&m(te)})}var u=a(J,2);le(u,17,()=>H.filter(m=>m.value&&e(ie)[m.value]?.length>0),be,(m,$)=>{var E=Qt(),j=o(E),f=o(j),ne=o(f,!0);t(f);var Z=a(f,2);Z.__click=()=>me(e($).value),t(j);var ge=a(j,2);le(ge,21,()=>e(ie)[e($).value].slice(0,4),P=>P.id,(P,x)=>{const q=Me(()=>K(e(x)));var de=Gt();de.__click=()=>cr(`/marketplace/${e(x).encode()}`);var ae=o(de);{var ye=W=>{var z=Nt(),ce=o(z);t(z),h((De,Ie)=>{xe(ce,"src",De),xe(ce,"alt",Ie)},[()=>N(e(x)),()=>e(x).tagValue("title")||"Listing"]),l(W,z)};U(ae,W=>{N(e(x))&&W(ye)})}var ve=a(ae,2),oe=o(ve),L=o(oe,!0);t(oe);var V=a(oe,2);{var ue=W=>{var z=Kt(),ce=o(z,!0);t(z),h(De=>M(ce,De),[()=>e(x).tagValue("summary")]),l(W,z)};U(V,W=>{e(x).tagValue("summary")&&W(ue)})}var se=a(V,2);{var $e=W=>{var z=Wt(),ce=o(z);t(z),h(()=>M(ce,`${e(q).amount??""} ${e(q).currency??""}`)),l(W,z)};U(se,W=>{e(q)&&W($e)})}t(ve),t(de),h(W=>M(L,W),[()=>e(x).tagValue("title")||"Untitled"]),l(P,de)}),t(ge),t(E),h(()=>M(ne,e($).label)),l(m,E)}),l(C,b)};U(B,C=>{Object.keys(e(ie)).length===0?C(I):C(Y,!1)})}t(k),l(p,k)};U(S,p=>{e(pe)?p(re):p(Le,!1)})}t(v);var Qe=a(v,2);Dt(Qe,{onClose:()=>{Q.restart?.()},get open(){return Cr.show},set open(p){Cr.show=p}}),t(O),l(Xe,O),Br()}jr(["click"]);export{ha as component};
