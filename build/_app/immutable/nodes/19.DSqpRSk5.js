import"../chunks/DsnmJJEf.js";import{d as ee,p as Z,i as x,k as s,j as g,r as o,t as A,l as U,e as f,h as D,M as J,g as i,a as P,aQ as re,f as te}from"../chunks/Bq750rDx.js";import{i as w}from"../chunks/BcjopvHb.js";import{e as G}from"../chunks/Cjcfrngr.js";import{g as oe}from"../chunks/C88829DE.js";import{k as ae,n as q,m as se,o as le,r as j}from"../chunks/CdRP5_sk.js";import{h as O}from"../chunks/jsJqZDHS.js";import{c as V,a as W}from"../chunks/uSFILAY7.js";import{p as Y}from"../chunks/BL6J_geM.js";import{u as ne}from"../chunks/BKSKCJuW.js";import{R as ie}from"../chunks/DoEkGPLs.js";import{A as ve}from"../chunks/Bt6DpIqu.js";var de=x('<span class="flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold bg-primary/20 text-primary rounded uppercase tracking-wide">Agora</span>'),ce=J('<svg class="w-4 h-4 text-primary flex-shrink-0" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>'),ue=x('<div class="w-5 h-5 rounded-full border-2 border-background bg-muted flex items-center justify-center text-[10px] font-medium text-muted-foreground"> </div>'),fe=x('<div class="flex -space-x-1.5 mb-2 items-center"><!> <!></div>'),ge=x('<p class="text-sm text-muted-foreground line-clamp-2"> </p>'),me=J('<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>'),pe=J('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg>'),he=x("<button><!></button>"),ye=x('<div><div class="flex items-start gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1 flex-wrap"><h3 class="text-sm font-semibold text-foreground truncate"> </h3> <!> <!></div> <p class="text-xs text-muted-foreground mb-1"> </p> <!> <!></div> <!></div></div>');function X(L,r){Z(r,!0);const d=Y(r,"pubkeys",19,()=>[]),m=Y(r,"isFavorite",3,!1),F=Y(r,"showFavoriteIcon",3,!1),v=ne(r.relayUrl);var l=ye();l.__click=function(...e){r.onclick?.apply(this,e)},l.__keydown=e=>{r.onclick&&(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),r.onclick())};var c=s(l),u=s(c);ie(u,{get relayUrl(){return r.relayUrl},size:"lg"});var k=g(u,2),R=s(k),a=s(R),p=s(a,!0);o(a);var I=g(a,2);{var K=e=>{var t=de();f(e,t)};w(I,e=>{ae(r.relayUrl)&&e(K)})}var T=g(I,2);{var B=e=>{var t=ce();f(e,t)};w(T,e=>{F()&&m()&&e(B)})}o(R);var z=g(R,2),H=s(z,!0);o(z);var E=g(z,2);{var N=e=>{var t=fe(),y=s(t);G(y,16,()=>d().slice(0,5),n=>n,(n,b)=>{ve(n,{get ndk(){return q},get pubkey(){return b},class:"rounded-full border-2 border-background",size:32})});var M=g(y,2);{var Q=n=>{var b=ue(),$=s(b);o(b),A(()=>U($,`+${d().length-5}`)),f(n,b)};w(M,n=>{d().length>5&&n(Q)})}o(t),f(e,t)};w(E,e=>{d().length>0&&e(N)})}var _=g(E,2);{var h=e=>{var t=ge(),y=s(t,!0);o(t),A(()=>U(y,v.info.description)),f(e,t)};w(_,e=>{v.info?.description&&e(h)})}o(k);var C=g(k,2);{var S=e=>{var t=he();t.__click=n=>{n.stopPropagation(),r.onFavoriteClick(n)};var y=s(t);{var M=n=>{var b=me();f(n,b)},Q=n=>{var b=pe();f(n,b)};w(y,n=>{m()?n(M):n(Q,!1)})}o(t),A(()=>{W(t,1,`flex-shrink-0 p-2 rounded-lg hover:bg-muted transition-colors ${m()?"text-primary":"text-muted-foreground hover:text-primary"}`),V(t,"title",m()?"Remove from favorites":"Add to favorites")}),f(e,t)};w(C,e=>{r.onFavoriteClick&&e(S)})}o(c),o(l),A(e=>{V(l,"role",r.onclick?"button":void 0),V(l,"tabindex",r.onclick?0:void 0),W(l,1,`p-4 bg-card rounded-lg border border-border hover:border-primary/50 transition-colors ${r.onclick?"cursor-pointer":""}`),U(p,e),U(H,r.relayUrl)},[()=>v.info?.name||r.relayUrl.replace("wss://","").replace("ws://","")]),f(L,l),D()}ee(["click","keydown"]);function xe(L){const r=P(()=>L.$sessions?.follows||new Set),d=P(()=>Array.from(i(r))),m=L.$subscribe(()=>{if(i(d).length!==0)return{filters:[{kinds:[10012],authors:i(d)}],subId:"follows-relay-lists",wrap:!0}}),F=P(()=>{const v=i(d).length;if(v===0)return[];const l=new Map;for(const c of m.events){const u=c,k=c.pubkey;if(u.relayUrls)for(const R of u.relayUrls){const a=se(R),p=l.get(a);p?(p.count++,p.pubkeys.includes(k)||p.pubkeys.push(k)):l.set(a,{count:1,pubkeys:[k]})}}return Array.from(l.entries()).map(([c,u])=>({url:c,count:u.count,percentage:v>0?u.count/v*100:0,pubkeys:u.pubkeys})).sort((c,u)=>u.count-c.count)});return{get relays(){return i(F)},get totalFollows(){return i(d).length},get eventsCount(){return m.events.length},getTopRelays(v=10){return i(F).slice(0,v)},getRelaysByThreshold(v){return i(F).filter(l=>l.percentage>=v)}}}var ke=x('<div class="text-center py-12"><svg class="w-16 h-16 mx-auto mb-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> <h3 class="text-lg font-semibold text-foreground mb-2">Login Required</h3> <p class="text-muted-foreground">Please login to manage your favorite relay feeds</p></div>'),_e=x('<div class="space-y-3"><h2 class="text-lg font-semibold text-foreground flex items-center gap-2"><svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg> Your Favorite Relays <span class="text-sm text-muted-foreground font-normal"> </span></h2> <div class="grid gap-3"></div></div>'),be=x(`<!> <div class="space-y-3"><div class="flex items-center justify-between"><div><h2 class="text-lg font-semibold text-foreground flex items-center gap-2"><svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg> Follows' Relays</h2> <p class="text-sm text-muted-foreground mt-1"> </p></div></div> <div class="grid gap-3"></div></div>`,1),we=x('<div class="p-4 space-y-6"><!></div>');function Te(L,r){Z(r,!0);const d=q.$sessionEvent(le),m=xe(q),F=P(()=>m.getTopRelays(20));async function v(a){j&&(j.isFavorite(a)?await j.removeRelay(a):await j.addRelay(a))}function l(a){oe(`/?relay=${encodeURIComponent(a)}`)}re(()=>(O.headerConfig={title:"Relay Feeds",subtitle:"Manage your favorite relays for curated content browsing",backNav:{href:"/"}},()=>{O.headerConfig=null}));var c=we(),u=s(c);{var k=a=>{var p=ke();f(a,p)},R=a=>{var p=be(),I=te(p);{var K=_=>{var h=_e(),C=s(h),S=g(s(C),2),e=s(S);o(S),o(C);var t=g(C,2);G(t,20,()=>d,y=>y,(y,M)=>{X(y,{get relayUrl(){return M},isFavorite:!0,showFavoriteIcon:!0,onclick:()=>l(M),onFavoriteClick:()=>v(M)})}),o(t),o(h),A(()=>U(e,`(${d.length??""})`)),f(_,h)};w(I,_=>{d?.relayUrls.length>0&&_(K)})}var T=g(I,2),B=s(T),z=s(B),H=g(s(z),2),E=s(H);o(H),o(z),o(B);var N=g(B,2);G(N,21,()=>i(F),_=>_.url,(_,h)=>{const C=P(()=>j?.isFavorite(i(h).url)||!1);X(_,{get relayUrl(){return i(h).url},get pubkeys(){return i(h).pubkeys},get isFavorite(){return i(C)},showFavoriteIcon:!0,onclick:()=>l(i(h).url),onFavoriteClick:()=>v(i(h).url)})}),o(N),o(T),A(()=>U(E,`Popular relays used by ${m.eventsCount??""}/${m.totalFollows??""} of your follows`)),f(a,p)};w(u,a=>{q.$currentUser?a(R,!1):a(k)})}o(c),f(L,c),D()}export{Te as component};
