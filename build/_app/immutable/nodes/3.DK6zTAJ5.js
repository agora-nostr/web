import"../chunks/DsnmJJEf.js";import{b as ue,K as zt,g as e,s as h,p as jt,u as bt,i as s,k as a,a as m,r,j as l,L as Me,t as w,l as E,e as t,h as Lt,f as y,d as Ht,aQ as hr,c as ae,M as Mt,aP as mt,P as Tt,aO as pr}from"../chunks/Bq750rDx.js";import{i as p}from"../chunks/BcjopvHb.js";import{e as Ue,i as $t}from"../chunks/Cjcfrngr.js";import{s as gr,a as fr}from"../chunks/wxUnewq1.js";import{p as mr,n as ot,B as Dt,e as Wt,s as pe,f as _r,h as xr,N as ft,C as br,d as wr}from"../chunks/CdRP5_sk.js";import{l as Kt}from"../chunks/D0qakMUX.js";import{h as qt}from"../chunks/jsJqZDHS.js";import{E as kr,u as yr,U as $r,N as Mr}from"../chunks/CPZq7sH0.js";import{A as Cr,M as Pr}from"../chunks/CK7OhTnQ.js";import{c as Be,a as ct}from"../chunks/uSFILAY7.js";import{T as jr}from"../chunks/3NtbZaKM.js";import{g as Lr}from"../chunks/BgxlgyeA.js";import{H as Gt}from"../chunks/_MORhMiq.js";import{a as Vt}from"../chunks/BKrWP4DR.js";import{b as At,p as Ot}from"../chunks/BL6J_geM.js";import{A as er}from"../chunks/Bt6DpIqu.js";import{c as Ut,L as Qt}from"../chunks/DseJecSJ.js";import{R as Rr,h as zr,c as Nt}from"../chunks/DqDkmS3U.js";import{M as Hr}from"../chunks/B3EHOrbg.js";import{u as It}from"../chunks/BKSKCJuW.js";import{c as Te}from"../chunks/BRAzWB6r.js";import{N as Fr,c as Sr}from"../chunks/wiMjQwcH.js";import{M as tr,b as rr,c as Br,d as ar,R as or,e as sr,f as lr,g as nr,h as ir}from"../chunks/Dw4s2o4Z.js";import{t as vt}from"../chunks/8lBcLtWK.js";import{D as dr}from"../chunks/DtjL0N-6.js";import{I as Yt,B as Pe}from"../chunks/DMhdcQZj.js";import{T as Jt}from"../chunks/BoTf7nuy.js";import{S as Tr}from"../chunks/8fKzzJjY.js";import{D as Ur}from"../chunks/CHVQ8-IN.js";import{R as Xt}from"../chunks/D2qeXkoa.js";import{p as Zt}from"../chunks/CK1WpjU7.js";import{p as Ar}from"../chunks/CFwZN-iQ.js";class Ir{#e=ue(zt(new Set));get _selectedHashtags(){return e(this.#e)}set _selectedHashtags(_){h(this.#e,_,!0)}get selectedHashtags(){return Array.from(this._selectedHashtags)}get hasFilters(){return this._selectedHashtags.size>0}toggleHashtag(_){const C=_.toLowerCase();this._selectedHashtags.has(C)?this._selectedHashtags.delete(C):this._selectedHashtags.add(C),this._selectedHashtags=new Set(this._selectedHashtags)}addHashtag(_){const C=_.toLowerCase();this._selectedHashtags.has(C)||(this._selectedHashtags.add(C),this._selectedHashtags=new Set(this._selectedHashtags))}removeHashtag(_){const C=_.toLowerCase();this._selectedHashtags.has(C)&&(this._selectedHashtags.delete(C),this._selectedHashtags=new Set(this._selectedHashtags))}clearAll(){this._selectedHashtags.clear(),this._selectedHashtags=new Set}isSelected(_){return this._selectedHashtags.has(_.toLowerCase())}}const ut=new Ir;var Er=s('<img class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy"/> <div class="absolute inset-0 bg-gradient-to-t from-neutral-900 via-transparent to-transparent opacity-60"></div>',1),Nr=s('<div class="w-full h-full flex items-center justify-center"><svg class="w-16 h-16 text-primary/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div>'),Dr=s('<p class="text-xs text-muted-foreground"><!></p>'),Vr=s('<a class="group block flex-shrink-0 w-[280px] h-[360px] rounded-2xl overflow-hidden bg-card hover:bg-muted transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl hover:shadow-primary/10"><div class="relative w-full h-48 overflow-hidden bg-gradient-to-br bg-primary/20"><!></div> <div class="p-4 flex flex-col h-[calc(100%-12rem)]"><h3 class="font-bold text-base text-foreground mb-2 line-clamp-2 leading-snug font-serif"> </h3> <p class="text-muted-foreground text-xs mb-3 line-clamp-3 leading-relaxed flex-1"> </p> <div class="flex items-center gap-2 mt-auto pt-2 border-t border-border"><div class="flex-1 min-w-0"><p class="text-xs font-medium text-muted-foreground truncate"> </p> <!></div> <svg class="w-5 h-5 text-primary opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></div></div></a>');function Or(We,_){jt(_,!0);let C=ue(void 0),N=ue(null);bt(()=>{h(C,_.article.author,!0),_.article.author.fetchProfile().then(re=>{h(N,re,!0)})});const k=m(()=>_.article.title||"Untitled"),R=m(()=>_.article.summary),g=m(()=>_.article.image),B=m(()=>_.article.published_at||_.article.created_at),T=m(()=>Lr(_.article,e(C))),X=m(()=>e(N)?.name||e(N)?.displayName||"Anonymous"),D=m(()=>{const re=e(R)||_.article.content;return re.slice(0,100)+(re.length>100?"...":"")});var F=Vr(),q=a(F),te=a(q);{var i=re=>{var be=Er(),we=y(be);Me(2),w(()=>{Be(we,"src",e(g)),Be(we,"alt",e(k))}),t(re,be)},b=re=>{var be=Nr();t(re,be)};p(te,re=>{e(g)?re(i):re(b,!1)})}r(q);var I=l(q,2),Y=a(I),je=a(Y,!0);r(Y);var n=l(Y,2),$=a(n,!0);r(n);var V=l(n,2),P=a(V),ge=a(P),Z=a(ge,!0);r(ge);var st=l(ge,2);{var Ke=re=>{var be=Dr(),we=a(be);jr(we,{get timestamp(){return e(B)}}),r(be),t(re,be)};p(st,re=>{e(B)&&re(Ke)})}r(P),Me(2),r(V),r(I),r(F),w(()=>{Be(F,"href",e(T)),E(je,e(k)),E($,e(D)),E(Z,e(X))}),t(We,F),Lt()}var Wr=s('<div class="flex items-center justify-center h-[calc(100vh-12rem)] text-muted-foreground">No videos found</div>'),Kr=Mt('<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path></svg>'),qr=Mt('<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>'),Gr=s('<p class="text-white text-sm mb-3 line-clamp-3"> </p>'),Qr=s('<div class="relative w-screen snap-start snap-always flex items-center justify-center bg-black h-screen lg:h-screen"><video class="w-full h-full object-contain" loop playsinline="" preload="auto"><track kind="captions"/></video> <div class="absolute inset-0 pointer-events-none"><div class="absolute top-0 left-0 right-0 bg-gradient-to-b from-black/70 via-black/20 to-transparent p-4 pointer-events-auto"><div class="flex items-center gap-3"><!> <div class="flex-1 min-w-0"><div class="text-white font-semibold text-sm truncate"> </div></div></div></div> <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-auto"><button class="w-12 h-12 rounded-full bg-black/50 hover:bg-black/70 backdrop-blur-sm flex items-center justify-center transition-colors" type="button"><!></button></div> <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent p-4 pointer-events-auto"><div class="flex items-end gap-4"><div class="flex-1 min-w-0 mb-2"><!></div> <div class="flex flex-col items-center gap-4 pb-2"><!></div></div></div></div></div>',2),Yr=s('<div class="fixed inset-0 overflow-y-scroll snap-y snap-mandatory scrollbar-hide bg-black lg:bottom-0 bottom-[72px] svelte-znq7e9"></div>');function Jr(We,_){jt(_,!0);let C=ue(null),N=ue(!0);function k(i){const b=/(https?:\/\/[^\s]+\.(mp4|webm|mov|avi|mkv))/gi;return i.match(b)||[]}function R(i){const b=i.m,I=i.url;if(b&&b.startsWith("video/"))return"video";if(I){const Y=I.split(".").pop()?.toLowerCase();if(["mp4","webm","mov","avi","mkv"].includes(Y||""))return"video"}return"other"}const g=m(()=>_.events.flatMap(i=>{const Y=i.tags.filter(n=>n[0]==="imeta").map(n=>mr(n)).filter(n=>n.url&&R(n)==="video").map(n=>({event:i,imeta:n}));return Y.length>0?Y:k(i.content).map(n=>{const $=n.split(".").pop()?.toLowerCase();return{event:i,imeta:{url:n,m:"video/"+$}}})}));let B=null,T=new Map;hr(()=>(B=new IntersectionObserver(i=>{i.forEach(b=>{const I=b.target;b.isIntersecting&&b.intersectionRatio>.5?I.play().catch(Y=>{console.log("Auto-play prevented:",Y)}):I.pause()})},{root:null,threshold:[.5]}),setTimeout(()=>{const i=T.get(0);i&&i.play().catch(b=>{console.log("Auto-play prevented:",b)})},100),()=>{B?.disconnect()}));function X(i,b){return T.set(b,i),B&&B.observe(i),{destroy(){T.delete(b),B&&B.unobserve(i)}}}var D=ae(),F=y(D);{var q=i=>{var b=Wr();t(i,b)},te=i=>{var b=Yr();Ue(b,23,()=>e(g),({event:I,imeta:Y},je)=>`${I.id}-${je}`,(I,Y,je)=>{let n=()=>e(Y).event,$=()=>e(Y).imeta;var V=Qr(),P=a(V);Vt(P,(oe,le)=>X?.(oe,le),()=>e(je));var ge=l(P,2),Z=a(ge),st=a(Z),Ke=a(st);er(Ke,{get ndk(){return ot},get pubkey(){return n().pubkey},class:"w-10 h-10 rounded-full border-2 border-white"});var re=l(Ke,2),be=a(re),we=a(be,!0);r(be),r(re),r(st),r(Z);var lt=l(Z,2),nt=a(lt);nt.__click=()=>h(N,!e(N));var Je=a(nt);{var Xe=oe=>{var le=Kr();t(oe,le)},qe=oe=>{var le=qr();t(oe,le)};p(Je,oe=>{e(N)?oe(Xe):oe(qe,!1)})}r(nt),r(lt);var De=l(lt,2),it=a(De),Ze=a(it),v=a(Ze);{var z=oe=>{var le=Gr(),Ve=a(le,!0);r(le),w(H=>E(Ve,H),[()=>n().content.replace($().url||"","").trim()]),t(oe,le)};p(v,oe=>{n().content&&oe(z)})}r(Ze);var de=l(Ze,2),et=a(de);kr(et,{get event(){return n()},variant:"tiktok"}),r(de),r(it),r(De),r(ge),r(V),w(oe=>{Be(P,"src",$().url),P.muted=e(N),E(we,oe),Be(nt,"aria-label",e(N)?"Unmute":"Mute")},[()=>n().author?.profile?.name||n().author?.npub?.substring(0,8)]),t(I,V)}),r(b),At(b,I=>h(C,I),()=>e(C)),t(i,b)};p(F,i=>{e(g).length===0?i(q):i(te,!1)})}t(We,D),Lt()}Ht(["click"]);var Xr=s('<button><span class="text-xs">#</span> <span> </span></button>'),Zr=s('<button class="flex-shrink-0 inline-flex items-center gap-1 px-2 py-1.5 rounded-full text-xs font-medium bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-all" title="Clear all filters"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),ea=s("<!> <!>",1),ta=s('<h1 class="text-xl font-bold text-foreground"> </h1>'),ra=s('<div><div class="py-2 pl-2 sm:p-4 w-full"><div class="flex items-center gap-2 min-w-0"><div class="flex-shrink-0 relative z-20"><!></div> <div class="flex items-center gap-2 overflow-x-auto scrollbar-hide flex-1 min-w-0 max-w-full"><!></div></div></div> <!></div>');function aa(We,_){jt(_,!0);const C=m(()=>_.selectedFilter==="videos");let N=ue(null);bt(()=>{if(!e(N))return;const i=()=>{const b=e(C)?0:e(N).offsetHeight;document.documentElement.style.setProperty("--header-height",`${b}px`)};return i(),window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}});var k=ra(),R=a(k),g=a(R),B=a(g),T=a(B);Rr(T,{iconOnly:!0}),r(B);var X=l(B,2),D=a(X);{var F=i=>{var b=ea(),I=y(b);Ue(I,17,()=>Dt.interests,$t,(n,$)=>{var V=Xr();V.__click=()=>ut.toggleHashtag(e($));var P=l(a(V),2),ge=a(P,!0);r(P),r(V),w(Z=>{ct(V,1,`flex-shrink-0 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium transition-all ${Z??""}`),E(ge,e($))},[()=>ut.isSelected(e($))?"bg-primary text-foreground border-2 border-primary-400":"bg-muted text-muted-foreground border-2 border-border hover:border"]),t(n,V)});var Y=l(I,2);{var je=n=>{var $=Zr();$.__click=()=>ut.clearAll(),t(n,$)};p(Y,n=>{ut.hasFilters&&n(je)})}t(i,b)},q=i=>{var b=ae(),I=y(b);{var Y=je=>{var n=ta(),$=a(n,!0);r(n),w(()=>E($,_.headerTitle.text)),t(je,n)};p(I,je=>{_.headerTitle&&je(Y)},!0)}t(i,b)};p(D,i=>{Dt.interests.length>0?i(F):i(q,!1)})}r(X),r(g),r(R);var te=l(R,2);Hr(te,{get selectedFilter(){return _.selectedFilter},get onFilterChange(){return _.onFilterChange}}),r(k),At(k,i=>h(N,i),()=>e(N)),w(()=>ct(k,1,`sticky top-0 z-10 bg-background/90 backdrop-blur-xl border-b border-border ${e(C)?"hidden":""}`)),t(We,k),Lt()}Ht(["click"]);var oa=s('<button class="w-full px-3 py-2 text-sm text-left border border-primary rounded-lg bg-primary/5 hover:bg-primary/10 transition-colors mb-4"><div class="flex items-center gap-2"><svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span class="text-primary font-medium"> </span></div> <p class="text-xs text-muted-foreground mt-1 ml-6">Press Enter or click to add</p></button>'),sa=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),la=s('<div class="mb-4 flex flex-wrap gap-2"></div>'),na=s('<div class="text-center py-12"><svg class="w-12 h-12 text-muted-foreground mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> <p class="text-muted-foreground"> </p></div>'),ia=s('<button><span class="font-medium truncate"> </span> <span class="text-xs text-muted-foreground ml-2 flex-shrink-0"> </span></button>'),da=s('<div class="grid grid-cols-2 gap-2"></div>'),va=s('<p class="text-xs text-muted-foreground"> </p> <!>',1),ca=s('<!> <div class="mb-4"><!></div> <!> <!> <div class="flex-1 overflow-y-auto -mx-6 px-6"><!></div> <!>',1),ua=s('<button class="w-full px-3 py-2 text-sm text-left border border-primary rounded-lg bg-primary/5 hover:bg-primary/10 transition-colors mb-4"><div class="flex items-center gap-2"><svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> <span class="text-primary font-medium"> </span></div> <p class="text-xs text-muted-foreground mt-1 ml-6">Press Enter or click to add</p></button>'),ha=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),pa=s('<div class="mb-4 flex flex-wrap gap-2"></div>'),ga=s('<div class="text-center py-12"><svg class="w-12 h-12 text-muted-foreground mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> <p class="text-muted-foreground"> </p></div>'),fa=s('<button><span class="font-medium truncate"> </span> <span class="text-xs text-muted-foreground ml-2 flex-shrink-0"> </span></button>'),ma=s('<div class="grid grid-cols-2 gap-2"></div>'),_a=s('<p class="text-xs text-muted-foreground"> </p> <!>',1),xa=s('<!> <div class="px-4"><div class="mb-4"><!></div> <!> <!> <div class="flex-1 overflow-y-auto max-h-[50vh]"><!></div></div> <!>',1);function ba(We,_){jt(_,!0);let C=Ot(_,"selectedTags",19,()=>[]),N=Ot(_,"open",15,!1);const k=new tr("(min-width: 768px)");let R=ue(zt([])),g=ue("");const B=m(()=>{if(!e(g))return e(R);const n=e(g).toLowerCase();return e(R).filter($=>$.tag.toLowerCase().includes(n))}),T=m(()=>{if(!e(g).trim())return!1;const n=e(g).trim().toLowerCase().replace(/^#/,"");return!e(R).some($=>$.tag.toLowerCase()===n)&&!C().some($=>$.toLowerCase()===n)}),X=m(()=>pe.selectedRelay||pe.relays.find(n=>n.enabled&&n.read)?.url),D=ot.$fetchEvents(()=>N()?{filters:{kinds:[1,20,21,22],limit:500},cacheUsage:e(X)?Wt.ONLY_RELAY:Wt.CACHE_FIRST,relayUrls:e(X)?[e(X)]:void 0}:void 0);bt(()=>{if(!D){h(R,[],!0);return}const n=new Tr;for(const $ of D){const V=$.tags.filter(P=>P[0]==="t"&&P[1]);for(const P of V){const ge=P[1].toLowerCase();n.set(ge,(n.get(ge)||0)+1)}}h(R,Array.from(n.entries()).map(([$,V])=>({tag:$,count:V})).sort(($,V)=>V.count-$.count).slice(0,100),!0)});function F(n){C().includes(n)?_.onTagsChange?.(C().filter($=>$!==n)):_.onTagsChange?.([...C(),n])}function q(){if(!e(T))return;const n=e(g).trim().toLowerCase().replace(/^#/,"");_.onTagsChange?.([...C(),n]),h(g,"")}function te(n){n.key==="Enter"&&e(T)&&(n.preventDefault(),q())}function i(){N(!1),h(g,""),_.onClose?.()}var b=ae(),I=y(b);{var Y=n=>{var $=ae(),V=y($);Te(V,()=>or,(P,ge)=>{ge(P,{get open(){return N()},onOpenChange:Z=>{N(Z),Z||i()},children:(Z,st)=>{var Ke=ae(),re=y(Ke);Te(re,()=>rr,(be,we)=>{we(be,{class:"max-w-xl max-h-[80vh] flex flex-col",children:(lt,nt)=>{var Je=ca(),Xe=y(Je);Te(Xe,()=>Br,(H,f)=>{f(H,{children:(o,c)=>{var d=ae(),u=y(d);Te(u,()=>ar,(S,j)=>{j(S,{children:(L,G)=>{Me();var ke=mt("Select Hashtags");t(L,ke)},$$slots:{default:!0}})}),t(o,d)},$$slots:{default:!0}})});var qe=l(Xe,2),De=a(qe);Yt(De,{type:"text",onkeydown:te,placeholder:"Search hashtags...",autofocus:!0,get value(){return e(g)},set value(H){h(g,H,!0)}}),r(qe);var it=l(qe,2);{var Ze=H=>{var f=oa();f.__click=q;var o=a(f),c=l(a(o),2),d=a(c);r(c),r(o),Me(2),r(f),w(u=>E(d,`Add custom tag: #${u??""}`),[()=>e(g).trim().toLowerCase().replace(/^#/,"")]),t(H,f)};p(it,H=>{e(T)&&H(Ze)})}var v=l(it,2);{var z=H=>{var f=la();Ue(f,20,C,o=>o,(o,c)=>{var d=sa();d.__click=()=>F(c);var u=a(d),S=a(u);r(u),Me(2),r(d),w(()=>E(S,`#${c??""}`)),t(o,d)}),r(f),t(H,f)};p(v,H=>{C().length>0&&H(z)})}var de=l(v,2),et=a(de);{var oe=H=>{var f=na(),o=l(a(f),2),c=a(o,!0);r(o),r(f),w(()=>E(c,e(g)?"No hashtags found matching your search":"No popular hashtags found")),t(H,f)},le=H=>{var f=da();Ue(f,21,()=>e(B),({tag:o,count:c})=>o,(o,c)=>{let d=()=>e(c).tag,u=()=>e(c).count;const S=m(()=>C().includes(d()));var j=ia();j.__click=()=>F(d());var L=a(j),G=a(L);r(L);var ke=l(L,2),ee=a(ke,!0);r(ke),r(j),w(()=>{ct(j,1,`flex items-center justify-between px-3 py-2 rounded-lg border transition-colors ${e(S)?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 hover:bg-muted"}`),E(G,`#${d()??""}`),E(ee,u())}),t(o,j)}),r(f),t(H,f)};p(et,H=>{e(B).length===0?H(oe):H(le,!1)})}r(de);var Ve=l(de,2);Te(Ve,()=>Ur,(H,f)=>{f(H,{class:"flex items-center justify-between pt-4 border-t border-border -mx-6 px-6",children:(o,c)=>{var d=va(),u=y(d),S=a(u);r(u);var j=l(u,2);Pe(j,{onclick:i,children:(L,G)=>{Me();var ke=mt("Done");t(L,ke)},$$slots:{default:!0}}),w(()=>E(S,`${C().length??""} ${C().length===1?"tag":"tags"} selected`)),t(o,d)},$$slots:{default:!0}})}),t(lt,Je)},$$slots:{default:!0}})}),t(Z,Ke)},$$slots:{default:!0}})}),t(n,$)},je=n=>{var $=ae(),V=y($);Te(V,()=>ir,(P,ge)=>{ge(P,{get open(){return N()},onOpenChange:Z=>{N(Z),Z||i()},children:(Z,st)=>{var Ke=ae(),re=y(Ke);Te(re,()=>sr,(be,we)=>{we(be,{children:(lt,nt)=>{var Je=xa(),Xe=y(Je);Te(Xe,()=>lr,(f,o)=>{o(f,{class:"text-left",children:(c,d)=>{var u=ae(),S=y(u);Te(S,()=>nr,(j,L)=>{L(j,{children:(G,ke)=>{Me();var ee=mt("Select Hashtags");t(G,ee)},$$slots:{default:!0}})}),t(c,u)},$$slots:{default:!0}})});var qe=l(Xe,2),De=a(qe),it=a(De);Yt(it,{type:"text",onkeydown:te,placeholder:"Search hashtags...",autofocus:!0,get value(){return e(g)},set value(f){h(g,f,!0)}}),r(De);var Ze=l(De,2);{var v=f=>{var o=ua();o.__click=q;var c=a(o),d=l(a(c),2),u=a(d);r(d),r(c),Me(2),r(o),w(S=>E(u,`Add custom tag: #${S??""}`),[()=>e(g).trim().toLowerCase().replace(/^#/,"")]),t(f,o)};p(Ze,f=>{e(T)&&f(v)})}var z=l(Ze,2);{var de=f=>{var o=pa();Ue(o,20,C,c=>c,(c,d)=>{var u=ha();u.__click=()=>F(d);var S=a(u),j=a(S);r(S),Me(2),r(u),w(()=>E(j,`#${d??""}`)),t(c,u)}),r(o),t(f,o)};p(z,f=>{C().length>0&&f(de)})}var et=l(z,2),oe=a(et);{var le=f=>{var o=ga(),c=l(a(o),2),d=a(c,!0);r(c),r(o),w(()=>E(d,e(g)?"No hashtags found matching your search":"No popular hashtags found")),t(f,o)},Ve=f=>{var o=ma();Ue(o,21,()=>e(B),({tag:c,count:d})=>c,(c,d)=>{let u=()=>e(d).tag,S=()=>e(d).count;const j=m(()=>C().includes(u()));var L=fa();L.__click=()=>F(u());var G=a(L),ke=a(G);r(G);var ee=l(G,2),Le=a(ee,!0);r(ee),r(L),w(()=>{ct(L,1,`flex items-center justify-between px-3 py-2 rounded-lg border transition-colors ${e(j)?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50 hover:bg-muted"}`),E(ke,`#${u()??""}`),E(Le,S())}),t(c,L)}),r(o),t(f,o)};p(oe,f=>{e(B).length===0?f(le):f(Ve,!1)})}r(et),r(qe);var H=l(qe,2);Te(H,()=>dr,(f,o)=>{o(f,{class:"pt-2 flex items-center justify-between",children:(c,d)=>{var u=_a(),S=y(u),j=a(S);r(S);var L=l(S,2);Pe(L,{onclick:i,children:(G,ke)=>{Me();var ee=mt("Done");t(G,ee)},$$slots:{default:!0}}),w(()=>E(j,`${C().length??""} ${C().length===1?"tag":"tags"} selected`)),t(c,u)},$$slots:{default:!0}})}),t(lt,Je)},$$slots:{default:!0}})}),t(Z,Ke)},$$slots:{default:!0}})}),t(n,$)};p(I,n=>{k.current?n(Y):n(je,!1)})}t(We,b),Lt()}Ht(["click"]);function wa(We,_,C=5){const N="0123456789bcdefghjkmnpqrstuvwxyz";let k=0,R=0,g=!0,B="",T=[-90,90],X=[-180,180];for(;B.length<C;){if(g){const D=(X[0]+X[1])/2;_>=D?(k|=1<<4-R,X[0]=D):X[1]=D}else{const D=(T[0]+T[1])/2;We>=D?(k|=1<<4-R,T[0]=D):T[1]=D}g=!g,R++,R===5&&(B+=N[k],R=0,k=0)}return B}var ka=s("<button></button>"),ya=s('<div class="absolute bottom-3 left-0 right-0 flex justify-center gap-1"></div>'),$a=s('<button><img alt="" class="w-full h-full object-cover rounded"/></button>'),Ma=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Ca=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Pa=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg> <!></div>'),ja=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>'),La=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Ra=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <!></div>'),za=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>'),Ha=s('<img alt="" class="w-5 h-5 rounded border border-background"/>'),Fa=s('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg></div>'),Sa=s('<div class="flex items-center -space-x-1"></div>'),Ba=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Ta=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> <!></div>'),Ua=s('<div role="presentation"><div role="dialog" tabindex="-1"><!></div></div>'),Aa=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Ia=s('<div class="flex flex-wrap gap-2 items-center"></div>'),Ea=s('<div class="text-sm text-muted-foreground flex items-center gap-1.5"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <span> </span> <button class="ml-1 hover:text-foreground transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Na=s('<div class="md:grid md:grid-cols-[2fr,3fr] md:h-full"><div class="md:border-r border-border md:p-6 p-0"><div class="relative w-full md:aspect-square md:rounded-lg overflow-hidden bg-black"><img class="w-full h-full object-contain"/> <button title="Remove this image" class="absolute top-2 right-2 p-2 bg-black/60 text-white rounded-full hover:bg-black/80 transition-colors backdrop-blur-sm" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!></div> <div class="hidden md:flex items-center gap-2 overflow-x-auto pb-2 mt-4"><!> <button title="Add more images" class="w-16 h-16 rounded border-2 border-dashed border-border hover:border-primary hover:bg-muted transition-all flex items-center justify-center flex-shrink-0" aria-label="Add more images"><svg class="w-6 h-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div class="p-4 md:p-6 space-y-4 md:overflow-auto"><!> <div class="flex items-center gap-1 border-t border-border pt-3"><!> <!> <!> <!> <!> <div class="relative"><!></div></div> <!> <!> <!></div></div>'),Da=s('<p class="text-sm text-muted-foreground"> </p>'),Va=s('<div class="flex flex-col items-center gap-2"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <!></div>'),Oa=s('<svg class="w-16 h-16 text-muted-foreground mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-lg font-medium text-foreground mb-2">Drop images here</p> <p class="text-sm text-muted-foreground">or click to browse</p> <p class="text-xs text-muted-foreground mt-2">Multiple images supported</p>',1),Wa=s('<p class="text-xs text-muted-foreground"> </p>'),Ka=s('<div class="flex flex-col items-center gap-3"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <p class="text-sm text-muted-foreground">Uploading...</p> <!></div>'),qa=s('<svg class="w-16 h-16 text-muted-foreground mb-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-muted-foreground mb-4">No images selected</p> <!>',1),Ga=s('<div class="hidden md:flex items-center justify-center p-12 h-full"><div role="button" tabindex="0"><!></div></div> <div class="md:hidden flex items-center justify-center p-8 h-full min-h-[60vh]"><div class="text-center"><!></div></div>',1),Qa=s('<div class="flex items-center justify-between px-4 md:px-6 py-3 md:py-4 border-b border-border bg-background"><button title="Close and discard post" class="text-foreground hover:text-muted-foreground transition-colors" aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!> <!></div> <div class="flex-1 overflow-auto"><input type="file" accept="image/*" multiple class="hidden"/> <!></div>',1),Ya=s("<button></button>"),Ja=s('<div class="absolute bottom-3 left-0 right-0 flex justify-center gap-1"></div>'),Xa=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Za=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),eo=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg> <!></div>'),to=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>'),ro=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),ao=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <!></div>'),oo=Mt('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>'),so=s('<img alt="" class="w-5 h-5 rounded border border-background"/>'),lo=s('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><svg class="w-3 h-3 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg></div>'),no=s('<div class="flex items-center -space-x-1"></div>'),io=s('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),vo=s('<div class="relative"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> <!></div>'),co=s('<div role="presentation"><div role="dialog" tabindex="-1"><!></div></div>'),uo=s('<button class="inline-flex items-center gap-1 px-2.5 py-1 bg-primary/10 text-primary rounded-full text-sm hover:bg-primary/20 transition-colors"><span> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),ho=s('<div class="flex flex-wrap gap-2 items-center"></div>'),po=s('<div class="text-sm text-muted-foreground flex items-center gap-1.5"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> <span> </span> <button class="ml-1 hover:text-foreground transition-colors"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),go=s('<div class="space-y-4"><div class="relative w-full overflow-hidden bg-black"><img class="w-full h-full object-contain"/> <button title="Remove this image" class="absolute top-2 right-2 p-2 bg-black/60 text-white rounded-full hover:bg-black/80 transition-colors backdrop-blur-sm" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <!></div> <!> <div class="flex items-center gap-1 border-t border-border pt-3"><!> <!> <!> <!> <!> <div class="relative"><!></div></div> <!> <!> <!></div>'),fo=s('<p class="text-xs text-muted-foreground"> </p>'),mo=s('<div class="flex flex-col items-center gap-3"><div class="w-12 h-12 border-4 border-border border-t-primary rounded-full animate-spin"></div> <p class="text-sm text-muted-foreground">Uploading...</p> <!></div>'),_o=s('<svg class="w-16 h-16 text-muted-foreground mb-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <p class="text-muted-foreground mb-4">No images selected</p> <!>',1),xo=s('<div class="flex items-center justify-center p-8 h-full min-h-[60vh]"><div class="text-center"><!></div></div>'),bo=s("<!> <!>",1),wo=s('<!> <div class="px-4 overflow-auto flex-1"><input type="file" accept="image/*" multiple class="hidden"/> <!></div> <!>',1),ko=s("<!> <!> <!>",1);function yo(We,_){jt(_,!0);const C=new tr("(min-width: 768px)");let N=Ot(_,"open",15,!1),k=ue(!1),R=ue(0),g=ue(!1),B=ue(!1),T=ue(!1),X=ue(""),D=ue(""),F=ue(zt([])),q=ue(zt([])),te=ue(!1),i=ue(zt([])),b,I=ue(!1),Y=ue(!1);const je=new Fr(ot),n=Sr(je),$=m(()=>window.innerWidth<768),V=yr(()=>N()),P=m(()=>V.selectedRelayUrls),ge=m(()=>V.allRelays);bt(()=>{N()&&e($)&&e(i).length===0&&setTimeout(()=>{b?.click()},300)});async function Z(o){if(!o.type.startsWith("image/")){vt.error("Please select an image file");return}try{if(await n.upload(o,{fallbackServer:"https://blossom.primal.net"}),n.result?.url){const c=new Image,d=await new Promise(u=>{c.onload=()=>u({width:c.width,height:c.height}),c.src=URL.createObjectURL(o)});h(i,[...e(i),{url:n.result.url,mimeType:o.type,hash:n.result.sha256||"",blurhash:n.result.blurhash,dimensions:d}],!0),h(R,e(i).length-1)}}catch(c){console.error("Upload failed:",c),vt.error("Failed to upload image")}}function st(o){const d=o.target.files;d&&Array.from(d).forEach(u=>Z(u))}function Ke(o){o.preventDefault(),h(I,!0)}function re(){h(I,!1)}async function be(o){o.preventDefault(),h(I,!1);const c=o.dataTransfer?.files;c&&Array.from(c).forEach(d=>Z(d))}function we(){b?.click()}function lt(o){h(i,e(i).filter((c,d)=>d!==o),!0),e(R)>=e(i).length&&h(R,Math.max(0,e(i).length-1),!0)}function nt(o){h(F,e(F).filter(c=>c!==o),!0)}function Je(o){h(F,o,!0)}function Xe(o){V.selectedRelayUrls.includes(o)?V.selectedRelayUrls=V.selectedRelayUrls.filter(c=>c!==o):V.selectedRelayUrls=[...V.selectedRelayUrls,o]}function qe(o){V.selectedRelayUrls=[o],h(g,!1)}function De(){h(g,!1)}function it(){navigator.geolocation?navigator.geolocation.getCurrentPosition(o=>{const c=o.coords.latitude,d=o.coords.longitude,u=wa(c,d,5);h(D,`Near ${u}`),vt.success("Location detected")},o=>{console.error("Error getting location:",o),vt.error("Could not get your location")}):vt.error("Geolocation is not supported")}async function Ze(){if(!e(X).trim()||e(i).length===0||e(k)){e(i).length===0?vt.error("Please add at least one image"):vt.error("Please add a caption");return}if(!ot.$currentUser){vt.error("Please log in to create a media post");return}if(e(P).length===0){vt.error("Please select at least one relay to publish to");return}try{h(k,!0);const o=new _r(ot);if(o.kind=20,o.content=e(X).trim(),o.isProtected=e(Y),e(i).forEach(d=>{const u=["imeta",`url ${d.url}`,`m ${d.mimeType}`];d.hash&&u.push(`x ${d.hash}`),d.blurhash&&u.push(`blurhash ${d.blurhash}`),d.dimensions&&u.push(`dim ${d.dimensions.width}x${d.dimensions.height}`),o.tags.push(u)}),e(F).forEach(d=>{o.tags.push(["t",d])}),e(q).forEach(d=>{o.tags.push(["p",d])}),e(D).trim())if(e(D).startsWith("Near ")){const d=e(D).replace("Near ","");for(let u=3;u<=d.length;u++)o.tags.push(["g",d.substring(0,u)])}else o.tags.push(["location",e(D).trim()]);e(te)&&o.tags.push(["content-warning","nsfw"]),await o.sign();const c=xr.fromRelayUrls(e(P),ot);if(await o.publish(c),o.publishStatus==="error"){const u=o.publishError?.relayErrors||{},S=Object.entries(u).map(([j,L])=>`${j}: ${L}`).join(`
`);vt.error(`Failed to publish:
${S||"Unknown error"}`);return}vt.success("Posted!"),v(),N(!1),_.onClose?.()}catch(o){console.error("Failed to publish media post:",o),vt.error(`Failed to publish: ${o instanceof Error?o.message:"Unknown error"}`)}finally{h(k,!1)}}function v(){h(X,""),h(D,""),h(F,[],!0),h(q,[],!0),h(i,[],!0),h(R,0),h(te,!1),h(g,!1),h(B,!1),h(T,!1)}function z(){e(k)||(v(),N(!1),_.onClose?.())}function de(o){o.key==="Escape"&&!e(k)&&z()}var et=ko();Tt("keydown",pr,de);var oe=y(et);{var le=o=>{var c=ae(),d=y(c);Te(d,()=>or,(u,S)=>{S(u,{get open(){return N()},onOpenChange:j=>{N(j),j||z()},children:(j,L)=>{var G=ae(),ke=y(G);Te(ke,()=>rr,(ee,Le)=>{Le(ee,{class:"max-md:!max-w-none max-md:!w-full max-md:!h-[100vh] max-md:!m-0 max-md:!rounded-none max-w-6xl max-h-[90vh] overflow-hidden flex flex-col p-0",children:(J,ve)=>{var fe=Qa(),he=y(fe),me=a(he);me.__click=z;var Ie=l(me,2);Te(Ie,()=>ar,(ce,Re)=>{Re(ce,{class:"text-lg md:text-xl font-semibold",children:(_e,se)=>{Me();var ye=mt("New Post");t(_e,ye)},$$slots:{default:!0}})});var ht=l(Ie,2);{let ce=m(()=>!e(X).trim()||e(i).length===0||e(k)||e(P).length===0);Pe(ht,{onclick:Ze,get disabled(){return e(ce)},size:"sm",class:"h-9 px-4",children:(Re,_e)=>{Me();var se=mt();w(()=>E(se,e(k)?"Posting...":"Post")),t(Re,se)},$$slots:{default:!0}})}r(he);var tt=l(he,2),Rt=a(tt);Rt.__change=st,At(Rt,ce=>b=ce,()=>b);var Et=l(Rt,2);{var Ge=ce=>{var Re=Na(),_e=a(Re),se=a(_e),ye=a(se),$e=l(ye,2);$e.__click=()=>lt(e(R));var Ee=l($e,2);{var Oe=x=>{var M=ya();Ue(M,21,()=>e(i),$t,(K,U,A)=>{var Ce=ka();Ce.__click=()=>h(R,A,!0),Be(Ce,"title",`View image ${A+1}`),Be(Ce,"aria-label",`View image ${A+1}`),w(()=>ct(Ce,1,`w-2 h-2 rounded-full transition-all ${e(R)===A?"bg-white w-6":"bg-white/50"}`)),t(K,Ce)}),r(M),t(x,M)};p(Ee,x=>{e(i).length>1&&x(Oe)})}r(se);var ze=l(se,2),at=a(ze);Ue(at,17,()=>e(i),$t,(x,M,K)=>{var U=$a();U.__click=()=>h(R,K,!0),Be(U,"title",`View image ${K+1}`),Be(U,"aria-label",`View image ${K+1}`);var A=a(U);r(U),w(()=>{ct(U,1,`w-16 h-16 rounded border-2 transition-all flex-shrink-0 ${e(R)===K?"border-primary":"border-border"}`),Be(A,"src",e(M).url)}),t(x,U)});var wt=l(at,2);wt.__click=we,r(ze),r(_e);var Ct=l(_e,2),xe=a(Ct);{let x=m(()=>!e($));Jt(xe,{placeholder:"Write a caption...",rows:4,get autofocus(){return e(x)},class:"resize-none border-0 focus-visible:ring-0 px-3 text-base placeholder:text-muted-foreground",get value(){return e(X)},set value(M){h(X,M,!0)}})}var He=l(xe,2),pt=a(He);Pe(pt,{type:"button",variant:"ghost",size:"icon",onclick:we,get disabled(){return e(k)},title:"Add more images to your post",class:"h-8 w-8",children:(x,M)=>{var K=Ma();t(x,K)},$$slots:{default:!0}});var _t=l(pt,2);{let x=m(()=>e(F).length>0?"text-primary":"");Pe(_t,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(B,!0),get disabled(){return e(k)},title:"Add hashtags to categorize your post and make it discoverable",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=Pa(),A=l(a(U),2);{var Ce=Se=>{var Ae=Ca(),xt=a(Ae,!0);r(Ae),w(()=>E(xt,e(F).length)),t(Se,Ae)};p(A,Se=>{e(F).length>0&&Se(Ce)})}r(U),t(M,U)},$$slots:{default:!0}})}var Qe=l(_t,2);{let x=m(()=>e(D)?"text-primary":"");Pe(Qe,{type:"button",variant:"ghost",size:"icon",onclick:it,get disabled(){return e(k)},title:"Add location - uses your device's GPS to tag where this was posted",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=ja();t(M,U)},$$slots:{default:!0}})}var Ye=l(Qe,2);{let x=m(()=>e(q).length>0?"text-primary":"");Pe(Ye,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(T,!0),get disabled(){return e(k)},title:"Tag people in this post - they'll be notified",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=Ra(),A=l(a(U),2);{var Ce=Se=>{var Ae=La(),xt=a(Ae,!0);r(Ae),w(()=>E(xt,e(q).length)),t(Se,Ae)};p(A,Se=>{e(q).length>0&&Se(Ce)})}r(U),t(M,U)},$$slots:{default:!0}})}var kt=l(Ye,2);{let x=m(()=>e(te)?"text-primary":"");Pe(kt,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(te,!e(te)),get disabled(){return e(k)},title:"Mark as sensitive content (NSFW)",get class(){return`h-8 w-8 ${e(x)??""}`},children:(M,K)=>{var U=za();t(M,U)},$$slots:{default:!0}})}var Ft=l(kt,2),W=a(Ft);Pe(W,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(g,!e(g)),get disabled(){return e(k)},title:"Choose which relays to publish this post to",class:"h-8 w-8",children:(x,M)=>{var K=ae(),U=y(K);{var A=Se=>{var Ae=Sa();Ue(Ae,21,()=>e(P),$t,(xt,dt)=>{const gt=m(()=>e(ge).find(yt=>yt.url===e(dt))),Pt=m(()=>e(gt)?It(e(gt).url):null);var St=ae(),vr=y(St);{var cr=yt=>{var Bt=Ha();w(()=>Be(Bt,"src",e(Pt).info.icon)),t(yt,Bt)},ur=yt=>{var Bt=Fa();t(yt,Bt)};p(vr,yt=>{e(Pt)?.info?.icon?yt(cr):yt(ur,!1)})}t(xt,St)}),r(Ae),t(Se,Ae)},Ce=Se=>{var Ae=Ta(),xt=l(a(Ae),2);{var dt=gt=>{var Pt=Ba(),St=a(Pt,!0);r(Pt),w(()=>E(St,e(P).length)),t(gt,Pt)};p(xt,gt=>{e(P).length>2&&gt(dt)})}r(Ae),t(Se,Ae)};p(U,Se=>{e(P).length<=2&&e(P).length>0?Se(A):Se(Ce,!1)})}t(x,K)},$$slots:{default:!0}}),r(Ft),r(He);var O=l(He,2);{var ne=x=>{var M=Ua();M.__click=De,M.__keydown=A=>A.key==="Escape"&&De();var K=a(M);K.__click=A=>A.stopPropagation(),K.__keydown=A=>A.stopPropagation();var U=a(K);Xt(U,{get selectedRelayUrls(){return e(P)},onToggleRelay:Xe,onSelectOnly:qe,get isProtected(){return e(Y)},set isProtected(A){h(Y,A,!0)}}),r(K),r(M),Vt(M,A=>Zt?.(A)),w(()=>{ct(M,1,`fixed inset-0 bg-black/50 z-[100] flex items-center justify-center transition-opacity ${e(g)?"opacity-100":"opacity-0"}`),ct(K,1,`bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto transition-all ${e(g)?"scale-100 opacity-100":"scale-95 opacity-0"}`)}),t(x,M)};p(O,x=>{e(g)&&x(ne)})}var ie=l(O,2);{var Q=x=>{var M=Ia();Ue(M,21,()=>e(F),$t,(K,U)=>{var A=Aa();A.__click=()=>nt(e(U));var Ce=a(A),Se=a(Ce);r(Ce),Me(2),r(A),w(()=>E(Se,`#${e(U)??""}`)),t(K,A)}),r(M),t(x,M)};p(ie,x=>{e(F).length>0&&x(Q)})}var Ne=l(ie,2);{var Fe=x=>{var M=Ea(),K=l(a(M),2),U=a(K,!0);r(K);var A=l(K,2);A.__click=()=>h(D,""),r(M),w(()=>E(U,e(D))),t(x,M)};p(Ne,x=>{e(D)&&x(Fe)})}r(Ct),r(Re),w(()=>{Be(ye,"src",e(i)[e(R)].url),Be(ye,"alt",`Image ${e(R)+1}`)}),t(ce,Re)},rt=ce=>{var Re=Ga(),_e=y(Re),se=a(_e);se.__click=we,se.__keydown=xe=>xe.key==="Enter"&&we();var ye=a(se);{var $e=xe=>{var He=Va(),pt=l(a(He),2);{var _t=Qe=>{var Ye=Da(),kt=a(Ye);r(Ye),w(()=>E(kt,`${n.progress.percentage??""}%`)),t(Qe,Ye)};p(pt,Qe=>{n.progress&&Qe(_t)})}r(He),t(xe,He)},Ee=xe=>{var He=Oa();Me(6),t(xe,He)};p(ye,xe=>{n.status==="uploading"?xe($e):xe(Ee,!1)})}r(se),r(_e);var Oe=l(_e,2),ze=a(Oe),at=a(ze);{var wt=xe=>{var He=Ka(),pt=l(a(He),4);{var _t=Qe=>{var Ye=Wa(),kt=a(Ye);r(Ye),w(()=>E(kt,`${n.progress.percentage??""}%`)),t(Qe,Ye)};p(pt,Qe=>{n.progress&&Qe(_t)})}r(He),t(xe,He)},Ct=xe=>{var He=qa(),pt=l(y(He),4);Pe(pt,{onclick:we,children:(_t,Qe)=>{Me();var Ye=mt("Choose Photos");t(_t,Ye)},$$slots:{default:!0}}),t(xe,He)};p(at,xe=>{n.status==="uploading"?xe(wt):xe(Ct,!1)})}r(ze),r(Oe),w(()=>ct(se,1,`w-full max-w-md aspect-square rounded-lg border-2 border-dashed border-border hover:border-primary hover:bg-muted/50 transition-all flex flex-col items-center justify-center cursor-pointer ${e(I)?"border-primary bg-muted/50":""} ${n.status==="uploading"?"pointer-events-none":""}`)),Tt("dragover",se,Ke),Tt("dragleave",se,re),Tt("drop",se,be),t(ce,Re)};p(Et,ce=>{e(i).length>0?ce(Ge):ce(rt,!1)})}r(tt),w(()=>me.disabled=e(k)),t(J,fe)},$$slots:{default:!0}})}),t(j,G)},$$slots:{default:!0}})}),t(o,c)},Ve=o=>{var c=ae(),d=y(c);Te(d,()=>ir,(u,S)=>{S(u,{get open(){return N()},onOpenChange:j=>{N(j),j||z()},children:(j,L)=>{var G=ae(),ke=y(G);Te(ke,()=>sr,(ee,Le)=>{Le(ee,{children:(J,ve)=>{var fe=wo(),he=y(fe);Te(he,()=>lr,(Ge,rt)=>{rt(Ge,{class:"text-left",children:(ce,Re)=>{var _e=ae(),se=y(_e);Te(se,()=>nr,(ye,$e)=>{$e(ye,{children:(Ee,Oe)=>{Me();var ze=mt("New Post");t(Ee,ze)},$$slots:{default:!0}})}),t(ce,_e)},$$slots:{default:!0}})});var me=l(he,2),Ie=a(me);Ie.__change=st,At(Ie,Ge=>b=Ge,()=>b);var ht=l(Ie,2);{var tt=Ge=>{var rt=go(),ce=a(rt),Re=a(ce),_e=l(Re,2);_e.__click=()=>lt(e(R));var se=l(_e,2);{var ye=W=>{var O=Ja();Ue(O,21,()=>e(i),$t,(ne,ie,Q)=>{var Ne=Ya();Ne.__click=()=>h(R,Q,!0),Be(Ne,"title",`View image ${Q+1}`),Be(Ne,"aria-label",`View image ${Q+1}`),w(()=>ct(Ne,1,`w-2 h-2 rounded-full transition-all ${e(R)===Q?"bg-white w-6":"bg-white/50"}`)),t(ne,Ne)}),r(O),t(W,O)};p(se,W=>{e(i).length>1&&W(ye)})}r(ce);var $e=l(ce,2);{let W=m(()=>!e($));Jt($e,{placeholder:"Write a caption...",rows:4,get autofocus(){return e(W)},class:"resize-none border-0 focus-visible:ring-0 px-3 text-base placeholder:text-muted-foreground",get value(){return e(X)},set value(O){h(X,O,!0)}})}var Ee=l($e,2),Oe=a(Ee);Pe(Oe,{type:"button",variant:"ghost",size:"icon",onclick:we,get disabled(){return e(k)},title:"Add more images to your post",class:"h-8 w-8",children:(W,O)=>{var ne=Xa();t(W,ne)},$$slots:{default:!0}});var ze=l(Oe,2);{let W=m(()=>e(F).length>0?"text-primary":"");Pe(ze,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(B,!0),get disabled(){return e(k)},title:"Add hashtags to categorize your post and make it discoverable",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ne)=>{var ie=eo(),Q=l(a(ie),2);{var Ne=Fe=>{var x=Za(),M=a(x,!0);r(x),w(()=>E(M,e(F).length)),t(Fe,x)};p(Q,Fe=>{e(F).length>0&&Fe(Ne)})}r(ie),t(O,ie)},$$slots:{default:!0}})}var at=l(ze,2);{let W=m(()=>e(D)?"text-primary":"");Pe(at,{type:"button",variant:"ghost",size:"icon",onclick:it,get disabled(){return e(k)},title:"Add location - uses your device's GPS to tag where this was posted",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ne)=>{var ie=to();t(O,ie)},$$slots:{default:!0}})}var wt=l(at,2);{let W=m(()=>e(q).length>0?"text-primary":"");Pe(wt,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(T,!0),get disabled(){return e(k)},title:"Tag people in this post - they'll be notified",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ne)=>{var ie=ao(),Q=l(a(ie),2);{var Ne=Fe=>{var x=ro(),M=a(x,!0);r(x),w(()=>E(M,e(q).length)),t(Fe,x)};p(Q,Fe=>{e(q).length>0&&Fe(Ne)})}r(ie),t(O,ie)},$$slots:{default:!0}})}var Ct=l(wt,2);{let W=m(()=>e(te)?"text-primary":"");Pe(Ct,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(te,!e(te)),get disabled(){return e(k)},title:"Mark as sensitive content (NSFW)",get class(){return`h-8 w-8 ${e(W)??""}`},children:(O,ne)=>{var ie=oo();t(O,ie)},$$slots:{default:!0}})}var xe=l(Ct,2),He=a(xe);Pe(He,{type:"button",variant:"ghost",size:"icon",onclick:()=>h(g,!e(g)),get disabled(){return e(k)},title:"Choose which relays to publish this post to",class:"h-8 w-8",children:(W,O)=>{var ne=ae(),ie=y(ne);{var Q=Fe=>{var x=no();Ue(x,21,()=>e(P),$t,(M,K)=>{const U=m(()=>e(ge).find(dt=>dt.url===e(K))),A=m(()=>e(U)?It(e(U).url):null);var Ce=ae(),Se=y(Ce);{var Ae=dt=>{var gt=so();w(()=>Be(gt,"src",e(A).info.icon)),t(dt,gt)},xt=dt=>{var gt=lo();t(dt,gt)};p(Se,dt=>{e(A)?.info?.icon?dt(Ae):dt(xt,!1)})}t(M,Ce)}),r(x),t(Fe,x)},Ne=Fe=>{var x=vo(),M=l(a(x),2);{var K=U=>{var A=io(),Ce=a(A,!0);r(A),w(()=>E(Ce,e(P).length)),t(U,A)};p(M,U=>{e(P).length>2&&U(K)})}r(x),t(Fe,x)};p(ie,Fe=>{e(P).length<=2&&e(P).length>0?Fe(Q):Fe(Ne,!1)})}t(W,ne)},$$slots:{default:!0}}),r(xe),r(Ee);var pt=l(Ee,2);{var _t=W=>{var O=co();O.__click=De,O.__keydown=Q=>Q.key==="Escape"&&De();var ne=a(O);ne.__click=Q=>Q.stopPropagation(),ne.__keydown=Q=>Q.stopPropagation();var ie=a(ne);Xt(ie,{get selectedRelayUrls(){return e(P)},onToggleRelay:Xe,onSelectOnly:qe,get isProtected(){return e(Y)},set isProtected(Q){h(Y,Q,!0)}}),r(ne),r(O),Vt(O,Q=>Zt?.(Q)),w(()=>{ct(O,1,`fixed inset-0 bg-black/50 z-[100] flex items-center justify-center transition-opacity ${e(g)?"opacity-100":"opacity-0"}`),ct(ne,1,`bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto transition-all ${e(g)?"scale-100 opacity-100":"scale-95 opacity-0"}`)}),t(W,O)};p(pt,W=>{e(g)&&W(_t)})}var Qe=l(pt,2);{var Ye=W=>{var O=ho();Ue(O,21,()=>e(F),$t,(ne,ie)=>{var Q=uo();Q.__click=()=>nt(e(ie));var Ne=a(Q),Fe=a(Ne);r(Ne),Me(2),r(Q),w(()=>E(Fe,`#${e(ie)??""}`)),t(ne,Q)}),r(O),t(W,O)};p(Qe,W=>{e(F).length>0&&W(Ye)})}var kt=l(Qe,2);{var Ft=W=>{var O=po(),ne=l(a(O),2),ie=a(ne,!0);r(ne);var Q=l(ne,2);Q.__click=()=>h(D,""),r(O),w(()=>E(ie,e(D))),t(W,O)};p(kt,W=>{e(D)&&W(Ft)})}r(rt),w(()=>{Be(Re,"src",e(i)[e(R)].url),Be(Re,"alt",`Image ${e(R)+1}`)}),t(Ge,rt)},Rt=Ge=>{var rt=xo(),ce=a(rt),Re=a(ce);{var _e=ye=>{var $e=mo(),Ee=l(a($e),4);{var Oe=ze=>{var at=fo(),wt=a(at);r(at),w(()=>E(wt,`${n.progress.percentage??""}%`)),t(ze,at)};p(Ee,ze=>{n.progress&&ze(Oe)})}r($e),t(ye,$e)},se=ye=>{var $e=_o(),Ee=l(y($e),4);Pe(Ee,{onclick:we,children:(Oe,ze)=>{Me();var at=mt("Choose Photos");t(Oe,at)},$$slots:{default:!0}}),t(ye,$e)};p(Re,ye=>{n.status==="uploading"?ye(_e):ye(se,!1)})}r(ce),r(rt),t(Ge,rt)};p(ht,Ge=>{e(i).length>0?Ge(tt):Ge(Rt,!1)})}r(me);var Et=l(me,2);Te(Et,()=>dr,(Ge,rt)=>{rt(Ge,{class:"pt-2",children:(ce,Re)=>{var _e=bo(),se=y(_e);{let $e=m(()=>!e(X).trim()||e(i).length===0||e(k)||e(P).length===0);Pe(se,{onclick:Ze,get disabled(){return e($e)},class:"w-full",children:(Ee,Oe)=>{Me();var ze=mt();w(()=>E(ze,e(k)?"Posting...":"Post")),t(Ee,ze)},$$slots:{default:!0}})}var ye=l(se,2);Pe(ye,{variant:"outline",onclick:z,get disabled(){return e(k)},class:"w-full",children:($e,Ee)=>{Me();var Oe=mt("Cancel");t($e,Oe)},$$slots:{default:!0}}),t(ce,_e)},$$slots:{default:!0}})}),t(J,fe)},$$slots:{default:!0}})}),t(j,G)},$$slots:{default:!0}})}),t(o,c)};p(oe,o=>{C.current?o(le):o(Ve,!1)})}var H=l(oe,2);ba(H,{get selectedTags(){return e(F)},onTagsChange:Je,get open(){return e(B)},set open(o){h(B,o,!0)}});var f=l(H,2);$r(f,{buttonClass:"hidden",iconOnly:!1,get open(){return e(T)},set open(o){h(T,o,!0)},get selectedPubkeys(){return e(q)},set selectedPubkeys(o){h(q,o,!0)}}),t(We,et),Lt()}Ht(["click","change","keydown"]);var $o=s('<div class="p-8 text-center text-muted-foreground">No articles found</div>'),Mo=s('<div class="p-8 text-center text-muted-foreground">Loading articles...</div>'),Co=s('<div class="snap-start snap-always"><!></div>'),Po=s('<div class="py-6 border-b border-border max-w-screen"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2 px-4"><svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg> Featured</h2> <div class="overflow-x-auto overflow-y-hidden scrollbar-hide snap-x snap-mandatory touch-pan-x"><div class="flex gap-4 px-4 pb-2"></div></div></div>'),jo=s('<div class="min-w-0"><!></div>'),Lo=s('<div class="px-4 py-6 border-b border-border"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> Recent Highlights</h2> <div class="grid grid-cols-2 gap-4 w-full"></div></div>'),Ro=s('<div class="px-4 py-6"><h2 class="text-lg font-bold text-foreground mb-4 flex items-center gap-2"><svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg> Latest Articles</h2> <div class="divide-y divide-neutral-800/50 -mx-4"></div></div>'),zo=s("<!> <!> <!>",1),Ho=s('<div class="pb-6"><!></div> <!>',1),Fo=s('<div class="p-8 text-center text-muted-foreground">No videos found</div>'),So=s('<div class="p-8 text-center text-muted-foreground">Loading videos...</div>'),Bo=s('<div class="p-8 text-center text-muted-foreground">No images found</div>'),To=s('<div class="p-8 text-center text-muted-foreground">Loading images...</div>'),Uo=s('<div class="sm:p-4"><!></div>'),Ao=s('<div class="flex justify-center py-2 lg:relative lg:static fixed bottom-20 left-0 right-0 z-[500] lg:z-auto pointer-events-none"><button class="flex items-center gap-2 px-4 py-2 bg-neutral-900/95 hover:bg-muted border border-primary/50 lg:border-border rounded-full transition-all shadow-lg backdrop-blur-sm pointer-events-auto"><div class="flex -space-x-2"></div> <span class="text-sm text-primary lg:text-foreground font-medium"> </span></button></div>'),Io=s('<div class="p-8 text-center text-muted-foreground">No notes found</div>'),Eo=s("<!> <!> <!>",1),No=s('<div class="max-w-full mx-auto"><div class="divide-y divide-neutral-800/50"><!></div></div> <!>',1);function ws(We,_){jt(_,!0);const C=()=>fr(Ar,"$page",N),[N,k]=gr(),R=v=>{aa(v,{get headerTitle(){return e(lt)},get selectedFilter(){return e(g)},onFilterChange:z=>h(g,z,!0)})};let g=ue("conversations");const B=m(()=>C().url.searchParams.get("relay"));bt(()=>{e(B)&&e(B)!==pe.selectedRelay&&pe.setSelectedRelay(e(B))}),bt(()=>{zr.set(e(g))});const T=m(()=>br(e(B)||pe.selectedRelay,pe.relays.filter(v=>v.enabled&&v.read).map(v=>v.url))),X=m(()=>ot.$sessions?.follows||[]),D=m(()=>Array.from(e(X)));function F(v){return v?.startsWith("followpack:")??!1}let q=ue(null);bt(()=>{if(!pe.selectedRelay||!F(pe.selectedRelay)){h(q,null);return}const v=pe.selectedRelay.replace("followpack:","");ot.fetchEvent(v).then(z=>{h(q,z,!0)}).catch(z=>{console.error("Failed to fetch selected pack:",z),h(q,null)})});const te=m(()=>e(q)?e(q).tags.filter(v=>v[0]==="p").map(v=>v[1]):pe.selectedRelay?[]:e(D));console.log("[HomePage] Creating subscriptions");const i=Ut(ot,()=>{const v={kinds:[ft.Text,9802],limit:200};return ut.hasFilters&&(v["#t"]=ut.selectedHashtags),(!pe.selectedRelay||F(pe.selectedRelay))&&e(te).length>0&&(v.authors=e(te)),console.log("relays to use for notes",e(T)),{filters:[v],relayUrls:e(T).length>0?e(T):void 0,subId:"notes",cacheUnconstrainFilter:[],exclusiveRelay:!0}},{initialLimit:20,pageSize:20});console.log("[HomePage] Notes subscription created");const b=Ut(ot,()=>{const v={kinds:[ft.Text,ft.Image,ft.Video,ft.ShortVideo],limit:300};return ut.hasFilters&&(v["#t"]=ut.selectedHashtags),(!pe.selectedRelay||F(pe.selectedRelay))&&e(te).length>0&&(v.authors=e(te)),{filters:[v],relayUrls:e(T).length>0?e(T):void 0,cacheUnconstrainFilter:[],subId:"home-media",exclusiveRelay:e(T).length>0}},{initialLimit:30,pageSize:30}),I=Ut(ot,()=>{const v={kinds:[ft.Article],limit:100};return ut.hasFilters&&(v["#t"]=ut.selectedHashtags),(!pe.selectedRelay||F(pe.selectedRelay))&&e(te).length>0&&(v.authors=e(te)),{filters:[v],subId:"articles",exclusiveRelay:e(T).length>0,relayUrls:e(T).length>0?e(T):void 0}},{initialLimit:10,pageSize:10}),Y=Ut(ot,()=>{const v={kinds:[9802],limit:100};return ut.hasFilters&&(v["#t"]=ut.selectedHashtags),(!pe.selectedRelay||F(pe.selectedRelay))&&e(te).length>0&&(v.authors=e(te)),{filters:[v],subId:"highlights",exclusiveRelay:e(T).length>0,relayUrls:e(T).length>0?e(T):void 0}},{initialLimit:10,pageSize:10}),je=m(()=>I.events.map(v=>wr.from(v))),n=m(()=>e(je).filter(v=>v.title&&v.content).sort((v,z)=>(z.published_at??z.created_at??0)-(v.published_at??v.created_at??0))),$=m(()=>{const v=e(n).filter(de=>de.image),z=e(n).filter(de=>!de.image);return[...v,...z].slice(0,10)}),V=m(()=>Y.events.slice(0,10)),P=m(()=>e(n).slice(10));function ge(v,z){return(z==="image"?/(https?:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp|svg|avif))/gi:/(https?:\/\/[^\s]+\.(mp4|webm|mov|avi|mkv))/gi).test(v)}const Z=m(()=>e(g)==="images"?b.events.filter(v=>v.kind===ft.Image||v.kind===ft.Text&&ge(v.content,"image")):e(g)==="videos"?b.events.filter(v=>v.kind===ft.Video||v.kind===ft.ShortVideo||v.kind===22||v.kind===ft.Text&&ge(v.content,"video")):[]),st=m(()=>e(g)==="articles"?[]:i.events),Ke=m(()=>e(g)==="articles"?I.hasMore:i.hasMore),re=m(()=>e(g)==="articles"?I.isLoading:i.isLoading);function be(){e(g)==="articles"?I.loadMore():i.loadMore()}const we=m(()=>{const v=new Set,z=i.pendingEvents;for(const de of z){if(v.size>=3)break;v.add(de.pubkey)}return Array.from(v)}),lt=m(()=>Dt.interests.length>0?null:e(B)?{type:"text",text:It(e(B)).info?.name||e(B).replace("wss://","").replace("ws://","")}:pe.selectedRelay?F(pe.selectedRelay)&&e(q)?{type:"text",text:e(q).tagValue("title")||"Untitled Pack"}:{type:"text",text:It(pe.selectedRelay).info?.name||pe.selectedRelay.replace("wss://","").replace("ws://","")}:{type:"logo"});bt(()=>{e(g)==="articles"?Kt.setReadsMode():Kt.reset()}),bt(()=>(qt.header=R,()=>{qt.clear()}));var nt=No(),Je=y(nt),Xe=a(Je),qe=a(Xe);{var De=v=>{var z=Ho(),de=y(z),et=a(de);{var oe=H=>{var f=$o();t(H,f)},le=H=>{var f=ae(),o=y(f);{var c=u=>{var S=Mo();t(u,S)},d=u=>{var S=zo(),j=y(S);{var L=J=>{var ve=Po(),fe=l(a(ve),2),he=a(fe);Ue(he,21,()=>e($),me=>me.id,(me,Ie)=>{var ht=Co(),tt=a(ht);Or(tt,{get article(){return e(Ie)}}),r(ht),t(me,ht)}),r(he),r(fe),r(ve),t(J,ve)};p(j,J=>{e($).length>0&&J(L)})}var G=l(j,2);{var ke=J=>{var ve=Lo(),fe=l(a(ve),2);Ue(fe,21,()=>e(V),he=>he.id,(he,me)=>{var Ie=jo(),ht=a(Ie);Gt(ht,{get event(){return e(me)},variant:"grid"}),r(Ie),t(he,Ie)}),r(fe),r(ve),t(J,ve)};p(G,J=>{e(V).length>0&&J(ke)})}var ee=l(G,2);{var Le=J=>{var ve=Ro(),fe=l(a(ve),2);Ue(fe,21,()=>e(P),he=>he.id,(he,me)=>{Cr(he,{get article(){return e(me)}})}),r(fe),r(ve),t(J,ve)};p(ee,J=>{e(P).length>0&&J(Le)})}t(u,S)};p(o,u=>{e(n).length===0?u(c):u(d,!1)},!0)}t(H,f)};p(et,H=>{e(n).length===0&&I.eosed?H(oe):H(le,!1)})}r(de);var Ve=l(de,2);Qt(Ve,{onIntersect:be,get hasMore(){return I.hasMore},get isLoading(){return I.isLoading}}),t(v,z)},it=v=>{var z=ae(),de=y(z);{var et=le=>{var Ve=ae(),H=y(Ve);{var f=c=>{var d=Fo();t(c,d)},o=c=>{var d=ae(),u=y(d);{var S=L=>{var G=So();t(L,G)},j=L=>{Jr(L,{get events(){return e(Z)}})};p(u,L=>{e(Z).length===0?L(S):L(j,!1)},!0)}t(c,d)};p(H,c=>{e(Z).length===0&&b.eosed?c(f):c(o,!1)})}t(le,Ve)},oe=le=>{var Ve=ae(),H=y(Ve);{var f=c=>{var d=Uo(),u=a(d);{var S=L=>{var G=Bo();t(L,G)},j=L=>{var G=ae(),ke=y(G);{var ee=J=>{var ve=To();t(J,ve)},Le=J=>{Pr(J,{get events(){return e(Z)}})};p(ke,J=>{e(Z).length===0?J(ee):J(Le,!1)},!0)}t(L,G)};p(u,L=>{e(Z).length===0&&b.eosed?L(S):L(j,!1)})}r(d),t(c,d)},o=c=>{var d=Eo(),u=y(d);{var S=ee=>{var Le=Ao(),J=a(Le);J.__click=()=>i.loadPendingEvents();var ve=a(J);Ue(ve,20,()=>e(we).slice(0,3),me=>me,(me,Ie)=>{er(me,{get ndk(){return ot},get pubkey(){return Ie},class:"w-6 h-6 rounded-full border-2 border-foreground"})}),r(ve);var fe=l(ve,2),he=a(fe);r(fe),r(J),r(Le),w(()=>E(he,`${i.pendingCount??""} new ${i.pendingCount===1?"note":"notes"}`)),t(ee,Le)};p(u,ee=>{i.pendingCount>0&&ee(S)})}var j=l(u,2);{var L=ee=>{var Le=Io();t(ee,Le)},G=ee=>{var Le=ae(),J=y(Le);Ue(J,17,()=>e(st),ve=>ve.id,(ve,fe)=>{var he=ae(),me=y(he);{var Ie=tt=>{Gt(tt,{get event(){return e(fe)},variant:"feed"})},ht=tt=>{Mr(tt,{get event(){return e(fe)}})};p(me,tt=>{e(fe).kind===9802?tt(Ie):tt(ht,!1)})}t(ve,he)}),t(ee,Le)};p(j,ee=>{e(st).length===0?ee(L):ee(G,!1)})}var ke=l(j,2);Qt(ke,{onIntersect:be,get hasMore(){return e(Ke)},get isLoading(){return e(re)}}),t(c,d)};p(H,c=>{e(g)==="images"?c(f):c(o,!1)},!0)}t(le,Ve)};p(de,le=>{e(g)==="videos"?le(et):le(oe,!1)},!0)}t(v,z)};p(qe,v=>{e(g)==="articles"?v(De):v(it,!1)})}r(Xe),r(Je);var Ze=l(Je,2);yo(Ze,{onClose:()=>Nt.close(),get open(){return Nt.show},set open(v){Nt.show=v}}),t(We,nt),Lt(),k()}Ht(["click"]);export{ws as component};
