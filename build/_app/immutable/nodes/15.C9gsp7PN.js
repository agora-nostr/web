import{f as v,s as R,a as r,c as $,d as xt}from"../chunks/rzUyzf2y.js";import{s as bt,b as yt,g as i,a as at,p as pt,e as n,r as e,d as g,t as S,c as gt,f as D,aL as wt}from"../chunks/AsQG98fS.js";import{i as x}from"../chunks/DZKExFZC.js";import{e as G,i as tt}from"../chunks/Cztbr3Ea.js";import{a as kt}from"../chunks/CS0aOiUg.js";import{n as Mt}from"../chunks/tv6-RHC_.js";import{K as ut,a as ft,b as Et,c as zt,d as jt,e as Nt}from"../chunks/CR7Fa_Et.js";import{U as lt}from"../chunks/DdUskozk.js";import{N as dt}from"../chunks/Cxhu68Im.js";function Dt(l){if(!l)return 0;try{const t=l.match(/lnbc(\d+)([a-z])?/i);if(!t)return 0;const _=parseInt(t[1],10),T=t[2];let E=_;switch(T){case"m":E=_*1e5;break;case"u":E=_*100;break;case"n":E=_/10;break;case"p":E=_/1e4;break}return Math.floor(E)}catch{return 0}}function mt(l,t){const _=l.tags.find(T=>T[0]==="e"&&T[3]==="reply");return!!(_&&t.has(_[1]))}function Tt(l){let t=yt("all");const _=l.$subscribe(()=>{if(l.$currentUser)return{filters:[{kinds:[ut,ft,30023],authors:[l.$currentUser.pubkey],since:Math.floor(Date.now()/1e3)-3600*24*30}],subId:"user-events-meta"}}),T=at(()=>{const u=Array.from(_.events??[]);return new Set(u.map(o=>o.id))}),E=l.$metaSubscribe(()=>{if(l.$currentUser)return{filters:[{kinds:[ut,ft],"#p":[l.$currentUser.pubkey],since:Math.floor(Date.now()/1e3)-3600*24*30,limit:200}],sort:"tag-time"}}),L=l.$metaSubscribe(()=>{if(l.$currentUser)return{filters:[{kinds:[Et],"#p":[l.$currentUser.pubkey],since:Math.floor(Date.now()/1e3)-3600*24*30,limit:200}],sort:"tag-time"}}),Z=l.$metaSubscribe(()=>{if(l.$currentUser)return{filters:[{kinds:[zt,jt],"#p":[l.$currentUser.pubkey],since:Math.floor(Date.now()/1e3)-3600*24*30,limit:200}],sort:"tag-time"}}),et=l.$metaSubscribe(()=>{if(l.$currentUser)return{filters:[{kinds:[Nt],"#p":[l.$currentUser.pubkey],since:Math.floor(Date.now()/1e3)-3600*24*30,limit:200}],sort:"tag-time"}}),P=at(()=>{if(!l.$currentUser)return[];const u=[];for(const o of E.events){const f=E.eventsTagging(o);if(f.length===0)continue;const b=f.filter(a=>mt(a,i(T))),m=f.filter(a=>!mt(a,i(T)));b.length>0&&u.push({id:`reply-${o.id}`,type:"reply",timestamp:Math.max(...b.map(a=>a.created_at||0)),targetEvent:o,replies:b}),m.length>0&&u.push({id:`mention-${o.id}`,type:"mention",timestamp:Math.max(...m.map(a=>a.created_at||0)),targetEvent:o,mentions:m})}for(const o of L.events){const f=L.eventsTagging(o);if(f.length===0)continue;const b=new Map;for(const m of f){let a=m.content||"ðŸ‘";a==="+"&&(a="â¤ï¸"),b.has(a)||b.set(a,[]),b.get(a).push({pubkey:m.pubkey,event:m})}u.push({id:`reaction-${o.id}`,type:"reaction",timestamp:Math.max(...f.map(m=>m.created_at||0)),targetEvent:o,reactions:b})}for(const o of Z.events){const f=Z.eventsTagging(o);f.length!==0&&u.push({id:`repost-${o.id}`,type:"repost",timestamp:Math.max(...f.map(b=>b.created_at||0)),targetEvent:o,reposts:f})}for(const o of et.events){const f=et.eventsTagging(o);if(f.length===0)continue;const b=f.map(m=>{const a=m.tags.find(J=>J[0]==="bolt11")?.[1],k=Dt(a),K=m.tags.find(J=>J[0]==="description")?.[1];let U=m.pubkey;if(K)try{U=JSON.parse(K).pubkey||U}catch{}return{event:m,amount:k,sender:U}});u.push({id:`zap-${o.id}`,type:"zap",timestamp:Math.max(...f.map(m=>m.created_at||0)),targetEvent:o,zaps:b})}return u.sort((o,f)=>f.timestamp-o.timestamp)}),st=at(()=>i(t)==="all"?i(P):i(P).filter(u=>u.type===i(t))),nt=at(()=>{const u={all:i(P).length,reply:0,mention:0,reaction:0,repost:0,zap:0};return i(P).forEach(o=>{u[o.type]++}),u});return{get notifications(){return i(st)},get filter(){return i(t)},get counts(){return i(nt)},get eosed(){return E.eosed&&L.eosed&&Z.eosed&&et.eosed},setFilter(u){bt(t,u,!0)}}}var Ut=v('<div class="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center"><svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg></div>'),At=v('<div class="w-8 h-8 rounded-full bg-purple-500/10 flex items-center justify-center"><svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path></svg></div>'),Ct=v('<div class="w-8 h-8 rounded-full bg-pink-500/10 flex items-center justify-center"><svg class="w-4 h-4 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></div>'),It=v('<div class="w-8 h-8 rounded-full bg-green-500/10 flex items-center justify-center"><svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></div>'),Rt=v('<div class="w-8 h-8 rounded-full bg-yellow-500/10 flex items-center justify-center"><svg class="w-4 h-4 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div>'),St=v('<span class="text-sm text-muted-foreground"> </span>'),Bt=v('<div class="flex flex-wrap items-center gap-2 mb-2"><!> <!></div> <p class="text-sm text-muted-foreground mb-2"> </p>',1),Lt=v('<span class="text-sm text-muted-foreground"> </span>'),Kt=v('<div class="flex flex-wrap items-center gap-2 mb-2"><!> <!></div> <p class="text-sm text-muted-foreground mb-2"> </p>',1),Ft=v('<div class="flex items-center gap-1"><span class="text-lg"> </span> <!></div>'),Ht=v('<div class="flex flex-wrap items-center gap-2 mb-2"></div> <p class="text-sm text-muted-foreground mb-2"> </p>',1),Ot=v('<span class="text-sm text-muted-foreground"> </span>'),Pt=v('<div class="flex flex-wrap items-center gap-2 mb-2"><!> <!></div> <p class="text-sm text-muted-foreground mb-2"> </p>',1),Vt=v('<span class="text-sm text-muted-foreground"> </span>'),Gt=v('<div class="flex flex-wrap items-center gap-2 mb-2"><!> <!></div> <p class="text-sm text-muted-foreground mb-2"> </p>',1),Zt=v('<div class="bg-muted/30 rounded p-2"><!></div>'),Jt=v('<div class="mt-3 space-y-2"><p class="text-xs font-medium text-muted-foreground">Recent replies:</p> <!></div>'),Wt=v('<div class="bg-muted/30 rounded p-2"><!></div>'),Xt=v('<div class="mt-3 space-y-2"><p class="text-xs font-medium text-muted-foreground">Recent mentions:</p> <!></div>'),Yt=v('<div class="border-b border-border p-4 hover:bg-muted/50 transition-colors"><div class="flex items-start gap-3"><div class="flex-shrink-0 mt-1"><!></div> <div class="flex-1 min-w-0"><div class="mb-2"><!> <span class="text-xs text-muted-foreground"> </span></div> <div class="bg-muted/50 rounded-lg p-3"><!></div> <!></div></div></div>');function qt(l,t){pt(t,!0);const _=s=>{const c=Date.now()/1e3-s;return c<60?"just now":c<3600?`${Math.floor(c/60)}m ago`:c<86400?`${Math.floor(c/3600)}h ago`:c<604800?`${Math.floor(c/86400)}d ago`:`${Math.floor(c/604800)}w ago`};var T=Yt(),E=n(T),L=n(E),Z=n(L);{var et=s=>{var p=Ut();r(s,p)},P=s=>{var p=$(),c=D(p);{var z=d=>{var y=At();r(d,y)},A=d=>{var y=$(),F=D(y);{var j=h=>{var C=Ct();r(h,C)},M=h=>{var C=$(),rt=D(C);{var I=w=>{var N=It();r(w,N)},B=w=>{var N=$(),H=D(N);{var W=O=>{var it=Rt();r(O,it)};x(H,O=>{t.notification.type==="zap"&&O(W)},!0)}r(w,N)};x(rt,w=>{t.notification.type==="repost"?w(I):w(B,!1)},!0)}r(h,C)};x(F,h=>{t.notification.type==="reaction"?h(j):h(M,!1)},!0)}r(d,y)};x(c,d=>{t.notification.type==="mention"?d(z):d(A,!1)},!0)}r(s,p)};x(Z,s=>{t.notification.type==="reply"?s(et):s(P,!1)})}e(L);var st=g(L,2),nt=n(st),u=n(nt);{var o=s=>{var p=Bt(),c=D(p),z=n(c);G(z,17,()=>t.notification.replies.slice(0,3),tt,(j,M)=>{lt(j,{get pubkey(){return i(M).pubkey}})});var A=g(z,2);{var d=j=>{var M=St(),h=n(M);e(M),S(()=>R(h,`+${t.notification.replies.length-3} more`)),r(j,M)};x(A,j=>{t.notification.replies.length>3&&j(d)})}e(c);var y=g(c,2),F=n(y,!0);e(y),S(()=>R(F,t.notification.replies.length===1?"replied to your post":`${t.notification.replies.length} replies to your post`)),r(s,p)},f=s=>{var p=$(),c=D(p);{var z=d=>{var y=Kt(),F=D(y),j=n(F);G(j,17,()=>t.notification.mentions.slice(0,3),tt,(I,B)=>{lt(I,{get pubkey(){return i(B).pubkey}})});var M=g(j,2);{var h=I=>{var B=Lt(),w=n(B);e(B),S(()=>R(w,`+${t.notification.mentions.length-3} more`)),r(I,B)};x(M,I=>{t.notification.mentions.length>3&&I(h)})}e(F);var C=g(F,2),rt=n(C,!0);e(C),S(()=>R(rt,t.notification.mentions.length===1?"mentioned you":`${t.notification.mentions.length} mentions`)),r(d,y)},A=d=>{var y=$(),F=D(y);{var j=h=>{const C=at(()=>Array.from(t.notification.reactions.values()).reduce((N,H)=>N+H.length,0));var rt=Ht(),I=D(rt);G(I,21,()=>Array.from(t.notification.reactions.entries()).slice(0,2),tt,(N,H)=>{var W=at(()=>wt(i(H),2));let O=()=>i(W)[0],it=()=>i(W)[1];var X=Ft(),Y=n(X),V=n(Y,!0);e(Y);var q=g(Y,2);G(q,17,()=>it().slice(0,2),tt,(vt,ct)=>{lt(vt,{get pubkey(){return i(ct).pubkey}})}),e(X),S(()=>R(V,O())),r(N,X)}),e(I);var B=g(I,2),w=n(B);e(B),S(()=>R(w,`${i(C)??""} ${i(C)===1?"reaction":"reactions"}`)),r(h,rt)},M=h=>{var C=$(),rt=D(C);{var I=w=>{var N=Pt(),H=D(N),W=n(H);G(W,17,()=>t.notification.reposts.slice(0,3),tt,(V,q)=>{lt(V,{get pubkey(){return i(q).pubkey}})});var O=g(W,2);{var it=V=>{var q=Ot(),vt=n(q);e(q),S(()=>R(vt,`+${t.notification.reposts.length-3} more`)),r(V,q)};x(O,V=>{t.notification.reposts.length>3&&V(it)})}e(H);var X=g(H,2),Y=n(X,!0);e(X),S(()=>R(Y,t.notification.reposts.length===1?"reposted":`${t.notification.reposts.length} reposts`)),r(w,N)},B=w=>{var N=$(),H=D(N);{var W=O=>{const it=at(()=>t.notification.zaps.reduce((Q,ot)=>Q+ot.amount,0));var X=Gt(),Y=D(X),V=n(Y);G(V,17,()=>t.notification.zaps.slice(0,3),tt,(Q,ot)=>{lt(Q,{get pubkey(){return i(ot).sender}})});var q=g(V,2);{var vt=Q=>{var ot=Vt(),ht=n(ot);e(ot),S(()=>R(ht,`+${t.notification.zaps.length-3} more`)),r(Q,ot)};x(q,Q=>{t.notification.zaps.length>3&&Q(vt)})}e(Y);var ct=g(Y,2),_t=n(ct);e(ct),S(Q=>R(_t,`âš¡ ${Q??""} sats
            ${t.notification.zaps.length>1?`(${t.notification.zaps.length} zaps)`:""}`),[()=>i(it).toLocaleString()]),r(O,X)};x(H,O=>{t.notification.type==="zap"&&O(W)},!0)}r(w,N)};x(rt,w=>{t.notification.type==="repost"?w(I):w(B,!1)},!0)}r(h,C)};x(F,h=>{t.notification.type==="reaction"?h(j):h(M,!1)},!0)}r(d,y)};x(c,d=>{t.notification.type==="mention"?d(z):d(A,!1)},!0)}r(s,p)};x(u,s=>{t.notification.type==="reply"?s(o):s(f,!1)})}var b=g(u,2),m=n(b,!0);e(b),e(nt);var a=g(nt,2),k=n(a);dt(k,{get event(){return t.notification.targetEvent},compact:!0}),e(a);var K=g(a,2);{var U=s=>{var p=Jt(),c=g(n(p),2);G(c,17,()=>t.notification.replies.slice(0,2),tt,(z,A)=>{var d=Zt(),y=n(d);dt(y,{get event(){return i(A)},compact:!0}),e(d),r(z,d)}),e(p),r(s,p)},J=s=>{var p=$(),c=D(p);{var z=A=>{var d=Xt(),y=g(n(d),2);G(y,17,()=>t.notification.mentions.slice(0,2),tt,(F,j)=>{var M=Wt(),h=n(M);dt(h,{get event(){return i(j)},compact:!0}),e(M),r(F,M)}),e(d),r(A,d)};x(c,A=>{t.notification.type==="mention"&&t.notification.mentions.length>0&&A(z)},!0)}r(s,p)};x(K,s=>{t.notification.type==="reply"&&t.notification.replies.length>0?s(U):s(J,!1)})}e(st),e(E),e(T),S(s=>R(m,s),[()=>_(t.notification.timestamp)]),r(l,T),gt()}var Qt=v('<div class="flex items-center gap-2 text-xs text-muted-foreground"><svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <span>Loading...</span></div>'),$t=v('<span class="ml-1 opacity-70"> </span>'),te=v('<button type="button"> <!></button>'),ee=v(`<div class="p-8 text-center text-muted-foreground"><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg> <p class="text-lg font-medium mb-1">No notifications yet</p> <p class="text-sm">When people interact with your posts, you'll see it here</p></div>`),re=v('<div class="space-y-0"></div>'),ae=v('<div class="w-full"><div class="sticky top-0 z-10 bg-background/90 backdrop-blur-xl border-b border-border"><div class="px-4 py-4"><div class="flex items-center justify-between mb-3"><h1 class="text-xl font-bold text-foreground">Notifications v2 <span class="text-sm font-normal text-muted-foreground ml-2">($metaSubscribe)</span></h1> <!></div> <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide svelte-srm3pu"></div></div></div> <div class="min-h-screen"><!></div></div>');function fe(l,t){pt(t,!0);const _=Tt(Mt),T=[{value:"all",label:"All"},{value:"reply",label:"Replies"},{value:"mention",label:"Mentions"},{value:"reaction",label:"Reactions"},{value:"repost",label:"Reposts"},{value:"zap",label:"Zaps"}];function E(a){_.setFilter(a)}var L=ae(),Z=n(L),et=n(Z),P=n(et),st=g(n(P),2);{var nt=a=>{var k=Qt();r(a,k)};x(st,a=>{_.eosed||a(nt)})}e(P);var u=g(P,2);G(u,21,()=>T,tt,(a,k)=>{const K=at(()=>_.counts[i(k).value]);var U=te();U.__click=()=>E(i(k).value);var J=n(U),s=g(J);{var p=c=>{var z=$t(),A=n(z);e(z),S(()=>R(A,`(${i(K)??""})`)),r(c,z)};x(s,c=>{i(K)>0&&c(p)})}e(U),S(()=>{kt(U,1,`px-3 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors ${_.filter===i(k).value?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"}`),R(J,`${i(k).label??""} `)}),r(a,U)}),e(u),e(et),e(Z);var o=g(Z,2),f=n(o);{var b=a=>{var k=ee();r(a,k)},m=a=>{var k=re();G(k,21,()=>_.notifications,K=>K.id,(K,U)=>{qt(K,{get notification(){return i(U)}})}),e(k),r(a,k)};x(f,a=>{_.notifications.length===0?a(b):a(m,!1)})}e(o),e(L),r(l,L),gt()}xt(["click"]);export{fe as component};
