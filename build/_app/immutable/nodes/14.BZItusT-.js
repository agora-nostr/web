import"../chunks/DsnmJJEf.js";import{i as _,k as b,N as W,r as g,j as C,t as j,e as r,c as I,f as N,l as M,d as Q,p as A,u as S,s as K,b as O,g as a,a as p,h as V,M as D,L as H,aP as J,aQ as tt,bm as _t}from"../chunks/Bq750rDx.js";import{i as P}from"../chunks/BcjopvHb.js";import{e as $,i as st}from"../chunks/Cjcfrngr.js";import{c as ht,a as lt}from"../chunks/uSFILAY7.js";import{n as B,H as xt}from"../chunks/CdRP5_sk.js";import{c as yt}from"../chunks/DzEFrwiG.js";import{A as et}from"../chunks/Bt6DpIqu.js";import{E as nt}from"../chunks/DIzqhxA9.js";import{n as X}from"../chunks/DAOE6Nme.js";import{T as kt}from"../chunks/3NtbZaKM.js";import{p as G}from"../chunks/BL6J_geM.js";import{c as wt}from"../chunks/BRAzWB6r.js";import{U as pt}from"../chunks/DOhHcjXC.js";import{F as Nt}from"../chunks/YxVSQae_.js";function Z(h,t=100){return h?h.length>t?h.slice(0,t)+"...":h:""}var Pt=_("<div> </div>"),Ct=_('<div class="flex gap-3 p-4 hover:bg-muted/50 transition-colors border-b border-border"><div class="flex-shrink-0"><!></div> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1 flex-wrap"><!> <span class="text-sm text-muted-foreground"><!></span> <!></div> <!> <!></div></div>');function U(h,t){var o=Ct(),x=b(o),m=b(x);W(m,()=>t.avatar),g(x);var d=C(x,2),v=b(d),l=b(v);{var f=s=>{var w=I(),z=N(w);W(z,()=>t.icon),r(s,w)};P(l,s=>{t.icon&&s(f)})}var c=C(l,2),e=b(c);W(e,()=>t.message),g(c);var n=C(c,2);{var i=s=>{kt(s,{get timestamp(){return t.timestamp},class:"text-sm text-muted-foreground ml-auto"})};P(n,s=>{t.timestamp&&s(i)})}g(v);var u=C(v,2);{var y=s=>{var w=I(),z=N(w);W(z,()=>t.content),r(s,w)};P(u,s=>{t.content&&s(y)})}var E=C(u,2);{var k=s=>{var w=Pt(),z=b(w,!0);g(w),j(()=>{lt(w,1,`text-sm text-muted-foreground bg-muted/30 rounded p-2 border-l-2 border-${t.previewColor??""}/50 break-words`),M(z,t.preview)}),r(s,w)};P(E,s=>{t.preview&&s(k)})}g(d),g(o),j(()=>ht(o,"data-testid",t.testId)),r(h,o)}var Et=_('<button type="button" class="flex-shrink-0"><!></button>'),jt=D('<svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>'),Mt=_('<button type="button" class="font-semibold hover:underline text-foreground"> </button> replied to your note',1),zt=_('<div class="text-foreground leading-relaxed mb-2 break-words"><!></div>');function It(h,t){A(t,!0);let o=O(null);S(()=>{t.event.author.fetchProfile().then(v=>{K(o,v,!0)})});const x=p(()=>a(o)?.name||a(o)?.displayName||"Anonymous");function m(){X(t.event.pubkey)}const d=p(()=>Z(t.targetEvent?.content??""));U(h,{get timestamp(){return t.event.created_at},get preview(){return a(d)},previewColor:"primary",avatar:e=>{var n=Et();n.__click=m;var i=b(n);et(i,{get ndk(){return B},get pubkey(){return t.event.pubkey},class:"w-10 h-10 cursor-pointer hover:opacity-80 transition-opacity"}),g(n),r(e,n)},icon:e=>{var n=jt();r(e,n)},message:e=>{var n=Mt(),i=N(n);i.__click=m;var u=b(i,!0);g(i),H(),j(()=>M(u,a(x))),r(e,n)},content:e=>{var n=zt(),i=b(n);nt(i,{get ndk(){return B},get content(){return t.event.content},get emojiTags(){return t.event.tags}}),g(n),r(e,n)}}),V()}Q(["click"]);var At=_('<button type="button" class="flex-shrink-0"><!></button>'),Vt=D('<svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path></svg>'),Rt=_('<button type="button" class="font-semibold hover:underline text-foreground"> </button> mentioned you',1),Bt=_('<div class="text-foreground leading-relaxed break-words"><!></div>');function Ft(h,t){A(t,!0);let o=O(null);S(()=>{t.event.author.fetchProfile().then(d=>{K(o,d,!0)})});const x=p(()=>a(o)?.name||a(o)?.displayName||"Anonymous");function m(){X(t.event.pubkey)}U(h,{get timestamp(){return t.event.created_at},avatar:c=>{var e=At();e.__click=m;var n=b(e);et(n,{get ndk(){return B},get pubkey(){return t.event.pubkey},class:"w-10 h-10 cursor-pointer hover:opacity-80 transition-opacity"}),g(e),r(c,e)},icon:c=>{var e=Vt();r(c,e)},message:c=>{var e=Rt(),n=N(e);n.__click=m;var i=b(n,!0);g(n),H(),j(()=>M(i,a(x))),r(c,e)},content:c=>{var e=Bt(),n=b(e);nt(n,{get ndk(){return B},get content(){return t.event.content},get emojiTags(){return t.event.tags}}),g(e),r(c,e)}}),V()}Q(["click"]);var Tt=_('<button type="button" class="flex-shrink-0"><!></button>'),Ut=D('<svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>'),Lt=_('<button type="button" class="font-semibold hover:underline text-foreground"> </button> quoted your note',1),qt=_('<div class="text-foreground leading-relaxed mb-2 break-words"><!></div>');function Ht(h,t){A(t,!0);let o=O(null);S(()=>{t.event.author.fetchProfile().then(v=>{K(o,v,!0)})});const x=p(()=>a(o)?.name||a(o)?.displayName||"Anonymous");function m(){X(t.event.pubkey)}const d=p(()=>Z(t.targetEvent?.content??""));U(h,{get timestamp(){return t.event.created_at},get preview(){return a(d)},previewColor:"purple-500",avatar:e=>{var n=Tt();n.__click=m;var i=b(n);et(i,{get ndk(){return B},get pubkey(){return t.event.pubkey},class:"w-10 h-10 cursor-pointer hover:opacity-80 transition-opacity"}),g(n),r(e,n)},icon:e=>{var n=Ut();r(e,n)},message:e=>{var n=Lt(),i=N(n);i.__click=m;var u=b(i,!0);g(i),H(),j(()=>M(u,a(x))),r(e,n)},content:e=>{var n=qt(),i=b(n);nt(i,{get ndk(){return B},get content(){return t.event.content},get emojiTags(){return t.event.tags}}),g(n),r(e,n)}}),V()}Q(["click"]);function Qt(h,t){A(t,!0);let o=G(t,"field",3,"displayName"),x=G(t,"class",3,""),m=G(t,"as",3,"span");const d=p(()=>t.user||(t.ndk&&t.pubkey?t.ndk.getUser({pubkey:t.pubkey}):null)),v=p(()=>a(d)&&t.ndk?xt({ndk:t.ndk,user:a(d)}):null),l=p(()=>()=>{if(!a(v)?.profile)return a(d)?.npub.slice(0,8)+"..."||"Unknown";const e=a(v).profile;if(o()==="name")return e.name||a(d)?.npub.slice(0,8)+"...";if(o()==="displayName")return e.displayName||e.name||a(d)?.npub.slice(0,8)+"...";if(o()==="both"){const n=e.displayName||e.name,i=e.name&&e.name!==e.displayName?e.name:null;return i?`${n} (@${i})`:n||a(d)?.npub.slice(0,8)+"..."}return a(d)?.npub.slice(0,8)+"..."||"Unknown"});var f=I(),c=N(f);wt(c,m,(e,n)=>{n(e,{get class(){return`ndk-name ${x()??""}`},children:(i,u)=>{H();var y=J();j(()=>M(y,a(l))),r(i,y)},$$slots:{default:!0}})}),r(h,f),V()}var St=_('<button type="button" class="font-semibold hover:underline text-foreground"><!><!></button>'),Dt=_('<span class="text-muted-foreground"> </span>'),Zt=_('<span class="inline-flex items-center gap-1 flex-wrap"><!> <!></span>');function at(h,t){A(t,!0);const o=G(t,"maxVisible",3,2),x=p(()=>t.pubkeys.slice(0,o())),m=p(()=>Math.max(0,t.pubkeys.length-o()));function d(e,n){n.stopPropagation(),X(e)}var v=Zt(),l=b(v);$(l,17,()=>a(x),st,(e,n,i)=>{var u=St();u.__click=s=>d(a(n),s);var y=b(u);Qt(y,{get ndk(){return B},get pubkey(){return a(n)}});var E=C(y);{var k=s=>{var w=J(",");r(s,w)};P(E,s=>{(i<a(x).length-1||a(m)>0)&&s(k)})}g(u),r(e,u)});var f=C(l,2);{var c=e=>{var n=Dt(),i=b(n);g(n),j(()=>M(i,`and ${a(m)??""} ${a(m)===1?"other":"others"}`)),r(e,n)};P(f,e=>{a(m)>0&&e(c)})}g(v),r(h,v),V()}Q(["click"]);var Wt=_('<div class="flex-shrink-0 w-10 h-10 flex items-center justify-center text-2xl"> </div>'),Gt=D('<svg class="w-4 h-4 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>'),Jt=_('<!> <span class="text-lg mx-1"> </span> to your note',1);function Kt(h,t){A(t,!0),console.log("[ReactionNotification] Rendering:",t.emoji,"reactors:",t.reactors.length,"targetEvent:",!!t.targetEvent),tt(()=>{console.log("[ReactionNotification] Mounted:",t.emoji)});const o=p(()=>t.reactors.map(m=>m.pubkey)),x=p(()=>Z(t.targetEvent?.content??""));U(h,{get timestamp(){return t.timestamp},get preview(){return a(x)},previewColor:"red-500",avatar:l=>{var f=Wt(),c=b(f,!0);g(f),j(()=>M(c,t.emoji)),r(l,f)},icon:l=>{var f=Gt();r(l,f)},message:l=>{var f=Jt(),c=N(f);at(c,{get pubkeys(){return a(o)},maxVisible:2});var e=C(c);e.nodeValue=" reacted ";var n=C(e),i=b(n,!0);g(n),H(),j(()=>M(i,t.emoji)),r(l,f)}}),V()}var Ot=_('<div class="flex-shrink-0 w-10 h-10 flex items-center justify-center"><svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></div>'),Xt=_("<!> ",1);function Yt(h,t){A(t,!0);const o=p(()=>t.reposts.map(m=>m.pubkey)),x=p(()=>Z(t.targetEvent?.content??""));U(h,{get timestamp(){return t.timestamp},get preview(){return a(x)},previewColor:"green-500",avatar:v=>{var l=Ot();r(v,l)},message:v=>{var l=Xt(),f=N(l);at(f,{get pubkeys(){return a(o)},maxVisible:2});var c=C(f);c.nodeValue=` reposted
		your note`,r(v,l)}}),V()}var $t=_('<div class="flex-shrink-0 w-10 h-10 flex items-center justify-center"><svg class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div>'),te=_('<!> <span class="font-semibold text-yellow-600 dark:text-yellow-400 mx-1"> </span> <!>',1);function ee(h,t){A(t,!0);const o=p(()=>t.zaps.map(v=>v.sender)),x=p(()=>t.zaps.reduce((v,l)=>v+l.amount,0)),m=p(()=>a(x).toLocaleString()),d=p(()=>Z(t.targetEvent?.content??""));U(h,{get timestamp(){return t.timestamp},get preview(){return a(d)},previewColor:"yellow-500",avatar:f=>{var c=$t();r(f,c)},message:f=>{var c=te(),e=N(c);at(e,{get pubkeys(){return a(o)},maxVisible:2});var n=C(e);n.nodeValue=" zapped ";var i=C(n),u=b(i);g(i);var y=C(i,2);{var E=s=>{var w=J("to your note");r(s,w)},k=s=>{var w=J("to you");r(s,w)};P(y,s=>{t.targetEvent?s(E):s(k,!1)})}j(()=>M(u,`${a(m)??""} sats`)),r(f,c)}}),V()}var ne=_('<p class="text-sm text-muted-foreground">accepted your invite ðŸŽ‰</p>'),ae=_('<div class="flex-1 min-w-0"><!></div>'),oe=D('<svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'),re=_('<p class="text-sm text-muted-foreground mt-1 line-clamp-2 break-words ml-[54px]"> </p>'),ie=_('<!> <div class="flex items-center gap-2 mt-2 ml-[54px]"><!></div>',1);function se(h,t){A(t,!0);let o=O(null);S(()=>{B.fetchUser(t.notification.inviteePubkey).then(d=>{d?.fetchProfile().then(v=>{K(o,v,!0)})})});const x=p(()=>B.$sessions?.follows??new Set),m=p(()=>a(x).has(t.notification.inviteePubkey));U(h,{testId:"invite-acceptance-notification",get timestamp(){return t.notification.timestamp},avatar:c=>{var e=ae(),n=b(e);pt(n,{get pubkey(){return t.notification.inviteePubkey},variant:"avatar-name-meta",avatarSize:"w-10 h-10",nameSize:"text-base font-semibold",meta:u=>{var y=ne();r(u,y)},$$slots:{meta:!0}}),g(e),r(c,e)},icon:c=>{var e=oe();r(c,e)},message:c=>{},content:c=>{var e=ie(),n=N(e);{var i=k=>{var s=re(),w=b(s,!0);g(s),j(()=>M(w,a(o).about)),r(k,s)};P(n,k=>{a(o)?.about&&k(i)})}var u=C(n,2),y=b(u);{var E=k=>{Nt(k,{get pubkey(){return t.notification.inviteePubkey},variant:"outline"})};P(y,k=>{a(m)||k(E)})}g(u),r(c,e)}}),V()}function le(h,t){A(t,!0),console.log("[NotificationItem] Rendering notification:",t.notification.type,t.notification.id),tt(()=>{console.log("[NotificationItem] Mounted:",t.notification.type,t.notification.id)}),_t(()=>{console.log("[NotificationItem] Destroyed:",t.notification.type,t.notification.id)});const o=p(()=>{if(console.log("[NotificationItem] Computing targetEvent for:",t.notification.type,t.notification.id),t.notification.type==="reply"){const l=t.targetEventsCache.get(t.notification.replyToEventId);return console.log("[NotificationItem] Reply target event:",l?"found":"not found"),l}else if(t.notification.type==="quote"){const l=t.targetEventsCache.get(t.notification.quotedEventId);return console.log("[NotificationItem] Quote target event:",l?"found":"not found"),l}else if(t.notification.type==="reaction"||t.notification.type==="repost"||t.notification.type==="zap"){const l=t.targetEventsCache.get(t.notification.targetEventId);return console.log("[NotificationItem]",t.notification.type,"target event:",l?"found":"not found"),l}});var x=I(),m=N(x);{var d=l=>{It(l,{get event(){return t.notification.event},get targetEvent(){return a(o)}})},v=l=>{var f=I(),c=N(f);{var e=i=>{Ft(i,{get event(){return t.notification.event}})},n=i=>{var u=I(),y=N(u);{var E=s=>{Ht(s,{get event(){return t.notification.event},get targetEvent(){return a(o)}})},k=s=>{var w=I(),z=N(w);{var F=R=>{Kt(R,{get emoji(){return t.notification.emoji},get reactors(){return t.notification.reactors},get targetEvent(){return a(o)},get timestamp(){return t.notification.timestamp}})},T=R=>{var ot=I(),ct=N(ot);{var vt=L=>{Yt(L,{get reposts(){return t.notification.reposts},get targetEvent(){return a(o)},get timestamp(){return t.notification.timestamp}})},ut=L=>{var rt=I(),dt=N(rt);{var ft=q=>{ee(q,{get zaps(){return t.notification.zaps},get targetEvent(){return a(o)},get timestamp(){return t.notification.timestamp}})},mt=q=>{var it=I(),gt=N(it);{var bt=Y=>{se(Y,{get notification(){return t.notification}})};P(gt,Y=>{t.notification.type==="invite_acceptance"&&Y(bt)},!0)}r(q,it)};P(dt,q=>{t.notification.type==="zap"?q(ft):q(mt,!1)},!0)}r(L,rt)};P(ct,L=>{t.notification.type==="repost"?L(vt):L(ut,!1)},!0)}r(R,ot)};P(z,R=>{t.notification.type==="reaction"?R(F):R(T,!1)},!0)}r(s,w)};P(y,s=>{t.notification.type==="quote"?s(E):s(k,!1)},!0)}r(i,u)};P(c,i=>{t.notification.type==="mention"?i(e):i(n,!1)},!0)}r(l,f)};P(m,l=>{t.notification.type==="reply"?l(d):l(v,!1)})}r(h,x),V()}var ce=_('<span class="ml-1 opacity-70"> </span>'),ve=_('<button type="button"> <!></button>'),ue=_(`<div class="p-8 text-center text-muted-foreground"><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg> <p class="text-lg font-medium mb-1">No notifications yet</p> <p class="text-sm">When people interact with your posts, you'll see it here</p></div>`),de=_(" <!>",1),fe=_('<div class="w-full"><div class="sticky top-0 z-10 bg-background/90 backdrop-blur-xl border-b border-border"><div class="px-4 py-4"><h1 class="text-xl font-bold text-foreground mb-3">Notifications</h1> <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide svelte-xbnxce"></div></div></div> <div class="min-h-screen"><!></div></div>');function Me(h,t){A(t,!0),console.log("[NotificationsPage] Initializing notifications page");const o=yt(B);tt(()=>{console.log("[NotificationsPage] Mounted")});const x=[{value:"all",label:"All"},{value:"reply",label:"Replies"},{value:"mention",label:"Mentions"},{value:"quote",label:"Quotes"},{value:"reaction",label:"Reactions"},{value:"repost",label:"Reposts"},{value:"zap",label:"Zaps"},{value:"invite",label:"Invites"}];function m(u){console.log("[NotificationsPage] Filter changed to:",u),o.setFilter(u)}S(()=>{console.log("[NotificationsPage] Notifications count:",o.notifications.length),console.log("[NotificationsPage] Current filter:",o.filter),console.log("[NotificationsPage] Counts:",o.counts)});var d=fe(),v=b(d),l=b(v),f=C(b(l),2);$(f,21,()=>x,st,(u,y)=>{const E=p(()=>o.counts[a(y).value]);var k=ve();k.__click=()=>m(a(y).value);var s=b(k),w=C(s);{var z=F=>{var T=ce(),R=b(T);g(T),j(()=>M(R,`(${a(E)??""})`)),r(F,T)};P(w,F=>{a(E)>0&&F(z)})}g(k),j(()=>{lt(k,1,`px-3 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors ${o.filter===a(y).value?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"}`),M(s,`${a(y).label??""} `)}),r(u,k)}),g(f),g(l),g(v);var c=C(v,2),e=b(c);{var n=u=>{var y=ue();r(u,y)},i=u=>{var y=I(),E=N(y);$(E,19,()=>o.notifications,k=>k.id,(k,s,w)=>{H();var z=de(),F=N(z),T=C(F);le(T,{get notification(){return a(s)},get targetEventsCache(){return o.targetEventsCache}}),j(R=>M(F,`${R??""} `),[()=>console.log("[NotificationsPage] Rendering notification",a(w),":",a(s).type,a(s).id)]),r(k,z)}),r(u,y)};P(e,u=>{o.notifications.length===0?u(n):u(i,!1)})}g(c),g(d),r(h,d),V()}Q(["click"]);export{Me as component};
