const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/CdRP5_sk.js","../chunks/PPVm8Dsz.js","../chunks/Bq750rDx.js","../chunks/8fKzzJjY.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{b as Q,ax as Ke,D as Ve,aw as Ce,af as Xe,g as e,ay as Ye,s as g,az as Pe,K as xe,u as Be,d as Ae,p as Fe,c as ie,f as N,e as l,h as Ue,i as H,L as A,aP as ce,j as c,k as p,r as f,a as se,M as Ee,t as ae,l as oe}from"../chunks/Bq750rDx.js";import{i as j}from"../chunks/BcjopvHb.js";import{e as ye,i as we}from"../chunks/Cjcfrngr.js";import{s as Ze,a as et}from"../chunks/wxUnewq1.js";import{p as tt}from"../chunks/CFwZN-iQ.js";import{q as rt,N as nt,n as Ne,b as Qe}from"../chunks/CdRP5_sk.js";import{S as qe}from"../chunks/8fKzzJjY.js";import{N as Le}from"../chunks/CPZq7sH0.js";import{H as je}from"../chunks/_MORhMiq.js";import{p as Je}from"../chunks/BL6J_geM.js";import{_ as st}from"../chunks/PPVm8Dsz.js";import{c as ee}from"../chunks/BRAzWB6r.js";import{M as at,b as ot,c as it,d as lt,R as dt,e as ut,f as vt,g as ct,h as ft}from"../chunks/Dw4s2o4Z.js";import{D as ht,a as pt}from"../chunks/C7FVrkeR.js";import{D as gt}from"../chunks/DtjL0N-6.js";import{I as We,B as ge}from"../chunks/DMhdcQZj.js";import{D as mt}from"../chunks/CHVQ8-IN.js";var _t=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],bt=["difference","intersection","symmetricDifference","union"],Ge=!1;class ke extends Set{#r=new Map;#e=Q(0);#t=Q(0);#n=Ke||-1;constructor(t){if(super(),Ve&&(t=new Set(t),Ce(this.#e,"SvelteSet version"),Ce(this.#t,"SvelteSet.size")),t){for(var a of t)super.add(a);this.#t.v=super.size}Ge||this.#a()}#s(t){return Ke===this.#n?Q(t):Xe(t)}#a(){Ge=!0;var t=ke.prototype,a=Set.prototype;for(const s of _t)t[s]=function(...r){return e(this.#e),a[s].apply(this,r)};for(const s of bt)t[s]=function(...r){e(this.#e);var i=a[s].apply(this,r);return new ke(i)}}has(t){var a=super.has(t),s=this.#r,r=s.get(t);if(r===void 0){if(!a)return e(this.#e),!1;r=this.#s(!0),Ve&&Ce(r,`SvelteSet has(${Ye(t)})`),s.set(t,r)}return e(r),a}add(t){return super.has(t)||(super.add(t),g(this.#t,super.size),Pe(this.#e)),this}delete(t){var a=super.delete(t),s=this.#r,r=s.get(t);return r!==void 0&&(s.delete(t),g(r,!1)),a&&(g(this.#t,super.size),Pe(this.#e)),a}clear(){if(super.size!==0){super.clear();var t=this.#r;for(var a of t.values())g(a,!1);t.clear(),g(this.#t,0),Pe(this.#e)}}keys(){return this.values()}values(){return e(this.#e),super.values()}entries(){return e(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return e(this.#t)}}function ze(h){if(!h)return null;const t=h.tags.find(r=>r[0]==="e"&&r[3]==="root");if(t)return t[1];if(h.tags.find(r=>r[0]==="e"&&r[3]==="reply"))return null;const s=h.tags.filter(r=>r[0]==="e");return s.length>0?s[0][1]:null}function Oe(h){if(!h)return null;const t=h.tags.find(r=>r[0]==="e"&&r[3]==="reply");if(t)return{id:t[1],relayHint:t[2]||void 0};const a=h.tags.find(r=>r[0]==="e"&&r[3]==="root");if(a&&a[1]!==h.id)return{id:a[1],relayHint:a[2]||void 0};const s=h.tags.filter(r=>r[0]==="e");if(s.length>0){const r=s[s.length-1];return{id:r[1],relayHint:r[2]||void 0}}return null}function xt(h,t,a=20){const s=[];let r=h,i=0;const n=new Set;for(;r&&i<a;){if(i++,n.has(r.id)){console.warn("Circular reference detected in thread",r.id);break}n.add(r.id);const d=Oe(r);if(d?.id)if(t.has(d.id)){const m=t.get(d.id);s.unshift({id:d.id,event:m,relayHint:d.relayHint}),r=m}else{s.unshift({id:d.id,event:null,relayHint:d.relayHint});break}else break}return i>=a&&console.warn(`Thread depth limit reached (${a})`),s}function yt(h,t,a,s=[]){const r=[];h&&h!==t&&r.push({ids:[h]},{kinds:a,"#e":[h]}),r.push({kinds:a,"#e":[t]});for(const i of s)i!==t&&i!==h&&r.push({kinds:a,"#e":[i]});return r.push({ids:[t]}),r}function wt(h,t,a=20){const s=[],r=h.pubkey,i=Array.from(t.values());let n=h,d=0;const m=new Set([h.id]);for(;d<a;){d++;const v=i.filter(b=>{if(m.has(b.id)||b.pubkey!==r)return!1;const F=b.tags.find(G=>G[0]==="e"&&G[3]==="reply");if(F)return F[1]===n.id;const Y=b.tags.filter(G=>G[0]==="e");return Y.length>0&&Y[Y.length-1][1]===n.id});if(v.sort((b,F)=>(b.created_at||0)-(F.created_at||0)),v.length===0)break;const k=v[0];m.add(k.id);const P=Oe(k);s.push({id:k.id,event:k,relayHint:P?.relayHint}),n=k}return s}function kt(h){return Array.from(h.keys())}function Et(h,t,a){const s=Oe(t),r={id:t.id,event:t,relayHint:s?.relayHint},i=[...h,r,...a];return i.map((n,d)=>{const m=d<i.length-1?i[d+1]:null,v=m?.event&&n.event?n.event.pubkey===m.event.pubkey:!1;return{...n,threading:{isSelfThread:v,showLineToNext:m!==null,depth:d,isMainChain:!0}}})}function $t(h,t,a){const s=[],r=[];for(const n of t){if(a.has(n.id))continue;const d=n.tags.find(v=>v[0]==="e"&&v[3]==="reply");let m=null;if(d)m=d[1];else{const v=n.tags.filter(k=>k[0]==="e");v.length>0&&(m=v[v.length-1][1])}m&&a.has(m)&&(m===h?s.push(n):r.push(n))}const i=(n,d)=>(n.created_at||0)-(d.created_at||0);return s.sort(i),r.sort(i),{replies:s,otherReplies:r}}function Tt(h,t){const a=rt(t),{focusedEvent:s,maxDepth:r=20,kinds:i=[nt.Text,9802]}=h();let n=Q(xe([])),d=Q(xe([])),m=Q(xe([])),v=Q(null),k,P=new qe,b=new qe,F=new ke;Be(()=>{Y()});async function Y(){if(typeof s=="string"){const w=await a.fetchEvent(s);w&&(g(v,w,!0),G())}else g(v,s,!0),G()}function G(){if(!e(v)||k)return;const w=ze(e(v)),_=yt(w,e(v).id,i);k=a.subscribe(_,{closeOnEose:!1,groupable:!1}),k.on("event",$=>{b.set($.id,$),te()}),te()}function te(){if(!e(v))return;const w=xt(e(v),b,r),_=wt(e(v),b,r),$=Et(w,e(v),_);g(n,$,!0);const O=new Set($.map(Z=>Z.id)),E=Array.from(b.values()),{replies:T,otherReplies:z}=$t(e(v).id,E,O);g(d,T,!0),g(m,z,!0),x(),o()}function x(){const w=e(n).filter(_=>!_.event);for(const _ of w){if(P.has(_.id))continue;const $=[{ids:[_.id]}];_.relayHint&&_.relayHint;const O=a.subscribe($,{closeOnEose:!0,groupable:!1});O.on("event",E=>{E.id===_.id&&(b.set(E.id,E),te(),O.stop(),P.delete(_.id))}),P.set(_.id,O)}}function o(){const _=kt(b).filter(E=>!F.has(E));if(_.length===0)return;_.forEach(E=>F.add(E));const $=_.map(E=>({kinds:i,"#e":[E]}));if($.length===0)return;const O=a.subscribe($,{closeOnEose:!0,groupable:!1});O.on("event",E=>{b.has(E.id)||b.set(E.id,E)}),O.on("eose",()=>{te(),O.stop()})}async function I(w){let _=null;if(typeof w=="string"){if(_=b.get(w)||null,!_){const T=await a.fetchEvent(w);T&&(_=T,b.set(T.id,T))}}else _=w,b.has(w.id)||b.set(w.id,w);if(!_)return;const $=e(v)?ze(e(v)):null,O=ze(_);$===O?(g(v,_,!0),te()):(U(),b.clear(),F.clear(),g(n,[],!0),g(d,[],!0),g(m,[],!0),g(v,_,!0),b.set(_.id,_),G())}function U(){k?.stop(),k=void 0;for(const w of P.values())w.stop();P.clear()}return Be(()=>()=>{U()}),{get events(){return e(n)},get replies(){return e(d)},get otherReplies(){return e(m)},get allReplies(){return[...e(d),...e(m)]},get focusedEventId(){return e(v)?.id??null},focusOn:I}}var Mt=H("<!> <!>",1),Rt=H('<div class="flex items-center justify-between p-2 bg-muted/30 rounded border border-border text-sm"><span class="font-mono text-xs truncate flex-1 mr-2"> </span> <button type="button" class="text-muted-foreground hover:text-destructive transition-colors p-1" aria-label="Remove relay"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),It=H('<div class="space-y-2"><div class="text-sm font-medium text-foreground"> </div> <div class="max-h-40 overflow-y-auto space-y-1"></div></div>'),Dt=H('<div class="p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-destructive text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),Ht=H('<div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-600 dark:text-green-400 text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Event found! Loading...</span></div>'),St=Ee('<svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Searching...',1),Ct=Ee('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Search for Event',1),Pt=H("<!> <!>",1),Lt=H('<!> <div class="space-y-4"><div class="p-3 bg-muted/50 rounded-lg border border-border"><div class="text-xs text-muted-foreground mb-1 font-medium">Event ID (nevent)</div> <div class="font-mono text-xs break-all text-foreground"> </div></div> <div class="space-y-2"><label class="text-sm font-medium text-foreground">Add Relay URL</label> <div class="flex gap-2"><!> <!></div> <p class="text-xs text-muted-foreground">Enter relay URLs where this event might be stored (e.g., wss://relay.damus.io)</p></div> <!> <!> <!></div> <!>',1),jt=H("<!> <!>",1),zt=H('<div class="flex items-center justify-between p-2 bg-muted/30 rounded border border-border text-sm"><span class="font-mono text-xs truncate flex-1 mr-2"> </span> <button type="button" class="text-muted-foreground hover:text-destructive transition-colors p-1" aria-label="Remove relay"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>'),Bt=H('<div class="space-y-2"><div class="text-sm font-medium text-foreground"> </div> <div class="max-h-40 overflow-y-auto space-y-1"></div></div>'),Nt=H('<div class="p-3 bg-destructive/10 border border-destructive/20 rounded-lg text-destructive text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span> </span></div>'),At=H('<div class="p-3 bg-green-500/10 border border-green-500/20 rounded-lg text-green-600 dark:text-green-400 text-sm flex gap-2"><svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span>Event found! Loading...</span></div>'),Ft=Ee('<svg class="w-4 h-4 animate-spin mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Searching...',1),Ut=Ee('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Search for Event',1),Ot=H('<div class="flex gap-3"><!> <!></div>'),Kt=H('<!> <div class="space-y-4 px-4"><div class="p-3 bg-muted/50 rounded-lg border border-border"><div class="text-xs text-muted-foreground mb-1 font-medium">Event ID (nevent)</div> <div class="font-mono text-xs break-all text-foreground"> </div></div> <div class="space-y-2"><label class="text-sm font-medium text-foreground">Add Relay URL</label> <div class="flex gap-2"><!> <!></div> <p class="text-xs text-muted-foreground">Enter relay URLs where this event might be stored (e.g., wss://relay.damus.io)</p></div> <!> <!> <!></div> <!>',1);function Vt(h,t){Fe(t,!0);const a=new at("(min-width: 768px)");let s=Je(t,"show",15),r=Q(""),i=Q(xe(t.relayHint?[t.relayHint]:[])),n=Q(!1),d=Q(""),m=Q(!1);const v=se(()=>{try{return Qe.neventEncode({id:t.eventId,relays:t.relayHint?[t.relayHint]:[]})}catch{return t.eventId}});function k(){const o=e(r).trim();if(o){if(!o.startsWith("wss://")&&!o.startsWith("ws://")){g(d,"Relay URL must start with wss:// or ws://");return}if(e(i).includes(o)){g(d,"This relay is already in the list");return}g(i,[...e(i),o],!0),g(r,""),g(d,"")}}function P(o){g(i,e(i).filter(I=>I!==o),!0)}async function b(){if(e(i).length===0){g(d,"Please add at least one relay URL");return}g(n,!0),g(d,""),g(m,!1);try{const o=await st(async()=>{const{NDKRelaySet:U}=await import("../chunks/CdRP5_sk.js").then(w=>w.T);return{NDKRelaySet:U}},__vite__mapDeps([0,1,2,3]),import.meta.url).then(({NDKRelaySet:U})=>U.fromRelayUrls(e(i),Ne)),I=await Ne.fetchEvent({ids:[t.eventId]},{closeOnEose:!0},o);I?(g(m,!0),t.onEventFound?.(I),setTimeout(()=>{s(!1)},1e3)):g(d,"Event not found on the specified relays")}catch(o){console.error("Error fetching event:",o),g(d,o instanceof Error?o.message:"Failed to fetch event",!0)}finally{g(n,!1)}}function F(o){o.key==="Enter"&&k()}var Y=ie(),G=N(Y);{var te=o=>{var I=ie(),U=N(I);ee(U,()=>dt,(w,_)=>{_(w,{get open(){return s()},set open($){s($)},children:($,O)=>{var E=ie(),T=N(E);ee(T,()=>ot,(z,Z)=>{Z(z,{class:"max-w-2xl",onClose:()=>s(!1),children:(le,me)=>{var de=Lt(),ue=N(de);ee(ue,()=>it,(u,y)=>{y(u,{children:(M,V)=>{var L=Mt(),q=N(L);ee(q,()=>lt,(R,D)=>{D(R,{children:(B,W)=>{A();var ne=ce("Missing Event Explorer");l(B,ne)},$$slots:{default:!0}})});var J=c(q,2);ee(J,()=>ht,(R,D)=>{D(R,{children:(B,W)=>{A();var ne=ce("This event couldn't be found on the default relays. Try adding relay URLs where it might be stored.");l(B,ne)},$$slots:{default:!0}})}),l(M,L)},$$slots:{default:!0}})});var S=c(ue,2),K=p(S),ve=c(p(K),2),fe=p(ve,!0);f(ve),f(K);var re=c(K,2),C=c(p(re),2),he=p(C);We(he,{type:"text",placeholder:"wss://relay.example.com",get disabled(){return e(n)},onkeydown:F,class:"flex-1",get value(){return e(r)},set value(u){g(r,u,!0)}});var $e=c(he,2);{let u=se(()=>e(n)||!e(r).trim());ge($e,{type:"button",onclick:k,get disabled(){return e(u)},variant:"outline",children:(y,M)=>{A();var V=ce("Add");l(y,V)},$$slots:{default:!0}})}f(C),A(2),f(re);var _e=c(re,2);{var Te=u=>{var y=It(),M=p(y),V=p(M);f(M);var L=c(M,2);ye(L,21,()=>e(i),we,(q,J)=>{var R=Rt(),D=p(R),B=p(D,!0);f(D);var W=c(D,2);W.__click=()=>P(e(J)),f(R),ae(()=>{oe(B,e(J)),W.disabled=e(n)}),l(q,R)}),f(L),f(y),ae(()=>oe(V,`Relays to search (${e(i).length??""})`)),l(u,y)};j(_e,u=>{e(i).length>0&&u(Te)})}var be=c(_e,2);{var Me=u=>{var y=Dt(),M=c(p(y),2),V=p(M,!0);f(M),f(y),ae(()=>oe(V,e(d))),l(u,y)};j(be,u=>{e(d)&&u(Me)})}var Re=c(be,2);{var Ie=u=>{var y=Ht();l(u,y)};j(Re,u=>{e(m)&&u(Ie)})}f(S);var De=c(S,2);ee(De,()=>mt,(u,y)=>{y(u,{children:(M,V)=>{var L=Pt(),q=N(L);ge(q,{type:"button",variant:"outline",onclick:()=>s(!1),get disabled(){return e(n)},children:(R,D)=>{A();var B=ce("Cancel");l(R,B)},$$slots:{default:!0}});var J=c(q,2);{let R=se(()=>e(n)||e(i).length===0||e(m));ge(J,{type:"button",onclick:b,get disabled(){return e(R)},children:(D,B)=>{var W=ie(),ne=N(W);{var He=X=>{var pe=St();A(),l(X,pe)},Se=X=>{var pe=Ct();A(),l(X,pe)};j(ne,X=>{e(n)?X(He):X(Se,!1)})}l(D,W)},$$slots:{default:!0}})}l(M,L)},$$slots:{default:!0}})}),ae(()=>oe(fe,e(v))),l(le,de)},$$slots:{default:!0}})}),l($,E)},$$slots:{default:!0}})}),l(o,I)},x=o=>{var I=ie(),U=N(I);ee(U,()=>ft,(w,_)=>{_(w,{get open(){return s()},set open($){s($)},children:($,O)=>{var E=ie(),T=N(E);ee(T,()=>ut,(z,Z)=>{Z(z,{children:(le,me)=>{var de=Kt(),ue=N(de);ee(ue,()=>vt,(u,y)=>{y(u,{class:"text-left",children:(M,V)=>{var L=jt(),q=N(L);ee(q,()=>ct,(R,D)=>{D(R,{children:(B,W)=>{A();var ne=ce("Missing Event Explorer");l(B,ne)},$$slots:{default:!0}})});var J=c(q,2);ee(J,()=>pt,(R,D)=>{D(R,{children:(B,W)=>{A();var ne=ce("This event couldn't be found on the default relays. Try adding relay URLs where it might be stored.");l(B,ne)},$$slots:{default:!0}})}),l(M,L)},$$slots:{default:!0}})});var S=c(ue,2),K=p(S),ve=c(p(K),2),fe=p(ve,!0);f(ve),f(K);var re=c(K,2),C=c(p(re),2),he=p(C);We(he,{type:"text",placeholder:"wss://relay.example.com",get disabled(){return e(n)},onkeydown:F,class:"flex-1",get value(){return e(r)},set value(u){g(r,u,!0)}});var $e=c(he,2);{let u=se(()=>e(n)||!e(r).trim());ge($e,{type:"button",onclick:k,get disabled(){return e(u)},variant:"outline",children:(y,M)=>{A();var V=ce("Add");l(y,V)},$$slots:{default:!0}})}f(C),A(2),f(re);var _e=c(re,2);{var Te=u=>{var y=Bt(),M=p(y),V=p(M);f(M);var L=c(M,2);ye(L,21,()=>e(i),we,(q,J)=>{var R=zt(),D=p(R),B=p(D,!0);f(D);var W=c(D,2);W.__click=()=>P(e(J)),f(R),ae(()=>{oe(B,e(J)),W.disabled=e(n)}),l(q,R)}),f(L),f(y),ae(()=>oe(V,`Relays to search (${e(i).length??""})`)),l(u,y)};j(_e,u=>{e(i).length>0&&u(Te)})}var be=c(_e,2);{var Me=u=>{var y=Nt(),M=c(p(y),2),V=p(M,!0);f(M),f(y),ae(()=>oe(V,e(d))),l(u,y)};j(be,u=>{e(d)&&u(Me)})}var Re=c(be,2);{var Ie=u=>{var y=At();l(u,y)};j(Re,u=>{e(m)&&u(Ie)})}f(S);var De=c(S,2);ee(De,()=>gt,(u,y)=>{y(u,{class:"pt-2",children:(M,V)=>{var L=Ot(),q=p(L);ge(q,{type:"button",variant:"outline",onclick:()=>s(!1),get disabled(){return e(n)},class:"flex-1",children:(R,D)=>{A();var B=ce("Cancel");l(R,B)},$$slots:{default:!0}});var J=c(q,2);{let R=se(()=>e(n)||e(i).length===0||e(m));ge(J,{type:"button",onclick:b,get disabled(){return e(R)},class:"flex-1",children:(D,B)=>{var W=ie(),ne=N(W);{var He=X=>{var pe=Ft();A(),l(X,pe)},Se=X=>{var pe=Ut();A(),l(X,pe)};j(ne,X=>{e(n)?X(He):X(Se,!1)})}l(D,W)},$$slots:{default:!0}})}f(L),l(M,L)},$$slots:{default:!0}})}),ae(()=>oe(fe,e(v))),l(le,de)},$$slots:{default:!0}})}),l($,E)},$$slots:{default:!0}})}),l(o,I)};j(G,o=>{a.current?o(te):o(x,!1)})}l(h,Y),Ue()}Ae(["click"]);var qt=H('<div class="absolute left-[29px] -top-px h-[73px] w-0.5 bg-muted"></div> <div class="absolute left-[29px] top-[73px] bottom-0 w-0.5 bg-muted"></div>',1),Wt=H('<p class="text-xs text-muted-foreground/70 font-mono truncate mb-3 bg-background/50 p-2 rounded"> </p>'),Gt=H(`<article class="p-3 sm:p-4 bg-muted/10 border-b border-border relative min-w-0"><!> <div class="p-4 border border-dashed border-muted-foreground/30 rounded-lg bg-muted/20"><div class="flex items-start gap-3"><div class="flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div class="flex-1 min-w-0"><p class="text-sm font-medium text-foreground mb-1">Missing Parent Event</p> <p class="text-xs text-muted-foreground mb-2">This note is replying to an event that couldn't be found on the default relays.</p> <!> <button type="button" class="text-sm text-primary hover:text-primary/80 underline transition-colors flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> Try fetching from other relays</button></div></div></div></article> <!>`,1);function Qt(h,t){Fe(t,!0);let a=Je(t,"showThreadLine",3,!1),s=Q(!1);const r=se(()=>{try{return Qe.neventEncode({id:t.eventId,relays:t.relayHint?[t.relayHint]:[]})}catch{return t.eventId}});var i=Gt(),n=N(i),d=p(n);{var m=x=>{var o=qt();A(2),l(x,o)};j(d,x=>{a()&&x(m)})}var v=c(d,2),k=p(v),P=c(p(k),2),b=c(p(P),4);{var F=x=>{var o=Wt(),I=p(o);f(o),ae(U=>oe(I,`${U??""}...`),[()=>e(r).slice(0,40)]),l(x,o)};j(b,x=>{e(r)&&x(F)})}var Y=c(b,2);Y.__click=()=>g(s,!0),f(P),f(k),f(v),f(n);var G=c(n,2);{var te=x=>{Vt(x,{get eventId(){return t.eventId},get relayHint(){return t.relayHint},get onEventFound(){return t.onEventFound},get show(){return e(s)},set show(o){g(s,o,!0)}})};j(G,x=>{e(s)&&x(te)})}l(h,i),Ue()}Ae(["click"]);var Jt=H('<div class="flex flex-col items-center justify-center mt-20"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div> <p class="mt-4 text-neutral-400">Loading thread...</p></div>'),Xt=H('<div class="px-4 py-3 border-b border-border"><h2 class="font-semibold text-foreground"> </h2></div> <!>',1),Yt=H('<main class="w-full lg:max-w-2xl mx-auto"><!> <!> <div><!></div></main>'),Zt=H('<div class="min-h-screen bg-background"><header class="sticky top-0 z-10 bg-background/80 backdrop-blur-md border-b border-border"><div class="flex items-center gap-4 px-4 py-3"><button class="p-2 hover:bg-neutral-900 rounded-lg transition-colors" aria-label="Go back"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg></button> <h1 class="text-xl font-semibold">Thread</h1></div></header> <!></div>');function _r(h,t){Fe(t,!0);const a=()=>et(tt,"$page",s),[s,r]=Ze(),i=se(()=>a().params.nevent);let n=Q(null);Be(()=>{e(i)&&(g(n,null),g(n,Tt(()=>({focusedEvent:e(i)}),Ne),!0))});function d(x){if(e(n)){e(n).focusOn(x);const o=x.encode();window.history.pushState({},"",`/e/${o}`)}}const m=se(()=>{if(!e(n))return null;const x=e(n).focusedEventId;return x&&e(n).events.find(I=>I.id===x)?.event||null}),v=se(()=>{if(!e(n))return[];const x=e(n).focusedEventId;if(!x)return[];const o=e(n).events.findIndex(I=>I.id===x);return o===-1?[]:e(n).events.slice(0,o)});var k=Zt(),P=p(k),b=p(P),F=p(b);F.__click=()=>history.back(),A(2),f(b),f(P);var Y=c(P,2);{var G=x=>{var o=Jt();l(x,o)},te=x=>{var o=Yt(),I=p(o);ye(I,17,()=>e(v),we,(T,z,Z)=>{var le=ie(),me=N(le);{var de=S=>{{let K=se(()=>Z<e(v).length-1);Qt(S,{get eventId(){return e(z).id},get relayHint(){return e(z).relayHint},get showThreadLine(){return e(K)},onEventFound:()=>{}})}},ue=S=>{var K=ie(),ve=N(K);{var fe=C=>{je(C,{get event(){return e(z).event},variant:"default"})},re=C=>{{let he=se(()=>Z<e(v).length-1);Le(C,{get event(){return e(z).event},variant:"thread-parent",get showThreadLine(){return e(he)},onNavigate:()=>e(z).event&&d(e(z).event)})}};j(ve,C=>{e(z).event.kind===9802?C(fe):C(re,!1)},!0)}l(S,K)};j(me,S=>{e(z).event?S(ue,!1):S(de)})}l(T,le)});var U=c(I,2);{var w=T=>{je(T,{get event(){return e(m)},variant:"default"})},_=T=>{Le(T,{get event(){return e(m)},variant:"thread-main",showThreadLine:!1})};j(U,T=>{e(m).kind===9802?T(w):T(_,!1)})}var $=c(U,2),O=p($);{var E=T=>{var z=Xt(),Z=N(z),le=p(Z),me=p(le);f(le),f(Z);var de=c(Z,2);ye(de,17,()=>e(n).replies,we,(ue,S)=>{var K=ie(),ve=N(K);{var fe=C=>{je(C,{get event(){return e(S)},variant:"default"})},re=C=>{Le(C,{get event(){return e(S)},variant:"thread-reply",onNavigate:()=>d(e(S))})};j(ve,C=>{e(S).kind===9802?C(fe):C(re,!1)})}l(ue,K)}),ae(()=>oe(me,`${e(n).replies.length??""} ${e(n).replies.length===1?"Reply":"Replies"}`)),l(T,z)};j(O,T=>{e(n)&&e(n).replies.length>0&&T(E)})}f($),f(o),l(x,o)};j(Y,x=>{e(m)?x(te,!1):x(G)})}f(k),l(h,k),Ue(),r()}Ae(["click"]);export{_r as component};
