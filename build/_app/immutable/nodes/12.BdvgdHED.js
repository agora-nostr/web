import{d as te,f as _,s as F,a as t,c as w,t as J}from"../chunks/rzUyzf2y.js";import{p as V,u as oe,s as q,b as re,e as i,d as k,r as l,t as G,g as Q,c as Y,f as d,y as X}from"../chunks/AsQG98fS.js";import{i as N}from"../chunks/DZKExFZC.js";import{n as L}from"../chunks/tv6-RHC_.js";import{e as ne}from"../chunks/Cztbr3Ea.js";import{c as b}from"../chunks/Dt3q2Svx.js";import{g as ae}from"../chunks/s53o-P2j.js";import{U as Z}from"../chunks/C-S0GgRw.js";import{T as ie}from"../chunks/2VdFane9.js";import{M as le,D as ve,a as de,R as ce,b as fe,d as ue,e as me}from"../chunks/CVV5LOp_.js";import{D as ge,a as pe}from"../chunks/CKdpi0zW.js";import{U as ee}from"../chunks/D-t5MXh4.js";import{m as _e}from"../chunks/CD9mSG_Y.js";var xe=_('<div class="text-xs text-neutral-500 flex-shrink-0 ml-2"><!></div>'),he=_('<span class="text-neutral-500">You:</span>'),be=_("<!> ",1),we=_('<div class="ml-2 flex-shrink-0 min-w-[20px] h-5 px-1.5 rounded-full bg-primary flex items-center justify-center"><span class="text-xs font-bold text-primary-foreground"> </span></div>'),ke=_('<button class="w-full flex items-center gap-3 px-4 py-4 hover:bg-neutral-900/50 transition-colors text-left"><!> <div class="flex-1 min-w-0"><div class="flex items-center justify-between mb-1"><div class="font-semibold text-white truncate"> </div> <!></div> <div class="flex items-center justify-between"><p class="text-sm text-neutral-400 truncate flex-1"><!></p> <!></div></div></button>');function ye(U,a){V(a,!0);const o=a.conversation.getOtherParticipant(),f=a.conversation.getLastMessage();let u=re(null);oe(()=>{if(!o?.pubkey){q(u,null);return}L.fetchUser(o.pubkey).then(e=>{e?.fetchProfile().then(r=>{q(u,r,!0)})})});function y(){o&&ae(`/messages/${o.npub}`)}var s=ke();s.__click=y;var m=i(s);{var v=e=>{var r=w(),c=d(r);b(c,()=>Z.Root,(C,P)=>{P(C,{get ndk(){return L},get pubkey(){return o.pubkey},children:($,z)=>{var O=w(),R=d(O);b(R,()=>Z.Avatar,(H,T)=>{T(H,{class:"w-12 h-12 flex-shrink-0"})}),t($,O)},$$slots:{default:!0}})}),t(e,r)};N(m,e=>{o&&e(v)})}var n=k(m,2),g=i(n),M=i(g),D=i(M,!0);l(M);var p=k(M,2);{var x=e=>{var r=xe(),c=i(r);ie(c,{get timestamp(){return f.timestamp}}),l(r),t(e,r)};N(p,e=>{f&&e(x)})}l(g);var h=k(g,2),j=i(h),A=i(j);{var B=e=>{var r=be(),c=d(r);{var C=$=>{var z=he();t($,z)};N(c,$=>{f.sender.pubkey===L.activeUser?.pubkey&&$(C)})}var P=k(c);G(()=>F(P,` ${f.content??""}`)),t(e,r)},I=e=>{var r=J("No messages yet");t(e,r)};N(A,e=>{f?e(B):e(I,!1)})}l(j);var E=k(j,2);{var S=e=>{var r=we(),c=i(r),C=i(c,!0);l(c),l(r),G(P=>F(C,P),[()=>a.conversation.getUnreadCount()>99?"99+":a.conversation.getUnreadCount()]),t(e,r)};N(E,e=>{a.conversation.getUnreadCount()>0&&e(S)})}l(h),l(n),l(s),G(()=>F(D,Q(u)?.name||Q(u)?.displayName||"Anonymous")),t(U,s),Y()}te(["click"]);var Me=_(`<div class="flex flex-col items-center justify-center py-16 px-6 text-center"><svg class="w-20 h-20 text-neutral-700 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <h3 class="text-xl font-semibold text-white mb-2">No messages yet</h3> <p class="text-neutral-400 max-w-sm">Start a conversation by visiting someone's profile and clicking the message button</p></div>`),Ce=_('<div class="divide-y divide-neutral-800/50"><!></div>');function Pe(U,a){V(a,!0);var o=Ce(),f=i(o);{var u=s=>{var m=Me();t(s,m)},y=s=>{var m=w(),v=d(m);ne(v,17,()=>a.conversations,n=>n.id,(n,g)=>{ye(n,{get conversation(){return Q(g)}})}),t(s,m)};N(f,s=>{a.conversations.length===0?s(u):s(y,!1)})}l(o),t(U,o),Y()}var $e=_("<!> <!>",1),Ne=_('<!> <div class="px-4 pb-4"><!></div>',1);function Ue(U,a){V(a,!0);const o=new le("(min-width: 768px)");function f(v){ae(`/messages/${v.npub}`),a.onClose()}var u=w(),y=d(u);{var s=v=>{var n=w(),g=d(n);b(g,()=>ce,(M,D)=>{D(M,{get open(){return a.isOpen},onOpenChange:p=>{p||a.onClose()},children:(p,x)=>{var h=w(),j=d(h);b(j,()=>ve,(A,B)=>{B(A,{class:"max-w-md",children:(I,E)=>{var S=$e(),e=d(S);b(e,()=>ge,(c,C)=>{C(c,{children:(P,$)=>{var z=w(),O=d(z);b(O,()=>de,(R,H)=>{H(R,{children:(T,K)=>{X();var W=J("New Message");t(T,W)},$$slots:{default:!0}})}),t(P,z)},$$slots:{default:!0}})});var r=k(e,2);ee(r,{get ndk(){return L},onSelect:f,placeholder:"Search by name, NIP-05, or paste npub..."}),t(I,S)},$$slots:{default:!0}})}),t(p,h)},$$slots:{default:!0}})}),t(v,n)},m=v=>{var n=w(),g=d(n);b(g,()=>me,(M,D)=>{D(M,{get open(){return a.isOpen},onOpenChange:p=>{p||a.onClose()},children:(p,x)=>{var h=w(),j=d(h);b(j,()=>fe,(A,B)=>{B(A,{children:(I,E)=>{var S=Ne(),e=d(S);b(e,()=>pe,(C,P)=>{P(C,{class:"text-left",children:($,z)=>{var O=w(),R=d(O);b(R,()=>ue,(H,T)=>{T(H,{children:(K,W)=>{X();var se=J("New Message");t(K,se)},$$slots:{default:!0}})}),t($,O)},$$slots:{default:!0}})});var r=k(e,2),c=i(r);ee(c,{get ndk(){return L},onSelect:f,placeholder:"Search by name, NIP-05, or paste npub..."}),l(r),t(I,S)},$$slots:{default:!0}})}),t(p,h)},$$slots:{default:!0}})}),t(v,n)};N(y,v=>{o.current?v(s):v(m,!1)})}t(U,u),Y()}var De=_('<div class="flex flex-col items-center justify-center h-full px-6 text-center"><svg class="w-20 h-20 text-muted mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> <h3 class="text-xl font-semibold text-foreground mb-2">Sign in required</h3> <p class="text-muted-foreground max-w-sm">Please sign in to view and send direct messages</p></div>'),je=_('<div class="h-full flex flex-col"><div class="sticky top-0 z-10 bg-background border-b border-border/50 px-4 py-3"><div class="flex items-center justify-between"><h1 class="text-xl font-bold text-foreground">Messages</h1> <button class="p-2 rounded-lg hover:bg-muted transition-colors text-muted-foreground hover:text-primary" title="New message"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div></div> <div class="flex-1 overflow-y-auto"><!></div></div> <!>',1);function Ye(U,a){V(a,!0);let o=re(!1);function f(){q(o,!0)}var u=je(),y=d(u),s=i(y),m=i(s),v=k(i(m),2);v.__click=f,l(m),l(s);var n=k(s,2),g=i(n);{var M=x=>{var h=De();t(x,h)},D=x=>{Pe(x,{get conversations(){return _e.conversations}})};N(g,x=>{L.$currentUser?x(D,!1):x(M)})}l(n),l(y);var p=k(y,2);Ue(p,{get isOpen(){return Q(o)},onClose:()=>q(o,!1)}),t(U,u),Y()}te(["click"]);export{Ye as component};
