import{d as Mt,f as i,a as t,c as ae,s as M,t as _e,i as Le}from"../chunks/rzUyzf2y.js";import{p as lt,b as ge,x as jt,u as ot,s as f,az as Rt,d as a,e as o,r,c as dt,f as b,g as e,a as q,t as Y,y as p}from"../chunks/AsQG98fS.js";import{i as w}from"../chunks/DZKExFZC.js";import{e as Ze,i as zt}from"../chunks/Cztbr3Ea.js";import{n as Ce,s as qe,k as ht,f as Nt,h as St,e as bt}from"../chunks/tv6-RHC_.js";import{h as gt}from"../chunks/BVrYKRgp.js";import{c as _t,N as Dt}from"../chunks/DM8SgQ6X.js";import{c as ee}from"../chunks/Dt3q2Svx.js";import{c as yt,b as wt,a as xt,r as st,g as kt}from"../chunks/CS0aOiUg.js";import{U as Xe}from"../chunks/C-S0GgRw.js";import{g as $t}from"../chunks/HXYFdwja.js";import{f as Tt}from"../chunks/KSN4Ur19.js";import{a as It}from"../chunks/CO-nanZk.js";import{c as At}from"../chunks/DF8Bk5Sh.js";import{p as Bt}from"../chunks/w-gpJwMz.js";import{u as nt}from"../chunks/DHRuQT7d.js";import{c as Pt}from"../chunks/a7XEC-kH.js";import{g as Et,a as Lt,b as Ut,e as Ot}from"../chunks/BSM2-0iS.js";import{M as Vt,D as Wt,a as Yt,R as Gt,b as Ht,d as Ft,e as Jt}from"../chunks/CVV5LOp_.js";import{D as Kt,a as Qt}from"../chunks/BlLlwFDc.js";import{D as qt}from"../chunks/D1QSAoU9.js";import{D as Xt,a as Zt}from"../chunks/CKdpi0zW.js";import{I as He,B as Ee}from"../chunks/DMKx7da8.js";import{L as Fe}from"../chunks/Cqd1tifG.js";import{T as Ct}from"../chunks/DHCUFZXp.js";import{R as it}from"../chunks/ymyJjmi3.js";import{D as er}from"../chunks/Dw5jWGaA.js";import{P as tr}from"../chunks/C6xvd7Uj.js";var rr=i('<p class="text-muted-foreground text-center py-8">No invites yet in this Agora</p>'),or=i('<p class="text-xs text-muted-foreground truncate"> </p>'),ar=i('<a class="relative bg-gradient-to-b from-primary/5 to-transparent border border-border rounded-xl p-6 hover:border-primary/50 transition-all hover:shadow-lg group"><div class="absolute -top-3 left-1/2 -translate-x-1/2"><div class="w-12 h-12 rounded-full bg-card border-2 border-border flex items-center justify-center text-2xl group-hover:border-primary transition-colors"> </div></div> <div class="flex justify-center mt-6 mb-4"><!></div> <div class="text-center mb-4"><h3 class="font-bold text-lg text-foreground truncate mb-1"> </h3> <!></div> <div class="bg-muted/50 rounded-lg p-3"><div class="text-center"><div class="text-3xl font-bold text-primary mb-1"> </div> <div class="text-xs text-muted-foreground"> </div></div></div> <div class="mt-3"><div class="h-1.5 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),sr=i('<button class="w-full flex items-center justify-center gap-2 py-3 text-sm font-medium text-primary hover:text-primary/80 transition-colors"><span> </span> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>'),nr=i('<a class="flex items-center gap-4 p-3 rounded-lg hover:bg-muted/50 transition-colors"><div class="flex items-center gap-3 flex-1"><span class="text-lg font-semibold text-muted-foreground w-8"> </span> <!> <div class="flex-1 min-w-0"><div class="font-medium text-foreground truncate"> </div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="hidden md:block w-32"><div class="h-2 bg-muted rounded-full overflow-hidden"><div class="h-full bg-gradient-to-r from-primary to-primary/60 transition-all duration-500"></div></div></div></a>'),ir=i('<div class="mt-4 space-y-2 border-t border-border pt-4"></div>'),lr=i('<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6"></div> <!> <!>',1),dr=i('<div><h2 class="text-xl font-bold text-foreground mb-6">üèÜ Top Inviters</h2> <!></div>');function vr(Ue,I){lt(I,!0);let V=ge(!1);function G(s){return s===1?"ü•á":s===2?"ü•à":s===3?"ü•â":""}const X=q(()=>I.stats.slice(0,3)),H=q(()=>I.stats.slice(3,10)),j=q(()=>Math.max(...I.stats.map(s=>s.successfulInvites),1));let R=ge(jt(new Map)),se=ge(0);ot(()=>{console.log("[TopInvitersPodium] $effect running, stats count:",I.stats.length);const s=new Map;let u=0;const h=I.stats.length;if(h===0){f(R,s,!0);return}I.stats.forEach(_=>{Ce.fetchUser(_.pubkey).then(x=>{x?.fetchProfile().then(te=>{console.log("[TopInvitersPodium] Setting profile for",_.pubkey),s.set(_.pubkey,te||null),u++,u===h&&(f(R,s,!0),Rt(se))})})})});var ne=dr(),ie=a(o(ne),2);{var he=s=>{var u=rr();t(s,u)},Se=s=>{var u=lr(),h=b(u);Ze(h,21,()=>e(X),k=>k.pubkey,(k,$)=>{const S=q(()=>e(R).get(e($).pubkey));var D=ar(),le=o(D),xe=o(le),P=o(xe,!0);r(xe),r(le);var B=a(le,2),c=o(B);ee(c,()=>Xe.Root,(de,we)=>{we(de,{get ndk(){return Ce},get pubkey(){return e($).pubkey},children:(Me,at)=>{var W=ae(),F=b(W);ee(F,()=>Xe.Avatar,(E,ve)=>{ve(E,{class:"w-24 h-24 rounded-full ring-4 ring-primary/20"})}),t(Me,W)},$$slots:{default:!0}})}),r(B);var A=a(B,2),be=o(A),Ie=o(be,!0);r(be);var Oe=a(be,2);{var z=de=>{var we=or(),Me=o(we,!0);r(we),Y(()=>M(Me,e(S).nip05)),t(de,we)};w(Oe,de=>{e(S)?.nip05&&de(z)})}r(A);var De=a(A,2),ye=o(De),Ae=o(ye),Te=o(Ae,!0);r(Ae);var re=a(Ae,2),Pe=o(re,!0);r(re),r(ye),r(De);var Qe=a(De,2),Ve=o(Qe),Be=o(Ve);r(Ve),r(Qe),r(D),Y((de,we,Me)=>{yt(D,"href",de),M(P,we),M(Ie,e(S)?.displayName||e(S)?.name||"Anonymous"),M(Te,e($).successfulInvites),M(Pe,e($).successfulInvites===1?"person joined":"people joined"),wt(Be,`width: ${Me??""}%`)},[()=>$t(e($).pubkey),()=>G(e($).rank),()=>Math.min(100,e($).successfulInvites/e(j)*100)]),t(k,D)}),r(h);var _=a(h,2);{var x=k=>{var $=sr();$.__click=()=>f(V,!e(V));var S=o($),D=o(S,!0);r(S);var le=a(S,2);r($),Y(()=>{M(D,e(V)?"Show Less":`View Top ${I.stats.length} Inviters`),xt(le,0,`w-4 h-4 transition-transform duration-200 ${e(V)?"rotate-180":""}`)}),t(k,$)};w(_,k=>{I.stats.length>3&&k(x)})}var te=a(_,2);{var T=k=>{var $=ir();Ze($,21,()=>e(H),S=>S.pubkey,(S,D)=>{const le=q(()=>e(R).get(e(D).pubkey));var xe=nr(),P=o(xe),B=o(P),c=o(B);r(B);var A=a(B,2);ee(A,()=>Xe.Root,(re,Pe)=>{Pe(re,{get ndk(){return Ce},get pubkey(){return e(D).pubkey},children:(Qe,Ve)=>{var Be=ae(),de=b(Be);ee(de,()=>Xe.Avatar,(we,Me)=>{Me(we,{class:"w-10 h-10 rounded-full"})}),t(Qe,Be)},$$slots:{default:!0}})});var be=a(A,2),Ie=o(be),Oe=o(Ie,!0);r(Ie);var z=a(Ie,2),De=o(z);r(z),r(be),r(P);var ye=a(P,2),Ae=o(ye),Te=o(Ae);r(Ae),r(ye),r(xe),Y((re,Pe)=>{yt(xe,"href",re),M(c,`${e(D).rank??""}.`),M(Oe,e(le)?.displayName||e(le)?.name||"Anonymous"),M(De,`${e(D).successfulInvites??""} ${e(D).successfulInvites===1?"person joined":"people joined"}`),wt(Te,`width: ${Pe??""}%`)},[()=>$t(e(D).pubkey),()=>Math.min(100,e(D).successfulInvites/e(j)*100)]),t(S,xe)}),r($),t(k,$)};w(te,k=>{e(V)&&e(H).length>0&&k(T)})}t(s,u)};w(ie,s=>{I.stats.length===0?s(he):s(Se,!1)})}r(ne),t(Ue,ne),dt()}Mt(["click"]);var ur=i('<div class="text-muted-foreground">Invited by <span class="font-medium text-primary"> </span></div>'),cr=i("<div></div>"),fr=i('<div class="border border-border rounded-lg p-4 hover:border-primary/50 transition-colors"><div class="flex items-center gap-3 mb-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2"><span class="text-lg">üëã</span> <span class="font-semibold text-foreground"> </span></div> <div class="text-sm text-muted-foreground"> </div></div></div> <div class="mb-3 text-foreground whitespace-pre-wrap line-clamp-4"> </div> <div class="flex items-center justify-between text-sm"><!></div></div>');function mr(Ue,I){lt(I,!0);let V=ge(null),G=ge(null);ot(()=>{console.log("[IntroductionCard] $effect running for author:",I.event.pubkey),I.event.author.fetchProfile().then(T=>{f(V,T,!0)})}),ot(()=>{if(console.log("[IntroductionCard] $effect running for invitedBy:",I.invitedBy),!I.invitedBy){f(G,null);return}Ce.fetchUser(I.invitedBy).then(T=>{T?.fetchProfile().then(k=>{f(G,k,!0)})})});var X=fr(),H=o(X),j=o(H);ee(j,()=>Xe.Root,(T,k)=>{k(T,{get ndk(){return Ce},get pubkey(){return I.event.pubkey},children:($,S)=>{var D=ae(),le=b(D);ee(le,()=>Xe.Avatar,(xe,P)=>{P(xe,{class:"w-12 h-12 rounded-full"})}),t($,D)},$$slots:{default:!0}})});var R=a(j,2),se=o(R),ne=a(o(se),2),ie=o(ne,!0);r(ne),r(se);var he=a(se,2),Se=o(he,!0);r(he),r(R),r(H);var s=a(H,2),u=o(s,!0);r(s);var h=a(s,2),_=o(h);{var x=T=>{var k=ur(),$=a(o(k)),S=o($);r($),r(k),Y(()=>M(S,`@${(e(G).name||"anonymous")??""}`)),t(T,k)},te=T=>{var k=cr();t(T,k)};w(_,T=>{e(G)?T(x):T(te,!1)})}r(h),r(X),Y(T=>{M(ie,e(V)?.displayName||e(V)?.name||"Anonymous"),M(Se,T),M(u,I.event.content)},[()=>Tt(I.event.created_at||0)]),t(Ue,X),dt()}var pr=i("<!> <!>",1),gr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1">Select Agora...</span>',1),_r=i('<!> <span class="text-sm text-muted-foreground flex-1"> </span>',1),hr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1"> </span>',1),xr=i('<p class="text-sm text-muted-foreground text-center py-4">No Agora relays configured</p>'),br=i('<div class="text-xs text-muted-foreground truncate"> </div>'),yr=i('<button type="button" class="w-full flex items-center gap-3 px-3 py-2.5 hover:bg-muted cursor-pointer transition-colors text-left"><input type="checkbox" class="w-4 h-4 text-primary border rounded focus:ring-orange-500 pointer-events-none"/> <!> <div class="flex-1 min-w-0"><div class="flex items-center gap-1.5"><div class="text-sm font-medium text-foreground truncate"> </div> <span class="flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold bg-primary/20 text-primary rounded uppercase tracking-wide">Agora</span></div> <!></div></button>'),wr=i('<div class="absolute z-[60] mt-1 w-full bg-popover border border-border rounded-xl shadow-lg max-h-64 overflow-y-auto"><!></div>'),kr=i('<p class="mt-1 text-xs text-muted-foreground"> </p>'),$r=Le(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Recipient's Name`,1),Ir=Le('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Include Cashu Token (sats)',1),Ar=i('<div class="space-y-4 border-l-4 border-primary pl-4"><div><!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">Add sats to help them get started on Nostr</p></div></div>'),Pr=i('<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div> Generating Invite...',1),Cr=i('<div><!> <!></div> <div class="relative"><label class="block text-sm font-medium text-muted-foreground mb-2">Invite to Agora</label> <button type="button" class="w-full px-4 py-2.5 text-left rounded-lg bg-muted/50 text-muted-foreground hover:bg-muted transition-colors flex items-center gap-3 group"><!> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">How many people can use this invite (1-500)</p></div> <div class="flex items-center space-x-3"><input type="checkbox" id="personalize" class="w-5 h-5 text-primary border rounded focus:ring-orange-500"/> <label for="personalize" class="text-sm font-medium text-muted-foreground cursor-pointer">Personalize this invite</label></div> <!> <!>',1),Mr=Le('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!',1),jr=Le('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy',1),Rr=Le('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg> Share',1),zr=i("<!> <!>",1),Nr=i('<div class="space-y-6"><div class="text-center py-8"><div class="w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <h3 class="text-lg font-semibold text-foreground mb-2">Invite Created!</h3> <p class="text-sm text-muted-foreground"> </p></div> <div class="bg-muted rounded-xl p-4 space-y-3"><div class="flex items-center space-x-2"><!> <!></div> <!></div> <!></div>'),Sr=i('<!> <div class="space-y-6"><!></div>',1),Dr=i("<!> <!>",1),Tr=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1">Select Agora...</span>',1),Br=i('<!> <span class="text-sm text-muted-foreground flex-1"> </span>',1),Er=i('<img src="/logo-icon.svg" alt="Agora" class="w-6 h-6 flex-shrink-0"/> <span class="text-sm text-muted-foreground flex-1"> </span>',1),Lr=i('<p class="text-sm text-muted-foreground text-center py-4">No Agora relays configured</p>'),Ur=i('<div class="text-xs text-muted-foreground truncate"> </div>'),Or=i('<button type="button" class="w-full flex items-center gap-3 px-3 py-2.5 hover:bg-muted cursor-pointer transition-colors text-left"><input type="checkbox" class="w-4 h-4 text-primary border rounded focus:ring-orange-500 pointer-events-none"/> <!> <div class="flex-1 min-w-0"><div class="flex items-center gap-1.5"><div class="text-sm font-medium text-foreground truncate"> </div> <span class="flex-shrink-0 px-1.5 py-0.5 text-[10px] font-semibold bg-primary/20 text-primary rounded uppercase tracking-wide">Agora</span></div> <!></div></button>'),Vr=i('<div class="absolute z-[60] mt-1 w-full bg-popover border border-border rounded-xl shadow-lg max-h-64 overflow-y-auto"><!></div>'),Wr=i('<p class="mt-1 text-xs text-muted-foreground"> </p>'),Yr=Le(`<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> Recipient's Name`,1),Gr=Le('<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Include Cashu Token (sats)',1),Hr=i('<div class="space-y-4 border-l-4 border-primary pl-4"><div><!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">Add sats to help them get started on Nostr</p></div></div>'),Fr=i('<div class="animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"></div> Generating Invite...',1),Jr=i('<div><!> <!></div> <div class="relative"><label class="block text-sm font-medium text-muted-foreground mb-2">Invite to Agora</label> <button type="button" class="w-full px-4 py-2.5 text-left rounded-lg bg-muted/50 text-muted-foreground hover:bg-muted transition-colors flex items-center gap-3 group"><!> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button> <!> <!></div> <div><!> <!> <p class="mt-1 text-xs text-muted-foreground">How many people can use this invite (1-500)</p></div> <div class="flex items-center space-x-3"><input type="checkbox" id="personalize" class="w-5 h-5 text-primary border rounded focus:ring-orange-500"/> <label for="personalize" class="text-sm font-medium text-muted-foreground cursor-pointer">Personalize this invite</label></div> <!> <!>',1),Kr=Le('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg> Copied!',1),Qr=Le('<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg> Copy',1),qr=Le('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg> Share',1),Xr=i('<div class="flex gap-3 w-full"><!> <!></div>'),Zr=i('<div class="space-y-6"><div class="text-center py-8"><div class="w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div> <h3 class="text-lg font-semibold text-foreground mb-2">Invite Created!</h3> <p class="text-sm text-muted-foreground"> </p></div> <div class="bg-muted rounded-xl p-4 space-y-3"><div class="flex items-center space-x-2"><!> <!></div> <!></div> <!></div>'),eo=i('<!> <div class="space-y-6 px-4 overflow-y-auto pb-4"><!></div>',1);function to(Ue,I){lt(I,!0);const V=new Vt("(min-width: 768px)");let G=Bt(I,"isOpen",15);const X=`Welcome to Agora! üéâ

I'm inviting you to join Agora, a new kind of social network where you own your identity and content. No algorithms, no ads, just authentic connections.

Looking forward to connecting with you on the open social web!`;let H=ge(X),j=ge(!1),R=ge(""),se=ge(""),ne=ge(10),ie=ge(""),he=ge(!1),Se=ge(!1),s=ge(jt([])),u=ge(!1);const h=q(()=>qe.relays.filter(c=>c.enabled&&c.write&&ht(c.url)));ot(()=>{G()&&qe.selectedRelay&&e(s).length===0&&ht(qe.selectedRelay)&&e(h).some(A=>A.url===qe.selectedRelay)&&f(s,[qe.selectedRelay],!0)});function _(c){e(s).includes(c)?f(s,e(s).filter(A=>A!==c),!0):f(s,[...e(s),c],!0)}const x=q(()=>e(s).length===0?null:e(s).length===1?{url:e(s)[0],info:nt(e(s)[0])}:null),te=q(()=>e(s).length===0?"Select Agora...":e(s).length===1?nt(e(s)[0]).info?.name||e(s)[0].replace("wss://","").replace("ws://",""):`${e(s).length} Agoras selected`);async function T(){if(!Ce.$currentUser){console.error("No user logged in");return}if(e(s).length===0){alert("Please select at least one Agora to publish the invite to.");return}f(he,!0);try{const c=Et(),A=e(j)?Lt():"",be=[];for(let re=0;re<e(ne);re++)be.push(Ut());const Ie={welcomeMessage:e(H),recipientName:e(j)?e(R):void 0,cashuToken:e(j)&&e(se)?`cashu:${e(se)}`:void 0,createdAt:Date.now(),inviter:Ce.$currentUser.pubkey},Oe=e(j)?await Ot(JSON.stringify(Ie),A):JSON.stringify(Ie),z=new Nt(Ce);z.kind=513,z.content=Oe,z.tags=[["d",c],...be.map(re=>["code",re])],z.isProtected=!0,await z.sign(),z.isProtected=!0,console.log("Publishing invite event to selected Agoras...",z.id,e(s));const De=new Set;for(const re of e(s)){const Pe=Ce.pool.getRelay(re,!0);Pe&&De.add(Pe)}const ye=new St(De,Ce);await z.publish(ye);const Ae=e(j)?`${c}${A}`:c,Te=`${window.location.origin}/i/${Ae}`;f(ie,Te),console.log("Invite created:",Te)}catch(c){console.error("Failed to generate invite:",c),alert("Failed to generate invite. Check console for details.")}finally{f(he,!1)}}async function k(){try{await navigator.clipboard.writeText(e(ie)),f(Se,!0),setTimeout(()=>f(Se,!1),2e3)}catch(c){console.error("Failed to copy:",c)}}async function $(){if(!navigator.share){console.log("Web Share API not supported, falling back to copy"),await k();return}try{await navigator.share({title:"Join Agora",text:e(j)&&e(R)?`${e(R)}, you're invited to join Agora!`:"You're invited to join Agora, a new kind of social network!",url:e(ie)})}catch(c){c.name!=="AbortError"&&console.error("Failed to share:",c)}}function S(){f(H,X),f(j,!1),f(R,""),f(se,""),f(ne,10),f(ie,""),f(s,[],!0),f(u,!1),I.onClose()}function D(){f(u,!1)}var le=ae(),xe=b(le);{var P=c=>{var A=ae(),be=b(A);ee(be,()=>Gt,(Ie,Oe)=>{Oe(Ie,{get open(){return G()},onOpenChange:z=>{G(z),z||S()},children:(z,De)=>{var ye=ae(),Ae=b(ye);ee(Ae,()=>Wt,(Te,re)=>{re(Te,{class:"max-w-lg max-h-[90vh] overflow-y-auto",children:(Pe,Qe)=>{var Ve=Sr(),Be=b(Ve);ee(Be,()=>Xt,(W,F)=>{F(W,{children:(E,ve)=>{var ke=pr(),L=b(ke);ee(L,()=>Yt,(J,ue)=>{ue(J,{children:(ce,je)=>{p();var C=_e("Create an Invite");t(ce,C)},$$slots:{default:!0}})});var U=a(L,2);ee(U,()=>Kt,(J,ue)=>{ue(J,{children:(ce,je)=>{p();var C=_e("Invite someone to join Agora with a personal message");t(ce,C)},$$slots:{default:!0}})}),t(E,ke)},$$slots:{default:!0}})});var de=a(Be,2),we=o(de);{var Me=W=>{var F=Cr(),E=b(F),ve=o(E);Fe(ve,{for:"welcome-message",children:(n,l)=>{p();var y=_e("Welcome Message");t(n,y)},$$slots:{default:!0}});var ke=a(ve,2);Ct(ke,{id:"welcome-message",rows:6,placeholder:"Write a welcome message...",class:"mt-2 resize-none",get value(){return e(H)},set value(n){f(H,n,!0)}}),r(E);var L=a(E,2),U=a(o(L),2);U.__click=()=>f(u,!e(u));var J=o(U);{var ue=n=>{var l=gr();p(2),t(n,l)},ce=n=>{var l=ae(),y=b(l);{var K=d=>{var m=_r(),g=b(m);it(g,{get relayUrl(){return e(x).url},size:"lg"});var v=a(g,2),Q=o(v,!0);r(v),Y(()=>M(Q,e(te))),t(d,m)},me=d=>{var m=hr(),g=a(b(m),2),v=o(g);r(g),Y(()=>M(v,`${e(s).length??""} Agoras selected`)),t(d,m)};w(y,d=>{e(s).length===1&&e(x)?d(K):d(me,!1)},!0)}t(n,l)};w(J,n=>{e(s).length===0?n(ue):n(ce,!1)})}var je=a(J,2);r(U);var C=a(U,2);{var Re=n=>{var l=wr(),y=o(l);{var K=d=>{var m=xr();t(d,m)},me=d=>{var m=ae(),g=b(m);Ze(g,17,()=>e(h),v=>v.url,(v,Q)=>{const pe=q(()=>nt(e(Q).url));var Ge=yr();Ge.__click=()=>{_(e(Q).url)};var Je=o(Ge);st(Je);var et=a(Je,2);it(et,{get relayUrl(){return e(Q).url},size:"md"});var tt=a(et,2),Ke=o(tt),rt=o(Ke),ct=o(rt,!0);r(rt),p(2),r(Ke);var ft=a(Ke,2);{var mt=ze=>{var Ne=br(),pt=o(Ne,!0);r(Ne),Y(()=>M(pt,e(pe).info.description)),t(ze,Ne)};w(ft,ze=>{e(pe).info?.description&&ze(mt)})}r(tt),r(Ge),Y((ze,Ne)=>{kt(Je,ze),M(ct,Ne)},[()=>e(s).includes(e(Q).url),()=>e(pe).info?.name||e(Q).url.replace("wss://","").replace("ws://","")]),t(v,Ge)}),t(d,m)};w(y,d=>{e(h).length===0?d(K):d(me,!1)})}r(l),It(l,(d,m)=>Pt?.(d,m),()=>D),t(n,l)};w(C,n=>{e(u)&&n(Re)})}var oe=a(C,2);{var We=n=>{var l=kr(),y=o(l);r(l),Y(()=>M(y,`${e(s).length??""} Agoras selected`)),t(n,l)};w(oe,n=>{e(s).length>1&&n(We)})}r(L);var Z=a(L,2),fe=o(Z);Fe(fe,{for:"max-uses",children:(n,l)=>{p();var y=_e("Maximum Uses");t(n,y)},$$slots:{default:!0}});var O=a(fe,2);He(O,{id:"max-uses",type:"number",min:"1",max:"500",class:"mt-2",get value(){return e(ne)},set value(n){f(ne,n,!0)}}),p(2),r(Z);var N=a(Z,2),Ye=o(N);st(Ye),p(2),r(N);var $e=a(N,2);{var vt=n=>{var l=Ar(),y=o(l),K=o(y);Fe(K,{for:"recipient-name",class:"flex items-center gap-2",children:(v,Q)=>{var pe=$r();p(),t(v,pe)},$$slots:{default:!0}});var me=a(K,2);He(me,{id:"recipient-name",type:"text",placeholder:"John Doe",class:"mt-2",get value(){return e(R)},set value(v){f(R,v,!0)}}),r(y);var d=a(y,2),m=o(d);Fe(m,{for:"cashu-amount",class:"flex items-center gap-2",children:(v,Q)=>{var pe=Ir();p(),t(v,pe)},$$slots:{default:!0}});var g=a(m,2);He(g,{id:"cashu-amount",type:"number",placeholder:"Amount in sats (optional)",class:"mt-2",get value(){return e(se)},set value(v){f(se,v,!0)}}),p(2),r(d),r(l),t(n,l)};w($e,n=>{e(j)&&n(vt)})}var ut=a($e,2);{let n=q(()=>e(he)||!e(H).trim()||e(s).length===0);Ee(ut,{onclick:T,get disabled(){return e(n)},class:"w-full",children:(l,y)=>{var K=ae(),me=b(K);{var d=g=>{var v=Pr();p(),t(g,v)},m=g=>{var v=_e("Generate Invite Link");t(g,v)};w(me,g=>{e(he)?g(d):g(m,!1)})}t(l,K)},$$slots:{default:!0}})}Y(()=>xt(je,0,`w-4 h-4 text-muted-foreground transition-transform flex-shrink-0 ${e(u)?"rotate-180":""}`)),At(Ye,()=>e(j),n=>f(j,n)),t(W,F)},at=W=>{var F=Nr(),E=o(F),ve=a(o(E),4),ke=o(ve,!0);r(ve),r(E);var L=a(E,2),U=o(L),J=o(U);He(J,{type:"text",get value(){return e(ie)},readonly:!0,class:"flex-1 bg-transparent"});var ue=a(J,2);Ee(ue,{onclick:k,size:"sm",children:(C,Re)=>{var oe=ae(),We=b(oe);{var Z=O=>{var N=Mr();p(),t(O,N)},fe=O=>{var N=jr();p(),t(O,N)};w(We,O=>{e(Se)?O(Z):O(fe,!1)})}t(C,oe)},$$slots:{default:!0}}),r(U);var ce=a(U,2);Ee(ce,{onclick:$,variant:"outline",class:"w-full",children:(C,Re)=>{var oe=Rr();p(),t(C,oe)},$$slots:{default:!0}}),r(L);var je=a(L,2);ee(je,()=>er,(C,Re)=>{Re(C,{class:"flex gap-3 sm:space-x-0",children:(oe,We)=>{var Z=zr(),fe=b(Z);Ee(fe,{variant:"outline",onclick:()=>f(ie,""),class:"flex-1",children:(N,Ye)=>{p();var $e=_e("Create Another");t(N,$e)},$$slots:{default:!0}});var O=a(fe,2);Ee(O,{onclick:S,class:"flex-1",children:(N,Ye)=>{p();var $e=_e("Done");t(N,$e)},$$slots:{default:!0}}),t(oe,Z)},$$slots:{default:!0}})}),r(F),Y(()=>M(ke,e(j)&&e(R)?`Your personalized invite for ${e(R)} is ready`:"Your invite link is ready to share")),t(W,F)};w(we,W=>{e(ie)?W(at,!1):W(Me)})}r(de),t(Pe,Ve)},$$slots:{default:!0}})}),t(z,ye)},$$slots:{default:!0}})}),t(c,A)},B=c=>{var A=ae(),be=b(A);ee(be,()=>Jt,(Ie,Oe)=>{Oe(Ie,{get open(){return G()},onOpenChange:z=>{G(z),z||S()},children:(z,De)=>{var ye=ae(),Ae=b(ye);ee(Ae,()=>Ht,(Te,re)=>{re(Te,{children:(Pe,Qe)=>{var Ve=eo(),Be=b(Ve);ee(Be,()=>Zt,(W,F)=>{F(W,{class:"text-left",children:(E,ve)=>{var ke=Dr(),L=b(ke);ee(L,()=>Ft,(J,ue)=>{ue(J,{children:(ce,je)=>{p();var C=_e("Create an Invite");t(ce,C)},$$slots:{default:!0}})});var U=a(L,2);ee(U,()=>Qt,(J,ue)=>{ue(J,{children:(ce,je)=>{p();var C=_e("Invite someone to join Agora with a personal message");t(ce,C)},$$slots:{default:!0}})}),t(E,ke)},$$slots:{default:!0}})});var de=a(Be,2),we=o(de);{var Me=W=>{var F=Jr(),E=b(F),ve=o(E);Fe(ve,{for:"welcome-message",children:(n,l)=>{p();var y=_e("Welcome Message");t(n,y)},$$slots:{default:!0}});var ke=a(ve,2);Ct(ke,{id:"welcome-message",rows:6,placeholder:"Write a welcome message...",class:"mt-2 resize-none",get value(){return e(H)},set value(n){f(H,n,!0)}}),r(E);var L=a(E,2),U=a(o(L),2);U.__click=()=>f(u,!e(u));var J=o(U);{var ue=n=>{var l=Tr();p(2),t(n,l)},ce=n=>{var l=ae(),y=b(l);{var K=d=>{var m=Br(),g=b(m);it(g,{get relayUrl(){return e(x).url},size:"lg"});var v=a(g,2),Q=o(v,!0);r(v),Y(()=>M(Q,e(te))),t(d,m)},me=d=>{var m=Er(),g=a(b(m),2),v=o(g);r(g),Y(()=>M(v,`${e(s).length??""} Agoras selected`)),t(d,m)};w(y,d=>{e(s).length===1&&e(x)?d(K):d(me,!1)},!0)}t(n,l)};w(J,n=>{e(s).length===0?n(ue):n(ce,!1)})}var je=a(J,2);r(U);var C=a(U,2);{var Re=n=>{var l=Vr(),y=o(l);{var K=d=>{var m=Lr();t(d,m)},me=d=>{var m=ae(),g=b(m);Ze(g,17,()=>e(h),v=>v.url,(v,Q)=>{const pe=q(()=>nt(e(Q).url));var Ge=Or();Ge.__click=()=>{_(e(Q).url)};var Je=o(Ge);st(Je);var et=a(Je,2);it(et,{get relayUrl(){return e(Q).url},size:"md"});var tt=a(et,2),Ke=o(tt),rt=o(Ke),ct=o(rt,!0);r(rt),p(2),r(Ke);var ft=a(Ke,2);{var mt=ze=>{var Ne=Ur(),pt=o(Ne,!0);r(Ne),Y(()=>M(pt,e(pe).info.description)),t(ze,Ne)};w(ft,ze=>{e(pe).info?.description&&ze(mt)})}r(tt),r(Ge),Y((ze,Ne)=>{kt(Je,ze),M(ct,Ne)},[()=>e(s).includes(e(Q).url),()=>e(pe).info?.name||e(Q).url.replace("wss://","").replace("ws://","")]),t(v,Ge)}),t(d,m)};w(y,d=>{e(h).length===0?d(K):d(me,!1)})}r(l),It(l,(d,m)=>Pt?.(d,m),()=>D),t(n,l)};w(C,n=>{e(u)&&n(Re)})}var oe=a(C,2);{var We=n=>{var l=Wr(),y=o(l);r(l),Y(()=>M(y,`${e(s).length??""} Agoras selected`)),t(n,l)};w(oe,n=>{e(s).length>1&&n(We)})}r(L);var Z=a(L,2),fe=o(Z);Fe(fe,{for:"max-uses",children:(n,l)=>{p();var y=_e("Maximum Uses");t(n,y)},$$slots:{default:!0}});var O=a(fe,2);He(O,{id:"max-uses",type:"number",min:"1",max:"500",class:"mt-2",get value(){return e(ne)},set value(n){f(ne,n,!0)}}),p(2),r(Z);var N=a(Z,2),Ye=o(N);st(Ye),p(2),r(N);var $e=a(N,2);{var vt=n=>{var l=Hr(),y=o(l),K=o(y);Fe(K,{for:"recipient-name",class:"flex items-center gap-2",children:(v,Q)=>{var pe=Yr();p(),t(v,pe)},$$slots:{default:!0}});var me=a(K,2);He(me,{id:"recipient-name",type:"text",placeholder:"John Doe",class:"mt-2",get value(){return e(R)},set value(v){f(R,v,!0)}}),r(y);var d=a(y,2),m=o(d);Fe(m,{for:"cashu-amount",class:"flex items-center gap-2",children:(v,Q)=>{var pe=Gr();p(),t(v,pe)},$$slots:{default:!0}});var g=a(m,2);He(g,{id:"cashu-amount",type:"number",placeholder:"Amount in sats (optional)",class:"mt-2",get value(){return e(se)},set value(v){f(se,v,!0)}}),p(2),r(d),r(l),t(n,l)};w($e,n=>{e(j)&&n(vt)})}var ut=a($e,2);{let n=q(()=>e(he)||!e(H).trim()||e(s).length===0);Ee(ut,{onclick:T,get disabled(){return e(n)},class:"w-full",children:(l,y)=>{var K=ae(),me=b(K);{var d=g=>{var v=Fr();p(),t(g,v)},m=g=>{var v=_e("Generate Invite Link");t(g,v)};w(me,g=>{e(he)?g(d):g(m,!1)})}t(l,K)},$$slots:{default:!0}})}Y(()=>xt(je,0,`w-4 h-4 text-muted-foreground transition-transform flex-shrink-0 ${e(u)?"rotate-180":""}`)),At(Ye,()=>e(j),n=>f(j,n)),t(W,F)},at=W=>{var F=Zr(),E=o(F),ve=a(o(E),4),ke=o(ve,!0);r(ve),r(E);var L=a(E,2),U=o(L),J=o(U);He(J,{type:"text",get value(){return e(ie)},readonly:!0,class:"flex-1 bg-transparent"});var ue=a(J,2);Ee(ue,{onclick:k,size:"sm",children:(C,Re)=>{var oe=ae(),We=b(oe);{var Z=O=>{var N=Kr();p(),t(O,N)},fe=O=>{var N=Qr();p(),t(O,N)};w(We,O=>{e(Se)?O(Z):O(fe,!1)})}t(C,oe)},$$slots:{default:!0}}),r(U);var ce=a(U,2);Ee(ce,{onclick:$,variant:"outline",class:"w-full",children:(C,Re)=>{var oe=qr();p(),t(C,oe)},$$slots:{default:!0}}),r(L);var je=a(L,2);ee(je,()=>qt,(C,Re)=>{Re(C,{class:"pt-2",children:(oe,We)=>{var Z=Xr(),fe=o(Z);Ee(fe,{variant:"outline",onclick:()=>f(ie,""),class:"flex-1",children:(N,Ye)=>{p();var $e=_e("Create Another");t(N,$e)},$$slots:{default:!0}});var O=a(fe,2);Ee(O,{onclick:S,class:"flex-1",children:(N,Ye)=>{p();var $e=_e("Done");t(N,$e)},$$slots:{default:!0}}),r(Z),t(oe,Z)},$$slots:{default:!0}})}),r(F),Y(()=>M(ke,e(j)&&e(R)?`Your personalized invite for ${e(R)} is ready`:"Your invite link is ready to share")),t(W,F)};w(we,W=>{e(ie)?W(at,!1):W(Me)})}r(de),t(Pe,Ve)},$$slots:{default:!0}})}),t(z,ye)},$$slots:{default:!0}})}),t(c,A)};w(xe,c=>{V.current?c(P):c(B,!1)})}t(Ue,le),dt()}Mt(["click"]);const ro=Ue=>{tr(Ue,{title:"üèÜ Agora Invites",subtitle:"Community growth and new members"})};var oo=i('<div class="min-h-screen flex items-center justify-center p-4"><div class="text-center"><svg class="w-16 h-16 mx-auto mb-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <h2 class="text-xl font-semibold text-foreground mb-2">Select an Agora</h2> <p class="text-muted-foreground">This page shows community invites for a specific Agora</p></div></div>'),ao=i('<p class="text-muted-foreground text-center py-8">No new members yet</p>'),so=i('<div class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>'),no=i('<p class="text-muted-foreground text-center py-8">No introductions yet</p>'),io=i('<div class="space-y-4"></div>'),lo=i('<div class="w-full lg:max-w-4xl mx-auto p-4 space-y-6"><!> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">üëã New Members</h2> <!></div> <div class="bg-card rounded-xl border border-border p-6"><h2 class="text-xl font-bold text-foreground mb-4">üí¨ Introductions</h2> <!></div></div> <!>',1);function Eo(Ue,I){lt(I,!0);const V=q(()=>qe.selectedRelay),G=q(()=>e(V)?ht(e(V)):!1),X=q(()=>(console.log("[INVITES] redemptionsSubscription $derived.by running",{selectedRelay:e(V),isAgora:e(G)}),!e(V)||!e(G)?null:Ce.$subscribe(()=>({filters:[{kinds:[514]}],relayUrls:[e(V)],subId:"invite-redemptions",cacheUsage:bt.ONLY_RELAY,closeOnEose:!0})))),H=q(()=>(console.log("[INVITES] introductionsSubscription $derived.by running",{selectedRelay:e(V),isAgora:e(G)}),!e(V)||!e(G)?null:Ce.$subscribe(()=>({filters:[{kinds:[1],"#t":["introduction"],limit:20}],relayUrls:[e(V)],cacheUsage:bt.ONLY_RELAY,exclusiveRelay:!0,closeOnEose:!0})))),j=q(()=>{if(console.log("[INVITES] inviterStats $derived.by running",e(X)?.events.length),!e(X))return[];const s=e(X).events,u=new Map;for(const _ of s){const x=_.tags.find(te=>te[0]==="p");if(x?.[1]){const te=x[1];u.set(te,(u.get(te)||0)+1)}}const h=Array.from(u.entries()).map(([_,x])=>({pubkey:_,totalInvites:x,successfulInvites:x,rank:0}));return h.sort((_,x)=>x.successfulInvites-_.successfulInvites),h.forEach((_,x)=>{_.rank=x+1}),h.slice(0,10)}),R=q(()=>{if(console.log("[INVITES] introductions $derived.by running",e(H)?.events.length,e(X)?.events.length),!e(H)||!e(X))return[];const s=e(H).events,u=e(X).events,h=new Map;for(const _ of u){const x=_.tags.find(te=>te[0]==="p");x&&x[1]&&h.set(_.pubkey,x[1])}return s.map(_=>({event:_,invitedBy:h.get(_.pubkey)||null})).sort((_,x)=>(x.event.created_at||0)-(_.event.created_at||0)).slice(0,10)}),se=q(()=>(console.log("[INVITES] newMembers $derived.by running",e(X)?.events.length),e(X)?e(X).events.map(u=>{const h=u.tags.find(_=>_[0]==="p");return{memberPubkey:u.pubkey,inviterPubkey:h?.[1]||null,joinedAt:u.created_at||0}}).sort((u,h)=>h.joinedAt-u.joinedAt).slice(0,20):[]));ot(()=>(e(G)?gt.header=ro:gt.clear(),()=>{gt.clear()}));var ne=ae(),ie=b(ne);{var he=s=>{var u=oo();t(s,u)},Se=s=>{var u=lo(),h=b(u),_=o(h);vr(_,{get stats(){return e(j)}});var x=a(_,2),te=a(o(x),2);{var T=P=>{var B=ao();t(P,B)},k=P=>{var B=so();Ze(B,21,()=>e(se).slice(0,6),zt,(c,A)=>{Dt(c,{get memberPubkey(){return e(A).memberPubkey},get inviterPubkey(){return e(A).inviterPubkey},get joinedAt(){return e(A).joinedAt}})}),r(B),t(P,B)};w(te,P=>{e(se).length===0?P(T):P(k,!1)})}r(x);var $=a(x,2),S=a(o($),2);{var D=P=>{var B=no();t(P,B)},le=P=>{var B=io();Ze(B,21,()=>e(R),c=>c.event.id,(c,A)=>{mr(c,{get event(){return e(A).event},get invitedBy(){return e(A).invitedBy}})}),r(B),t(P,B)};w(S,P=>{e(R).length===0?P(D):P(le,!1)})}r($),r(h);var xe=a(h,2);to(xe,{onClose:()=>_t.close(),get isOpen(){return _t.show},set isOpen(P){_t.show=P}}),t(s,u)};w(ie,s=>{e(G)?s(Se,!1):s(he)})}t(Ue,ne),dt()}export{Eo as component};
