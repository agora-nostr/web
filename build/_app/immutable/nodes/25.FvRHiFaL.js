import{d as tt,f as j,a as b,s,c as we}from"../chunks/rzUyzf2y.js";import{p as rt,g as e,a as M,u as H,s as C,b as R,x as at,c as it,e as t,r,d as i,t as I,f as Me,y as ot}from"../chunks/AsQG98fS.js";import{i as O}from"../chunks/DZKExFZC.js";import{c as Ce}from"../chunks/Dt3q2Svx.js";import{s as nt,a as je}from"../chunks/DfBYFC16.js";import{p as st}from"../chunks/BcDbBYPM.js";import{g as oe}from"../chunks/s53o-P2j.js";import{n as T,e as Se,A as dt}from"../chunks/tv6-RHC_.js";import{d as lt}from"../chunks/BSM2-0iS.js";import{U as $e}from"../chunks/C-S0GgRw.js";import{o as vt}from"../chunks/C3Y4KEs7.js";import{$ as ct}from"../chunks/DrbR318x.js";var ut=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="animate-spin rounded-full h-12 w-12 border-4 border-primary-200 border-t-orange-600 mx-auto mb-4"></div> <p class="text-muted-foreground"> </p></div></div>'),ft=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden p-8"><div class="text-center"><div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-4"><svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></div> <h2 class="text-xl font-bold text-foreground mb-2"> </h2> <p class="text-muted-foreground mb-6"> </p> <button class="px-6 py-2 bg-primary hover:bg-primary-700 text-white font-semibold rounded-xl transition-colors"> </button></div></div>'),pt=j('<div class="flex flex-col items-center mb-8 -mt-20"><div class="relative mb-4"><div class="w-24 h-24 rounded-full ring-4 ring-white dark:ring-neutral-900 overflow-hidden bg-neutral-200 dark:bg-neutral-800 flex items-center justify-center"><!></div></div> <div class="text-center"><h2 class="text-xl font-bold text-foreground"> </h2> <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"> </p></div></div>'),mt=j('<div class="mb-8 p-6 bg-neutral-50 dark:bg-neutral-800/50 rounded-xl border border-border"><p class="text-foreground whitespace-pre-wrap leading-relaxed"> </p></div>'),gt=j('<div class="relative bg-card dark:bg-neutral-900 rounded-2xl shadow-xl overflow-hidden"><div class="h-32 bg-primary opacity-90"></div> <div class="px-8 pb-8 pt-12"><!> <!> <div class="text-center mb-8"><h1 class="text-3xl font-bold mb-3 text-foreground"> </h1> <p class="text-muted-foreground"> </p></div> <div class="space-y-5 mb-10"><div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-primary dark:text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div> <div class="flex items-start gap-4"><div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center flex-shrink-0 mt-0.5"><svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg></div> <div class="flex-1"><h3 class="font-semibold text-lg mb-1 text-foreground"> </h3> <p class="text-muted-foreground leading-relaxed"> </p></div></div></div> <div class="space-y-4"><button class="w-full py-6 text-lg font-semibold bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white shadow-lg transition-all duration-200 hover:shadow-xl rounded-xl flex items-center justify-center gap-2"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg></button> <button class="w-full text-center text-muted-foreground hover:text-neutral-900 dark:hover:text-neutral-200 transition-colors py-2"> <span class="font-semibold underline"> </span></button></div> <div class="mt-8 pt-6 border-t border-neutral-200 dark:border-neutral-800"><p class="text-xs text-center text-neutral-500"> </p></div></div></div>'),xt=j('<div class="min-h-screen bg-gradient-to-b from-neutral-50 to-neutral-100 dark:from-neutral-950 dark:to-neutral-900 flex items-center justify-center p-4"><div class="w-full max-w-xl"><!></div></div>');function Rt(Ne,Ae){rt(Ae,!0);const Re=()=>je(st,"$page",ne),o=()=>je(ct,"$t",ne),[ne,Ie]=nt(),x=M(()=>Re().params.code),Ue=M(()=>e(x)?e(x).slice(0,12):null),se=M(()=>e(x)&&e(x).length>12?e(x).slice(12):null),V=T.$subscribe(()=>({filters:{kinds:[513],"#d":[e(Ue)],limit:1},relayUrls:[...dt],subId:"invite",cacheUsage:Se.ONLY_RELAY,closeOnEose:!0}));let c=R(null);H(()=>{C(c,e(c)??V.events[0],!0)});let a=R(null);H(()=>{!e(c)||!e(x)||e(a)||(async()=>{try{const d=e(c).tags.filter(l=>l[0]==="code").map(l=>l[1]);if(d.length===0)return;const v=e(c).relay?.url||Array.from(e(c).onRelays)[0]?.url;let u;if(e(se)){const l=await lt(e(c).content,e(se));u=JSON.parse(l)}else u=JSON.parse(e(c).content);C(a,{...u,inviteEventId:e(c).id,inviteRelay:v,inviteCode:d[0],validCodes:d},!0)}catch(n){console.error("Failed to parse invite:",n)}})()});let de=R(at(new Set)),z=R(!1);H(()=>{!e(c)||!e(a)||e(z)||(async()=>{C(z,!0);const n=e(a).inviteRelay;if(n)try{const d=await T.guardrailOff().fetchEvents({kinds:[514],"#e":[e(c).id]},{relayUrls:[n],subId:"invite-redemptions",cacheUsage:Se.ONLY_RELAY}),v=new Set;for(const l of d){const f=l.tags.find(p=>p[0]==="code");f?.[1]&&v.add(f[1])}C(de,v,!0);const u=e(a).validCodes?.filter(l=>!v.has(l))||[];u.length>0&&(e(a).inviteCode=u[0])}catch(d){console.error("Failed to fetch redemptions:",d)}})()});const Ee=M(()=>e(a)?.validCodes?e(a).validCodes.some(n=>!e(de).has(n)):!1);let U=R(null);H(()=>{const n=e(a)?.inviter;if(!n){C(U,null);return}T.fetchUser(n).then(d=>{d?.fetchProfile().then(v=>{C(U,v,!0)})})});const Fe=M(()=>!e(x)||!e(a)),le=M(()=>{if(!e(x)||V.events.length===0&&V.eosed)return o()("onboarding.invite.inviteNotFound");if(e(a)&&!e(Ee)&&e(z)){const n=e(a).inviter?"them":"the inviter";return o()("onboarding.invite.inviteReachedMax",{values:{inviter:n}})}return null});function Le(){e(a)&&(vt.setInvite({welcomeMessage:e(a).welcomeMessage,recipientName:e(a).recipientName,cashuToken:e(a).cashuToken,inviter:e(a).inviter,inviteEventId:e(a).inviteEventId,inviteRelay:e(a).inviteRelay,inviteCode:e(a).inviteCode}),oe("/onboarding"))}function Ye(){oe("/")}var B=xt(),ve=t(B),He=t(ve);{var Oe=n=>{var d=ut(),v=t(d),u=i(t(v),2),l=t(u,!0);r(u),r(v),r(d),I(f=>s(l,f),[()=>o()("onboarding.invite.loadingInvite")]),b(n,d)},Te=n=>{var d=we(),v=Me(d);{var u=f=>{var p=ft(),S=t(p),y=i(t(S),2),J=t(y,!0);r(y);var k=i(y,2),P=t(k,!0);r(k);var _=i(k,2);_.__click=()=>oe("/");var $=t(_,!0);r(_),r(S),r(p),I((D,E)=>{s(J,D),s(P,e(le)),s($,E)},[()=>o()("onboarding.invite.inviteNotFound"),()=>o()("onboarding.invite.goHome")]),b(f,p)},l=f=>{var p=gt(),S=i(t(p),2),y=t(S);{var J=m=>{var g=pt(),h=t(g),w=t(h),te=t(w);Ce(te,()=>$e.Root,(A,ie)=>{ie(A,{get ndk(){return T},get pubkey(){return e(a).inviter},children:(We,ht)=>{var ke=we(),Xe=Me(ke);Ce(Xe,()=>$e.Avatar,(Ze,et)=>{et(Ze,{class:"w-full h-full object-cover [&>*]:w-full [&>*]:h-full [&>*]:object-cover"})}),b(We,ke)},$$slots:{default:!0}})}),r(w),r(h);var L=i(h,2),N=t(L),re=t(N,!0);r(N);var Y=i(N,2),ae=t(Y,!0);r(Y),r(L),r(g),I(A=>{s(re,e(U)?.displayName||e(U)?.name||"Someone"),s(ae,A)},[()=>o()("onboarding.invite.invitedYou")]),b(m,g)};O(y,m=>{e(a)?.inviter&&m(J)})}var k=i(y,2);{var P=m=>{var g=mt(),h=t(g),w=t(h,!0);r(h),r(g),I(()=>s(w,e(a).welcomeMessage)),b(m,g)};O(k,m=>{e(a)?.welcomeMessage&&m(P)})}var _=i(k,2),$=t(_),D=t($,!0);r($);var E=i($,2),Ve=t(E,!0);r(E),r(_);var G=i(_,2),K=t(G),ce=i(t(K),2),q=t(ce),ze=t(q,!0);r(q);var ue=i(q,2),Be=t(ue,!0);r(ue),r(ce),r(K);var Q=i(K,2),fe=i(t(Q),2),W=t(fe),Je=t(W,!0);r(W);var pe=i(W,2),Pe=t(pe,!0);r(pe),r(fe),r(Q);var me=i(Q,2),ge=i(t(me),2),X=t(ge),De=t(X,!0);r(X);var xe=i(X,2),Ge=t(xe,!0);r(xe),r(ge),r(me),r(G);var Z=i(G,2),F=t(Z);F.__click=Le;var Ke=t(F);ot(),r(F);var ee=i(F,2);ee.__click=Ye;var he=t(ee),be=i(he),qe=t(be,!0);r(be),r(ee),r(Z);var _e=i(Z,2),ye=t(_e),Qe=t(ye,!0);r(ye),r(_e),r(S),r(p),I((m,g,h,w,te,L,N,re,Y,ae,A,ie)=>{s(D,m),s(Ve,g),s(ze,h),s(Be,w),s(Je,te),s(Pe,L),s(De,N),s(Ge,re),s(Ke,`${Y??""} `),s(he,`${ae??""}  `),s(qe,A),s(Qe,ie)},[()=>o()("onboarding.invite.yourVoiceMatters"),()=>o()("onboarding.invite.joinGlobal"),()=>o()("onboarding.invite.ownYourVoice.title"),()=>o()("onboarding.invite.ownYourVoice.description"),()=>o()("onboarding.invite.earnFromStories.title"),()=>o()("onboarding.invite.earnFromStories.description"),()=>o()("onboarding.invite.connectCommunity.title"),()=>o()("onboarding.invite.connectCommunity.description"),()=>o()("onboarding.invite.startJourney"),()=>o()("onboarding.invite.alreadyHaveAccount"),()=>o()("onboarding.invite.signInHere"),()=>o()("onboarding.invite.trustSignals")]),b(f,p)};O(v,f=>{e(le)?f(u):f(l,!1)},!0)}b(n,d)};O(He,n=>{e(Fe)?n(Oe):n(Te,!1)})}r(ve),r(B),b(Ne,B),it(),Ie()}tt(["click"]);export{Rt as component};
