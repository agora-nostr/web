import"./DsnmJJEf.js";import{d as ue,p as ce,u as re,s as i,b as P,i as F,k as a,j as n,r as o,t as B,g as e,l as M,e as x,h as ve,M as Re,K as xe,c as ke,P as he,f as ye,aO as Te,L as _e,O as Ie,a as ne,aR as Oe}from"./Bq750rDx.js";import{i as z}from"./BcjopvHb.js";import{e as we}from"./Cjcfrngr.js";import{a as Ke}from"./BKrWP4DR.js";import{a as te,r as se,c as Ve}from"./uSFILAY7.js";import{b as ee}from"./BTSVJW8r.js";import{p as Qe}from"./BL6J_geM.js";import{n as k,a as Pe}from"./CdRP5_sk.js";import{p as Ye}from"./CK1WpjU7.js";import{t as U}from"./8lBcLtWK.js";import{A as Me}from"./Bt6DpIqu.js";var qe=Re('<svg class="w-3 h-3 text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),Ge=F('<button><!> <div class="flex-1 min-w-0 text-left"><div class="font-medium text-foreground truncate"> </div> <div class="text-xs text-muted-foreground truncate"> </div></div> <div><!></div></button>');function He(I,r){ce(r,!0);let v=P(null);re(()=>{k.fetchUser(r.pubkey).then(w=>{w?.fetchProfile().then(C=>{i(v,C,!0)})})});var c=Ge();c.__click=()=>r.onToggle(r.pubkey);var b=a(c);Me(b,{get ndk(){return k},get pubkey(){return r.pubkey},class:"w-10 h-10 flex-shrink-0"});var m=n(b,2),g=a(m),h=a(g,!0);o(g);var l=n(g,2),u=a(l,!0);o(l),o(m);var j=n(m,2),S=a(j);{var _=w=>{var C=qe();x(w,C)};z(S,w=>{r.isSelected&&w(_)})}o(j),o(c),B((w,C)=>{te(c,1,`w-full flex items-center gap-3 p-3 rounded-lg transition-colors ${r.isSelected?"bg-primary/20 border border-primary/50":"bg-card border border-border hover:border-border"}`),M(h,w),M(u,C),te(j,1,`w-5 h-5 rounded border-2 flex items-center justify-center ${r.isSelected?"bg-primary border-primary":"border"}`)},[()=>e(v)?.displayName||e(v)?.name||`${r.pubkey.slice(0,8)}...`,()=>e(v)?.nip05||`${r.pubkey.slice(0,16)}...`]),x(I,c),ve()}ue(["click"]);var Je=F('<div class="flex items-center gap-3 p-2 rounded-lg bg-card/50"><!> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-foreground truncate"> </div> <div class="text-xs text-muted-foreground truncate"> </div></div> <button class="p-1 text-muted-foreground hover:text-red-500 transition-colors" aria-label="Remove member"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>');function We(I,r){ce(r,!0);let v=P(null);re(()=>{k.fetchUser(r.pubkey).then(S=>{S?.fetchProfile().then(_=>{i(v,_,!0)})})});var c=Je(),b=a(c);Me(b,{get ndk(){return k},get pubkey(){return r.pubkey},class:"w-8 h-8 flex-shrink-0"});var m=n(b,2),g=a(m),h=a(g,!0);o(g);var l=n(g,2),u=a(l,!0);o(l),o(m);var j=n(m,2);j.__click=()=>r.onRemove(r.pubkey),o(c),B((S,_)=>{M(h,S),M(u,_)},[()=>e(v)?.displayName||e(v)?.name||`${r.pubkey.slice(0,8)}...`,()=>e(v)?.nip05||`${r.pubkey.slice(0,16)}...`]),x(I,c),ve()}ue(["click"]);var Xe=F('<div class="mt-3 rounded-lg overflow-hidden border border-border"><img alt="Preview" class="w-full h-48 object-cover"/></div>'),Ze=F('<div class="space-y-5"><div><label class="block text-sm font-medium text-muted-foreground mb-2">Cover Image URL (optional)</label> <input type="url" placeholder="https://example.com/image.jpg" class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors"/> <!></div> <div><label class="block text-sm font-medium text-muted-foreground mb-2">Title <span class="text-red-500">*</span></label> <input type="text" placeholder="e.g., Bitcoin Developers" class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors" maxlength="100"/></div> <div><label class="block text-sm font-medium text-muted-foreground mb-2">Description (optional)</label> <textarea placeholder="Describe what this follow pack is about..." class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors resize-none" rows="4" maxlength="500"></textarea> <p class="text-xs text-muted-foreground mt-1"> </p></div></div>'),$e=F('<button class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1.5 bg-primary hover:bg-accent-dark text-foreground rounded text-sm font-medium transition-colors">Add</button>'),er=F('<div class="text-center py-8 text-muted-foreground text-sm"> </div>'),rr=F('<div class="bg-muted/50 rounded-lg p-4 border border-border"><div class="text-sm font-medium text-muted-foreground mb-3"> </div> <div class="space-y-2 max-h-48 overflow-y-auto"></div></div>'),tr=F('<div class="space-y-4"><div><label class="block text-sm font-medium text-muted-foreground mb-2">Add members</label> <div class="relative"><svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search follows or enter npub/NIP-05..." class="w-full pl-10 pr-20 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors"/> <!></div> <p class="text-xs text-muted-foreground mt-1.5">Search your follows by name, or paste an npub/NIP-05 to add anyone</p></div> <div><div class="max-h-96 overflow-y-auto space-y-2 bg-muted/30 rounded-lg p-2 border border-border"><!></div></div> <!></div>'),or=F('<div class="fixed inset-0 z-50 flex items-start justify-center bg-background/80 backdrop-blur-sm overflow-y-auto py-8" role="presentation"><div class="w-full max-w-3xl mx-4 bg-card rounded-2xl border border-border shadow-2xl my-auto" role="dialog" aria-modal="true"><div class="flex items-center justify-between px-6 py-4 border-b border-border"><div class="flex items-center gap-3"><button class="text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50" aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <h2 class="text-xl font-bold text-foreground flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg> </h2></div> <button class="px-5 py-2.5 bg-primary hover:bg-accent-dark disabled:bg-muted disabled:cursor-not-allowed text-foreground rounded-lg transition-colors font-semibold text-sm"> </button></div> <div class="flex border-b border-border"><button>Details</button> <button> </button></div> <div class="p-6"><!></div> <div class="px-6 py-4 border-t border-border bg-card/50"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel</p></div></div></div>');function gr(I,r){ce(r,!0);let v=Qe(r,"open",15,!1),c=P("details"),b=P(!1),m=P(""),g=P(""),h=P(""),l=P(xe(new Set(r.initialPubkey?[r.initialPubkey]:[]))),u=P("");const j=k.$subscribe(()=>k.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[k.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),S=ne(()=>{const t=j.events[0];return t?new Set(t.tags.filter(d=>d[0]==="p").map(d=>d[1])):new Set});let _=P(xe(new Map));const w=ne(()=>e(u)?Array.from(e(_).entries()).filter(([d])=>e(S).has(d)).map(([d])=>d):Array.from(e(S)));re(()=>{if(!e(u).trim()||!k.cacheAdapter?.getProfiles){i(_,new Map,!0);return}const t=e(u).toLowerCase();k.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:t}).then(d=>{i(_,d??new Map,!0)}).catch(d=>{console.error("Failed to search profiles:",d),i(_,new Map,!0)})});function C(t){e(l).has(t)?e(l).delete(t):e(l).add(t),i(l,new Set(e(l)),!0)}async function me(){if(e(u).trim())try{const t=e(u).trim();let d=await k.fetchUser(t);!d&&t.includes("@")&&(d=await k.fetchUser(t)),d?.pubkey?(e(l).add(d.pubkey),i(l,new Set(e(l)),!0),i(u,""),U.success("User added")):U.error("User not found")}catch(t){console.error("Failed to fetch user:",t),U.error("Failed to fetch user")}}async function Fe(){if(!e(m).trim()||e(b)){U.error("Please provide a title");return}if(e(l).size===0){U.error("Please add at least one member");return}try{i(b,!0);const t=r.editingPack?Pe.from(r.editingPack):new Pe(k);if(t.title=e(m).trim(),t.description=e(g).trim()||void 0,t.image=e(h).trim()||void 0,t.pubkeys=Array.from(e(l)),await t.sign(),await t.publishReplaceable(),t.publishStatus==="error"){const E=t.publishError?.relayErrors||{},O=Object.entries(E).map(([K,V])=>`${K}: ${V}`).join(`
`);U.error(`Failed to publish:
${O||"Unknown error"}`);return}U.success(r.editingPack?"Follow pack updated":"Follow pack created"),fe(),v(!1),r.onClose?.()}catch(t){console.error("Failed to publish follow pack:",t),U.error(`${r.editingPack?"Failed to update":"Failed to create"} follow pack: ${t instanceof Error?t.message:"Unknown error"}`)}finally{i(b,!1)}}function fe(){i(m,""),i(g,""),i(h,""),i(l,new Set(r.initialPubkey?[r.initialPubkey]:[]),!0),i(u,""),i(c,"details")}function oe(){e(b)||(fe(),v(!1),r.onClose?.())}function Se(t){t.target===t.currentTarget&&oe()}function Ce(t){t.key==="Escape"&&!e(b)&&oe()}re(()=>{if(v()&&r.editingPack){i(m,r.editingPack.tagValue("title")||"",!0),i(g,r.editingPack.tagValue("description")||"",!0),i(h,r.editingPack.tagValue("image")||"",!0);const t=r.editingPack.tags.filter(d=>d[0]==="p").map(d=>d[1]);i(l,new Set(t),!0),i(c,"details")}else v()&&r.initialPubkey&&i(l,new Set([r.initialPubkey]),!0)});var be=ke();he("keydown",Te,Ce);var Ue=ye(be);{var je=t=>{var d=or();d.__click=Se;var E=a(d);E.__click=p=>p.stopPropagation();var O=a(E),K=a(O),V=a(K);V.__click=oe;var ge=n(V,2),Ae=n(a(ge));o(ge),o(K);var X=n(K,2);X.__click=Fe;var Le=a(X,!0);o(X),o(O);var ae=n(O,2),ie=a(ae);ie.__click=()=>i(c,"details");var Z=n(ie,2);Z.__click=()=>i(c,"members");var Ne=a(Z);o(Z),o(ae);var pe=n(ae,2),ze=a(pe);{var Be=p=>{var A=Ze(),L=a(A),D=n(a(L),2);se(D);var R=n(D,2);{var de=y=>{var G=Xe(),s=a(G);o(G),B(()=>Ve(s,"src",e(h))),he("error",s,f=>f.currentTarget.style.display="none"),Oe(s),x(y,G)};z(R,y=>{e(h).trim()&&y(de)})}o(L);var Q=n(L,2),T=n(a(Q),2);se(T),o(Q);var Y=n(Q,2),q=n(a(Y),2);Ie(q);var $=n(q,2),le=a($);o($),o(Y),o(A),B(()=>M(le,`${e(g).length??""}/500 characters`)),ee(D,()=>e(h),y=>i(h,y)),ee(T,()=>e(m),y=>i(m,y)),ee(q,()=>e(g),y=>i(g,y)),x(p,A)},Ee=p=>{var A=tr(),L=a(A),D=n(a(L),2),R=n(a(D),2);se(R),R.__keydown=s=>{s.key==="Enter"&&e(u).trim()&&me()};var de=n(R,2);{var Q=s=>{var f=$e();f.__click=me,x(s,f)};z(de,s=>{e(u).trim()&&(e(u).includes("npub1")||e(u).includes("@"))&&s(Q)})}o(D),_e(2),o(L);var T=n(L,2),Y=a(T),q=a(Y);{var $=s=>{var f=er(),N=a(f,!0);o(f),B(()=>M(N,e(u)?"No matches found":"You don't follow anyone yet")),x(s,f)},le=s=>{var f=ke(),N=ye(f);we(N,16,()=>e(w),H=>H,(H,J)=>{{let W=ne(()=>e(l).has(J));He(H,{get pubkey(){return J},get isSelected(){return e(W)},onToggle:C})}}),x(s,f)};z(q,s=>{e(w).length===0?s($):s(le,!1)})}o(Y),o(T);var y=n(T,2);{var G=s=>{var f=rr(),N=a(f),H=a(N);o(N);var J=n(N,2);we(J,20,()=>Array.from(e(l)),W=>W,(W,De)=>{We(W,{get pubkey(){return De},onRemove:C})}),o(J),o(f),B(()=>M(H,`Selected Members (${e(l).size??""})`)),x(s,f)};z(y,s=>{e(l).size>0&&s(G)})}o(A),ee(R,()=>e(u),s=>i(u,s)),x(p,A)};z(ze,p=>{e(c)==="details"?p(Be):p(Ee,!1)})}o(pe),_e(2),o(E),o(d),Ke(d,p=>Ye?.(p)),B(p=>{V.disabled=e(b),M(Ae,` ${r.editingPack?"Edit Follow Pack":"Create Follow Pack"}`),X.disabled=p,M(Le,e(b)?r.editingPack?"Updating...":"Creating...":r.editingPack?"Update Pack":"Create Pack"),te(ie,1,`flex-1 px-6 py-3 font-medium transition-colors ${e(c)==="details"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-muted-foreground"}`),te(Z,1,`flex-1 px-6 py-3 font-medium transition-colors ${e(c)==="members"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-muted-foreground"}`),M(Ne,`Members (${e(l).size??""})`)},[()=>!e(m).trim()||e(l).size===0||e(b)]),x(t,d)};z(Ue,t=>{v()&&t(je)})}x(I,be),ve()}ue(["click","keydown"]);export{gr as C};
