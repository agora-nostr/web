import"./DsnmJJEf.js";import{g as r,a as W,u as Re,s as V,b as pe,p as ie,i as k,k as F,r as x,t as g,e as o,h as se,aP as xe,l as A,c,f as l,d as Ne,j as Ce,N as Q}from"./Bq750rDx.js";import{p as ve}from"./BL6J_geM.js";import{i as f}from"./BcjopvHb.js";import{e as Me,i as Te}from"./Cjcfrngr.js";import{a as le,c as X}from"./uSFILAY7.js";import{b as qe,q as He,H as Se}from"./CdRP5_sk.js";import{g as we}from"./C88829DE.js";const Le={EMOJI_SHORTCODE:/:([a-zA-Z0-9_]+):/g,NOSTR_URI:/nostr:(npub1[a-z0-9]{58}|nprofile1[a-z0-9]+|note1[a-z0-9]{58}|nevent1[a-z0-9]+|naddr1[a-z0-9]+)/gi,HASHTAG:/(^|\s)#([a-zA-Z0-9_\u0080-\uFFFF]+)(?=\s|$|[^\w])/g,MEDIA_FILE:/https?:\/\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|mov)(\?[^\s<>"]*)?/gi,YOUTUBE:/https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})[^\s<>"]*/gi,URL:/https?:\/\/[^\s<>"]+/gi};function Oe(t){const e=new Map;for(const[s,i,a]of t)s==="emoji"&&i&&a&&e.set(i,a);return e}function Ze(t,e){const s=e.get(t);return s?{type:"emoji",content:t,data:s}:{type:"text",content:`:${t}:`}}function De(t){try{const e=t.substring(0,t.indexOf("1")+1);if(qe.decode(t),e==="npub1")return{type:"npub",content:t,data:t};if(e==="nprofile1")return{type:"nprofile",content:t,data:t};if(e==="note1"||e==="nevent1"||e==="naddr1")return{type:"event-ref",content:t,data:t}}catch{console.warn("[EventContent] Failed to decode Nostr URI:",t)}return{type:"text",content:`nostr:${t}`}}function ze(t){return/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i.test(t)}function Ue(t){return/\.(mp4|webm|mov)(\?|$)/i.test(t)}function We(t){return/youtube\.com|youtu\.be/i.test(t)}function Be(t,e){const s=t.match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(s){const[,i,a]=s;return i?{type:"hashtag",content:a,data:a}:{type:"hashtag",content:a,data:a}}if(t.startsWith(":")&&t.endsWith(":")){const i=t.slice(1,-1);return Ze(i,e)}return t.startsWith("nostr:")?De(t.slice(6)):ze(t)||Ue(t)||We(t)?{type:"media",content:t}:t.startsWith("http")?{type:"link",content:t}:{type:"text",content:t}}function Ge(t){const e=[];for(const s of Object.values(Le)){s.lastIndex=0;let i=s.exec(t);for(;i!==null;)e.push({match:i,index:i.index}),i=s.exec(t)}return e.sort((s,i)=>s.index-i.index)}function Pe(t,e){const s=[],i=Ge(t);let a=0;for(const{match:m,index:n}of i)if(!(n<a)){if(n>a&&s.push({type:"text",content:t.slice(a,n)}),m[0].match(/^\s?#[a-zA-Z0-9_\u0080-\uFFFF]+$/)){const v=m[0].match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(v){const[,_,y]=v;_&&s.push({type:"text",content:_}),s.push({type:"hashtag",content:y,data:y})}}else s.push(Be(m[0],e));a=n+m[0].length}return a<t.length&&s.push({type:"text",content:t.slice(a)}),s}function Ye(t){const e=[];let s=[];function i(){s.length!==0&&(s.length===1?e.push({type:"media",content:s[0]}):e.push({type:"image-grid",content:"",data:s}),s=[])}for(const a of t)a.type==="media"&&ze(a.content)?s.push(a.content):(i(),e.push(a));return i(),e}function Ke(t,e){const s=W(()=>t().event?.content??t().content??""),i=W(()=>t().event?t().event.tags.filter(_=>_[0]==="emoji"):t().emojiTags??[]),a=W(()=>r(s).replace(/\[Image #\d+\]/gi,"").trim()),m=W(()=>Oe(r(i))),n=W(()=>Pe(r(a),r(m))),v=W(()=>Ye(r(n)));return{get segments(){return r(v)},get content(){return r(a)},get emojiMap(){return r(m)}}}function Je(t,e){const s=He(e);let i=pe(null),a=pe(!0),m=pe(null);return Re(()=>{const{bech32:n}=t();n&&(V(a,!0),V(m,null),s.fetchEvent(n).then(v=>{v?V(i,v,!0):V(m,"Event not found"),V(a,!1)}).catch(v=>{console.error("Failed to fetch embedded event:",v),V(m,"Failed to load event"),V(a,!1)}))}),{get event(){return r(i)},get loading(){return r(a)},get error(){return r(m)}}}var Ve=k('<span role="button" tabindex="0"><!></span>');function Qe(t,e){ie(e,!0);let s=ve(e,"class",3,"");const i=W(()=>Se({ndk:e.ndk,user:()=>e.bech32}));var a=Ve(),m=F(a);{var n=_=>{var y=xe();g(Z=>A(y,`@${Z??""}...`),[()=>e.bech32.slice(0,8)]),o(_,y)},v=_=>{var y=c(),Z=l(y);{var b=h=>{var d=xe();g(()=>A(d,`@${(r(i).profile?.name||r(i).profile?.displayName||e.bech32)??""}`)),o(h,d)};f(Z,h=>{r(i)?.profile&&h(b)},!0)}o(_,y)};f(m,_=>{r(i)?.loading?_(n):_(v,!1)})}x(a),g(()=>le(a,1,`mention ${s()??""}`,"svelte-pcdwx6")),o(t,a),se()}var Xe=k('<span role="button" tabindex="0"> </span>');function $e(t,e){ie(e,!0);let s=ve(e,"class",3,"");function i(){e.onclick&&e.onclick(e.tag)}var a=Xe();a.__click=i,a.__keydown=n=>n.key==="Enter"&&i();var m=F(a);x(a),g(()=>{le(a,1,`hashtag ${s()??""}`,"svelte-1m8dia2"),A(m,`#${e.tag??""}`)}),o(t,a),se()}Ne(["click","keydown"]);var et=k('<div class="loading svelte-10400wq">Loading event...</div>'),tt=k('<div class="error svelte-10400wq"> </div>'),at=k('<div class="event-preview svelte-10400wq"><div class="event-content svelte-10400wq"> </div> <div class="event-meta svelte-10400wq"><span class="event-author svelte-10400wq"> </span> <span class="event-time svelte-10400wq"> </span></div></div>'),nt=k("<div><!></div>");function rt(t,e){ie(e,!0);let s=ve(e,"class",3,"");const i=Je({ndk:e.ndk,bech32:()=>e.bech32});var a=nt(),m=F(a);{var n=_=>{var y=et();o(_,y)},v=_=>{var y=c(),Z=l(y);{var b=d=>{var u=tt(),C=F(u,!0);x(u),g(()=>A(C,i.error)),o(d,u)},h=d=>{var u=c(),C=l(u);{var R=L=>{var B=at(),G=F(B),ee=F(G,!0);x(G);var p=Ce(G,2),q=F(p),P=F(q,!0);x(q);var $=Ce(q,2),te=F($,!0);x($),x(p),x(B),g((j,S)=>{A(ee,i.event.content),A(P,j),A(te,S)},[()=>i.event.author?.profile?.name||i.event.pubkey.slice(0,8),()=>new Date((i.event.created_at||0)*1e3).toLocaleDateString()]),o(L,B)};f(C,L=>{i.event&&L(R)},!0)}o(d,u)};f(Z,d=>{i.error?d(b):d(h,!1)},!0)}o(_,y)};f(m,_=>{i.loading?_(n):_(v,!1)})}x(a),g(()=>le(a,1,`embedded-event ${s()??""}`,"svelte-10400wq")),o(t,a),se()}var ot=k('<a target="_blank" rel="noopener noreferrer" class="link svelte-unlh7t"> </a>'),it=k('<img alt="" class="media-image svelte-unlh7t"/>'),st=k('<video controls class="media-video svelte-unlh7t"></video>',2),vt=k('<iframe title="YouTube video" class="media-youtube svelte-unlh7t" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>'),ct=k('<img class="custom-emoji svelte-unlh7t"/>'),lt=k('<img alt="" class="grid-image svelte-unlh7t"/>'),ut=k('<div class="image-grid svelte-unlh7t"></div>'),ft=k("<div></div>");function dt(t,e){ie(e,!0);let s=ve(e,"class",3,"");const i=Ke({ndk:e.ndk,event:()=>e.event,content:()=>e.content,emojiTags:()=>e.emojiTags});var a=ft();Me(a,21,()=>i.segments,Te,(m,n)=>{var v=c(),_=l(v);{var y=b=>{var h=xe();g(()=>A(h,r(n).content)),o(b,h)},Z=b=>{var h=c(),d=l(h);{var u=R=>{var L=c(),B=l(L);{var G=p=>{var q=c(),P=l(q);Q(P,()=>e.mention,()=>({bech32:r(n).data})),o(p,q)},ee=p=>{Qe(p,{get ndk(){return e.ndk},get bech32(){return r(n).data}})};f(B,p=>{e.mention?p(G):p(ee,!1)})}o(R,L)},C=R=>{var L=c(),B=l(L);{var G=p=>{var q=c(),P=l(q);{var $=j=>{var S=c(),ae=l(S);Q(ae,()=>e.eventRef,()=>({bech32:r(n).data})),o(j,S)},te=j=>{rt(j,{get ndk(){return e.ndk},get bech32(){return r(n).data}})};f(P,j=>{e.eventRef?j($):j(te,!1)})}o(p,q)},ee=p=>{var q=c(),P=l(q);{var $=j=>{var S=c(),ae=l(S);{var ue=M=>{var D=c(),ne=l(D);Q(ne,()=>e.hashtag,()=>({tag:r(n).data})),o(M,D)},fe=M=>{$e(M,{get tag(){return r(n).data}})};f(ae,M=>{e.hashtag?M(ue):M(fe,!1)})}o(j,S)},te=j=>{var S=c(),ae=l(S);{var ue=M=>{var D=c(),ne=l(D);{var de=T=>{var N=c(),Y=l(N);Q(Y,()=>e.link,()=>({url:r(n).content})),o(T,N)},me=T=>{var N=ot(),Y=F(N,!0);x(N),g(()=>{X(N,"href",r(n).content),A(Y,r(n).content)}),o(T,N)};f(ne,T=>{e.link?T(de):T(me,!1)})}o(M,D)},fe=M=>{var D=c(),ne=l(D);{var de=T=>{var N=c(),Y=l(N);{var _e=z=>{var H=c(),K=l(H);Q(K,()=>e.media,()=>({url:r(n).content})),o(z,H)},he=z=>{var H=c(),K=l(H);{var re=w=>{var E=it();g(()=>X(E,"src",r(n).content)),o(w,E)},J=w=>{var E=c(),oe=l(E);{var ge=I=>{var O=st();g(()=>X(O,"src",r(n).content)),o(I,O)},U=I=>{var O=c(),be=l(O);{var ce=ke=>{const je=W(()=>r(n).content.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/)?.[1]);var Ee=c(),Ie=l(Ee);{var Ae=ye=>{var Fe=vt();g(()=>X(Fe,"src",`https://www.youtube.com/embed/${r(je)??""}`)),o(ye,Fe)};f(Ie,ye=>{r(je)&&ye(Ae)})}o(ke,Ee)};f(be,ke=>{r(n).content.match(/youtube\.com|youtu\.be/i)&&ke(ce)},!0)}o(I,O)};f(oe,I=>{r(n).content.match(/\.(mp4|webm|mov)(\?|$)/i)?I(ge):I(U,!1)},!0)}o(w,E)};f(K,w=>{r(n).content.match(/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i)?w(re):w(J,!1)})}o(z,H)};f(Y,z=>{e.media?z(_e):z(he,!1)})}o(T,N)},me=T=>{var N=c(),Y=l(N);{var _e=z=>{var H=c(),K=l(H);{var re=w=>{var E=c(),oe=l(E);Q(oe,()=>e.emoji,()=>({shortcode:r(n).content,url:r(n).data})),o(w,E)},J=w=>{var E=ct();g(()=>{X(E,"src",r(n).data),X(E,"alt",`:${r(n).content??""}:`)}),o(w,E)};f(K,w=>{e.emoji?w(re):w(J,!1)})}o(z,H)},he=z=>{var H=c(),K=l(H);{var re=J=>{var w=c(),E=l(w);{var oe=U=>{var I=c(),O=l(I);Q(O,()=>e.imageGrid,()=>({urls:r(n).data})),o(U,I)},ge=U=>{var I=ut();Me(I,21,()=>r(n).data,Te,(O,be)=>{var ce=lt();g(()=>X(ce,"src",r(be))),o(O,ce)}),x(I),o(U,I)};f(E,U=>{e.imageGrid?U(oe):U(ge,!1)})}o(J,w)};f(K,J=>{r(n).type==="image-grid"&&J(re)},!0)}o(z,H)};f(Y,z=>{r(n).type==="emoji"?z(_e):z(he,!1)},!0)}o(T,N)};f(ne,T=>{r(n).type==="media"?T(de):T(me,!1)},!0)}o(M,D)};f(ae,M=>{r(n).type==="link"?M(ue):M(fe,!1)},!0)}o(j,S)};f(P,j=>{r(n).type==="hashtag"?j($):j(te,!1)},!0)}o(p,q)};f(B,p=>{r(n).type==="event-ref"?p(G):p(ee,!1)},!0)}o(R,L)};f(d,R=>{r(n).type==="npub"||r(n).type==="nprofile"?R(u):R(C,!1)},!0)}o(b,h)};f(_,b=>{r(n).type==="text"?b(y):b(Z,!1)})}o(m,v)}),x(a),g(()=>le(a,1,`event-content ${s()??""}`,"svelte-unlh7t")),o(t,a),se()}var mt=k('<button type="button" class="mention-button svelte-1d033kw"> </button>'),_t=k('<button type="button" class="event-ref-button svelte-1d033kw"> </button>'),ht=k('<button type="button" class="hashtag-button svelte-1d033kw"> </button>'),gt=k('<button type="button" class="link-button svelte-1d033kw"> </button>');function Ft(t,e){ie(e,!0);let s=ve(e,"class",3,"");function i(v){e.onMentionClick?e.onMentionClick(v):we(`/p/${v}`)}function a(v){e.onEventClick?e.onEventClick(v):we(`/e/${v}`)}function m(v){e.onHashtagClick?e.onHashtagClick(v):we(`/t/${v}`)}function n(v){e.onLinkClick?e.onLinkClick(v):window.open(v,"_blank")}dt(t,{get ndk(){return e.ndk},get event(){return e.event},get content(){return e.content},get emojiTags(){return e.emojiTags},get class(){return s()},mention:(b,h)=>{let d=()=>h?.().bech32;var u=mt();u.__click=()=>i(d());var C=F(u);x(u),g(R=>A(C,`@${R??""}...`),[()=>d().slice(0,8)]),o(b,u)},eventRef:(b,h)=>{let d=()=>h?.().bech32;var u=_t();u.__click=()=>a(d());var C=F(u);x(u),g(R=>A(C,`note:${R??""}...`),[()=>d().slice(0,8)]),o(b,u)},hashtag:(b,h)=>{let d=()=>h?.().tag;var u=ht();u.__click=()=>m(d());var C=F(u);x(u),g(()=>A(C,`#${d()??""}`)),o(b,u)},link:(b,h)=>{let d=()=>h?.().url;var u=gt();u.__click=()=>n(d());var C=F(u,!0);x(u),g(()=>A(C,d())),o(b,u)},$$slots:{mention:!0,eventRef:!0,hashtag:!0,link:!0}}),se()}Ne(["click"]);export{Ft as E};
