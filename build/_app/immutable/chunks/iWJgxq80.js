import{f as z,a as x,d as T,c as D}from"./rzUyzf2y.js";import{p as k,t as N,g as e,a as L,c as S,u as y,b as _,f as O,e as P,r as W,s as n,x as w}from"./AsQG98fS.js";import{i as I}from"./DZKExFZC.js";import{b as j}from"./CkKAtl6l.js";import{p as M}from"./w-gpJwMz.js";import{a as q}from"./CS0aOiUg.js";var A=z('<div role="status" aria-label="Loading"><span class="sr-only">Loading...</span></div>');function B(h,r){k(r,!0);const u=M(r,"size",3,"md"),d=M(r,"class",3,""),f=L(()=>({xs:"w-3 h-3",sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8",xl:"w-12 h-12"})[u()]),l=L(()=>({xs:"border",sm:"border-2",md:"border-2",lg:"border-3",xl:"border-4"})[u()]);var s=A();N(()=>q(s,1,`inline-block ${e(f)??""} ${e(l)??""} border-current border-t-transparent rounded-full animate-spin ${d()??""}`)),x(h,s),S()}var H=z('<button class="px-4 py-2 text-muted-foreground hover:text-muted-foreground transition-colors">Load more</button>'),J=z('<div class="p-4 text-center"><!></div>');function Z(h,r){k(r,!0);const u=M(r,"isLoading",3,!1);let d=_(void 0);y(()=>{if(!e(d))return;const t=new IntersectionObserver(a=>{a[0].isIntersecting&&r.hasMore&&!u()&&r.onIntersect()},{rootMargin:"200px",threshold:.1});return t.observe(e(d)),()=>{t.unobserve(e(d))}});var f=D(),l=O(f);{var s=t=>{var a=J(),o=P(a);{var g=i=>{B(i,{size:"md"})},v=i=>{var b=H();b.__click=function(...E){r.onIntersect?.apply(this,E)},x(i,b)};I(o,i=>{u()?i(g):i(v,!1)})}W(a),j(a,i=>n(d,i),()=>e(d)),x(t,a)};I(l,t=>{r.hasMore&&t(s)})}x(h,f),S()}T(["click"]);function G(h,r,u={}){const{initialLimit:d=20,pageSize:f=20}=u;let l=h.$subscribe(r),s=_(w(d)),t=_(w([])),a=_(!1),o=_(w([]));const g=new Set;let v=0;y(()=>{const m=l.events;if(!e(a)&&l.eosed)n(t,[...m],!0),n(a,!0),m.forEach(c=>{g.add(c.id),c.created_at&&c.created_at>v&&(v=c.created_at)});else if(!e(a))n(t,[...m],!0);else if(e(a)){const c=m.filter(p=>!g.has(p.id)&&p.created_at&&p.created_at>v);c.length>0&&(n(o,[...c,...e(o)],!0),c.forEach(p=>g.add(p.id)))}});const i=L(()=>e(t).slice(0,e(s))),b=L(()=>e(s)<e(t).length),E=L(()=>!l.eosed);function F(){e(b)&&n(s,Math.min(e(s)+f,e(t).length),!0)}function R(){if(e(o).length>0){const m=e(o).length;n(t,[...e(o),...e(t)],!0),n(o,[],!0),n(s,e(s)+m)}}let C=!0;return y(()=>{if(r(),C){C=!1;return}n(s,d,!0),n(t,[],!0),n(a,!1),n(o,[],!0),g.clear(),v=0}),{get events(){return e(i)},get allEvents(){return e(t)},get pendingEvents(){return e(o)},get hasMore(){return e(b)},get isLoading(){return e(E)},get eosed(){return l.eosed},get count(){return l.count},get totalCount(){return e(t).length},get visibleCount(){return e(i).length},get pendingCount(){return e(o).length},loadMore:F,loadPendingEvents:R}}export{Z as L,G as c};
