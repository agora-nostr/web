import"./DsnmJJEf.js";import{d as Ie,p as Te,bg as Nt,i as h,g as e,a as D,k as o,r,t as q,e as a,h as Ae,c as pe,f as H,N as wt,bn as ut,j as s,u as Oe,s as i,b as fe,l as ae,L as Se,M as Be,K as Ze,P as De,aO as ct,O as jt,b8 as Lt,aP as Re}from"./Bq750rDx.js";import{i as E}from"./BcjopvHb.js";import{c as xe}from"./BRAzWB6r.js";import{d as tt,a as Ee,c as He,r as Dt,b as kt}from"./uSFILAY7.js";import{p as ve,b as at}from"./BL6J_geM.js";import{Q as It,n as ce,b as Pt,s as $e,f as vt,h as Bt,R as Ft}from"./CdRP5_sk.js";import{c as lt}from"./DRdfZ70c.js";import{U as Ge,A as et}from"./Bt6DpIqu.js";import{T as Zt}from"./3NtbZaKM.js";import{E as Qt,R as ft}from"./D2qeXkoa.js";import{E as Wt}from"./DIzqhxA9.js";import{a as Ye}from"./BKrWP4DR.js";import{t as Pe}from"./8lBcLtWK.js";import{c as ot}from"./a7XEC-kH.js";import{e as Xe,i as nt}from"./Cjcfrngr.js";import{u as mt}from"./BKSKCJuW.js";import{p as st}from"./CK1WpjU7.js";import{M as Ct,b as St,d as Mt,R as Et,e as Rt,g as Tt,h as At}from"./Dw4s2o4Z.js";import{B as Ne,I as gt}from"./DMhdcQZj.js";import{b as zt}from"./BTSVJW8r.js";import{N as Ot,c as Ht}from"./wiMjQwcH.js";import{I as Ue}from"./BrZTJthz.js";import{D as qt,a as Kt}from"./C7FVrkeR.js";import{D as Vt}from"./DtjL0N-6.js";import{L as pt}from"./BoTf7nuy.js";import{D as Yt}from"./CHVQ8-IN.js";async function Xt(te,t,l,u){if(!te.wallet)throw new Error("No wallet connected");if(!te.$currentPubkey)throw new Error("No active session");const g=new It(t,l,"msat",{comment:u?.comment});return te.$payments.addPending(g,te.$currentPubkey),await g.zap()}const it=Symbol.for("event-card");var Gt=h("<article><!></article>");function Jt(te,t){Te(t,!0);let l=ve(t,"interactive",3,!1),u=ve(t,"class",3,"");Nt(it,{get ndk(){return t.ndk},get event(){return t.event},get threading(){return t.threading},get interactive(){return l()}});function d(){if(t.onclick){t.onclick();return}if(!l())return;const b=t.event.encode();window.location.href=`/e/${b}`}const p=D(()=>l()||!!t.onclick);var f=Gt();f.__click=function(...b){(e(p)?d:void 0)?.apply(this,b)},f.__keydown=function(...b){(e(p)?_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),d())}:void 0)?.apply(this,b)};var C=o(f);{var R=b=>{var _=pe(),v=H(_);wt(v,()=>t.children),a(b,_)};E(C,b=>{t.children&&b(R)})}r(f),q(b=>{Ee(f,1,b),He(f,"role",e(p)?"button":void 0),He(f,"tabindex",e(p)?0:void 0)},[()=>tt(lt("event-card","relative","border-b border-border",e(p)&&"cursor-pointer hover:bg-card/30 transition-colors",u()))]),a(te,f),Ae()}Ie(["click","keydown"]);var $t=h('<div class="flex flex-col flex-1 min-w-0"><!> <!></div>'),er=h('<div class="flex items-center gap-2 min-w-0 flex-1"><!> <!></div>'),tr=h("<!> <!>",1),rr=h('<header><div class="flex items-center gap-2 flex-1 min-w-0"><!></div> <div class="flex items-center gap-2 flex-shrink-0"><!> <!></div></header>');function ar(te,t){Te(t,!0);let l=ve(t,"variant",3,"compact"),u=ve(t,"showAvatar",3,!0),g=ve(t,"showTimestamp",3,!0),d=ve(t,"showMenu",3,!0),p=ve(t,"avatarClass",3,"w-9 h-9 sm:w-12 sm:h-12"),f=ve(t,"nameClass",3,"text-base font-semibold"),C=ve(t,"class",3,"");const R=ut(it);function b(j){j.stopPropagation()}var _=rr(),v=o(_);v.__click=b;var m=o(v);xe(m,()=>Ge.Root,(j,de)=>{de(j,{get ndk(){return R.ndk},get pubkey(){return R.event.pubkey},children:(w,I)=>{var le=tr(),F=H(le);{var Z=T=>{var A=pe(),P=H(A);xe(P,()=>Ge.Avatar,(M,X)=>{X(M,{get class(){return p()}})}),a(T,A)};E(F,T=>{u()&&T(Z)})}var k=s(F,2);{var S=T=>{var A=$t(),P=o(A);xe(P,()=>Ge.Name,(X,G)=>{G(X,{field:"displayName",get class(){return f()}})});var M=s(P,2);xe(M,()=>Ge.Handle,(X,G)=>{G(X,{class:"text-sm text-muted-foreground"})}),r(A),a(T,A)},he=T=>{var A=pe(),P=H(A);{var M=G=>{var z=er(),U=o(z);xe(U,()=>Ge.Name,(ee,oe)=>{oe(ee,{field:"displayName",get class(){return f()}})});var $=s(U,2);xe($,()=>Ge.Handle,(ee,oe)=>{oe(ee,{class:"text-sm text-muted-foreground"})}),r(z),a(G,z)},X=G=>{var z=pe(),U=H(z);xe(U,()=>Ge.Name,($,ee)=>{ee($,{field:"displayName",get class(){return f()}})}),a(G,z)};E(P,G=>{l()==="compact"?G(M):G(X,!1)},!0)}a(T,A)};E(k,T=>{l()==="full"?T(S):T(he,!1)})}a(w,le)},$$slots:{default:!0}})}),r(v);var N=s(v,2),V=o(N);{var Y=j=>{Zt(j,{get timestamp(){return R.event.created_at},class:"text-muted-foreground text-sm"})};E(V,j=>{g()&&R.event.created_at&&j(Y)})}var L=s(V,2);{var y=j=>{Qt(j,{get event(){return R.event}})};E(L,j=>{d()&&j(y)})}r(N),r(_),q(j=>Ee(_,1,j),[()=>tt(lt("event-card-header","flex items-center gap-2 sm:gap-3",C()))]),a(te,_),Ae()}Ie(["click"]);var or=h("<div><!></div>");function nr(te,t){Te(t,!0);let l=ve(t,"textClass",3,"text-base"),u=ve(t,"class",3,"");const g=ut(it),d=D(()=>{if(!t.truncate||!g.event.content||g.event.content.length<=t.truncate)return;let C=t.truncate;const R=g.event.content.lastIndexOf(" ",t.truncate);return R>t.truncate*.8&&(C=R),g.event.content.slice(0,C)+"..."});var p=or(),f=o(p);Wt(f,{get ndk(){return g.ndk},get event(){return g.event},get content(){return e(d)}}),r(p),q(C=>Ee(p,1,C),[()=>tt(lt("event-card-content","text-foreground whitespace-pre-wrap break-words overflow-hidden",l(),u()))]),a(te,p),Ae()}Ie(["click"]);var sr=h('<div aria-hidden="true"></div>');function lr(te,t){Te(t,!0);let l=ve(t,"forceShow",3,!1),u=ve(t,"class",3,"");const g=ut(it),d=D(()=>l()||g?.threading?.showLineToNext),p=D(()=>g?.threading?lt("thread-line",g.threading.isSelfThread&&"thread-line--self",u()):"thread-line");var f=pe(),C=H(f);{var R=b=>{var _=sr();q(()=>Ee(_,1,tt(e(p)),"svelte-55x6wn")),a(b,_)};E(C,b=>{e(d)&&b(R)})}a(te,f),Ae()}const rt={Root:Jt,Header:ar,Content:nr,ThreadLine:lr};var ir=h('<div class="flex items-center gap-1 mb-2 text-sm text-muted-foreground"><span>Replying to</span> <a class="font-medium hover:underline text-muted-foreground"> </a></div>'),dr=h('<div class="flex items-center gap-1 mb-2 text-sm text-muted-foreground"><span>Replying to event</span></div>');function ur(te,t){Te(t,!0);let l=fe(null),u=fe(null);const g=D(()=>{const _=t.event.tags.find(N=>N[0]==="e"&&N[3]==="reply");if(_)return _;const v=t.event.tags.find(N=>N[0]==="e"&&N[3]==="root");if(v)return v;const m=t.event.tags.filter(N=>N[0]==="e");if(m.length===1)return m[0]});Oe(()=>{e(g)&&ce.fetchEventFromTag(e(g),t.event).then(_=>{_&&(i(l,_,!0),_.author.fetchProfile().then(v=>{i(u,v,!0)}))})});const d=D(()=>e(l)?e(u)?.name?e(u).name:e(u)?.displayName?e(u).displayName:`${e(l).pubkey.slice(0,8)}...`:""),p=D(()=>e(l)?Pt.npubEncode(e(l).pubkey):"");var f=pe(),C=H(f);{var R=_=>{var v=ir(),m=s(o(v),2),N=o(m);r(m),r(v),q(()=>{He(m,"href",`/p/${e(p)??""}`),ae(N,`@${e(d)??""}`)}),a(_,v)},b=_=>{var v=pe(),m=H(v);{var N=V=>{var Y=dr();a(V,Y)};E(m,V=>{e(g)&&!e(l)&&V(N)},!0)}a(_,v)};E(C,_=>{e(l)&&e(u)?_(R):_(b,!1)})}a(te,f),Ae()}var cr=h('<button type="button" class="inline-flex items-center gap-1 px-2 py-1 bg-primary/20 hover:bg-primary/30 text-foreground rounded-full text-xs transition-colors"><!> <span class="max-w-[100px] truncate"> </span> <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>');function vr(te,t){Te(t,!0);let l=fe(null);Oe(()=>{ce.fetchUser(t.pubkey).then(C=>{C?.fetchProfile().then(R=>{i(l,R,!0)})})});const u=D(()=>e(l)?.displayName||e(l)?.name||`${t.pubkey.slice(0,8)}...`);var g=cr();g.__click=()=>t.onRemove(t.pubkey);var d=o(g);et(d,{get ndk(){return ce},get pubkey(){return t.pubkey},size:14,class:"flex-shrink-0"});var p=s(d,2),f=o(p,!0);r(p),Se(2),r(g),q(()=>ae(f,e(u))),a(te,g),Ae()}Ie(["click"]);var fr=h('<div class="text-xs text-muted-foreground truncate"> </div>'),mr=Be('<svg class="w-3 h-3 text-primary-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),gr=h("<div><!></div>"),pr=h('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div> <!></button>');function hr(te,t){Te(t,!0);let l=fe(null);Oe(()=>{ce.fetchUser(t.pubkey).then(m=>{m?.fetchProfile().then(N=>{i(l,N,!0)})})});const u=D(()=>e(l)?.displayName||e(l)?.name||`${t.pubkey.slice(0,8)}...`);var g=pr();g.__click=()=>t.onToggle(t.pubkey);var d=o(g);et(d,{get ndk(){return ce},get pubkey(){return t.pubkey},size:32,class:"flex-shrink-0"});var p=s(d,2),f=o(p),C=o(f,!0);r(f);var R=s(f,2);{var b=m=>{var N=fr(),V=o(N,!0);r(N),q(()=>ae(V,e(l).nip05)),a(m,N)};E(R,m=>{e(l)?.nip05&&m(b)})}r(p);var _=s(p,2);{var v=m=>{var N=gr(),V=o(N);{var Y=L=>{var y=mr();a(L,y)};E(V,L=>{t.isSelected&&L(Y)})}r(N),q(()=>Ee(N,1,`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 ${t.isSelected?"bg-primary border-primary":"border-border"}`)),a(m,N)};E(_,m=>{t.showCheckbox&&m(v)})}r(g),q(()=>{Ee(g,1,`w-full flex items-center gap-2 p-2 rounded-md transition-colors ${t.isSelected?"bg-primary/20":"hover:bg-muted"}`),ae(C,e(u))}),a(te,g),Ae()}Ie(["click"]);var br=h('<button type="button" class="absolute right-1 top-1/2 -translate-y-1/2 px-2 py-1 bg-primary hover:bg-primary/90 text-primary-foreground rounded text-xs font-medium transition-colors">Add</button>'),xr=h('<p class="text-xs text-muted-foreground mt-1.5">Search follows or paste npub/hex/NIP-05</p>'),_r=h('<div class="px-3 py-2 border-b border-border bg-muted/30"><div class="text-xs font-medium text-muted-foreground mb-2"> </div> <div class="flex flex-wrap gap-1.5"></div></div>'),yr=h('<div class="text-center py-8 px-3 text-muted-foreground text-sm"> </div>'),wr=h('<div class="p-2 space-y-1"></div>'),kr=h('<div class="flex flex-col max-h-[400px]"><div class="p-3 border-b border-border"><h3 class="font-semibold text-sm mb-2">Tag people</h3> <div class="relative"><svg class="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search or paste npub/identifier..." class="w-full pl-8 pr-16 py-2 bg-muted border border-border rounded-lg text-foreground text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"/> <!></div> <!></div> <!> <div class="overflow-y-auto flex-1"><!></div></div>');function ht(te,t){Te(t,!0);let l=ve(t,"searchQuery",15);var u=kr(),g=o(u),d=s(o(g),2),p=s(o(d),2);Dt(p),p.__keydown=L=>{L.key==="Enter"&&t.isIdentifierInput&&t.onAddByIdentifier()};var f=s(p,2);{var C=L=>{var y=br();y.__click=function(...j){t.onAddByIdentifier?.apply(this,j)},a(L,y)};E(f,L=>{t.isIdentifierInput&&L(C)})}r(d);var R=s(d,2);{var b=L=>{var y=xr();a(L,y)};E(R,L=>{l()||L(b)})}r(g);var _=s(g,2);{var v=L=>{var y=_r(),j=o(y),de=o(j);r(j);var w=s(j,2);Xe(w,20,()=>t.selectedPubkeys,I=>I,(I,le)=>{vr(I,{get pubkey(){return le},get onRemove(){return t.onRemoveUser}})}),r(w),r(y),q(()=>ae(de,`Selected (${t.selectedPubkeys.length??""})`)),a(L,y)};E(_,L=>{t.selectedPubkeys.length>0&&L(v)})}var m=s(_,2),N=o(m);{var V=L=>{var y=yr(),j=o(y,!0);r(y),q(()=>ae(j,l()?"No matches found":"You don't follow anyone yet")),a(L,y)},Y=L=>{var y=wr();Xe(y,20,()=>t.filteredFollows,j=>j,(j,de)=>{{let w=D(()=>t.selectedPubkeys.includes(de));hr(j,{get pubkey(){return de},get isSelected(){return e(w)},get showCheckbox(){return t.multiple},get onToggle(){return t.onToggleUser}})}}),r(y),a(L,y)};E(N,L=>{t.filteredFollows.length===0?L(V):L(Y,!1)})}r(m),r(u),zt(p,l),a(te,u),Ae()}Ie(["keydown","click"]);var Pr=h('<span class="ml-auto text-xs bg-primary/20 text-primary rounded-full px-2 py-0.5"> </span>'),Cr=h('<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> <span> </span> <!>',1),Sr=h('<span class="absolute -top-1 -right-1 text-[10px] bg-primary text-primary-foreground rounded-full w-4 h-4 flex items-center justify-center"> </span>'),Mr=Be('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg><!>',1),Er=h('<div role="presentation" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center"><div role="dialog" tabindex="-1" style="width: 380px;" class="bg-card border border-border rounded-lg shadow-xl overflow-hidden"><!></div></div>'),Rr=h('<div class="bg-card border border-border rounded-lg shadow-xl z-50 overflow-hidden"><!></div>'),Tr=h('<div class="relative"><!> <!></div>');function Ar(te,t){Te(t,!0);let l=ve(t,"selectedPubkeys",31,()=>Ze([])),u=ve(t,"multiple",3,!0),g=ve(t,"buttonClass",3,""),d=ve(t,"disabled",3,!1),p=ve(t,"iconOnly",3,!0),f=ve(t,"open",15,!1),C=fe(""),R=null,b=fe(Ze({top:0,left:0,width:0}));const _=ce.$subscribe(()=>ce.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[ce.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),v=D(()=>{const k=_.events[0];return k?new Set(k.tags.filter(S=>S[0]==="p").map(S=>S[1])):new Set});let m=fe(Ze(new Map));const N=D(()=>e(C)?Array.from(e(m).entries()).filter(([S])=>e(v).has(S)).map(([S])=>S).slice(0,50):Array.from(e(v)).slice(0,50));Oe(()=>{if(!e(C).trim()||!ce.cacheAdapter?.getProfiles){i(m,new Map,!0);return}const k=e(C).toLowerCase();ce.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:k}).then(S=>{i(m,S??new Map,!0)}).catch(S=>{console.error("Failed to search profiles:",S),i(m,new Map,!0)})});function V(){if(!f()&&R){const k=R.getBoundingClientRect();i(b,{top:k.bottom+4,left:k.left,width:Math.max(k.width,380)},!0)}f(!f())}const Y=D(()=>g().includes("hidden"));Oe(()=>{if(f()&&e(Y)){const k=window.innerWidth,S=window.innerHeight,he=380;i(b,{top:(S-400)/2,left:(k-he)/2,width:he},!0)}});function L(k){u()?l().includes(k)?l(l().filter(S=>S!==k)):l([...l(),k]):(l([k]),f(!1)),t.onSelect?.(l())}function y(k){l(l().filter(S=>S!==k)),t.onSelect?.(l())}async function j(){if(e(C).trim())try{const k=e(C).trim(),S=await ce.fetchUser(k);S?.pubkey?(u()?l().includes(S.pubkey)||(l([...l(),S.pubkey]),t.onSelect?.(l()),Pe.success("User added")):(l([S.pubkey]),t.onSelect?.(l()),f(!1)),i(C,"")):Pe.error("User not found")}catch(k){console.error("Failed to fetch user:",k),Pe.error("Failed to fetch user")}}function de(){f(!1)}const w=D(()=>{const k=e(C).trim();return k.length>0&&(k.startsWith("npub1")||k.startsWith("nprofile1")||k.includes("@")||k.length===64&&/^[0-9a-f]+$/i.test(k))});var I=Tr(),le=o(I);{let k=D(()=>p()?"icon":"default"),S=D(()=>p()?"h-8 w-8":"w-full justify-start"),he=D(g),T=D(()=>t.buttonLabel||"Tag people");Ne(le,{type:"button",variant:"ghost",get size(){return e(k)},get class(){return`${e(S)??""} ${e(he)??""}`},get disabled(){return d()},onclick:V,get title(){return e(T)},get ref(){return R},set ref(A){R=A},children:(A,P)=>{var M=pe(),X=H(M);{var G=U=>{var $=Cr(),ee=s(H($),2),oe=o(ee,!0);r(ee);var O=s(ee,2);{var ne=ge=>{var _e=Pr(),Q=o(_e,!0);r(_e),q(()=>ae(Q,l().length)),a(ge,_e)};E(O,ge=>{l().length>0&&ge(ne)})}q(()=>ae(oe,t.buttonLabel)),a(U,$)},z=U=>{var $=Mr(),ee=s(H($));{var oe=O=>{var ne=Sr(),ge=o(ne,!0);r(ne),q(()=>ae(ge,l().length)),a(O,ne)};E(ee,O=>{l().length>0&&O(oe)})}a(U,$)};E(X,U=>{!p()&&t.buttonLabel?U(G):U(z,!1)})}a(A,M)},$$slots:{default:!0}})}var F=s(le,2);{var Z=k=>{var S=pe(),he=H(S);{var T=P=>{var M=Er();M.__click=de,M.__keydown=z=>z.key==="Escape"&&de();var X=o(M);X.__click=z=>z.stopPropagation(),X.__keydown=z=>z.stopPropagation();var G=o(X);ht(G,{get isIdentifierInput(){return e(w)},get selectedPubkeys(){return l()},get filteredFollows(){return e(N)},get multiple(){return u()},onSearchQueryChange:z=>i(C,z,!0),onAddByIdentifier:j,onRemoveUser:y,onToggleUser:L,get searchQuery(){return e(C)},set searchQuery(z){i(C,z,!0)}}),r(X),r(M),Ye(M,z=>st?.(z)),a(P,M)},A=P=>{var M=Rr(),X=o(M);ht(X,{get isIdentifierInput(){return e(w)},get selectedPubkeys(){return l()},get filteredFollows(){return e(N)},get multiple(){return u()},onSearchQueryChange:G=>i(C,G,!0),onAddByIdentifier:j,onRemoveUser:y,onToggleUser:L,get searchQuery(){return e(C)},set searchQuery(G){i(C,G,!0)}}),r(M),Ye(M,G=>st?.(G)),Ye(M,(G,z)=>ot?.(G,z),()=>de),q(()=>kt(M,`position: fixed; top: ${e(b).top??""}px; left: ${e(b).left??""}px; width: 380px;`)),a(P,M)};E(he,P=>{e(Y)?P(T):P(A,!1)})}a(k,S)};E(F,k=>{f()&&k(Z)})}r(I),a(te,I),Ae()}Ie(["click","keydown"]);var zr=h('<div class="text-xs text-muted-foreground truncate"> </div>'),Ur=h('<button type="button"><!> <div class="flex-1 min-w-0 text-left"><div class="text-sm font-medium text-foreground truncate"> </div> <!></div></button>');function Nr(te,t){Te(t,!0);let l=fe(null);Oe(()=>{ce.fetchUser(t.pubkey).then(b=>{b?.fetchProfile().then(_=>{i(l,_,!0)})})});var u=Ur();u.__click=b=>{b.preventDefault(),b.stopPropagation(),t.onSelect(t.pubkey)};var g=o(u);et(g,{get ndk(){return ce},get pubkey(){return t.pubkey},size:32,class:"flex-shrink-0"});var d=s(g,2),p=o(d),f=o(p,!0);r(p);var C=s(p,2);{var R=b=>{var _=zr(),v=o(_,!0);r(_),q(()=>ae(v,e(l).nip05)),a(b,_)};E(C,b=>{e(l)?.nip05&&b(R)})}r(d),r(u),q(()=>{Ee(u,1,`w-full flex items-center gap-2 p-2 transition-colors ${t.isSelected?"bg-primary/20":"hover:bg-muted"}`),ae(f,e(l)?.displayName||e(l)?.name||"Anonymous")}),De("mouseenter",u,function(...b){t.onMouseEnter?.apply(this,b)}),a(te,u),Ae()}Ie(["click"]);var jr=h('<div class="bg-card border border-border rounded-lg shadow-xl z-[1003] overflow-hidden"><div class="max-h-[300px] overflow-y-auto"></div></div>');function Lr(te,t){Te(t,!0);let l=fe(0);const u=ce.$subscribe(()=>ce.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[ce.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),g=D(()=>{const v=u.events[0];return v?new Set(v.tags.filter(m=>m[0]==="p").map(m=>m[1])):new Set});let d=fe(Ze(new Map));const p=D(()=>t.searchQuery?Array.from(e(d).entries()).filter(([m])=>e(g).has(m)).map(([m])=>m).slice(0,10):Array.from(e(g)).slice(0,10));Oe(()=>{if(!t.searchQuery.trim()||!ce.cacheAdapter?.getProfiles){i(d,new Map,!0);return}const v=t.searchQuery.toLowerCase();ce.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:v}).then(m=>{i(d,m??new Map,!0)}).catch(m=>{console.error("Failed to search profiles:",m),i(d,new Map,!0)})}),Oe(()=>{e(l)>=e(p).length&&i(l,Math.max(0,e(p).length-1),!0)});function f(v){const m=ce.getUser({pubkey:v}),N=Array.from(m.relayUrls||[]),V=Pt.nprofileEncode({pubkey:v,relays:N.slice(0,3)});t.onSelect(`nostr:${V}`)}function C(v){switch(v.key){case"ArrowDown":v.preventDefault(),i(l,(e(l)+1)%e(p).length);break;case"ArrowUp":v.preventDefault(),i(l,e(l)===0?e(p).length-1:e(l)-1,!0);break;case"Enter":v.preventDefault(),e(p).length>0&&f(e(p)[e(l)]);break;case"Escape":v.preventDefault(),t.onClose();break}}var R=pe();De("keydown",ct,C);var b=H(R);{var _=v=>{var m=jr(),N=o(m);Xe(N,22,()=>e(p),V=>V,(V,Y,L)=>{{let y=D(()=>e(L)===e(l));Nr(V,{get pubkey(){return Y},get isSelected(){return e(y)},onSelect:f,onMouseEnter:()=>i(l,e(L),!0)})}}),r(N),r(m),Ye(m,V=>st?.(V)),q(()=>kt(m,`position: fixed; top: ${t.position.top??""}px; left: ${t.position.left??""}px; max-width: 320px;`)),a(v,m)};E(b,v=>{e(p).length>0&&v(_)})}a(te,R),Ae()}var Dr=h('<div class="absolute inset-0 flex items-center justify-center"><div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div></div>'),Ir=h('<button type="button" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center hover:bg-red-600" aria-label="Remove image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Br=h('<div class="relative group"><img alt="Upload preview"/> <!></div>'),Fr=h('<div class="flex flex-wrap gap-2 mt-2"></div>'),Zr=Be('<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Qr=h('<div><input type="file" accept="image/*" multiple class="hidden"/> <div><textarea class="w-full min-h-[120px] max-md:flex-1 max-md:min-h-0 bg-transparent text-foreground placeholder-neutral-500 resize-none focus:outline-none focus:ring-0 text-lg"></textarea> <!></div> <div class="flex items-center gap-2 mt-2 pt-2 border-t border-border"><!> <!> <!></div></div> <!>',1);function bt(te,t){Te(t,!0);let l=ve(t,"value",15,""),u=ve(t,"placeholder",3,"What's on your mind?"),g=ve(t,"autofocus",3,!1),d=ve(t,"disabled",3,!1),p=ve(t,"class",3,""),f=ve(t,"selectedMentions",31,()=>Ze([]));const C=new Ot(ce),R=Ht(C);let b,_,v=fe(!1),m=fe(Ze([])),N=fe(!1),V=fe(!1),Y=fe(""),L=fe(0),y=fe(Ze({top:0,left:0})),j=Ze(new Map);async function de(n){if(!n.type.startsWith("image/")){Pe.error("Please select an image file");return}const c=URL.createObjectURL(n),x=e(m).length;i(m,[...e(m),{url:"",preview:c}],!0),i(N,!0);try{await R.upload(n,{fallbackServer:"https://blossom.primal.net"}),R.result?.url&&(e(m)[x]={url:R.result.url,preview:c},w(R.result.url),Pe.success("Image uploaded"))}catch(K){console.error("Upload failed:",K),Pe.error("Failed to upload image"),i(m,e(m).filter((se,ie)=>ie!==x),!0)}finally{i(N,!1)}}function w(n){const c=b;if(!c)return;const x=c.selectionStart,K=c.selectionEnd,se=`
${n}
`;l(l().slice(0,x)+se+l().slice(K)),setTimeout(()=>{c.selectionStart=c.selectionEnd=x+se.length,c.focus()},0)}function I(n){const c=e(m)[n];c.url&&l(l().replace(`
${c.url}
`,"").replace(c.url,"")),URL.revokeObjectURL(c.preview),i(m,e(m).filter((x,K)=>K!==n),!0)}function le(n){const c=n.target,x=c.files?.[0];x&&de(x),c.value=""}function F(n){n.preventDefault(),i(v,!0)}function Z(n){n.preventDefault(),i(v,!1)}async function k(n){n.preventDefault(),i(v,!1);const c=n.dataTransfer?.files;if(c&&c.length>0)for(const x of Array.from(c))x.type.startsWith("image/")&&await de(x)}async function S(n){const c=n.clipboardData?.items;if(c){for(const x of Array.from(c))if(x.type.startsWith("image/")){n.preventDefault();const K=x.getAsFile();K&&await de(K)}}}function he(){_?.click()}function T(){if(!b)return{top:0,left:0};const n=b,c=n.selectionStart,x=document.createElement("div"),K=window.getComputedStyle(n);["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(we=>{x.style[we]=K[we]}),x.style.position="absolute",x.style.visibility="hidden",x.style.whiteSpace="pre-wrap",x.style.wordWrap="break-word",document.body.appendChild(x);const ie=n.value.substring(0,c);x.textContent=ie;const me=document.createElement("span");me.textContent=n.value.substring(c)||".",x.appendChild(me);const be=n.getBoundingClientRect(),Me={top:be.top+me.offsetTop+parseInt(K.borderTopWidth)-n.scrollTop+20,left:be.left+me.offsetLeft+parseInt(K.borderLeftWidth)};return document.body.removeChild(x),Me}function A(n){const c=n.target,x=c.selectionStart,K=c.value.substring(0,x),se=K.lastIndexOf("@");if(se!==-1){const ie=K.substring(se+1),me=se>0?K[se-1]:" ",be=ie.includes(" ")||ie.includes(`
`);if((me===" "||me===`
`||se===0)&&!be){i(L,se,!0),i(Y,ie,!0),i(y,T(),!0),i(V,!0);return}}i(V,!1)}async function P(n){const c=b;if(!c)return;const x=c.selectionStart;if(!n.match(/nostr:nprofile1([a-z0-9]+)/))return;const se=ce.getUser({nprofile:n.replace("nostr:","")});await se.fetchProfile();const ie=se.profile?.nip05?`@${se.profile.nip05}`:`@${se.profile?.displayName||se.profile?.name||se.npub.slice(0,12)}`;j.set(ie,n);const me=l().substring(0,e(L)),be=l().substring(x);l(me+ie+" "+be);const Me=e(L)+ie.length+1;setTimeout(()=>{c.selectionStart=c.selectionEnd=Me,c.focus()},0),i(V,!1),i(Y,"")}function M(){i(V,!1),i(Y,"")}function X(){let n=l();for(const[c,x]of j)for(;n.includes(c);)n=n.replace(c,x);return n}function G(){l(""),j.clear(),i(m,[],!0),i(V,!1),i(Y,"")}function z(n){e(V)||n.key==="Enter"&&n.stopPropagation()}var U={getContentWithNostrEntities:X,reset:G},$=Qr(),ee=H($),oe=o(ee);oe.__change=le,at(oe,n=>_=n,()=>_);var O=s(oe,2),ne=o(O);jt(ne),Lt(ne,g()),ne.__input=A,ne.__keydown=z,at(ne,n=>b=n,()=>b);var ge=s(ne,2);{var _e=n=>{var c=Fr();Xe(c,23,()=>e(m),x=>x.preview,(x,K,se)=>{var ie=Br(),me=o(ie),be=s(me,2);{var Me=Ce=>{var ke=Dr();a(Ce,ke)},we=Ce=>{var ke=Ir();ke.__click=()=>I(e(se)),a(Ce,ke)};E(be,Ce=>{e(K).url?Ce(we,!1):Ce(Me)})}r(ie),q(()=>{He(me,"src",e(K).preview),Ee(me,1,`w-20 h-20 object-cover rounded-lg border border ${e(K).url?"":"opacity-50 animate-pulse"}`)}),a(x,ie)}),r(c),a(n,c)};E(ge,n=>{e(m).length>0&&n(_e)})}r(O);var Q=s(O,2),B=o(Q);{var ue=n=>{var c=pe(),x=H(c);wt(x,()=>t.relayButton),a(n,c)};E(B,n=>{t.relayButton&&n(ue)})}var ye=s(B,2);{let n=D(()=>d()||e(N));Ne(ye,{type:"button",variant:"ghost",size:"icon",onclick:he,get disabled(){return e(n)},class:"h-8 w-8",title:"Add image",children:(c,x)=>{var K=Zr();a(c,K)},$$slots:{default:!0}})}var re=s(ye,2);Ar(re,{get onSelect(){return t.onMentionsChange},get disabled(){return d()},get selectedPubkeys(){return f()},set selectedPubkeys(n){f(n)}}),r(Q),r(ee);var W=s(ee,2);{var J=n=>{Lr(n,{get position(){return e(y)},get searchQuery(){return e(Y)},onSelect:P,onClose:M})};E(W,n=>{e(V)&&n(J)})}return q(()=>{Ee(ee,1,`relative flex-1 flex flex-col ${p()??""}`),Ee(O,1,`flex-1 flex flex-col ${e(v)?"ring-2 ring-primary ring-offset-2 rounded-lg":""}`),He(ne,"placeholder",u()),ne.disabled=d()}),De("dragover",O,F),De("dragleave",O,Z),De("drop",O,k),De("paste",ne,S),zt(ne,l),a(te,$),Ae(U)}Ie(["change","input","keydown","click"]);function Wr(te){const t=Ze({selectedRelayUrls:[]}),l=D(()=>$e.relays.filter(u=>u.enabled));return Oe(()=>{te()&&($e.selectedRelay?t.selectedRelayUrls=[$e.selectedRelay]:t.selectedRelayUrls.length===0&&(t.selectedRelayUrls=e(l).filter(u=>u.write).map(u=>u.url)))}),{get selectedRelayUrls(){return t.selectedRelayUrls},set selectedRelayUrls(u){t.selectedRelayUrls=u},get allRelays(){return e(l)}}}var Or=h('<div class="-mx-6 px-4 py-3 mb-4 border-b border-border bg-card/50"><div class="flex gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-foreground text-sm"> </span> <span class="text-muted-foreground text-xs"> </span></div> <p class="text-muted-foreground text-sm line-clamp-3"> </p></div></div></div>'),Hr=h('<img alt="" class="w-5 h-5 rounded border border-background"/>'),qr=h('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><!></div>'),Kr=h('<div class="flex items-center -space-x-1"></div>'),Vr=h('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),Yr=h('<div class="relative"><!> <!></div>'),Xr=h('<div class="absolute top-full left-0 mt-2 bg-popover border border-border rounded-lg shadow-xl z-[100] w-80 max-h-[400px] overflow-y-auto transition-all duration-200"><!></div>'),Gr=h('<div class="relative"><!> <!></div>'),Jr=h('<div class="-mx-6 px-4 py-3 mb-4 border-y border-border bg-muted/30"><div class="text-xs text-muted-foreground mb-2">Quoting</div> <div class="border border-border rounded-lg overflow-hidden bg-card"><!></div></div>'),$r=h('<div class="flex items-center justify-between -mx-6 -mt-6 px-4 py-3 mb-4 border-b border-border"><!> <!> <!></div> <!> <div class="relative mb-4"><!></div> <!> <div class="-mx-6 px-4 py-3 border-t border-border"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel, <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">âŒ˜</kbd> + <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Enter</kbd> to post</p></div>',1),ea=h('<div class="px-4 py-3 mb-4 border-b border-border bg-card/50 shrink-0"><div class="flex gap-3"><!> <div class="flex-1 min-w-0"><div class="flex items-center gap-2 mb-1"><span class="font-semibold text-foreground text-sm"> </span> <span class="text-muted-foreground text-xs"> </span></div> <p class="text-muted-foreground text-sm line-clamp-3"> </p></div></div></div>'),ta=h('<img alt="" class="w-5 h-5 rounded border border-background"/>'),ra=h('<div class="w-5 h-5 rounded bg-muted flex items-center justify-center border border-background"><!></div>'),aa=h('<div class="flex items-center -space-x-1"></div>'),oa=h('<span class="absolute -top-1 -right-1 bg-primary text-primary-foreground text-[10px] font-medium rounded-full min-w-[14px] h-[14px] flex items-center justify-center px-0.5"> </span>'),na=h('<div class="relative"><!> <!></div>'),sa=h('<div role="presentation" class="fixed inset-0 bg-black/50 z-[1002] flex items-center justify-center transition-opacity"><div role="dialog" tabindex="-1" class="bg-popover border border-border rounded-lg shadow-xl w-80 max-h-[400px] overflow-y-auto"><!></div></div>'),la=h('<div class="relative"><!> <!></div>'),ia=h('<div class="px-4 py-3 mb-4 border-y border-border bg-muted/30 shrink-0"><div class="text-xs text-muted-foreground mb-2">Quoting</div> <div class="border border-border rounded-lg overflow-hidden bg-card"><!></div></div>'),da=h('<div class="flex items-center justify-between px-4 py-3 mb-4 border-b border-border shrink-0"><!> <!> <!></div> <!> <div class="relative mb-4 flex-1 flex flex-col overflow-hidden px-4"><div class="flex-1 overflow-hidden"><!></div></div> <!> <div class="px-4 py-3 border-t border-border shrink-0"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel, <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">âŒ˜</kbd> + <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Enter</kbd> to post</p></div>',1);function xt(te,t){Te(t,!0);const l=new Ct("(min-width: 768px)");let u=ve(t,"open",15,!1),g=fe(""),d=fe(!1),p=fe(!1),f=fe(!1),C=fe(Ze([])),R,b=fe(null);Oe(()=>{if(!t.replyTo){i(b,null);return}t.replyTo.author.fetchProfile().then(F=>{i(b,F,!0)})});const _=Wr(()=>u()),v=D(()=>_.selectedRelayUrls),m=D(()=>_.allRelays);async function N(){if(!(!e(g).trim()||e(d)||e(v).length===0))try{i(d,!0);const F=R?.getContentWithNostrEntities()??e(g);let Z;t.replyTo?Z=t.replyTo.reply():t.quotedEvent?(Z=new vt(ce),Z.kind=1,Z.tag(t.quotedEvent,void 0,!1,"q")):(Z=new vt(ce),Z.kind=1),Z.content=t.quotedEvent?`${F}
nostr:${t.quotedEvent.encode()}`:F,t.replyTo||(Z.isProtected=e(f)),e(C).forEach(S=>{Z.tags.push(["p",S])}),await Z.sign();const k=Bt.fromRelayUrls(e(v),ce);if(await Z.publish(k),Z.publishStatus==="error"){const S=Z.publishError;console.error("Publish error object:",S),console.error("Relay errors:",S?.relayErrors);const he=S?.relayErrors||{},T=Object.entries(he);if(T.length>0){const A=T.map(([P,M])=>`â€¢ ${P.replace("wss://","")}: ${M}`).join(`
`);Pe.error(`Failed to publish to relays:

${A}`)}else Pe.error(`Failed to publish: ${S?.message||"Not enough relays received the event"}`);return}R?.reset(),i(g,""),i(C,[],!0),u(!1),Pe.success(t.replyTo?"Reply published":t.quotedEvent?"Quote published":"Note published"),t.onPublished?.(),t.onClose?.()}catch(F){console.error("Failed to publish note:",F),Pe.error(`Failed to publish: ${F instanceof Error?F.message:"Unknown error"}`)}finally{i(d,!1)}}function V(F){_.selectedRelayUrls.includes(F)?_.selectedRelayUrls=_.selectedRelayUrls.filter(Z=>Z!==F):_.selectedRelayUrls=[..._.selectedRelayUrls,F]}function Y(F){_.selectedRelayUrls=[F],i(p,!1)}function L(){i(p,!1)}function y(){e(d)||(u(!1),i(g,""),i(C,[],!0),t.onClose?.())}function j(F){(F.metaKey||F.ctrlKey)&&F.key==="Enter"&&N()}var de=pe();De("keydown",ct,j);var w=H(de);{var I=F=>{var Z=pe(),k=H(Z);xe(k,()=>Et,(S,he)=>{he(S,{get open(){return u()},onOpenChange:T=>{T?u(!0):y()},children:(T,A)=>{var P=pe(),M=H(P);xe(M,()=>St,(X,G)=>{G(X,{class:"md:max-w-2xl !overflow-visible",children:(z,U)=>{var $=$r(),ee=H($),oe=o(ee);Ne(oe,{variant:"ghost",size:"icon",onclick:y,get disabled(){return e(d)},class:"h-10 w-10",children:(re,W)=>{Ue(re,{name:"close",size:"lg"})},$$slots:{default:!0}});var O=s(oe,2);xe(O,()=>Mt,(re,W)=>{W(re,{class:"text-lg",children:(J,n)=>{Se();var c=Re();q(()=>ae(c,t.replyTo?"Reply":t.quotedEvent?"Quote":"Compose")),a(J,c)},$$slots:{default:!0}})});var ne=s(O,2);{let re=D(()=>!e(g).trim()||e(d)||e(v).length===0);Ne(ne,{onclick:N,get disabled(){return e(re)},class:"rounded-full",size:"sm",children:(W,J)=>{Se();var n=Re();q(()=>ae(n,e(d)?"Publishing...":"Post")),a(W,n)},$$slots:{default:!0}})}r(ee);var ge=s(ee,2);{var _e=re=>{var W=Or(),J=o(W),n=o(J);et(n,{get ndk(){return ce},get pubkey(){return t.replyTo.pubkey},class:"w-10 h-10"});var c=s(n,2),x=o(c),K=o(x),se=o(K,!0);r(K);var ie=s(K,2),me=o(ie);r(ie),r(x);var be=s(x,2),Me=o(be,!0);r(be),r(c),r(J),r(W),q((we,Ce)=>{ae(se,we),ae(me,`@${Ce??""}`),ae(Me,t.replyTo.content)},[()=>e(b).displayName||e(b).name||`${t.replyTo.pubkey.slice(0,8)}...`,()=>e(b).name||t.replyTo.pubkey.slice(0,8)]),a(re,W)};E(ge,re=>{t.replyTo&&e(b)&&re(_e)})}var Q=s(ge,2),B=o(Q);{const re=J=>{var n=Gr(),c=o(n);Ne(c,{type:"button",variant:"ghost",size:"icon",onclick:()=>i(p,!e(p)),get disabled(){return e(d)},class:"h-8 w-8",title:"Select relays",children:(se,ie)=>{var me=pe(),be=H(me);{var Me=Ce=>{var ke=Kr();Xe(ke,21,()=>e(v),nt,(Le,qe)=>{const Ke=D(()=>e(m).find(We=>We.url===e(qe))),Fe=D(()=>e(Ke)?mt(e(Ke).url):null);var je=pe(),Qe=H(je);{var Je=We=>{var ze=Hr();q(()=>He(ze,"src",e(Fe).info.icon)),a(We,ze)},dt=We=>{var ze=qr(),Ve=o(ze);Ue(Ve,{name:"relay",size:"xs",class:"text-muted-foreground"}),r(ze),a(We,ze)};E(Qe,We=>{e(Fe)?.info?.icon?We(Je):We(dt,!1)})}a(Le,je)}),r(ke),a(Ce,ke)},we=Ce=>{var ke=Yr(),Le=o(ke);Ue(Le,{name:"relay",size:"md"});var qe=s(Le,2);{var Ke=Fe=>{var je=Vr(),Qe=o(je,!0);r(je),q(()=>ae(Qe,e(v).length)),a(Fe,je)};E(qe,Fe=>{e(v).length>2&&Fe(Ke)})}r(ke),a(Ce,ke)};E(be,Ce=>{e(v).length<=2&&e(v).length>0?Ce(Me):Ce(we,!1)})}a(se,me)},$$slots:{default:!0}});var x=s(c,2);{var K=se=>{var ie=Xr(),me=o(ie);ft(me,{get selectedRelayUrls(){return e(v)},onToggleRelay:V,onSelectOnly:Y,get isProtected(){return e(f)},set isProtected(be){i(f,be,!0)}}),r(ie),Ye(ie,(be,Me)=>ot?.(be,Me),()=>L),a(se,ie)};E(x,se=>{e(p)&&se(K)})}r(n),a(J,n)};let W=D(()=>t.replyTo?"Write your reply...":t.quotedEvent?"Add your thoughts...":"What's on your mind?");at(bt(B,{get placeholder(){return e(W)},autofocus:!0,get disabled(){return e(d)},get value(){return e(g)},set value(J){i(g,J,!0)},get selectedMentions(){return e(C)},set selectedMentions(J){i(C,J,!0)},relayButton:re,$$slots:{relayButton:!0}}),J=>R=J,()=>R)}r(Q);var ue=s(Q,2);{var ye=re=>{var W=Jr(),J=s(o(W),2),n=o(J);yt(n,{get event(){return t.quotedEvent},showActions:!1}),r(J),r(W),a(re,W)};E(ue,re=>{t.quotedEvent&&re(ye)})}Se(2),a(z,$)},$$slots:{default:!0}})}),a(T,P)},$$slots:{default:!0}})}),a(F,Z)},le=F=>{var Z=pe(),k=H(Z);xe(k,()=>At,(S,he)=>{he(S,{get open(){return u()},onOpenChange:T=>{T?u(!0):y()},children:(T,A)=>{var P=pe(),M=H(P);xe(M,()=>Rt,(X,G)=>{G(X,{class:"h-[95vh] flex flex-col !overflow-visible",children:(z,U)=>{var $=da(),ee=H($),oe=o(ee);Ne(oe,{variant:"ghost",size:"icon",onclick:y,get disabled(){return e(d)},class:"h-10 w-10",children:(W,J)=>{Ue(W,{name:"close",size:"lg"})},$$slots:{default:!0}});var O=s(oe,2);xe(O,()=>Tt,(W,J)=>{J(W,{class:"text-lg",children:(n,c)=>{Se();var x=Re();q(()=>ae(x,t.replyTo?"Reply":t.quotedEvent?"Quote":"Compose")),a(n,x)},$$slots:{default:!0}})});var ne=s(O,2);{let W=D(()=>!e(g).trim()||e(d)||e(v).length===0);Ne(ne,{onclick:N,get disabled(){return e(W)},class:"rounded-full",size:"sm",children:(J,n)=>{Se();var c=Re();q(()=>ae(c,e(d)?"Publishing...":"Post")),a(J,c)},$$slots:{default:!0}})}r(ee);var ge=s(ee,2);{var _e=W=>{var J=ea(),n=o(J),c=o(n);et(c,{get ndk(){return ce},get pubkey(){return t.replyTo.pubkey},class:"w-10 h-10"});var x=s(c,2),K=o(x),se=o(K),ie=o(se,!0);r(se);var me=s(se,2),be=o(me);r(me),r(K);var Me=s(K,2),we=o(Me,!0);r(Me),r(x),r(n),r(J),q((Ce,ke)=>{ae(ie,Ce),ae(be,`@${ke??""}`),ae(we,t.replyTo.content)},[()=>e(b).displayName||e(b).name||`${t.replyTo.pubkey.slice(0,8)}...`,()=>e(b).name||t.replyTo.pubkey.slice(0,8)]),a(W,J)};E(ge,W=>{t.replyTo&&e(b)&&W(_e)})}var Q=s(ge,2),B=o(Q),ue=o(B);{const W=n=>{var c=la(),x=o(c);Ne(x,{type:"button",variant:"ghost",size:"icon",onclick:()=>i(p,!e(p)),get disabled(){return e(d)},class:"h-8 w-8",title:"Select relays",children:(ie,me)=>{var be=pe(),Me=H(be);{var we=ke=>{var Le=aa();Xe(Le,21,()=>e(v),nt,(qe,Ke)=>{const Fe=D(()=>e(m).find(ze=>ze.url===e(Ke))),je=D(()=>e(Fe)?mt(e(Fe).url):null);var Qe=pe(),Je=H(Qe);{var dt=ze=>{var Ve=ta();q(()=>He(Ve,"src",e(je).info.icon)),a(ze,Ve)},We=ze=>{var Ve=ra(),Ut=o(Ve);Ue(Ut,{name:"relay",size:"xs",class:"text-muted-foreground"}),r(Ve),a(ze,Ve)};E(Je,ze=>{e(je)?.info?.icon?ze(dt):ze(We,!1)})}a(qe,Qe)}),r(Le),a(ke,Le)},Ce=ke=>{var Le=na(),qe=o(Le);Ue(qe,{name:"relay",size:"md"});var Ke=s(qe,2);{var Fe=je=>{var Qe=oa(),Je=o(Qe,!0);r(Qe),q(()=>ae(Je,e(v).length)),a(je,Qe)};E(Ke,je=>{e(v).length>2&&je(Fe)})}r(Le),a(ke,Le)};E(Me,ke=>{e(v).length<=2&&e(v).length>0?ke(we):ke(Ce,!1)})}a(ie,be)},$$slots:{default:!0}});var K=s(x,2);{var se=ie=>{var me=sa();me.__click=L,me.__keydown=we=>we.key==="Escape"&&L();var be=o(me);be.__click=we=>we.stopPropagation(),be.__keydown=we=>we.stopPropagation();var Me=o(be);ft(Me,{get selectedRelayUrls(){return e(v)},onToggleRelay:V,onSelectOnly:Y,get isProtected(){return e(f)},set isProtected(we){i(f,we,!0)}}),r(be),r(me),Ye(me,we=>st?.(we)),a(ie,me)};E(K,ie=>{e(p)&&ie(se)})}r(c),a(n,c)};let J=D(()=>t.replyTo?"Write your reply...":t.quotedEvent?"Add your thoughts...":"What's on your mind?");at(bt(ue,{get placeholder(){return e(J)},autofocus:!0,get disabled(){return e(d)},class:"flex-1 overflow-hidden",get value(){return e(g)},set value(n){i(g,n,!0)},get selectedMentions(){return e(C)},set selectedMentions(n){i(C,n,!0)},relayButton:W,$$slots:{relayButton:!0}}),n=>R=n,()=>R)}r(B),r(Q);var ye=s(Q,2);{var re=W=>{var J=ia(),n=s(o(J),2),c=o(n);yt(c,{get event(){return t.quotedEvent},showActions:!1}),r(n),r(J),a(W,J)};E(ye,W=>{t.quotedEvent&&W(re)})}Se(2),a(z,$)},$$slots:{default:!0}})}),a(T,P)},$$slots:{default:!0}})}),a(F,Z)};E(w,F=>{l.current?F(I):F(le,!1)})}a(te,de),Ae()}Ie(["click","keydown"]);var ua=h('<div class="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"></div> <div class="relative flex flex-col items-center gap-2"><span class="text-2xl"> </span> <span> </span></div>',1),ca=h('<div class="p-4 rounded-2xl bg-primary/20 border-2 border-primary/30"><div class="flex items-center justify-between"><span class="text-sm text-foreground/70">Selected Amount:</span> <span class="text-2xl font-bold text-foreground"> </span></div></div>'),va=h('<span class="text-xl mr-2">âš¡</span> ',1),fa=h("<!> <!>",1),ma=h('<div class="relative -mx-6 -mt-6 px-6 py-6 mb-6 border-b border-border bg-primary/10"><div class="absolute inset-0 bg-primary/5 blur-xl"></div> <div class="relative flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center shadow-lg shadow-primary/50"><span class="text-2xl">âš¡</span></div> <div><!> <!></div></div></div> <div class="space-y-6"><div class="grid grid-cols-4 gap-3"></div> <div class="space-y-2"><!> <div class="relative"><!> <div class="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground font-semibold">sats</div></div></div> <!> <!></div>',1),ga=h('<div class="absolute inset-0 bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity"></div> <div class="relative flex flex-col items-center gap-2"><span class="text-2xl"> </span> <span> </span></div>',1),pa=h('<div class="p-4 rounded-2xl bg-primary/20 border-2 border-primary/30"><div class="flex items-center justify-between"><span class="text-sm text-foreground/70">Selected Amount:</span> <span class="text-2xl font-bold text-foreground"> </span></div></div>'),ha=h('<span class="text-xl mr-2">âš¡</span> ',1),ba=h('<div class="flex gap-3"><!> <!></div>'),xa=h('<div class="relative px-6 py-6 mb-6 border-b border-border bg-primary/10"><div class="absolute inset-0 bg-primary/5 blur-xl"></div> <div class="relative flex items-center gap-3"><div class="w-12 h-12 rounded-full bg-primary flex items-center justify-center shadow-lg shadow-primary/50"><span class="text-2xl">âš¡</span></div> <div><!> <!></div></div></div> <div class="space-y-6 px-4"><div class="grid grid-cols-4 gap-3"></div> <div class="space-y-2"><!> <div class="relative"><!> <div class="absolute right-4 top-1/2 -translate-y-1/2 text-muted-foreground font-semibold">sats</div></div></div> <!></div> <!>',1);function _a(te,t){Te(t,!0);const l=new Ct("(min-width: 768px)");let u=ve(t,"open",15,!1);const g=[{value:10,label:"10",emoji:"â˜•"},{value:21,label:"21",emoji:"âš¡"},{value:50,label:"50",emoji:"ðŸ¤™"},{value:100,label:"100",emoji:"ðŸ’¯"},{value:500,label:"500",emoji:"ðŸ”¥"},{value:1e3,label:"1K",emoji:"ðŸ’Ž"},{value:2100,label:"2.1K",emoji:"ðŸš€"},{value:5e3,label:"5K",emoji:"ðŸ‘‘"}];let d=fe(Ze($e.zap.defaultAmount)),p=fe(""),f=fe(!1);function C(Y){i(d,Y,!0),i(f,!1),i(p,"")}function R(){i(f,!0);const Y=Number.parseInt(e(p));!Number.isNaN(Y)&&Y>0&&i(d,Y,!0)}function b(){e(d)>0&&t.onZap(e(d))}function _(Y){Y.key==="Enter"&&e(d)>0&&b()}var v=pe();De("keydown",ct,_);var m=H(v);{var N=Y=>{var L=pe(),y=H(L);xe(y,()=>Et,(j,de)=>{de(j,{get open(){return u()},onOpenChange:w=>{w?u(!0):t.onCancel()},children:(w,I)=>{var le=pe(),F=H(le);xe(F,()=>St,(Z,k)=>{k(Z,{class:"max-w-md bg-background border-2 border-primary/30 shadow-2xl shadow-primary/50",children:(S,he)=>{var T=ma(),A=H(T),P=s(o(A),2),M=s(o(P),2),X=o(M);xe(X,()=>Mt,(Q,B)=>{B(Q,{class:"text-xl text-foreground",children:(ue,ye)=>{Se();var re=Re("Zap Amount");a(ue,re)},$$slots:{default:!0}})});var G=s(X,2);xe(G,()=>qt,(Q,B)=>{B(Q,{class:"text-sm text-muted-foreground",children:(ue,ye)=>{Se();var re=Re("Choose your zap amount");a(ue,re)},$$slots:{default:!0}})}),r(M),r(P),r(A);var z=s(A,2),U=o(z);Xe(U,21,()=>g,nt,(Q,B)=>{{let ue=D(()=>e(d)===e(B).value&&!e(f)?"bg-primary shadow-lg shadow-primary/50 scale-105":"bg-muted hover:bg-muted/80 hover:scale-105");Ne(Q,{variant:"ghost",onclick:()=>C(e(B).value),get class(){return`group relative overflow-hidden rounded-2xl p-4 h-auto transition-all duration-200 ${e(ue)??""}`},children:(ye,re)=>{var W=ua(),J=s(H(W),2),n=o(J),c=o(n,!0);r(n);var x=s(n,2),K=o(x,!0);r(x),r(J),q(()=>{ae(c,e(B).emoji),Ee(x,1,`text-xs font-bold ${e(d)===e(B).value&&!e(f)?"text-primary-foreground":"text-foreground"}`),ae(K,e(B).label)}),a(ye,W)},$$slots:{default:!0}})}}),r(U);var $=s(U,2),ee=o($);pt(ee,{for:"custom-amount",class:"text-sm font-semibold text-muted-foreground",children:(Q,B)=>{Se();var ue=Re("Custom Amount");a(Q,ue)},$$slots:{default:!0}});var oe=s(ee,2),O=o(oe);{let Q=D(()=>e(f)?"border-primary":"border-border");gt(O,{id:"custom-amount",type:"number",oninput:R,placeholder:"Enter custom amount...",get class(){return`w-full px-4 py-4 bg-muted border-2 ${e(Q)??""} rounded-2xl text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:border-primary transition-colors text-lg font-semibold pr-16`},get value(){return e(p)},set value(B){i(p,B,!0)}})}Se(2),r(oe),r($);var ne=s($,2);{var ge=Q=>{var B=ca(),ue=o(B),ye=s(o(ue),2),re=o(ye);r(ye),r(ue),r(B),q(W=>ae(re,`${W??""} sats`),[()=>e(d).toLocaleString()]),a(Q,B)};E(ne,Q=>{e(d)>0&&Q(ge)})}var _e=s(ne,2);xe(_e,()=>Yt,(Q,B)=>{B(Q,{class:"flex gap-3 sm:space-x-0",children:(ue,ye)=>{var re=fa(),W=H(re);Ne(W,{variant:"outline",get onclick(){return t.onCancel},class:"flex-1 px-6 py-4 rounded-2xl",children:(n,c)=>{Se();var x=Re("Cancel");a(n,x)},$$slots:{default:!0}});var J=s(W,2);{let n=D(()=>e(d)<=0);Ne(J,{onclick:b,get disabled(){return e(n)},class:"flex-1 px-6 py-4 rounded-2xl bg-primary hover:opacity-90 shadow-lg shadow-primary/50 hover:shadow-primary/70 disabled:opacity-50 disabled:shadow-none",children:(c,x)=>{var K=va(),se=s(H(K));q(ie=>ae(se,` Zap ${ie??""}`),[()=>e(d)>0?e(d).toLocaleString():""]),a(c,K)},$$slots:{default:!0}})}a(ue,re)},$$slots:{default:!0}})}),r(z),a(S,T)},$$slots:{default:!0}})}),a(w,le)},$$slots:{default:!0}})}),a(Y,L)},V=Y=>{var L=pe(),y=H(L);xe(y,()=>At,(j,de)=>{de(j,{get open(){return u()},onOpenChange:w=>{w?u(!0):t.onCancel()},children:(w,I)=>{var le=pe(),F=H(le);xe(F,()=>Rt,(Z,k)=>{k(Z,{children:(S,he)=>{var T=xa(),A=H(T),P=s(o(A),2),M=s(o(P),2),X=o(M);xe(X,()=>Tt,(Q,B)=>{B(Q,{class:"text-xl text-foreground",children:(ue,ye)=>{Se();var re=Re("Zap Amount");a(ue,re)},$$slots:{default:!0}})});var G=s(X,2);xe(G,()=>Kt,(Q,B)=>{B(Q,{class:"text-sm text-muted-foreground",children:(ue,ye)=>{Se();var re=Re("Choose your zap amount");a(ue,re)},$$slots:{default:!0}})}),r(M),r(P),r(A);var z=s(A,2),U=o(z);Xe(U,21,()=>g,nt,(Q,B)=>{{let ue=D(()=>e(d)===e(B).value&&!e(f)?"bg-primary shadow-lg shadow-primary/50 scale-105":"bg-muted hover:bg-muted/80 hover:scale-105");Ne(Q,{variant:"ghost",onclick:()=>C(e(B).value),get class(){return`group relative overflow-hidden rounded-2xl p-4 h-auto transition-all duration-200 ${e(ue)??""}`},children:(ye,re)=>{var W=ga(),J=s(H(W),2),n=o(J),c=o(n,!0);r(n);var x=s(n,2),K=o(x,!0);r(x),r(J),q(()=>{ae(c,e(B).emoji),Ee(x,1,`text-xs font-bold ${e(d)===e(B).value&&!e(f)?"text-primary-foreground":"text-foreground"}`),ae(K,e(B).label)}),a(ye,W)},$$slots:{default:!0}})}}),r(U);var $=s(U,2),ee=o($);pt(ee,{for:"custom-amount",class:"text-sm font-semibold text-muted-foreground",children:(Q,B)=>{Se();var ue=Re("Custom Amount");a(Q,ue)},$$slots:{default:!0}});var oe=s(ee,2),O=o(oe);{let Q=D(()=>e(f)?"border-primary":"border-border");gt(O,{id:"custom-amount",type:"number",oninput:R,placeholder:"Enter custom amount...",get class(){return`w-full px-4 py-4 bg-muted border-2 ${e(Q)??""} rounded-2xl text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:border-primary transition-colors text-lg font-semibold pr-16`},get value(){return e(p)},set value(B){i(p,B,!0)}})}Se(2),r(oe),r($);var ne=s($,2);{var ge=Q=>{var B=pa(),ue=o(B),ye=s(o(ue),2),re=o(ye);r(ye),r(ue),r(B),q(W=>ae(re,`${W??""} sats`),[()=>e(d).toLocaleString()]),a(Q,B)};E(ne,Q=>{e(d)>0&&Q(ge)})}r(z);var _e=s(z,2);xe(_e,()=>Vt,(Q,B)=>{B(Q,{class:"pt-2",children:(ue,ye)=>{var re=ba(),W=o(re);Ne(W,{variant:"outline",get onclick(){return t.onCancel},class:"flex-1 px-6 py-4 rounded-2xl",children:(n,c)=>{Se();var x=Re("Cancel");a(n,x)},$$slots:{default:!0}});var J=s(W,2);{let n=D(()=>e(d)<=0);Ne(J,{onclick:b,get disabled(){return e(n)},class:"flex-1 px-6 py-4 rounded-2xl bg-primary hover:opacity-90 shadow-lg shadow-primary/50 hover:shadow-primary/70 disabled:opacity-50 disabled:shadow-none",children:(c,x)=>{var K=ha(),se=s(H(K));q(ie=>ae(se,` Zap ${ie??""}`),[()=>e(d)>0?e(d).toLocaleString():""]),a(c,K)},$$slots:{default:!0}})}r(re),a(ue,re)},$$slots:{default:!0}})}),a(S,T)},$$slots:{default:!0}})}),a(w,le)},$$slots:{default:!0}})}),a(Y,L)};E(m,Y=>{l.current?Y(N):Y(V,!1)})}a(te,v),Ae()}var ya=Be('<svg class="w-6 h-6 animate-spin text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),wa=Be('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),ka=Be('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),Pa=Be('<svg stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),Ca=h('<button type="button"><div><!></div> <span class="text-xs font-semibold text-white"><!></span></button>'),Sa=Be('<svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'),Ma=Be('<svg class="w-5 h-5 animate-pulse" fill="currentColor" viewBox="0 0 24 24"><path d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>'),Ea=Be('<path d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),Ra=Be('<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>'),Ta=Be('<svg class="w-5 h-5" stroke="currentColor" viewBox="0 0 24 24"><!></svg>'),Aa=h('<span class="text-xs opacity-70"> </span>'),za=h(" <!>",1),Ua=h('<button type="button"><!> <span class="text-sm group-hover:underline"><!></span></button>'),Na=h("<!> <!>",1);function _t(te,t){Te(t,!0);const l=ve(t,"variant",3,"default"),u=ce.$zaps(()=>({target:t.event,validated:!0})),g=D(()=>{const w=ce.$currentPubkey;return w?Ft(u.events,w):!1}),d=D(()=>{const w=u.totalAmount;return w>=1e6?`${(w/1e6).toFixed(1)}M`:w>=1e3?`${(w/1e3).toFixed(1)}K`:w.toString()});let p=fe(!1),f=fe(!1),C=fe(!1),R=null;async function b(w){if(!ce.signer){Pe.error("Please login to zap");return}i(f,!0);try{await Xt(ce,t.event,w*1e3),i(C,!0),setTimeout(()=>i(C,!1),2e3),Pe.success(`Zapped ${w} sats!`)}catch(I){console.error("Failed to zap:",I);const le=I instanceof Error?I.message:"Failed to send zap";le.includes("wallet")||le.includes("NWC")?Pe.error("Lightning wallet error. Please check your wallet connection in settings."):le.includes("invoice")?Pe.error("Failed to create invoice. The recipient may not have a Lightning address configured."):Pe.error("Failed to send zap. Please try again.")}finally{i(f,!1)}}async function _(w){w.stopPropagation(),!(e(f)||!ce.signer)&&await b($e.zap.defaultAmount)}function v(w){i(p,!1),b(w)}function m(w){w.preventDefault(),w.stopPropagation(),R=setTimeout(()=>{i(p,!0),R=null},500)}function N(w){R&&(clearTimeout(R),R=null,(w.type==="mouseup"||w.type==="touchend")&&_(w))}function V(){R&&(clearTimeout(R),R=null)}var Y=Na(),L=H(Y);{var y=w=>{var I=Ca();I.__mousedown=m,I.__mouseup=N,I.__touchstart=m,I.__touchend=N;var le=o(I),F=o(le);{var Z=P=>{var M=ya();a(P,M)},k=P=>{var M=Pa(),X=o(M);{var G=U=>{var $=wa();a(U,$)},z=U=>{var $=ka();a(U,$)};E(X,U=>{e(g)?U(G):U(z,!1)})}r(M),q(()=>{Ee(M,0,`w-6 h-6 transition-colors ${e(g)?"text-yellow-400":"text-white"}`),He(M,"fill",e(g)?"currentColor":"none")}),a(P,M)};E(F,P=>{e(f)?P(Z):P(k,!1)})}r(le);var S=s(le,2),he=o(S);{var T=P=>{var M=Re();q(()=>ae(M,e(d))),a(P,M)},A=P=>{var M=Re("Zap");a(P,M)};E(he,P=>{u.totalAmount>0?P(T):P(A,!1)})}r(S),r(I),q(()=>{I.disabled=e(f),Ee(I,1,`flex flex-col items-center gap-1 hover:scale-110 transition-transform group ${e(f)?"opacity-50 cursor-wait":""}`),Ee(le,1,`w-12 h-12 rounded-full backdrop-blur-sm flex items-center justify-center transition-colors ${e(C)?"bg-yellow-400/30":e(g)?"bg-yellow-400/20":"bg-white/20"}`)}),De("mouseleave",I,V),De("touchcancel",I,V),a(w,I)},j=w=>{var I=Ua();I.__mousedown=m,I.__mouseup=N,I.__touchstart=m,I.__touchend=N;var le=o(I);{var F=A=>{var P=Sa();a(A,P)},Z=A=>{var P=pe(),M=H(P);{var X=z=>{var U=Ma();a(z,U)},G=z=>{var U=Ta(),$=o(U);{var ee=O=>{var ne=Ea();a(O,ne)},oe=O=>{var ne=Ra();a(O,ne)};E($,O=>{e(g)?O(ee):O(oe,!1)})}r(U),q(()=>He(U,"fill",e(g)?"currentColor":"none")),a(z,U)};E(M,z=>{e(C)?z(X):z(G,!1)},!0)}a(A,P)};E(le,A=>{e(f)?A(F):A(Z,!1)})}var k=s(le,2),S=o(k);{var he=A=>{var P=Re("Zapped!");a(A,P)},T=A=>{var P=pe(),M=H(P);{var X=z=>{var U=Re("Zapping...");a(z,U)},G=z=>{var U=pe(),$=H(U);{var ee=O=>{var ne=za(),ge=H(ne),_e=s(ge);{var Q=B=>{var ue=Aa(),ye=o(ue);r(ue),q(()=>ae(ye,`(${u.count??""})`)),a(B,ue)};E(_e,B=>{u.count>0&&B(Q)})}q(()=>ae(ge,`${e(d)??""} `)),a(O,ne)},oe=O=>{var ne=Re("Zap");a(O,ne)};E($,O=>{u.totalAmount>0?O(ee):O(oe,!1)},!0)}a(z,U)};E(M,z=>{e(f)?z(X):z(G,!1)},!0)}a(A,P)};E(S,A=>{e(C)?A(he):A(T,!1)})}r(k),r(I),q(()=>{I.disabled=e(f),Ee(I,1,`relative flex items-center gap-2 transition-colors group ${e(C)||e(g)?"text-yellow-400":"text-muted-foreground hover:text-yellow-400"} ${e(f)?"opacity-50 cursor-wait":""}`)}),De("mouseleave",I,V),De("touchcancel",I,V),a(w,I)};E(L,w=>{l()==="tiktok"?w(y):w(j,!1)})}var de=s(L,2);_a(de,{get event(){return t.event},onZap:v,onCancel:()=>i(p,!1),get open(){return e(p)},set open(w){i(p,w,!0)}}),a(te,Y),Ae()}Ie(["mousedown","mouseup","touchstart","touchend"]);var ja=h('<div class="absolute bottom-full mb-2 right-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),La=h('<div class="flex flex-col items-center gap-6 text-white"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><!></div> <span class="text-xs font-semibold"> </span></button> <div class="relative"><button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center"><!></div> <span class="text-xs font-semibold"> </span></button> <!></div> <button type="button" class="flex flex-col items-center gap-1 hover:scale-110 transition-transform group"><div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center text-red-400"><!></div> <span class="text-xs font-semibold"> </span></button> <!></div>'),Da=h('<div class="absolute bottom-full mb-2 left-0 bg-popover border border-border rounded-lg shadow-xl z-50 min-w-[180px] overflow-hidden"><button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3"><!> <div><div class="font-medium">Repost</div> <div class="text-xs text-muted-foreground">Share instantly</div></div></button> <button class="w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-center gap-3 border-t border-border"><!> <div><div class="font-medium">Quote</div> <div class="text-xs text-muted-foreground">Add your thoughts</div></div></button></div>'),Ia=h('<div><button type="button" class="flex items-center gap-2 hover:text-primary transition-colors group"><!> <span class="text-sm group-hover:underline"> </span></button> <div class="relative"><button type="button" class="flex items-center gap-2 hover:text-green-400 transition-colors group"><!> <span class="text-sm group-hover:underline"> </span></button> <!></div> <button type="button" class="flex items-center gap-2 hover:text-red-400 transition-colors group"><!> <span class="text-sm group-hover:underline"> </span></button> <!></div>'),Ba=h("<!> <!> <!>",1);function Fa(te,t){Te(t,!0);const l=ve(t,"variant",3,"default");let u=fe(!1),g=fe(!1),d=fe(!1);const p=ce.$subscribe(()=>({filters:[{kinds:[1,1111,6,16,7],...t.event.filter()}],subId:"interactions"})),f=D(()=>Array.from(p.events??[]).filter(y=>y.kind===1||y.kind===1111).length),C=D(()=>Array.from(p.events??[]).filter(y=>y.kind===6||y.kind===16).length),R=D(()=>Array.from(p.events??[]).filter(y=>y.kind===7).length);async function b(y){if(!ce.signer){Pe.error("Please login to react");return}try{await t.event.react(y),Pe.success("Reaction added")}catch(j){console.error("Failed to react:",j),Pe.error("Failed to add reaction")}}async function _(){if(!ce.signer){Pe.error("Please login to repost");return}try{await t.event.repost(),Pe.success("Note reposted")}catch(y){console.error("Failed to repost:",y),Pe.error("Failed to repost")}}var v=Ba(),m=H(v);{var N=y=>{var j=La(),de=o(j);de.__click=oe=>{oe.stopPropagation(),i(u,!0)};var w=o(de),I=o(w);Ue(I,{name:"message",size:"lg"}),r(w);var le=s(w,2),F=o(le,!0);r(le),r(de);var Z=s(de,2),k=o(Z);k.__click=oe=>{oe.stopPropagation(),i(d,!e(d))};var S=o(k),he=o(S);Ue(he,{name:"repost",size:"lg"}),r(S);var T=s(S,2),A=o(T,!0);r(T),r(k);var P=s(k,2);{var M=oe=>{var O=ja();O.__click=_e=>_e.stopPropagation();var ne=o(O);ne.__click=_e=>{_e.stopPropagation(),i(d,!1),_()};var ge=s(ne,2);ge.__click=_e=>{_e.stopPropagation(),i(d,!1),i(g,!0)},r(O),Ye(O,(_e,Q)=>ot?.(_e,Q),()=>()=>i(d,!1)),a(oe,O)};E(P,oe=>{e(d)&&oe(M)})}r(Z);var X=s(Z,2);X.__click=oe=>{oe.stopPropagation(),b("â¤ï¸")};var G=o(X),z=o(G);Ue(z,{name:"heart-filled",size:"lg"}),r(G);var U=s(G,2),$=o(U,!0);r(U),r(X);var ee=s(X,2);_t(ee,{get event(){return t.event},variant:"tiktok"}),r(j),q(()=>{ae(F,e(f)),ae(A,e(C)),ae($,e(R))}),a(y,j)},V=y=>{var j=Ia(),de=o(j);de.__click=U=>{U.stopPropagation(),i(u,!0)};var w=o(de);Ue(w,{name:"message",size:"md"});var I=s(w,2),le=o(I,!0);r(I),r(de);var F=s(de,2),Z=o(F);Z.__click=U=>{U.stopPropagation(),i(d,!e(d))};var k=o(Z);Ue(k,{name:"repost",size:"md"});var S=s(k,2),he=o(S,!0);r(S),r(Z);var T=s(Z,2);{var A=U=>{var $=Da();$.__click=ge=>ge.stopPropagation();var ee=o($);ee.__click=ge=>{ge.stopPropagation(),i(d,!1),_()};var oe=o(ee);Ue(oe,{name:"repost",size:"md"}),Se(2),r(ee);var O=s(ee,2);O.__click=ge=>{ge.stopPropagation(),i(d,!1),i(g,!0)};var ne=o(O);Ue(ne,{name:"message",size:"md"}),Se(2),r(O),r($),Ye($,(ge,_e)=>ot?.(ge,_e),()=>()=>i(d,!1)),a(U,$)};E(T,U=>{e(d)&&U(A)})}r(F);var P=s(F,2);P.__click=U=>{U.stopPropagation(),b("â¤ï¸")};var M=o(P);Ue(M,{name:"heart",size:"md"});var X=s(M,2),G=o(X,!0);r(X),r(P);var z=s(P,2);_t(z,{get event(){return t.event}}),r(j),q(()=>{Ee(j,1,`flex items-center gap-3 sm:gap-6 ${l()==="thread-main"?"border-t border-border pt-3":""} text-muted-foreground`),ae(le,e(f)),ae(he,e(C)),ae(G,e(R))}),a(y,j)};E(m,y=>{l()==="tiktok"?y(N):y(V,!1)})}var Y=s(m,2);xt(Y,{get replyTo(){return t.event},get open(){return e(u)},set open(y){i(u,y,!0)}});var L=s(Y,2);xt(L,{get quotedEvent(){return t.event},get open(){return e(g)},set open(y){i(g,y,!0)}}),a(te,v),Ae()}Ie(["click"]);var Za=h('<!> <div><!></div> <!> <div class="mb-2"><!></div> <!>',1);function yt(te,t){const l=ve(t,"showActions",3,!0),u=ve(t,"variant",3,"default"),g=ve(t,"showThreadLine",3,!1),d=D(()=>u()==="thread-main"?"w-14 h-14":u()==="thread-reply"?"w-10 h-10":"w-9 h-9 sm:w-12 sm:h-12"),p=D(()=>u()==="thread-main"?"text-lg leading-relaxed":"text-base"),f=D(()=>u()==="thread-main"?"text-lg font-bold":"text-base font-semibold"),C=D(()=>u()==="thread-main"?"bg-card/50":(u()==="default","hover:bg-card/30")),R=D(()=>u()==="default"||t.onNavigate!==void 0),b=D(()=>u()==="thread-main"?"full":"compact"),_=D(()=>u()==="thread-main"?"mb-2":"mb-1.5");var v=pe(),m=H(v);xe(m,()=>rt.Root,(N,V)=>{V(N,{get ndk(){return ce},get event(){return t.event},get interactive(){return e(R)},get onclick(){return t.onNavigate},get class(){return`p-3 sm:p-4 flex flex-col max-sm:max-w-screen ${e(C)??""} transition-colors min-w-0`},children:(Y,L)=>{var y=Za(),j=H(y);{var de=T=>{var A=pe(),P=H(A);xe(P,()=>rt.ThreadLine,(M,X)=>{X(M,{forceShow:!0})}),a(T,A)};E(j,T=>{g()&&T(de)})}var w=s(j,2),I=o(w);xe(I,()=>rt.Header,(T,A)=>{A(T,{get variant(){return e(b)},get avatarClass(){return e(d)},get nameClass(){return e(f)}})}),r(w);var le=s(w,2);{var F=T=>{ur(T,{get event(){return t.event}})};E(le,T=>{u()==="default"&&T(F)})}var Z=s(le,2),k=o(Z);xe(k,()=>rt.Content,(T,A)=>{A(T,{get textClass(){return e(p)}})}),r(Z);var S=s(Z,2);{var he=T=>{Fa(T,{get event(){return t.event},get variant(){return u()}})};E(S,T=>{l()&&T(he)})}q(()=>Ee(w,1,tt(e(_)))),a(Y,y)},$$slots:{default:!0}})}),a(te,v)}export{xt as C,Fa as E,yt as N,Ar as U,bt as a,Wr as u};
