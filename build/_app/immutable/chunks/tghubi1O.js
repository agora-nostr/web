import{d as ie,c as le,a as g,f as I,j as K,i as de,s as ce}from"./rzUyzf2y.js";import{p as ue,b as x,x as pe,f as me,c as fe,e as m,g as e,a as S,d as h,z as ve,r as f,t as j,s as o}from"./AsQG98fS.js";import{i as B}from"./DZKExFZC.js";import{a as O}from"./CS0aOiUg.js";import{b as he}from"./DF8Bk5Sh.js";import{b as V}from"./CkKAtl6l.js";import{N as be,c as ge}from"./BpHW1rOk.js";import{n as k}from"./tv6-RHC_.js";import{U as xe}from"./DdUskozk.js";import{B as _e}from"./DMKx7da8.js";import{t as z}from"./D7cSTCXZ.js";import{U as ye}from"./Cxhu68Im.js";var ke=I('<button type="button" class="w-7 h-7 bg-accent text-white rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-200 active:scale-90"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></button>'),we=de('<svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>'),Ue=I('<div class="flex items-center justify-between pt-2 border-t border-neutral-200 dark:border-neutral-800 opacity-100 transition-opacity duration-200"><div class="flex gap-1"><!> <!></div> <button type="button" class="px-[18px] py-2 bg-accent text-white rounded-[18px] font-semibold text-[14px] transition-all duration-150 active:scale-95 disabled:opacity-40 disabled:cursor-not-allowed"> </button></div>'),$e=I('<div class="mb-8"><div class="flex gap-2.5 items-end max-md:items-start"><!> <div class="flex-1 flex flex-col gap-2"><div><input type="file" accept="image/*" class="hidden"/> <textarea placeholder="Share your thoughts..." rows="1"></textarea> <!> <!></div></div></div></div>');function Te(W,_){ue(_,!0);let s=x(""),d=x(!1),n=x(!1),c,w,U=x(pe([]));const q=new be(k),$=ge(q);let E=x(!1);const P=S(()=>e(s).trim().length>0);async function H(){if(!(!k.$currentUser||!e(s).trim())){o(d,!0);try{const t=_.article.reply();if(t.content=e(s),await t.publish(),t.publishStatus==="error"){const i=t.publishError?.relayErrors||{},v=Object.entries(i).map(([u,b])=>`${u}: ${b}`).join(`
`);_.onError(`Failed to publish:
${v||"Unknown error"}`);return}o(s,""),o(n,!1),o(U,[],!0)}catch(t){const r=t instanceof Error?t.message:"Failed to publish comment";_.onError(r)}finally{o(d,!1)}}}function A(){o(n,!0)}function G(){setTimeout(()=>{e(s).trim()||o(n,!1)},100)}function L(){if(!c)return;c.style.height="auto";const t=Math.min(150,Math.max(20,c.scrollHeight));c.style.height=t+"px"}async function J(t){if(!t.type.startsWith("image/")){z.error("Please select an image file");return}o(E,!0);try{await $.upload(t,{fallbackServer:"https://blossom.primal.net"}),$.result?.url&&(Q($.result.url),z.success("Image uploaded"))}catch(r){console.error("Upload failed:",r),z.error("Failed to upload image")}finally{o(E,!1)}}function Q(t){const r=c;if(!r)return;const i=r.selectionStart,v=r.selectionEnd,u=`
${t}
`;o(s,e(s).slice(0,i)+u+e(s).slice(v)),setTimeout(()=>{r.selectionStart=r.selectionEnd=i+u.length,r.focus(),L()},0)}function R(t){const r=t.target,i=r.files?.[0];i&&J(i),r.value=""}function X(){w?.click()}var N=le(),Y=me(N);{var Z=t=>{var r=$e(),i=m(r),v=m(i);{let a=S(()=>e(n)?"w-9 h-9":"w-8 h-8");xe(v,{get pubkey(){return k.$currentUser.pubkey},variant:"avatar",get avatarSize(){return e(a)},class:"transition-all duration-300 max-md:mt-0.5"})}var u=h(v,2),b=m(u),C=m(b);C.__change=R,V(C,a=>w=a,()=>w);var l=h(C,2);ve(l),l.__input=L,V(l,a=>c=a,()=>c);var T=h(l,2);{var ee=a=>{var p=ke();p.__click=H,j(()=>p.disabled=e(d)),g(a,p)};B(T,a=>{e(P)&&!e(n)&&a(ee)})}var te=h(T,2);{var re=a=>{var p=Ue(),F=m(p),D=m(F);{let M=S(()=>e(d)||e(E));_e(D,{type:"button",variant:"ghost",size:"icon",onclick:X,get disabled(){return e(M)},class:"h-8 w-8",children:(se,Ee)=>{var ne=we();g(se,ne)},$$slots:{default:!0}})}var ae=h(D,2);ye(ae,{get disabled(){return e(d)},get selectedPubkeys(){return e(U)},set selectedPubkeys(M){o(U,M,!0)}}),f(F);var y=h(F,2);y.__click=H;var oe=m(y,!0);f(y),f(p),j(()=>{y.disabled=!e(P)||e(d),ce(oe,e(d)?"Posting...":"Comment")}),g(a,p)};B(te,a=>{e(n)&&a(re)})}f(b),f(u),f(i),f(r),j(()=>{O(b,1,`bg-neutral-50 dark:bg-card border border rounded-[18px] ${e(n)?"rounded-[14px] p-3":"py-2.5 px-3.5"} transition-all duration-300 ${e(n)?"border-neutral-300 dark:border-neutral-700":"border-neutral-200 dark:border-neutral-800"} flex ${e(n)?"flex-col":"items-center"} gap-2`),l.disabled=e(d),O(l,1,`w-full bg-transparent text-foreground placeholder-neutral-500 resize-none focus:outline-none text-[15px] leading-[1.4] transition-all duration-300 ${e(n)?"max-h-[150px]":"max-h-9"} overflow-hidden`)}),K("focus",l,A),K("blur",l,G),he(l,()=>e(s),a=>o(s,a)),g(t,r)};B(Y,t=>{k.$currentUser&&t(Z)})}g(W,N),fe()}ie(["change","input","click"]);export{Te as C};
