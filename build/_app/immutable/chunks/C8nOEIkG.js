import{d as ke,f as C,c as ie,a as x,s as S,i as Te,j as Fe,r as Ie}from"./rzUyzf2y.js";import{p as he,u as de,s as i,b as M,e as a,f as le,d as n,r as o,t as D,g as e,c as ye,x as Me,aJ as Ve,y as Se,z as Ke,a as pe}from"./AsQG98fS.js";import{i as R}from"./DZKExFZC.js";import{e as Ce}from"./Cztbr3Ea.js";import{a as Oe}from"./CO-nanZk.js";import{a as ne,r as xe,c as Je}from"./CS0aOiUg.js";import{b as ae}from"./DF8Bk5Sh.js";import{p as Qe}from"./w-gpJwMz.js";import{n as y,a as Ue}from"./tv6-RHC_.js";import{p as Ye}from"./DkZQAMY8.js";import{t as U}from"./D7cSTCXZ.js";import{c as se}from"./Dt3q2Svx.js";import{U as ue}from"./C-S0GgRw.js";var qe=Te('<svg class="w-3 h-3 text-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>'),Ge=C('<button><!> <div class="flex-1 min-w-0 text-left"><div class="font-medium text-foreground truncate"> </div> <div class="text-xs text-muted-foreground truncate"> </div></div> <div><!></div></button>');function He(O,r){he(r,!0);let v=M(null);de(()=>{y.fetchUser(r.pubkey).then(p=>{p?.fetchProfile().then(w=>{i(v,w,!0)})})});var c=Ge();c.__click=()=>r.onToggle(r.pubkey);var b=a(c);se(b,()=>ue.Root,(p,w)=>{w(p,{get ndk(){return y},get pubkey(){return r.pubkey},children:(A,ee)=>{var z=ie(),N=le(z);se(N,()=>ue.Avatar,(ce,ve)=>{ve(ce,{class:"w-10 h-10 flex-shrink-0"})}),x(A,z)},$$slots:{default:!0}})});var m=n(b,2),g=a(m),_=a(g,!0);o(g);var l=n(g,2),u=a(l,!0);o(l),o(m);var j=n(m,2),F=a(j);{var k=p=>{var w=qe();x(p,w)};R(F,p=>{r.isSelected&&p(k)})}o(j),o(c),D((p,w)=>{ne(c,1,`w-full flex items-center gap-3 p-3 rounded-lg transition-colors ${r.isSelected?"bg-primary/20 border border-primary/50":"bg-card border border-border hover:border-border"}`),S(_,p),S(u,w),ne(j,1,`w-5 h-5 rounded border-2 flex items-center justify-center ${r.isSelected?"bg-primary border-primary":"border"}`)},[()=>e(v)?.displayName||e(v)?.name||`${r.pubkey.slice(0,8)}...`,()=>e(v)?.nip05||`${r.pubkey.slice(0,16)}...`]),x(O,c),ye()}ke(["click"]);var We=C('<div class="flex items-center gap-3 p-2 rounded-lg bg-card/50"><!> <div class="flex-1 min-w-0"><div class="text-sm font-medium text-foreground truncate"> </div> <div class="text-xs text-muted-foreground truncate"> </div></div> <button class="p-1 text-muted-foreground hover:text-red-500 transition-colors" aria-label="Remove member"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>');function Xe(O,r){he(r,!0);let v=M(null);de(()=>{y.fetchUser(r.pubkey).then(F=>{F?.fetchProfile().then(k=>{i(v,k,!0)})})});var c=We(),b=a(c);se(b,()=>ue.Root,(F,k)=>{k(F,{get ndk(){return y},get pubkey(){return r.pubkey},children:(p,w)=>{var A=ie(),ee=le(A);se(ee,()=>ue.Avatar,(z,N)=>{N(z,{class:"w-8 h-8 flex-shrink-0"})}),x(p,A)},$$slots:{default:!0}})});var m=n(b,2),g=a(m),_=a(g,!0);o(g);var l=n(g,2),u=a(l,!0);o(l),o(m);var j=n(m,2);j.__click=()=>r.onRemove(r.pubkey),o(c),D((F,k)=>{S(_,F),S(u,k)},[()=>e(v)?.displayName||e(v)?.name||`${r.pubkey.slice(0,8)}...`,()=>e(v)?.nip05||`${r.pubkey.slice(0,16)}...`]),x(O,c),ye()}ke(["click"]);var Ze=C('<div class="mt-3 rounded-lg overflow-hidden border border-border"><img alt="Preview" class="w-full h-48 object-cover"/></div>'),$e=C('<div class="space-y-5"><div><label class="block text-sm font-medium text-muted-foreground mb-2">Cover Image URL (optional)</label> <input type="url" placeholder="https://example.com/image.jpg" class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors"/> <!></div> <div><label class="block text-sm font-medium text-muted-foreground mb-2">Title <span class="text-red-500">*</span></label> <input type="text" placeholder="e.g., Bitcoin Developers" class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors" maxlength="100"/></div> <div><label class="block text-sm font-medium text-muted-foreground mb-2">Description (optional)</label> <textarea placeholder="Describe what this follow pack is about..." class="w-full px-4 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors resize-none" rows="4" maxlength="500"></textarea> <p class="text-xs text-muted-foreground mt-1"> </p></div></div>'),er=C('<button class="absolute right-2 top-1/2 -translate-y-1/2 px-3 py-1.5 bg-primary hover:bg-accent-dark text-foreground rounded text-sm font-medium transition-colors">Add</button>'),rr=C('<div class="text-center py-8 text-muted-foreground text-sm"> </div>'),tr=C('<div class="bg-muted/50 rounded-lg p-4 border border-border"><div class="text-sm font-medium text-muted-foreground mb-3"> </div> <div class="space-y-2 max-h-48 overflow-y-auto"></div></div>'),or=C('<div class="space-y-4"><div><label class="block text-sm font-medium text-muted-foreground mb-2">Add members</label> <div class="relative"><svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search follows or enter npub/NIP-05..." class="w-full pl-10 pr-20 py-3 bg-muted border border-border rounded-lg text-foreground placeholder:text-muted-foreground focus:outline-none focus:border-primary transition-colors"/> <!></div> <p class="text-xs text-muted-foreground mt-1.5">Search your follows by name, or paste an npub/NIP-05 to add anyone</p></div> <div><div class="max-h-96 overflow-y-auto space-y-2 bg-muted/30 rounded-lg p-2 border border-border"><!></div></div> <!></div>'),ar=C('<div class="fixed inset-0 z-50 flex items-start justify-center bg-background/80 backdrop-blur-sm overflow-y-auto py-8" role="presentation"><div class="w-full max-w-3xl mx-4 bg-card rounded-2xl border border-border shadow-2xl my-auto" role="dialog" aria-modal="true"><div class="flex items-center justify-between px-6 py-4 border-b border-border"><div class="flex items-center gap-3"><button class="text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50" aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> <h2 class="text-xl font-bold text-foreground flex items-center gap-2"><svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg> </h2></div> <button class="px-5 py-2.5 bg-primary hover:bg-accent-dark disabled:bg-muted disabled:cursor-not-allowed text-foreground rounded-lg transition-colors font-semibold text-sm"> </button></div> <div class="flex border-b border-border"><button>Details</button> <button> </button></div> <div class="p-6"><!></div> <div class="px-6 py-4 border-t border-border bg-card/50"><p class="text-xs text-muted-foreground">Press <kbd class="px-1.5 py-0.5 bg-muted rounded text-muted-foreground">Esc</kbd> to cancel</p></div></div></div>');function xr(O,r){he(r,!0);let v=Qe(r,"open",15,!1),c=M("details"),b=M(!1),m=M(""),g=M(""),_=M(""),l=M(Me(new Set(r.initialPubkey?[r.initialPubkey]:[]))),u=M("");const j=y.$subscribe(()=>y.$currentUser?.pubkey?{filters:[{kinds:[3],authors:[y.$currentUser.pubkey],limit:1}],bufferMs:100}:void 0),F=pe(()=>{const t=j.events[0];return t?new Set(t.tags.filter(d=>d[0]==="p").map(d=>d[1])):new Set});let k=M(Me(new Map));const p=pe(()=>e(u)?Array.from(e(k).entries()).filter(([d])=>e(F).has(d)).map(([d])=>d):Array.from(e(F)));de(()=>{if(!e(u).trim()||!y.cacheAdapter?.getProfiles){i(k,new Map,!0);return}const t=e(u).toLowerCase();y.cacheAdapter.getProfiles({fields:["name","displayName","nip05"],contains:t}).then(d=>{i(k,d??new Map,!0)}).catch(d=>{console.error("Failed to search profiles:",d),i(k,new Map,!0)})});function w(t){e(l).has(t)?e(l).delete(t):e(l).add(t),i(l,new Set(e(l)),!0)}async function A(){if(e(u).trim())try{const t=e(u).trim();let d=await y.fetchUser(t);!d&&t.includes("@")&&(d=await y.fetchUser(t)),d?.pubkey?(e(l).add(d.pubkey),i(l,new Set(e(l)),!0),i(u,""),U.success("User added")):U.error("User not found")}catch(t){console.error("Failed to fetch user:",t),U.error("Failed to fetch user")}}async function ee(){if(!e(m).trim()||e(b)){U.error("Please provide a title");return}if(e(l).size===0){U.error("Please add at least one member");return}try{i(b,!0);const t=r.editingPack?Ue.from(r.editingPack):new Ue(y);if(t.title=e(m).trim(),t.description=e(g).trim()||void 0,t.image=e(_).trim()||void 0,t.pubkeys=Array.from(e(l)),await t.sign(),await t.publishReplaceable(),t.publishStatus==="error"){const T=t.publishError?.relayErrors||{},J=Object.entries(T).map(([Q,Y])=>`${Q}: ${Y}`).join(`
`);U.error(`Failed to publish:
${J||"Unknown error"}`);return}U.success(r.editingPack?"Follow pack updated":"Follow pack created"),z(),v(!1),r.onClose?.()}catch(t){console.error("Failed to publish follow pack:",t),U.error(`${r.editingPack?"Failed to update":"Failed to create"} follow pack: ${t instanceof Error?t.message:"Unknown error"}`)}finally{i(b,!1)}}function z(){i(m,""),i(g,""),i(_,""),i(l,new Set(r.initialPubkey?[r.initialPubkey]:[]),!0),i(u,""),i(c,"details")}function N(){e(b)||(z(),v(!1),r.onClose?.())}function ce(t){t.target===t.currentTarget&&N()}function ve(t){t.key==="Escape"&&!e(b)&&N()}de(()=>{if(v()&&r.editingPack){i(m,r.editingPack.tagValue("title")||"",!0),i(g,r.editingPack.tagValue("description")||"",!0),i(_,r.editingPack.tagValue("image")||"",!0);const t=r.editingPack.tags.filter(d=>d[0]==="p").map(d=>d[1]);i(l,new Set(t),!0),i(c,"details")}else v()&&r.initialPubkey&&i(l,new Set([r.initialPubkey]),!0)});var _e=ie();Fe("keydown",Ve,ve);var je=le(_e);{var Ae=t=>{var d=ar();d.__click=ce;var T=a(d);T.__click=h=>h.stopPropagation();var J=a(T),Q=a(J),Y=a(Q);Y.__click=N;var we=n(Y,2),ze=n(a(we));o(we),o(Q);var re=n(Q,2);re.__click=ee;var Ne=a(re,!0);o(re),o(J);var me=n(J,2),fe=a(me);fe.__click=()=>i(c,"details");var te=n(fe,2);te.__click=()=>i(c,"members");var Be=a(te);o(te),o(me);var Pe=n(me,2),Ee=a(Pe);{var Le=h=>{var B=$e(),E=a(B),I=n(a(E),2);xe(I);var V=n(I,2);{var be=P=>{var W=Ze(),s=a(W);o(W),D(()=>Je(s,"src",e(_))),Fe("error",s,f=>f.currentTarget.style.display="none"),Ie(s),x(P,W)};R(V,P=>{e(_).trim()&&P(be)})}o(E);var q=n(E,2),K=n(a(q),2);xe(K),o(q);var G=n(q,2),H=n(a(G),2);Ke(H);var oe=n(H,2),ge=a(oe);o(oe),o(G),o(B),D(()=>S(ge,`${e(g).length??""}/500 characters`)),ae(I,()=>e(_),P=>i(_,P)),ae(K,()=>e(m),P=>i(m,P)),ae(H,()=>e(g),P=>i(g,P)),x(h,B)},Re=h=>{var B=or(),E=a(B),I=n(a(E),2),V=n(a(I),2);xe(V),V.__keydown=s=>{s.key==="Enter"&&e(u).trim()&&A()};var be=n(V,2);{var q=s=>{var f=er();f.__click=A,x(s,f)};R(be,s=>{e(u).trim()&&(e(u).includes("npub1")||e(u).includes("@"))&&s(q)})}o(I),Se(2),o(E);var K=n(E,2),G=a(K),H=a(G);{var oe=s=>{var f=rr(),L=a(f,!0);o(f),D(()=>S(L,e(u)?"No matches found":"You don't follow anyone yet")),x(s,f)},ge=s=>{var f=ie(),L=le(f);Ce(L,16,()=>e(p),X=>X,(X,Z)=>{{let $=pe(()=>e(l).has(Z));He(X,{get pubkey(){return Z},get isSelected(){return e($)},onToggle:w})}}),x(s,f)};R(H,s=>{e(p).length===0?s(oe):s(ge,!1)})}o(G),o(K);var P=n(K,2);{var W=s=>{var f=tr(),L=a(f),X=a(L);o(L);var Z=n(L,2);Ce(Z,20,()=>Array.from(e(l)),$=>$,($,De)=>{Xe($,{get pubkey(){return De},onRemove:w})}),o(Z),o(f),D(()=>S(X,`Selected Members (${e(l).size??""})`)),x(s,f)};R(P,s=>{e(l).size>0&&s(W)})}o(B),ae(V,()=>e(u),s=>i(u,s)),x(h,B)};R(Ee,h=>{e(c)==="details"?h(Le):h(Re,!1)})}o(Pe),Se(2),o(T),o(d),Oe(d,h=>Ye?.(h)),D(h=>{Y.disabled=e(b),S(ze,` ${r.editingPack?"Edit Follow Pack":"Create Follow Pack"}`),re.disabled=h,S(Ne,e(b)?r.editingPack?"Updating...":"Creating...":r.editingPack?"Update Pack":"Create Pack"),ne(fe,1,`flex-1 px-6 py-3 font-medium transition-colors ${e(c)==="details"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-muted-foreground"}`),ne(te,1,`flex-1 px-6 py-3 font-medium transition-colors ${e(c)==="members"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-muted-foreground"}`),S(Be,`Members (${e(l).size??""})`)},[()=>!e(m).trim()||e(l).size===0||e(b)]),x(t,d)};R(je,t=>{v()&&t(Ae)})}x(O,_e),ye()}ke(["click","keydown"]);export{xr as C};
