import{c as i,a as n,f as A,s as me,t as Fe}from"./rzUyzf2y.js";import{b as te,g as e,s as R,p as Oe,B as Ne,aO as Se,a as x,u as Ue,f as l,c as He,t as w,e as Me,r as pe}from"./AsQG98fS.js";import{i as f}from"./DZKExFZC.js";import{e as Te,i as Ie}from"./Cztbr3Ea.js";import{c as ee}from"./Dt3q2Svx.js";import{a as ze,c as $}from"./CS0aOiUg.js";import{p as Ke}from"./w-gpJwMz.js";import{C as Le}from"./tv6-RHC_.js";const Ye={EMOJI_SHORTCODE:/:([a-zA-Z0-9_]+):/g,NOSTR_URI:/nostr:(npub1[a-z0-9]{58}|nprofile1[a-z0-9]+|note1[a-z0-9]{58}|nevent1[a-z0-9]+|naddr1[a-z0-9]+)/gi,HASHTAG:/(^|\s)#([a-zA-Z0-9_\u0080-\uFFFF]+)(?=\s|$|[^\w])/g,MEDIA_FILE:/https?:\/\/[^\s<>"]+\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|mov)(\?[^\s<>"]*)?/gi,YOUTUBE:/https?:\/\/(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})[^\s<>"]*/gi,URL:/https?:\/\/[^\s<>"]+/gi};function Re(a){const t=new Map;if(!Array.isArray(a))return console.warn("[buildEmojiMap] Expected tags to be an array, got:",typeof a),t;for(const[r,d,s]of a)r==="emoji"&&d&&s&&t.set(d,s);return t}function De(a,t){const r=t.get(a);return r?{type:"emoji",content:a,data:r}:{type:"text",content:`:${a}:`}}function qe(a){try{const t=a.substring(0,a.indexOf("1")+1);if(Le.decode(a),t==="npub1")return{type:"npub",content:a,data:a};if(t==="nprofile1")return{type:"nprofile",content:a,data:a};if(t==="note1"||t==="nevent1"||t==="naddr1")return{type:"event-ref",content:a,data:a}}catch{console.warn("[EventContent] Failed to decode Nostr URI:",a)}return{type:"text",content:`nostr:${a}`}}function We(a){return/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i.test(a)}function Ge(a){return/\.(mp4|webm|mov)(\?|$)/i.test(a)}function Je(a){return/youtube\.com|youtu\.be/i.test(a)}function Pe(a,t){const r=a.match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(r){const[,d,s]=r;return d?{type:"hashtag",content:s,data:s}:{type:"hashtag",content:s,data:s}}if(a.startsWith(":")&&a.endsWith(":")){const d=a.slice(1,-1);return De(d,t)}return a.startsWith("nostr:")?qe(a.slice(6)):We(a)||Ge(a)||Je(a)?{type:"media",content:a}:a.startsWith("http")?{type:"link",content:a}:{type:"text",content:a}}function Ve(a){const t=[];for(const r of Object.values(Ye)){r.lastIndex=0;let d=r.exec(a);for(;d!==null;)t.push({match:d,index:d.index}),d=r.exec(a)}return t.sort((r,d)=>r.index-d.index)}function Xe(a,t){const r=[],d=Ve(a);let s=0;for(const{match:p,index:c}of d)if(!(c<s)){if(c>s&&r.push({type:"text",content:a.slice(s,c)}),p[0].match(/^\s?#[a-zA-Z0-9_\u0080-\uFFFF]+$/)){const K=p[0].match(/^(\s)?#([a-zA-Z0-9_\u0080-\uFFFF]+)$/);if(K){const[,o,U]=K;o&&r.push({type:"text",content:o}),r.push({type:"hashtag",content:U,data:U})}}else r.push(Pe(p[0],t));s=c+p[0].length}return s<a.length&&r.push({type:"text",content:a.slice(s)}),r}function Ze(a){return/^\s*$/.test(a)}function Qe(a){const t=[];let r=[],d=[];function s(){r.length!==0&&(r.length===1?t.push({type:"media",content:r[0]}):t.push({type:"image-grid",content:"",data:r}),r=[],d=[])}function p(){for(const c of d)t.push(c);d=[]}for(const c of a)c.type==="media"&&We(c.content)?r.push(c.content):c.type==="text"&&Ze(c.content)&&r.length>0?d.push(c):(s(),p(),t.push(c));return s(),t}function $e(a){const t=[];let r=[],d=[];function s(){r.length!==0&&(r.length===1?t.push({type:"link",content:r[0]}):t.push({type:"link-group",content:"",data:r}),r=[],d=[])}function p(){for(const c of d)t.push(c);d=[]}for(const c of a)c.type==="link"?r.push(c.content):c.type==="text"&&Ze(c.content)&&r.length>0?d.push(c):(s(),p(),t.push(c));return s(),t}function et(a){return{get segments(){const t=String(a().event?.content??a().content??""),r=a().event,d=r?.tags&&Array.isArray(r.tags)?r.tags.filter(K=>K[0]==="emoji"):a().emojiTags??[],s=Re(d),p=Xe(t,s),c=Qe(p);return $e(c)},get content(){return String(a().event?.content??a().content??"").trim()},get emojiMap(){const t=a().event,r=t?.tags&&Array.isArray(t.tags)?t.tags.filter(d=>d[0]==="emoji"):a().emojiTags??[];return Re(r)}}}class tt{#e=te(null);get mentionComponent(){return e(this.#e)}set mentionComponent(t){R(this.#e,t,!0)}#t=te(null);get hashtagComponent(){return e(this.#t)}set hashtagComponent(t){R(this.#t,t,!0)}#a=te(null);get linkComponent(){return e(this.#a)}set linkComponent(t){R(this.#a,t,!0)}#n=te(null);get mediaComponent(){return e(this.#n)}set mediaComponent(t){R(this.#n,t,!0)}#r=te(null);get fallbackComponent(){return e(this.#r)}set fallbackComponent(t){R(this.#r,t,!0)}handlers=new Map;addKind(t,r){if(Array.isArray(t))for(const d of t)this.handlers.set(d,{component:r,wrapper:null});else{const d=t.kinds||[],s=t.from?t:null;for(const p of d)this.handlers.set(p,{component:r,wrapper:s})}}getKindHandler(t){if(t!==void 0)return this.handlers.get(t)}hasKindHandler(t){return t===void 0?!1:this.handlers.has(t)}getRegisteredKinds(){return Array.from(this.handlers.keys()).sort((t,r)=>t-r)}clear(){this.handlers.clear(),this.mentionComponent=null,this.hashtagComponent=null,this.linkComponent=null,this.mediaComponent=null,this.fallbackComponent=null}}const Be=new tt,xe=Symbol("content-renderer");var at=A('<div><div class="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"></div> <span>Loading event...</span></div>'),nt=A("<div><span>Failed to load event</span></div>"),rt=A("<code> </code>");function ot(a,t){Oe(t,!0);let r=Ke(t,"class",3,"");const d=Ne(xe),s=x(()=>t.renderer??d?.renderer??Be);Se(xe,{get renderer(){return e(s)}});let p=te(void 0),c=te(!0),K=te(void 0);Ue(()=>{R(c,!0),R(K,void 0),R(p,void 0),t.ndk.fetchEvent(t.bech32).then(F=>{R(p,F??void 0,!0),R(c,!1)}).catch(F=>{R(K,F,!0),R(c,!1)})});const o=x(()=>({event:e(p),loading:e(c),error:e(K)}));let U=x(()=>e(s).getKindHandler(e(o).event?.kind)),Ce=x(()=>e(U)?.component),ke=x(()=>e(s).fallbackComponent),ae=x(()=>e(o).event&&e(U)?.wrapper?.from?e(U).wrapper.from(e(o).event):e(o).event);var L=i(),ne=l(L);{var je=F=>{var T=at();w(()=>ze(T,1,`flex items-center gap-2 p-3 rounded-lg border border-border bg-muted text-sm ${r()??""}`)),n(F,T)},Ee=F=>{var T=i(),re=l(T);{var he=I=>{var g=nt();w(()=>ze(g,1,`p-3 rounded-lg border border-border bg-muted text-sm text-destructive ${r()??""}`)),n(I,g)},ge=I=>{var g=i(),Y=l(g);{var oe=v=>{var h=i(),M=l(h);ee(M,()=>e(Ce),(D,q)=>{q(D,{get ndk(){return t.ndk},get event(){return e(ae)}})}),n(v,h)},se=v=>{var h=i(),M=l(h);{var D=C=>{var _=i(),O=l(_);ee(O,()=>e(ke),(G,N)=>{N(G,{get ndk(){return t.ndk},get event(){return e(ae)},get class(){return r()}})}),n(C,_)},q=C=>{var _=i(),O=l(_);{var G=N=>{var k=rt(),u=Me(k,!0);pe(k),w(()=>me(u,t.bech32)),n(N,k)};f(O,N=>{e(ae)&&N(G)},!0)}n(C,_)};f(M,C=>{e(ke)&&e(ae)?C(D):C(q,!1)},!0)}n(v,h)};f(Y,v=>{e(Ce)&&e(ae)?v(oe):v(se,!1)},!0)}n(I,g)};f(re,I=>{e(o).error?I(he):I(ge,!1)},!0)}n(F,T)};f(ne,F=>{e(o).loading?F(je):F(Ee,!1)})}n(a,L),He()}var st=A('<a target="_blank" rel="noopener noreferrer" class="text-primary underline break-all hover:opacity-80"> </a>'),it=A('<img alt="" class="max-w-full h-auto rounded-lg my-2"/>'),lt=A('<video controls class="max-w-full rounded-lg my-2"></video>',2),dt=A('<iframe title="YouTube video" class="w-full aspect-video rounded-lg my-2" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>'),ct=A('<img class="inline-block w-[1.25em] h-[1.25em] align-middle mx-[0.1em]"/>'),ft=A('<img alt="" class="w-full h-auto object-cover rounded-lg aspect-square"/>'),ut=A('<div class="grid grid-cols-[repeat(auto-fit,minmax(200px,1fr))] gap-2 my-2"></div>'),vt=A('<a target="_blank" rel="noopener noreferrer" class="text-primary underline break-all hover:opacity-80"> </a>'),mt=A('<div class="flex flex-col gap-1 my-2"></div>'),pt=A("<div></div>");function xt(a,t){Oe(t,!0);let r=Ke(t,"class",3,"");const d=Ne(xe),s=x(()=>t.renderer??d?.renderer??Be);Se(xe,{get renderer(){return e(s)}});const p=et(()=>({event:t.event,content:t.content,emojiTags:t.emojiTags}));var c=pt();Te(c,21,()=>p.segments,Ie,(K,o)=>{var U=i(),Ce=l(U);{var ke=L=>{var ne=Fe();w(()=>me(ne,e(o).content)),n(L,ne)},ae=L=>{var ne=i(),je=l(ne);{var Ee=T=>{var re=i(),he=l(re);{var ge=I=>{var g=i(),Y=l(g);{var oe=v=>{const h=x(()=>e(s).mentionComponent);var M=i(),D=l(M);ee(D,()=>e(h),(q,C)=>{C(q,{get ndk(){return t.ndk},get bech32(){return e(o).data}})}),n(v,M)},se=v=>{var h=Fe();w(()=>me(h,e(o).content)),n(v,h)};f(Y,v=>{e(s).mentionComponent?v(oe):v(se,!1)})}n(I,g)};f(he,I=>{e(o).data&&typeof e(o).data=="string"&&I(ge)})}n(T,re)},F=T=>{var re=i(),he=l(re);{var ge=g=>{var Y=i(),oe=l(Y);{var se=v=>{ot(v,{get ndk(){return t.ndk},get bech32(){return e(o).data}})};f(oe,v=>{e(o).data&&typeof e(o).data=="string"&&v(se)})}n(g,Y)},I=g=>{var Y=i(),oe=l(Y);{var se=h=>{var M=i(),D=l(M);{var q=C=>{var _=i(),O=l(_);{var G=k=>{const u=x(()=>e(s).hashtagComponent);var y=i(),W=l(y);ee(W,()=>e(u),(ie,le)=>{le(ie,{get ndk(){return t.ndk},get tag(){return e(o).data}})}),n(k,y)},N=k=>{var u=Fe();w(()=>me(u,`#${e(o).data??""}`)),n(k,u)};f(O,k=>{e(s).hashtagComponent?k(G):k(N,!1)})}n(C,_)};f(D,C=>{e(o).data&&typeof e(o).data=="string"&&C(q)})}n(h,M)},v=h=>{var M=i(),D=l(M);{var q=_=>{var O=i(),G=l(O);{var N=u=>{const y=x(()=>e(s).linkComponent);var W=i(),ie=l(W);ee(ie,()=>e(y),(le,b)=>{b(le,{get url(){return e(o).content}})}),n(u,W)},k=u=>{var y=st(),W=Me(y,!0);pe(y),w(()=>{$(y,"href",e(o).content),me(W,e(o).content)}),n(u,y)};f(G,u=>{e(s).linkComponent?u(N):u(k,!1)})}n(_,O)},C=_=>{var O=i(),G=l(O);{var N=u=>{var y=i(),W=l(y);{var ie=b=>{const Z=x(()=>e(s).mediaComponent);var Q=i(),de=l(Q);ee(de,()=>e(Z),(J,m)=>{m(J,{get url(){return e(o).content}})}),n(b,Q)},le=b=>{var Z=i(),Q=l(Z);{var de=m=>{var S=it();w(()=>$(S,"src",e(o).content)),n(m,S)},J=m=>{var S=i(),_e=l(S);{var ye=z=>{var V=lt();w(()=>$(V,"src",e(o).content)),n(z,V)},P=z=>{var V=i(),be=l(V);{var ce=j=>{const B=x(()=>e(o).content.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/)?.[1]);var X=i(),fe=l(X);{var E=H=>{var ue=dt();w(()=>$(ue,"src",`https://www.youtube.com/embed/${e(B)??""}`)),n(H,ue)};f(fe,H=>{e(B)&&H(E)})}n(j,X)};f(be,j=>{e(o).content.match(/youtube\.com|youtu\.be/i)&&j(ce)},!0)}n(z,V)};f(_e,z=>{e(o).content.match(/\.(mp4|webm|mov)(\?|$)/i)?z(ye):z(P,!1)},!0)}n(m,S)};f(Q,m=>{e(o).content.match(/\.(jpg|jpeg|png|gif|webp|svg)(\?|$)/i)?m(de):m(J,!1)})}n(b,Z)};f(W,b=>{e(s).mediaComponent?b(ie):b(le,!1)})}n(u,y)},k=u=>{var y=i(),W=l(y);{var ie=b=>{var Z=i(),Q=l(Z);{var de=J=>{var m=ct();w(()=>{$(m,"src",e(o).data),$(m,"alt",`:${e(o).content??""}:`)}),n(J,m)};f(Q,J=>{typeof e(o).data=="string"&&J(de)})}n(b,Z)},le=b=>{var Z=i(),Q=l(Z);{var de=m=>{var S=i(),_e=l(S);{var ye=P=>{var z=i(),V=l(z);{var be=j=>{const B=x(()=>e(s).mediaComponent);var X=i(),fe=l(X);ee(fe,()=>e(B),(E,H)=>{H(E,{get url(){return e(o).data}})}),n(j,X)},ce=j=>{var B=ut();Te(B,21,()=>e(o).data,Ie,(X,fe)=>{var E=ft();w(()=>$(E,"src",e(fe))),n(X,E)}),pe(B),n(j,B)};f(V,j=>{e(s).mediaComponent?j(be):j(ce,!1)})}n(P,z)};f(_e,P=>{e(o).data&&Array.isArray(e(o).data)&&P(ye)})}n(m,S)},J=m=>{var S=i(),_e=l(S);{var ye=P=>{var z=i(),V=l(z);{var be=ce=>{var j=i(),B=l(j);{var X=E=>{const H=x(()=>e(s).linkComponent);var ue=i(),we=l(ue);ee(we,()=>e(H),(ve,Ae)=>{Ae(ve,{get url(){return e(o).data}})}),n(E,ue)},fe=E=>{var H=mt();Te(H,21,()=>e(o).data,Ie,(ue,we)=>{var ve=vt(),Ae=Me(ve,!0);pe(ve),w(()=>{$(ve,"href",e(we)),me(Ae,e(we))}),n(ue,ve)}),pe(H),n(E,H)};f(B,E=>{e(s).linkComponent?E(X):E(fe,!1)})}n(ce,j)};f(V,ce=>{e(o).data&&Array.isArray(e(o).data)&&ce(be)})}n(P,z)};f(_e,P=>{e(o).type==="link-group"&&P(ye)},!0)}n(m,S)};f(Q,m=>{e(o).type==="image-grid"?m(de):m(J,!1)},!0)}n(b,Z)};f(W,b=>{e(o).type==="emoji"?b(ie):b(le,!1)},!0)}n(u,y)};f(G,u=>{e(o).type==="media"?u(N):u(k,!1)},!0)}n(_,O)};f(D,_=>{e(o).type==="link"?_(q):_(C,!1)},!0)}n(h,M)};f(oe,h=>{e(o).type==="hashtag"?h(se):h(v,!1)},!0)}n(g,Y)};f(he,g=>{e(o).type==="event-ref"?g(ge):g(I,!1)},!0)}n(T,re)};f(je,T=>{e(o).type==="npub"||e(o).type==="nprofile"?T(Ee):T(F,!1)},!0)}n(L,ne)};f(Ce,L=>{e(o).type==="text"?L(ke):L(ae,!1)})}n(K,U)}),pe(c),w(()=>ze(c,1,`whitespace-pre-wrap wrap-break-words leading-relaxed ${r()??""}`)),n(a,c),He()}export{xe as C,xt as E};
